$PBExportHeader$w_music_composer_fingering.srw
forward
global type w_music_composer_fingering from window
end type
type cbx_phrase_op_indicator from checkbox within w_music_composer_fingering
end type
type cbx_define_phrase from checkbox within w_music_composer_fingering
end type
type cb_mk_entry from commandbutton within w_music_composer_fingering
end type
type cbx_image_lib from checkbox within w_music_composer_fingering
end type
type cb_28 from commandbutton within w_music_composer_fingering
end type
type cb_21 from commandbutton within w_music_composer_fingering
end type
type cb_22 from commandbutton within w_music_composer_fingering
end type
type cb_compile_lesson from commandbutton within w_music_composer_fingering
end type
type cb_18 from commandbutton within w_music_composer_fingering
end type
type cb_populate_loudness from commandbutton within w_music_composer_fingering
end type
type sle_note_char_to from singlelineedit within w_music_composer_fingering
end type
type sle_note_char_from from singlelineedit within w_music_composer_fingering
end type
type cb_17 from commandbutton within w_music_composer_fingering
end type
type cb_16 from commandbutton within w_music_composer_fingering
end type
type cb_7 from commandbutton within w_music_composer_fingering
end type
type pb_16 from picturebutton within w_music_composer_fingering
end type
type cbx_key_only from checkbox within w_music_composer_fingering
end type
type cb_play_notes from commandbutton within w_music_composer_fingering
end type
type st_19 from statictext within w_music_composer_fingering
end type
type st_18 from statictext within w_music_composer_fingering
end type
type st_17 from statictext within w_music_composer_fingering
end type
type sle_right_volume from singlelineedit within w_music_composer_fingering
end type
type sle_left_volume from singlelineedit within w_music_composer_fingering
end type
type cbx_delete_tmp_img from checkbox within w_music_composer_fingering
end type
type cbx_replace from checkbox within w_music_composer_fingering
end type
type cbx_entry from checkbox within w_music_composer_fingering
end type
type cbx_note from checkbox within w_music_composer_fingering
end type
type cbx_fingering from checkbox within w_music_composer_fingering
end type
type cb_batch_copy from commandbutton within w_music_composer_fingering
end type
type sle_dest_from from singlelineedit within w_music_composer_fingering
end type
type sle_source_to from singlelineedit within w_music_composer_fingering
end type
type sle_source_from from singlelineedit within w_music_composer_fingering
end type
type cb_15 from commandbutton within w_music_composer_fingering
end type
type cb_save_project from commandbutton within w_music_composer_fingering
end type
type cb_browse_project from commandbutton within w_music_composer_fingering
end type
type sle_project_file from singlelineedit within w_music_composer_fingering
end type
type st_16 from statictext within w_music_composer_fingering
end type
type cb_reload_library from commandbutton within w_music_composer_fingering
end type
type sle_tempo from singlelineedit within w_music_composer_fingering
end type
type cbx_mix_image from checkbox within w_music_composer_fingering
end type
type cbx_view_image from checkbox within w_music_composer_fingering
end type
type cbx_activate_animation from checkbox within w_music_composer_fingering
end type
type cbx_1 from checkbox within w_music_composer_fingering
end type
type cb_27 from commandbutton within w_music_composer_fingering
end type
type st_15 from statictext within w_music_composer_fingering
end type
type sle_h_inc from singlelineedit within w_music_composer_fingering
end type
type sle_w_inc from singlelineedit within w_music_composer_fingering
end type
type sle_y_inc from singlelineedit within w_music_composer_fingering
end type
type sle_x_inc from singlelineedit within w_music_composer_fingering
end type
type sle_3 from singlelineedit within w_music_composer_fingering
end type
type pb_15 from picturebutton within w_music_composer_fingering
end type
type pb_14 from picturebutton within w_music_composer_fingering
end type
type pb_13 from picturebutton within w_music_composer_fingering
end type
type pb_12 from picturebutton within w_music_composer_fingering
end type
type pb_11 from picturebutton within w_music_composer_fingering
end type
type pb_10 from picturebutton within w_music_composer_fingering
end type
type pb_9 from picturebutton within w_music_composer_fingering
end type
type pb_8 from picturebutton within w_music_composer_fingering
end type
type pb_7 from picturebutton within w_music_composer_fingering
end type
type pb_6 from picturebutton within w_music_composer_fingering
end type
type st_14 from statictext within w_music_composer_fingering
end type
type cb_26 from commandbutton within w_music_composer_fingering
end type
type cb_25 from commandbutton within w_music_composer_fingering
end type
type cb_24 from commandbutton within w_music_composer_fingering
end type
type cb_23 from commandbutton within w_music_composer_fingering
end type
type sle_dest_lib from singlelineedit within w_music_composer_fingering
end type
type cb_input_lib from commandbutton within w_music_composer_fingering
end type
type cb_20 from commandbutton within w_music_composer_fingering
end type
type sle_source_lib from singlelineedit within w_music_composer_fingering
end type
type cb_19 from commandbutton within w_music_composer_fingering
end type
type cb_delete_row from commandbutton within w_music_composer_fingering
end type
type cb_get_list from commandbutton within w_music_composer_fingering
end type
type cb_dup_row from commandbutton within w_music_composer_fingering
end type
type cb_capture_image from commandbutton within w_music_composer_fingering
end type
type pb_5 from picturebutton within w_music_composer_fingering
end type
type cb_6 from commandbutton within w_music_composer_fingering
end type
type sle_dw_path from singlelineedit within w_music_composer_fingering
end type
type cb_get_time from commandbutton within w_music_composer_fingering
end type
type pb_4 from picturebutton within w_music_composer_fingering
end type
type pb_3 from picturebutton within w_music_composer_fingering
end type
type cbx_note_on from checkbox within w_music_composer_fingering
end type
type cb_restore_dw from commandbutton within w_music_composer_fingering
end type
type cb_save_dw from commandbutton within w_music_composer_fingering
end type
type cb_copy_to_dw from commandbutton within w_music_composer_fingering
end type
type cb_copy_from_dw from commandbutton within w_music_composer_fingering
end type
type cbx_dw_visible from checkbox within w_music_composer_fingering
end type
type cb_13 from commandbutton within w_music_composer_fingering
end type
type ddlb_note_level_range_max from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_note_name_range_max from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_note_level_range_min from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_note_name_range_min from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_name_5 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_level_5 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_name_4 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_level_4 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_name_3 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_level_3 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_name_2 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_level_2 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_name_1 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_note_level_1 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_name_5 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_level_5 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_name_4 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_level_4 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_name_3 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_level_3 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_name_2 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_level_2 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_level_1 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_note_name_1 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_5 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_4 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_3 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_2 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_rh_1 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_5 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_4 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_3 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_2 from dropdownlistbox within w_music_composer_fingering
end type
type ddlb_lh_1 from dropdownlistbox within w_music_composer_fingering
end type
type cb_finger_attr_default from commandbutton within w_music_composer_fingering
end type
type cb_12 from commandbutton within w_music_composer_fingering
end type
type uo_1 from uo_music_container_dummy_fingering within w_music_composer_fingering
end type
type cb_append_clear from commandbutton within w_music_composer_fingering
end type
type cb_append_repeat from commandbutton within w_music_composer_fingering
end type
type cbx_all_finger from checkbox within w_music_composer_fingering
end type
type cb_play_note from commandbutton within w_music_composer_fingering
end type
type cb_4 from commandbutton within w_music_composer_fingering
end type
type cbx_origin_size from checkbox within w_music_composer_fingering
end type
type cbx_append_right_hand from checkbox within w_music_composer_fingering
end type
type cbx_append_left_hand from checkbox within w_music_composer_fingering
end type
type cbx_new_format from checkbox within w_music_composer_fingering
end type
type cb_11 from commandbutton within w_music_composer_fingering
end type
type st_13 from statictext within w_music_composer_fingering
end type
type cb_10 from commandbutton within w_music_composer_fingering
end type
type cb_9 from commandbutton within w_music_composer_fingering
end type
type pb_2 from picturebutton within w_music_composer_fingering
end type
type pb_1 from picturebutton within w_music_composer_fingering
end type
type rb_14 from radiobutton within w_music_composer_fingering
end type
type rb_13 from radiobutton within w_music_composer_fingering
end type
type rb_12 from radiobutton within w_music_composer_fingering
end type
type rb_11 from radiobutton within w_music_composer_fingering
end type
type rb_10 from radiobutton within w_music_composer_fingering
end type
type rb_9 from radiobutton within w_music_composer_fingering
end type
type rb_8 from radiobutton within w_music_composer_fingering
end type
type rb_rh_3 from radiobutton within w_music_composer_fingering
end type
type rb_rh_2 from radiobutton within w_music_composer_fingering
end type
type rb_rh_1 from radiobutton within w_music_composer_fingering
end type
type sle_lh_1_h from singlelineedit within w_music_composer_fingering
end type
type sle_lh_5_h from singlelineedit within w_music_composer_fingering
end type
type sle_lh_4_h from singlelineedit within w_music_composer_fingering
end type
type sle_lh_3_h from singlelineedit within w_music_composer_fingering
end type
type sle_lh_2_h from singlelineedit within w_music_composer_fingering
end type
type sle_rh_2_h from singlelineedit within w_music_composer_fingering
end type
type sle_rh_3_h from singlelineedit within w_music_composer_fingering
end type
type sle_rh_4_h from singlelineedit within w_music_composer_fingering
end type
type sle_rh_5_h from singlelineedit within w_music_composer_fingering
end type
type sle_rh_1_h from singlelineedit within w_music_composer_fingering
end type
type sle_rh_1_w from singlelineedit within w_music_composer_fingering
end type
type sle_rh_5_w from singlelineedit within w_music_composer_fingering
end type
type sle_rh_4_w from singlelineedit within w_music_composer_fingering
end type
type sle_rh_3_w from singlelineedit within w_music_composer_fingering
end type
type sle_rh_2_w from singlelineedit within w_music_composer_fingering
end type
type sle_lh_2_w from singlelineedit within w_music_composer_fingering
end type
type sle_lh_3_w from singlelineedit within w_music_composer_fingering
end type
type sle_lh_4_w from singlelineedit within w_music_composer_fingering
end type
type sle_lh_5_w from singlelineedit within w_music_composer_fingering
end type
type sle_lh_1_w from singlelineedit within w_music_composer_fingering
end type
type st_12 from statictext within w_music_composer_fingering
end type
type sle_min_note from singlelineedit within w_music_composer_fingering
end type
type sle_max_note from singlelineedit within w_music_composer_fingering
end type
type sle_note_id from singlelineedit within w_music_composer_fingering
end type
type cbx_collect_ind from checkbox within w_music_composer_fingering
end type
type cb_draw from commandbutton within w_music_composer_fingering
end type
type st_11 from statictext within w_music_composer_fingering
end type
type sle_y_pct from singlelineedit within w_music_composer_fingering
end type
type sle_x_pct from singlelineedit within w_music_composer_fingering
end type
type sle_rh_2_note from singlelineedit within w_music_composer_fingering
end type
type sle_rh_3_note from singlelineedit within w_music_composer_fingering
end type
type sle_rh_4_note from singlelineedit within w_music_composer_fingering
end type
type sle_rh_5_note from singlelineedit within w_music_composer_fingering
end type
type sle_rh_1_note from singlelineedit within w_music_composer_fingering
end type
type sle_lh_1_note from singlelineedit within w_music_composer_fingering
end type
type sle_lh_5_note from singlelineedit within w_music_composer_fingering
end type
type sle_lh_4_note from singlelineedit within w_music_composer_fingering
end type
type sle_lh_3_note from singlelineedit within w_music_composer_fingering
end type
type sle_lh_2_note from singlelineedit within w_music_composer_fingering
end type
type sle_lh_1_x from singlelineedit within w_music_composer_fingering
end type
type sle_lh_5_x from singlelineedit within w_music_composer_fingering
end type
type sle_lh_4_x from singlelineedit within w_music_composer_fingering
end type
type sle_lh_3_x from singlelineedit within w_music_composer_fingering
end type
type sle_lh_2_x from singlelineedit within w_music_composer_fingering
end type
type sle_rh_2_x from singlelineedit within w_music_composer_fingering
end type
type sle_rh_3_x from singlelineedit within w_music_composer_fingering
end type
type sle_rh_4_x from singlelineedit within w_music_composer_fingering
end type
type sle_rh_5_x from singlelineedit within w_music_composer_fingering
end type
type sle_rh_1_x from singlelineedit within w_music_composer_fingering
end type
type sle_rh_1_y from singlelineedit within w_music_composer_fingering
end type
type sle_rh_5_y from singlelineedit within w_music_composer_fingering
end type
type sle_rh_4_y from singlelineedit within w_music_composer_fingering
end type
type sle_rh_3_y from singlelineedit within w_music_composer_fingering
end type
type sle_rh_2_y from singlelineedit within w_music_composer_fingering
end type
type sle_lh_2_y from singlelineedit within w_music_composer_fingering
end type
type sle_lh_3_y from singlelineedit within w_music_composer_fingering
end type
type sle_lh_4_y from singlelineedit within w_music_composer_fingering
end type
type sle_lh_5_y from singlelineedit within w_music_composer_fingering
end type
type sle_lh_1_y from singlelineedit within w_music_composer_fingering
end type
type cb_stop_keyboard from commandbutton within w_music_composer_fingering
end type
type cb_start_keyboard from commandbutton within w_music_composer_fingering
end type
type cb_8 from commandbutton within w_music_composer_fingering
end type
type cb_5 from commandbutton within w_music_composer_fingering
end type
type sle_file_name from singlelineedit within w_music_composer_fingering
end type
type cb_new_format from commandbutton within w_music_composer_fingering
end type
type cb_3 from commandbutton within w_music_composer_fingering
end type
type rb_3 from radiobutton within w_music_composer_fingering
end type
type st_6 from statictext within w_music_composer_fingering
end type
type st_5 from statictext within w_music_composer_fingering
end type
type sle_2 from singlelineedit within w_music_composer_fingering
end type
type rb_5 from radiobutton within w_music_composer_fingering
end type
type rb_4 from radiobutton within w_music_composer_fingering
end type
type rb_2 from radiobutton within w_music_composer_fingering
end type
type st_4 from statictext within w_music_composer_fingering
end type
type st_3 from statictext within w_music_composer_fingering
end type
type st_2 from statictext within w_music_composer_fingering
end type
type cb_2 from commandbutton within w_music_composer_fingering
end type
type cb_1 from commandbutton within w_music_composer_fingering
end type
type sle_1 from singlelineedit within w_music_composer_fingering
end type
type st_1 from statictext within w_music_composer_fingering
end type
type p_1 from picture within w_music_composer_fingering
end type
type gb_1 from groupbox within w_music_composer_fingering
end type
type gb_2 from groupbox within w_music_composer_fingering
end type
type mle_finger_attributes from multilineedit within w_music_composer_fingering
end type
type mle_note from multilineedit within w_music_composer_fingering
end type
type mle_note_coord from multilineedit within w_music_composer_fingering
end type
type mle_entry from multilineedit within w_music_composer_fingering
end type
type dw_1 from datawindow within w_music_composer_fingering
end type
end forward

global type w_music_composer_fingering from window
integer x = 101
integer y = 100
integer width = 6226
integer height = 3280
windowtype windowtype = popup!
windowstate windowstate = maximized!
boolean center = true
event ue_get_player_handle pbm_custom01
event ue_key_played pbm_custom02
event ue_get_finger_coord pbm_custom04
event ue_keydown pbm_keydown
event ue_keyboard_drew pbm_custom05
cbx_phrase_op_indicator cbx_phrase_op_indicator
cbx_define_phrase cbx_define_phrase
cb_mk_entry cb_mk_entry
cbx_image_lib cbx_image_lib
cb_28 cb_28
cb_21 cb_21
cb_22 cb_22
cb_compile_lesson cb_compile_lesson
cb_18 cb_18
cb_populate_loudness cb_populate_loudness
sle_note_char_to sle_note_char_to
sle_note_char_from sle_note_char_from
cb_17 cb_17
cb_16 cb_16
cb_7 cb_7
pb_16 pb_16
cbx_key_only cbx_key_only
cb_play_notes cb_play_notes
st_19 st_19
st_18 st_18
st_17 st_17
sle_right_volume sle_right_volume
sle_left_volume sle_left_volume
cbx_delete_tmp_img cbx_delete_tmp_img
cbx_replace cbx_replace
cbx_entry cbx_entry
cbx_note cbx_note
cbx_fingering cbx_fingering
cb_batch_copy cb_batch_copy
sle_dest_from sle_dest_from
sle_source_to sle_source_to
sle_source_from sle_source_from
cb_15 cb_15
cb_save_project cb_save_project
cb_browse_project cb_browse_project
sle_project_file sle_project_file
st_16 st_16
cb_reload_library cb_reload_library
sle_tempo sle_tempo
cbx_mix_image cbx_mix_image
cbx_view_image cbx_view_image
cbx_activate_animation cbx_activate_animation
cbx_1 cbx_1
cb_27 cb_27
st_15 st_15
sle_h_inc sle_h_inc
sle_w_inc sle_w_inc
sle_y_inc sle_y_inc
sle_x_inc sle_x_inc
sle_3 sle_3
pb_15 pb_15
pb_14 pb_14
pb_13 pb_13
pb_12 pb_12
pb_11 pb_11
pb_10 pb_10
pb_9 pb_9
pb_8 pb_8
pb_7 pb_7
pb_6 pb_6
st_14 st_14
cb_26 cb_26
cb_25 cb_25
cb_24 cb_24
cb_23 cb_23
sle_dest_lib sle_dest_lib
cb_input_lib cb_input_lib
cb_20 cb_20
sle_source_lib sle_source_lib
cb_19 cb_19
cb_delete_row cb_delete_row
cb_get_list cb_get_list
cb_dup_row cb_dup_row
cb_capture_image cb_capture_image
pb_5 pb_5
cb_6 cb_6
sle_dw_path sle_dw_path
cb_get_time cb_get_time
pb_4 pb_4
pb_3 pb_3
cbx_note_on cbx_note_on
cb_restore_dw cb_restore_dw
cb_save_dw cb_save_dw
cb_copy_to_dw cb_copy_to_dw
cb_copy_from_dw cb_copy_from_dw
cbx_dw_visible cbx_dw_visible
cb_13 cb_13
ddlb_note_level_range_max ddlb_note_level_range_max
ddlb_note_name_range_max ddlb_note_name_range_max
ddlb_note_level_range_min ddlb_note_level_range_min
ddlb_note_name_range_min ddlb_note_name_range_min
ddlb_rh_note_name_5 ddlb_rh_note_name_5
ddlb_rh_note_level_5 ddlb_rh_note_level_5
ddlb_rh_note_name_4 ddlb_rh_note_name_4
ddlb_rh_note_level_4 ddlb_rh_note_level_4
ddlb_rh_note_name_3 ddlb_rh_note_name_3
ddlb_rh_note_level_3 ddlb_rh_note_level_3
ddlb_rh_note_name_2 ddlb_rh_note_name_2
ddlb_rh_note_level_2 ddlb_rh_note_level_2
ddlb_rh_note_name_1 ddlb_rh_note_name_1
ddlb_rh_note_level_1 ddlb_rh_note_level_1
ddlb_lh_note_name_5 ddlb_lh_note_name_5
ddlb_lh_note_level_5 ddlb_lh_note_level_5
ddlb_lh_note_name_4 ddlb_lh_note_name_4
ddlb_lh_note_level_4 ddlb_lh_note_level_4
ddlb_lh_note_name_3 ddlb_lh_note_name_3
ddlb_lh_note_level_3 ddlb_lh_note_level_3
ddlb_lh_note_name_2 ddlb_lh_note_name_2
ddlb_lh_note_level_2 ddlb_lh_note_level_2
ddlb_lh_note_level_1 ddlb_lh_note_level_1
ddlb_lh_note_name_1 ddlb_lh_note_name_1
ddlb_rh_5 ddlb_rh_5
ddlb_rh_4 ddlb_rh_4
ddlb_rh_3 ddlb_rh_3
ddlb_rh_2 ddlb_rh_2
ddlb_rh_1 ddlb_rh_1
ddlb_lh_5 ddlb_lh_5
ddlb_lh_4 ddlb_lh_4
ddlb_lh_3 ddlb_lh_3
ddlb_lh_2 ddlb_lh_2
ddlb_lh_1 ddlb_lh_1
cb_finger_attr_default cb_finger_attr_default
cb_12 cb_12
uo_1 uo_1
cb_append_clear cb_append_clear
cb_append_repeat cb_append_repeat
cbx_all_finger cbx_all_finger
cb_play_note cb_play_note
cb_4 cb_4
cbx_origin_size cbx_origin_size
cbx_append_right_hand cbx_append_right_hand
cbx_append_left_hand cbx_append_left_hand
cbx_new_format cbx_new_format
cb_11 cb_11
st_13 st_13
cb_10 cb_10
cb_9 cb_9
pb_2 pb_2
pb_1 pb_1
rb_14 rb_14
rb_13 rb_13
rb_12 rb_12
rb_11 rb_11
rb_10 rb_10
rb_9 rb_9
rb_8 rb_8
rb_rh_3 rb_rh_3
rb_rh_2 rb_rh_2
rb_rh_1 rb_rh_1
sle_lh_1_h sle_lh_1_h
sle_lh_5_h sle_lh_5_h
sle_lh_4_h sle_lh_4_h
sle_lh_3_h sle_lh_3_h
sle_lh_2_h sle_lh_2_h
sle_rh_2_h sle_rh_2_h
sle_rh_3_h sle_rh_3_h
sle_rh_4_h sle_rh_4_h
sle_rh_5_h sle_rh_5_h
sle_rh_1_h sle_rh_1_h
sle_rh_1_w sle_rh_1_w
sle_rh_5_w sle_rh_5_w
sle_rh_4_w sle_rh_4_w
sle_rh_3_w sle_rh_3_w
sle_rh_2_w sle_rh_2_w
sle_lh_2_w sle_lh_2_w
sle_lh_3_w sle_lh_3_w
sle_lh_4_w sle_lh_4_w
sle_lh_5_w sle_lh_5_w
sle_lh_1_w sle_lh_1_w
st_12 st_12
sle_min_note sle_min_note
sle_max_note sle_max_note
sle_note_id sle_note_id
cbx_collect_ind cbx_collect_ind
cb_draw cb_draw
st_11 st_11
sle_y_pct sle_y_pct
sle_x_pct sle_x_pct
sle_rh_2_note sle_rh_2_note
sle_rh_3_note sle_rh_3_note
sle_rh_4_note sle_rh_4_note
sle_rh_5_note sle_rh_5_note
sle_rh_1_note sle_rh_1_note
sle_lh_1_note sle_lh_1_note
sle_lh_5_note sle_lh_5_note
sle_lh_4_note sle_lh_4_note
sle_lh_3_note sle_lh_3_note
sle_lh_2_note sle_lh_2_note
sle_lh_1_x sle_lh_1_x
sle_lh_5_x sle_lh_5_x
sle_lh_4_x sle_lh_4_x
sle_lh_3_x sle_lh_3_x
sle_lh_2_x sle_lh_2_x
sle_rh_2_x sle_rh_2_x
sle_rh_3_x sle_rh_3_x
sle_rh_4_x sle_rh_4_x
sle_rh_5_x sle_rh_5_x
sle_rh_1_x sle_rh_1_x
sle_rh_1_y sle_rh_1_y
sle_rh_5_y sle_rh_5_y
sle_rh_4_y sle_rh_4_y
sle_rh_3_y sle_rh_3_y
sle_rh_2_y sle_rh_2_y
sle_lh_2_y sle_lh_2_y
sle_lh_3_y sle_lh_3_y
sle_lh_4_y sle_lh_4_y
sle_lh_5_y sle_lh_5_y
sle_lh_1_y sle_lh_1_y
cb_stop_keyboard cb_stop_keyboard
cb_start_keyboard cb_start_keyboard
cb_8 cb_8
cb_5 cb_5
sle_file_name sle_file_name
cb_new_format cb_new_format
cb_3 cb_3
rb_3 rb_3
st_6 st_6
st_5 st_5
sle_2 sle_2
rb_5 rb_5
rb_4 rb_4
rb_2 rb_2
st_4 st_4
st_3 st_3
st_2 st_2
cb_2 cb_2
cb_1 cb_1
sle_1 sle_1
st_1 st_1
p_1 p_1
gb_1 gb_1
gb_2 gb_2
mle_finger_attributes mle_finger_attributes
mle_note mle_note
mle_note_coord mle_note_coord
mle_entry mle_entry
dw_1 dw_1
end type
global w_music_composer_fingering w_music_composer_fingering

type variables
integer ii_counter = 0, SectionCount
integer ii_rh_lo_note,ii_rh_hi_note
integer ii_lh_lo_note,ii_lh_hi_note
integer ii_bh_rowcount=0,ii_rh_rowcount=0,ii_lh_rowcount=0
constant integer REAPEAT_FINGERING = 9
constant integer NO_FINGERING = 0
constant integer LEFTHAND_FINGERING = 1
constant integer RIGHTHAND_FINGERING = 2
constant integer FINGERING_ATTR_LEN = 17

integer ii_FileNum
integer ii_row = 0, ii_current_row = 0
integer ii_current_i = 0
integer ii_BeginX, ii_BeginY, ii_EndX, ii_EndY
int ii_p1_width_orig, ii_p1_height_orig, ii_cur_f = 1
string is_note_list[], is_empty_list[], is_entry_list[], is_fingering_list[]
//w_materials iw_window
integer ii_x_list[]
integer ii_y_list[]
integer ii_empty_list[]
long il_thread_id = 0
long il_player_handle
String is_id[]
string is_graph_path = "", is_dw_path = ""
//string is_graph_path = "", is_dw_path = ""
string is_startupfile = ""
//string is_phrase_file_bh, is_phrase_file_rh, is_phrase_file_lh
long il_phrase_list_bh[], il_phrase_list_rh[], il_phrase_list_lh[]

boolean ib_playing_note = false
string is_text_list[]
long il_midi_data[], il_midi_time[], il_data_count = 0
double idb_beat_rate, idb_beat_duration, idb_note_per_beat, idb_empty[]
double idb_right_note_duration[5], idb_left_note_duration[5], idb_left_min_duration = 10.0
double idb_right_note_duration0[5], idb_left_note_duration0[5], idb_right_min_duration = 10.0
double idb_min_duration = 10.0
double idb_right_note_duration1[5], idb_left_note_duration1[5], idb_left_min_duration1 = 10.0
double idb_right_note_duration00[5], idb_left_note_duration00[5], idb_right_min_duration1 = 10.0

long il_beat_rate, il_note_beat_denomitor
boolean ib_busy_token = false // to control code flow
boolean ib_playing_token = true // to control code flow
boolean ib_playing_demo = false
boolean ib_sound_seperation = false
boolean ib_left_hand_exists=false,ib_right_exists=false,ib_both_exists=false
boolean ib_data_process = false

string is_empty_note = ""
string is_current_note = ""

string is_rh_text_list[], is_lh_text_list[], is_bh_text_list[], is_cur_text_list[]
integer ii_rh_text_count = 0, ii_lh_text_count = 0, ii_bh_text_count = 0
string is_rh_wave_list[], is_lh_wave_list[], is_bh_wave_list[]
string is_rh_picture_list[], is_lh_picture_list[], is_bh_picture_list[]
string is_rh_finger_list[], is_lh_finger_list[], is_bh_finger_list[], is_finger_list[]
string is_deploy_directory

string is_measure_size
double idb_measure_size
integer ii_measure_right_begin_index[], ii_measure_right_end_index[]
integer ii_measure_left_begin_index[], ii_measure_left_end_index[]
integer ii_measure_both_begin_index[], ii_measure_both_end_index[]
integer ii_measure_cur_begin_index[], ii_measure_cur_end_index[]
integer ii_bh_to_rh[], ii_bh_to_lh[]

SingleLineEdit isle_lh_note[5], isle_lh_x[5], isle_lh_y[5], isle_lh_w[5], isle_lh_h[5]
SingleLineEdit isle_rh_note[5], isle_rh_x[5], isle_rh_y[5], isle_rh_w[5], isle_rh_h[5]
datastore ids_1

boolean ib_animate_fingering = false
boolean ib_note_playing = false
boolean ib_keyboard_draw = false // to synchronized image capture process
long il_animate_id = 0
string is_image_prefix
string is_res_file_name
string is_category_path = ""
string is_lesson_name_prefix = ""
string is_lesson_output_prefix = ""

integer ii_played_notes[], ii_row_source_from, ii_row_source_to

integer ii_next_picture_index = 1

long il_mem_handle


integer ii_rh_list_index[],ii_lh_list_index[],ii_bh_list_index[], ii_cur_list_index[], ii_cur_piece
str_music_repeat istr_empty,istr_cur_repeat[],istr_bh_repeat[],istr_both_repeat[],istr_lh_repeat[],istr_rh_repeat[]
string is_cur_finger_list[]
integer ii_bean_drop_style, ii_char_index =  1, ii_high_note, ii_low_note, ii_the_high_note, ii_the_low_note
integer ii_begin_note = 2
double idb_width_ratio = 1.0, idb_height_ratio = 1.0
integer RIGHT_HAND = 1, LEFT_HAND = 2, BOTH_HAND = 3
nvo_music_phrase invo_music_phrase
long il_split_phrase = 0
long il_delete_phrase = 0
integer ii_phrase_cur_begin_index[], ii_phrase_cur_end_index[]
integer ii_sheet_type = 3 // default to BOTH_HAND
//note header specification
//picture width, height
//note specififcation
//1111222233334444555566667777888899aabbbbccddeeeeffgghhhhiijjkkkkllmm000ppqqrrrrsstt
//1111-note Upper X
//2222-note Upper Y
//3333-note Lower X
//4444-note Lower Y
//5555-1st note Time Fraction 0401=1/4 note whilte  1601=1/16
//66-1st note key code LEFT HAND
//77-1st note key character LEFT HAND 1st char {1=normal, 2=staccado, 3=continued}, 2nd char {finger number}
//8888-1st note Time Fraction 0401=1/4 note whilte  1601=1/16 RIGHT HAND
//99-1st note key code RIGHT HAND
//aa-1st note key character RIGHT HAND
//bbbb-2nd note Time Fraction 0401=1/4 note whilte  1601=1/16 LEFT HAND
//cc-2nd note key code LEFT HAND
//dd-2nd note key character LEFT HAND
//eeee-2nd note Time Fraction 0401=1/4 note whilte  1601=1/16 RIGHT HAND
//ff-2nd note key code RIGHT HAND
//gg-2nd note key character RIGHT HAND
//hhhh-3rd note Time Fraction 0401=1/4 note whilte  1601=1/16 LEFT HAND
//ii-3rd note key code LEFT HAND
//jj-3rd note key character LEFT HAND
//kkkk-3rd note Time Fraction 0401=1/4 note whilte  1601=1/16 RIGHT HAND
//ll-3rd note key code RIGHT HAND
//mm-3rd note key character RIGHT HAND
//oooo-4th note Time Fraction 0401=1/4 note whilte  1601=1/16 LEFT HAND
//pp-4th note key code LEFT HAND
//qq-4th note key character LEFT HAND
//rrrr-4th note Time Fraction 0401=1/4 note whilte  1601=1/16 RIGHT HAND
//ss-4th note key code RIGHT HAND
//tt-4th note key character RIGHT HAND
//hex	dec	Score
//24	36	C1
//25		C1#
//30	48	C2
//3C	60	C3
//48	72	C4
//54	84	C5
//24	C0
//25	C0#
//26	D0
//27	D0#
//28	E0
//29	F0
//30	F0#
//31	G0
//32	G0#
//33	A0
//34	A0#
//35	B0
//36	
end variables

forward prototypes
public function integer wf_rec_move (string as_note)
public function string wf_seq_to_note (integer ai_seq)
public function integer wf_note_to_seq (string as_note)
public function integer wf_make_string_list (string as_input, ref string as_output[])
public function integer wf_get_note_list (string as_l_or_r_ind, string as_input, ref integer ai_note_list[], ref string as_note_list[])
public function integer wf_get_note_list (string as_l_or_r_ind, string as_input, ref string as_note_list[])
public function integer wf_draw_fingers (integer ax_resize_numerator, integer ax_resize_denominator, integer ay_resize_numerator, integer ay_resize_denominator, integer ax_reverse_ind, integer ay_reverse_ind, integer ax_offset, integer ay_offset)
public function integer wf_draw_fingers2 (integer ax_resize_numerator, integer ax_resize_denominator, integer ay_resize_numerator, integer ay_resize_denominator, integer ax_reverse_ind, integer ay_reverse_ind, integer ax_offset, integer ay_offset)
public function integer wf_getderivatives (ref double adb_xarr_list[], ref double adb_yarr_list[], integer ai_n, ref double adb_deriv_list[], ref double adb_h_list[], double adb_tolerance)
public function double wf_spline (ref double adb_xarr_list[], ref double adb_yarr_list[], ref double adb_deriv_list[], ref double adb_h_list[], integer ai_n, double adb_x)
public function integer wf_tridiagonal (integer ai_n, ref double adb_a_list[], ref double adb_b_list[], ref double adb_c_list[], ref double adb_d_list[], double adb_epsilon)
public function boolean isnaturalnote (integer ai_note)
public function integer getarrayrange (long al_array[])
public function integer wf_send_note ()
public function integer wf_get_finger_entry_id (ref long al_entry_id_list[], ref string as_entry_id_list[])
public function integer wf_fingering_test (string as_finger_attr, string as_entry)
public function string wf_make_entry (string as_note, string as_coord, string as_finger)
public function double wf_string_to_fraction (string as_input)
public function string wf_fraction_to_string (double adb_input)
public function integer wf_get_note_list ()
public function integer wf_parse_finger_entry (string as_input, ref string as_output_list[])
public function integer wf_parse_note_attribute (string as_current_note_entry, ref string as_note_coordinate, ref string as_note_to_keyboard, ref integer ai_total_note_set_count, ref integer ai_rh_note_set_count, ref integer ai_lh_note_set_count, ref string as_rh_time_fraction[], ref string as_lh_time_fraction[], ref string as_rh_note_value[], ref string as_lh_note_value[], ref string as_rh_note_char[], ref string as_lh_note_char[], ref string as_rh_note_finger[], ref string as_lh_note_finger[])
public subroutine wf_load_finger_proportionally ()
public function integer wf_naturalnote_to_note_seq (integer ai_note_id, integer ai_naturalnote_diff)
public subroutine wf_show_graph ()
public function integer wf_parse_finger_entry (string as_input, ref string as_lh_output, ref string as_rh_output, ref string as_lh_output_list[], ref string as_rh_output_list[])
public function integer wf_goto_rec (integer ai_x, integer ai_y)
public subroutine wf_play_note ()
public subroutine wf_add_played_note (integer ai_note)
public function double wf_get_min_time ()
public subroutine wf_remove_played_note (integer ai_note)
public subroutine wf_remove_all_played_notes ()
public subroutine wf_capture_image_set ()
public subroutine wf_capture_image_single ()
public function integer wf_build_image ()
public function integer wf_retrieve_image ()
public subroutine wf_display_single_image ()
public function integer wf_build_image_library ()
public function integer wf_rebuild_image ()
public function integer wf_build_lesson ()
public function integer wf_make_section_images ()
public function integer wf_display_music_sheet ()
public function integer wf_get_rh_lh_note_list ()
public function integer wf_set_current_data_array ()
public subroutine wf_get_high_low_notes ()
end prototypes

event ue_get_player_handle;long ll_pb_win_handle, ll_lh_id[], ll_rh_id[],ll_lh_note_pos[],ll_rh_note_pos[] 
string ls_text, ls_note_to_keyboard
string ls_device1 = "SoundMAX Digital Audio"
string ls_device2 = "SSS USB Headphone Set"
integer li_i

//return 
//ll_lh_id[1] = long(ddlb_lh_1.text)
//ll_lh_id[2] = long(ddlb_lh_2.text)
//ll_lh_id[3] = long(ddlb_lh_3.text)
//ll_lh_id[4] = long(ddlb_lh_4.text)
//ll_lh_id[5] = long(ddlb_lh_5.text)
//ll_lh_note_pos[1] = long(sle_lh_1p.text)
//ll_lh_note_pos[2] = long(sle_lh_2p.text)
//ll_lh_note_pos[3] = long(sle_lh_3p.text)
//ll_lh_note_pos[4] = long(sle_lh_4p.text)
//ll_lh_note_pos[5] = long(sle_lh_5p.text)
//
//ll_rh_id[1] = long(ddlb_rh_1.text)
//ll_rh_id[2] = long(ddlb_rh_2.text)
//ll_rh_id[3] = long(ddlb_rh_3.text)
//ll_rh_id[4] = long(ddlb_rh_4.text)
//ll_rh_id[5] = long(ddlb_rh_5.text)
//ll_rh_note_pos[1] = long(sle_rh_1p.text)
//ll_rh_note_pos[2] = long(sle_rh_2p.text)
//ll_rh_note_pos[3] = long(sle_rh_3p.text)
//ll_rh_note_pos[4] = long(sle_rh_4p.text)
//ll_rh_note_pos[5] = long(sle_rh_5p.text)
//
//extCurrentEntry(ll_lh_id,ll_lh_note_pos,upperbound(ll_lh_id),ll_rh_id,ll_rh_note_pos,upperbound(ll_rh_id))
//cb_draw.event clicked()

//ls_text = trim(is_note_list[ii_current_i])
//
//ls_note_to_keyboard = mid(ls_text, 17, len(ls_text) - 16)
////extSetMusicNoteToSharedMemory(ls_note_to_keyboard) //set key-note information to sharememory
//ls_note_to_keyboard = "000000000040104805"
//extSetCurrentNote(ls_note_to_keyboard) 
//extPostThreadMessage(il_thread_id, 1025, 0, 0)	// send message to the music player to inform Next Note to play data in sharemory

//if not cbx_collect_ind.checked then
//	wf_send_note()
//end if

end event

event ue_key_played;ii_current_i++

//return 0
//MessageBox("ue_key_played", "info")
if not cbx_collect_ind.checked then
	if ii_current_i <= upperbound(is_entry_list) then
		wf_send_note()
//	else
//		MessageBox("Info", "The End")
	end if
end if
//extCurrentEntry(ref long lh_id[], long lh_size, ref long rh_id[], long rh_size,ref long note_pos[])


//extSetMusicNoteToSharedMemory(ls_empty_note)
//Send(il_player_handle, 1025, 0, 0)
//
//ls_note_to_keyboard = mid(is_cur_text_list[ii_current_note], 17, len(is_cur_text_list[ii_current_note]) - 16)
//extSetMusicNoteToSharedMemory(ls_note_to_keyboard)
//extPostThreadMessage(il_thread_id,1025, 0, 0)
return 1
end event

event ue_get_finger_coord;SingleLineEdit lsle_note, lsle_x, lsle_y


if not cbx_collect_ind.checked then return


choose case ii_cur_f
	case 1
		lsle_note = sle_lh_1_note
		lsle_x = sle_lh_1_x
		lsle_y = sle_lh_1_y
	case 2
		lsle_note = sle_lh_2_note
		lsle_x = sle_lh_2_x
		lsle_y = sle_lh_2_y
	case 3
		lsle_note = sle_lh_3_note
		lsle_x = sle_lh_3_x
		lsle_y = sle_lh_3_y
	case 4
		lsle_note = sle_lh_4_note
		lsle_x = sle_lh_4_x
		lsle_y = sle_lh_4_y
	case 5
		lsle_note = sle_lh_5_note
		lsle_x = sle_lh_5_x
		lsle_y = sle_lh_5_y
	case 6
		lsle_note = sle_rh_1_note
		lsle_x = sle_rh_1_x
		lsle_y = sle_rh_1_y
	case 7
		lsle_note = sle_rh_2_note
		lsle_x = sle_rh_2_x
		lsle_y = sle_rh_2_y
	case 8
		lsle_note = sle_rh_3_note
		lsle_x = sle_rh_3_x
		lsle_y = sle_rh_3_y
	case 9
		lsle_note = sle_rh_4_note
		lsle_x = sle_rh_4_x
		lsle_y = sle_rh_4_y
	case 10
		lsle_note = sle_rh_5_note
		lsle_x = sle_rh_5_x
		lsle_y = sle_rh_5_y
end choose

//return

//MessageBox("ue_get_finger_coord", wparam)
if wparam > 0 then
	lsle_x.text = string(wparam)
	if lparam > 1000 then
		lsle_y.text = string(0 - (lparam - 1000))
	else
		lsle_y.text = string(lparam)
	end if
else // note id
	if lparam > 0 then 
		lsle_note.text = string(lparam)
		cb_draw.post event clicked()
	end if
end if

end event

event ue_keydown;
If KeyDown(KeyR!) and keyflags = 2 then
	
//	FOOTSWITCHPRESSEDFOOTSWITCHPRESSEDFOOTSWITCHPRESSED
	MessageBox("keydown: " + string(integer(key)), keyflags)
end if
end event

event ue_keyboard_drew;//MessageBox("ue_keyboard_new", "1")
ib_keyboard_draw = true
end event

public function integer wf_rec_move (string as_note);string ls_debug
if len(as_note) = 16 then
	ii_BeginX = integer(mid(as_note, 1, 4)) + uo_1.uo_1.p_1.x
	ii_BeginY = integer(mid(as_note, 5, 4)) + uo_1.uo_1.p_1.y
	ii_EndX = integer(mid(as_note, 9, 4)) + uo_1.uo_1.p_1.x
	ii_EndY = integer(mid(as_note, 13, 4)) + uo_1.uo_1.p_1.y
elseif len(as_note) = 17 then
	ii_BeginX = integer(mid(as_note, 1, 4)) + uo_1.uo_1.p_1.x
	ii_BeginY = integer(mid(as_note, 5, 4)) + uo_1.uo_1.p_1.y
	ii_EndX = integer(mid(as_note, 9, 4)) + uo_1.uo_1.p_1.x
	ii_EndY = integer(mid(as_note, 13, 5)) + uo_1.uo_1.p_1.y
elseif len(as_note) > 17 then
	ii_BeginX = integer(mid(as_note, 1, 4)) + uo_1.uo_1.p_1.x
	ii_BeginY = integer(mid(as_note, 5, 5)) + uo_1.uo_1.p_1.y
	ii_EndX = integer(mid(as_note, 10, 4)) + uo_1.uo_1.p_1.x
	ii_EndY = integer(mid(as_note, 14, 5)) + uo_1.uo_1.p_1.y
end if
ls_debug = "ii_BeginX:" + string(ii_BeginX) + " ii_BeginY:" + string(ii_BeginY) + &
				+ " ii_EndX:" + string(ii_EndX) + " ii_EndY:" + string(ii_EndY) 
//MessageBox("wf_rec_move", ls_debug)

//ii_BeginX = 100
//ii_BeginY = 100
//ii_EndX = 100
//ii_EndY = 100

uo_1.uo_1.st_11.BringToTop = true
uo_1.uo_1.st_2.BringToTop = true
uo_1.uo_1.st_3.BringToTop = true
uo_1.uo_1.st_4.BringToTop = true

uo_1.uo_1.st_11.Visible = true
uo_1.uo_1.st_2.Visible = true
uo_1.uo_1.st_3.Visible = true
uo_1.uo_1.st_4.Visible = true

uo_1.uo_1.st_11.x = ii_BeginX
uo_1.uo_1.st_11.y = ii_BeginY
uo_1.uo_1.st_11.width = ii_EndX - ii_BeginX
uo_1.uo_1.st_11.height = 10 
uo_1.uo_1.st_11.text = string(ii_current_row)

uo_1.uo_1.st_2.x = ii_BeginX
uo_1.uo_1.st_2.y = ii_BeginY
uo_1.uo_1.st_2.width = 10
uo_1.uo_1.st_2.height = ii_EndY - ii_BeginY

uo_1.uo_1.st_3.x = ii_EndX
uo_1.uo_1.st_3.y = ii_BeginY
uo_1.uo_1.st_3.width = 10
uo_1.uo_1.st_3.height = ii_EndY - ii_BeginY

uo_1.uo_1.st_4.x = ii_BeginX
uo_1.uo_1.st_4.y = ii_EndY
uo_1.uo_1.st_4.width = ii_EndX - ii_BeginX
uo_1.uo_1.st_4.height = 10 


return 1
end function

public function string wf_seq_to_note (integer ai_seq);integer li_i, ll_level
string ls_level, ls_scale_note
string ls_note_list[] = {"C","C","D","D","E","F","F","G","G","A","A","B"}
string ls_sharp_list[] = {"","#","","#","","","#","","#","","#",""}
if ai_seq = 0 then return ""
if not cbx_new_format.checked then
	if ai_seq >= 12 and ai_seq <= 23 then
		ls_level = ""
	elseif ai_seq >= 24 and ai_seq <= 35 then
		ls_level = "0"
	elseif ai_seq >= 36 and ai_seq <= 47 then
		ls_level = "1"
	elseif ai_seq >= 48 and ai_seq <= 59 then
		ls_level = "2"
	elseif ai_seq >= 60 and ai_seq <= 71 then
		ls_level = "3"
	elseif ai_seq >= 72 and ai_seq <= 83 then
		ls_level = "4"
	elseif ai_seq >= 84 and ai_seq <= 95 then
		ls_level = "5"
	end if
	li_i = mod(ai_seq, 12) + 1
	ls_scale_note = ls_note_list[li_i] + ls_sharp_list[li_i] + ls_level
else
	ll_level = ai_seq/12
	li_i = mod(ai_seq, 12)
	ls_scale_note = ls_note_list[li_i + 1] + ls_sharp_list[li_i + 1] + string(ll_level)
end if

return ls_scale_note

// NEW FORMAT
//  C       D       E   F       G       A       B   Level
//     C#      D#          F#      G#      A#
//  *       *       *   *       *       *       *
//      1   2   3   4   5   6   7   8   9  10  11   0
// 12  13  14  15  16  17  18  19  20  21  22  23   1
// 24  25  26  27  28  29  30  31  32  33  34  35   2
// 36  37  38  39  40  41  42  43  44  45  46  47   3
// 48  49  50  51  52  53  54  55  56  57  58  59   4
// 60  61  62  63  64  65  66  67  68  69  70  71   5
// 72  73  74  75  76  77  78  79  80  81  82  83   6
// 84  85  86  87  88  89  90  91  92  93  94  95   7
// 96  97  98  99 100 101 102 103 104 105 106 107   8
//108                                               9
//
//
//a natural key can be determined by mod 12 with remaining of 0 2 4 5 7 9 or 11
//and on contrery a non-natural key by mod 12 with remaining of 1 3 6 8 or 10

//piano beginning at 21 and end at 108 (totally there are 88 keys)

//hex	dec	Score
//24	36	C1
//25		C1#
//30	48	C2
//3C	60	C3
//48	72	C4
//54	84	C5
//12	C
//24	C0
//25	C0#
//26	D0
//27	D0#
//28	E0
//29	F0
//30	F0#
//31	G0
//32	G0#
//33	A0
//34	A0#
//35	B0
//36	

end function

public function integer wf_note_to_seq (string as_note);integer li_i, ll_level, li_seq
string ls_note_list[] = {"C","C","D","D","E","F","F","G","G","A","A","B"}

for li_i = 1 to 12
	if left(as_note, 1) = ls_note_list[li_i] then exit
next
if pos(as_note, "#") > 0 then li_i++

if pos(as_note, "1") > 0 then
	ll_level = 1
elseif pos(as_note, "2") > 0 then
	ll_level = 2
elseif pos(as_note, "3") > 0 then
	ll_level = 3
elseif pos(as_note, "4") > 0 then
	ll_level = 4
elseif pos(as_note, "5") > 0 then
	ll_level = 5
elseif pos(as_note, "6") > 0 then
	ll_level = 6
elseif pos(as_note, "7") > 0 then
	ll_level = 7
elseif pos(as_note, "8") > 0 then
	ll_level = 8
elseif pos(as_note, "9") > 0 then
	ll_level = 9
else
	ll_level = 0
end if

if not cbx_new_format.checked then ll_level = ll_level + 2

if as_note = "00" then 
	li_seq = 0	
else	
	li_seq = 12*ll_level + li_i - 1
end if


return li_seq
//  C       D       E   F       G       A       B   Level
//     C#      D#          F#      G#      A#
//  *       *       *   *       *       *       *
//      1   2   3   4   5   6   7   8   9  10  11   0
// 12  13  14  15  16  17  18  19  20  21  22  23   1
// 24  25  26  27  28  29  30  31  32  33  34  35   2
// 36  37  38  39  40  41  42  43  44  45  46  47   3
// 48  49  50  51  52  53  54  55  56  57  58  59   4
// 60  61  62  63  64  65  66  67  68  69  70  71   5
// 72  73  74  75  76  77  78  79  80  81  82  83   6
// 84  85  86  87  88  89  90  91  92  93  94  95   7
// 96  97  98  99 100 101 102 103 104 105 106 107   8
//108                                               9
//
//
//a natural key can be determined by mod 12 with remaining of 0 2 4 5 7 9 or 11
//and on contrery a non-natural key by mod 12 with remaining of 1 3 6 8 or 10

//piano beginning at 21 and end at 108 (totally there 88 keys)
end function

public function integer wf_make_string_list (string as_input, ref string as_output[]);integer li_i, li_seq, li_begin, li_pos, li_len
string ls_tmp, ls_line

ls_tmp = as_input
if len(ls_tmp) > 0 then
	li_pos = pos(ls_tmp, "~r~n")
	do while li_pos > 0
		ls_line = left(ls_tmp, li_pos - 1)
		as_output[upperbound(as_output) + 1] = ls_line
//		MessageBox(ls_line, ls_line)
		ls_tmp = right(ls_tmp, len(ls_tmp) - li_pos - 1)
		li_pos = pos(ls_tmp, "~r~n")
	loop
	if len(ls_tmp) > 0 then
		ls_line = ls_tmp
		as_output[upperbound(as_output) + 1] = ls_line
//		MessageBox(ls_line, ls_line)		
	end if
end if

return 1
end function

public function integer wf_get_note_list (string as_l_or_r_ind, string as_input, ref integer ai_note_list[], ref string as_note_list[]);integer li_i, li_seq, li_begin, li_end, li_end1, li_end2, li_pos, li_len
string ls_tmp, ls_token

ls_tmp = trim(as_input)
//MessageBox(as_l_or_r_ind, as_input)
if len(ls_tmp) > 0 then
	li_begin = pos(ls_tmp, as_l_or_r_ind)
//	MessageBox("li_begin", li_begin)
	do while li_begin > 0
		// extract a note between R and L
		li_end1 = pos(ls_tmp, "R", li_begin + 4)
		li_end2 = pos(ls_tmp, "L", li_begin + 4)
//		MessageBox("wf_get_note_list", "li_begin:" + string(li_begin) + " li_end1:" + string(li_end1) + " li_end2:" + string(li_end2))
		if li_end1 = 0 and li_end2 = 0 then
			li_end = len(ls_tmp)
		elseif li_end1 = 0 then
			li_end = li_end2 - 1
		elseif li_end2 = 0 then
			li_end = li_end1 - 1
		elseif li_end2 > li_end1 then
			li_end = li_end1 - 1
		else
			li_end = li_end2 - 1		
		end if	
//		MessageBox("wf_get_note_list", "li_begin:" + string(li_begin) + " li_end1:" + string(li_end1) + " li_end2:" + string(li_end2) + " li_end:" + string(li_end))
		ls_token = mid(ls_tmp, li_begin + 1, li_end - li_begin)
		
		if len(ls_token) = 4 then
			ai_note_list[upperbound(ai_note_list) + 1] =  0
			as_note_list[upperbound(as_note_list) + 1] = ls_token + "00"
		else
			ai_note_list[upperbound(ai_note_list) + 1] = wf_note_to_seq(right(ls_token, len(ls_token) - 6)) // skip 6 leading chars (4 time fraction and 2 note character chars)
			as_note_list[upperbound(as_note_list) + 1] = left(ls_token, 6) // 6 leading chars (4 time fraction and 2 note character chars)
		end if
//		MessageBox("ls_token", ls_token)
		ls_tmp = right(ls_tmp, len(ls_tmp) - li_end)
		li_begin = pos(ls_tmp, as_l_or_r_ind)
	loop
end if

return 1


end function

public function integer wf_get_note_list (string as_l_or_r_ind, string as_input, ref string as_note_list[]);integer li_i, li_seq, li_begin, li_end, li_end1, li_end2, li_pos, li_len
string ls_tmp, ls_token

ls_tmp = trim(as_input)
//MessageBox(as_l_or_r_ind, as_input)
if len(ls_tmp) > 0 then
	li_begin = pos(ls_tmp, as_l_or_r_ind)
//	MessageBox("li_begin", li_begin)
	do while li_begin > 0
		// extract a note between R and L
		li_end1 = pos(ls_tmp, "R", li_begin + 4)
		li_end2 = pos(ls_tmp, "L", li_begin + 4)
//		MessageBox("wf_get_note_list", "li_begin:" + string(li_begin) + " li_end1:" + string(li_end1) + " li_end2:" + string(li_end2))
		if li_end1 = 0 and li_end2 = 0 then
			li_end = len(ls_tmp)
		elseif li_end1 = 0 then
			li_end = li_end2 - 1
		elseif li_end2 = 0 then
			li_end = li_end1 - 1
		elseif li_end2 > li_end1 then
			li_end = li_end1 - 1
		else
			li_end = li_end2 - 1		
		end if	
//		MessageBox("wf_get_note_list", "li_begin:" + string(li_begin) + " li_end1:" + string(li_end1) + " li_end2:" + string(li_end2) + " li_end:" + string(li_end))
		ls_token = mid(ls_tmp, li_begin, li_end - li_begin + 1)
		as_note_list[upperbound(as_note_list) + 1] = ls_token
//		MessageBox("ls_token", ls_token)
		ls_tmp = right(ls_tmp, len(ls_tmp) - li_end)
		li_begin = pos(ls_tmp, as_l_or_r_ind)
	loop
end if

return 1


end function

public function integer wf_draw_fingers (integer ax_resize_numerator, integer ax_resize_denominator, integer ay_resize_numerator, integer ay_resize_denominator, integer ax_reverse_ind, integer ay_reverse_ind, integer ax_offset, integer ay_offset);long i,li_x, li_y
ulong ul_win_handle, ul_device, ul_color
integer li_num, li_image_width, li_image_height, li_i,li_j, li_pos
string ls_buf, ls_sub
integer X_RESIZE_NUMERATOR,X_RESIZE_DENOMINATOR,Y_RESIZE_NUMERATOR,Y_RESIZE_DENOMINATOR
integer X_REVERSE_IND, Y_REVERSE_IND, X_OFFSET, Y_OFFSET
X_RESIZE_NUMERATOR = ax_resize_numerator
X_RESIZE_DENOMINATOR = ax_resize_denominator
Y_RESIZE_NUMERATOR = ay_resize_numerator
Y_RESIZE_DENOMINATOR = ay_resize_denominator
X_REVERSE_IND = ax_reverse_ind
Y_REVERSE_IND = ay_reverse_ind
X_OFFSET = ax_offset
Y_OFFSET = ay_offset


ul_win_handle = handle(p_1)

ul_device = GetDC(ul_win_handle)

integer RH_F1P1L =5
integer rh_finger1p1_left_list[] = {626,198,576,218,544,254,549,334,544,462}
str_mousepos rh_finger1p1_left[], p
for i=1 to RH_F1P1L
	rh_finger1p1_left[i].xpos = X_REVERSE_IND*rh_finger1p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger1p1_left[i].ypos = Y_REVERSE_IND*rh_finger1p1_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger1p1_left[i].xpos, rh_finger1p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger1p1_left[i].xpos, rh_finger1p1_left[i].ypos)
	end if
next

integer RH_F1P1R=5
integer rh_finger1p1_right_list[] = {626,198,709,214,764,254,805,418,828,518}
str_mousepos rh_finger1p1_right[]
for i=1 to RH_F1P1R
	rh_finger1p1_right[i].xpos = X_REVERSE_IND*rh_finger1p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger1p1_right[i].ypos = Y_REVERSE_IND*rh_finger1p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger1p1_right[i].xpos, rh_finger1p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger1p1_right[i].xpos, rh_finger1p1_right[i].ypos)
	end if
next

integer RH_F1P2L=6
integer rh_finger1p2_left_list[] = {544,462,508,554,448,678,434,710,457,814,498,902}
str_mousepos rh_finger1p2_left[]
for i=1 to RH_F1P2L
	rh_finger1p2_left[i].xpos = X_REVERSE_IND*rh_finger1p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger1p2_left[i].ypos = Y_REVERSE_IND*rh_finger1p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger1p2_left[i].xpos, rh_finger1p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger1p2_left[i].xpos, rh_finger1p2_left[i].ypos)
	end if
next

integer RH_F1P2R=3

integer rh_finger1p2_right_list[] = {828,518,815,678,950,1024}
str_mousepos rh_finger1p2_right[]
for i=1 to RH_F1P2R
	rh_finger1p2_right[i].xpos = X_REVERSE_IND*rh_finger1p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger1p2_right[i].ypos = Y_REVERSE_IND*rh_finger1p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger1p2_right[i].xpos, rh_finger1p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger1p2_right[i].xpos, rh_finger1p2_right[i].ypos)
	end if
next


integer RH_F2P1L=6
integer rh_finger2p1_left_list[] = {1376,44,1220,70,1120,128,1037,188,973,312,923,448}
str_mousepos rh_finger2p1_left[]
for i=1 to RH_F2P1L
	rh_finger2p1_left[i].xpos = X_REVERSE_IND*rh_finger2p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger2p1_left[i].ypos = Y_REVERSE_IND*rh_finger2p1_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger2p1_left[i].xpos, rh_finger2p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger2p1_left[i].xpos, rh_finger2p1_left[i].ypos)
	end if
next


integer RH_F2P1R=6
integer rh_finger2p1_right_list[] = {1376,52,1422,96,1422,156,1399,192,1298,276,1294,388}
str_mousepos rh_finger2p1_right[]
for i=1 to RH_F2P1R
	rh_finger2p1_right[i].xpos = X_REVERSE_IND*rh_finger2p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET 
	rh_finger2p1_right[i].ypos = Y_REVERSE_IND*rh_finger2p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger2p1_right[i].xpos, rh_finger2p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger2p1_right[i].xpos, rh_finger2p1_right[i].ypos)
	end if
next


integer RH_F2P2L=4
integer rh_finger2p2_left_list[] = {923,448,877,600,928,792,969,1024}
str_mousepos rh_finger2p2_left[]
for i=1 to RH_F2P2L
	rh_finger2p2_left[i].xpos = X_REVERSE_IND*rh_finger2p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger2p2_left[i].ypos = Y_REVERSE_IND*rh_finger2p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger2p2_left[i].xpos, rh_finger2p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger2p2_left[i].xpos, rh_finger2p2_left[i].ypos)
	end if
next

integer RH_F2P2R=4
integer rh_finger2p2_right_list[] = {1294,388,1253,532,1330,680,1399,836}
str_mousepos rh_finger2p2_right[]
for i=1 to RH_F2P2R
	rh_finger2p2_right[i].xpos = X_REVERSE_IND*rh_finger2p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger2p2_right[i].ypos = Y_REVERSE_IND*rh_finger2p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger2p2_right[i].xpos, rh_finger2p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger2p2_right[i].xpos, rh_finger2p2_right[i].ypos)
	end if
next


integer RH_F3P1L=6
integer rh_finger3p1_left_list[] = {1815,0,1719,12,1641,60,1600,152,1550,244,1509,376}
str_mousepos rh_finger3p1_left[]
for i=1 to RH_F3P1L
	rh_finger3p1_left[i].xpos = X_REVERSE_IND*rh_finger3p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger3p1_left[i].ypos = Y_REVERSE_IND*rh_finger3p1_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger3p1_left[i].xpos, rh_finger3p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger3p1_left[i].xpos, rh_finger3p1_left[i].ypos)
	end if
next

integer RH_F3P1R=5
integer rh_finger3p1_right_list[] = {1815,0,1897,60,1934,168,1961,288,1970,420}
str_mousepos rh_finger3p1_right[]
for i=1 to RH_F3P1R
	rh_finger3p1_right[i].xpos = X_REVERSE_IND*rh_finger3p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger3p1_right[i].ypos = Y_REVERSE_IND*rh_finger3p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger3p1_right[i].xpos, rh_finger3p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger3p1_right[i].xpos, rh_finger3p1_right[i].ypos)
	end if
next

integer RH_F3P2L=5
integer rh_finger3p2_left_list[] = {1509,376,1490,448,1481,584,1472,728,1413,848}
str_mousepos rh_finger3p2_left[]
for i=1 to RH_F3P2L
	rh_finger3p2_left[i].xpos = X_REVERSE_IND*rh_finger3p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger3p2_left[i].ypos = Y_REVERSE_IND*rh_finger3p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger3p2_left[i].xpos, rh_finger3p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger3p2_left[i].xpos, rh_finger3p2_left[i].ypos)
	end if
next

integer RH_F3P2R=5
integer rh_finger3p2_right_list[] = {1970,420,1993,596,2007,708,2030,908,2069,928}
str_mousepos rh_finger3p2_right[]
for i=1 to RH_F3P2L
	rh_finger3p2_right[i].xpos = X_REVERSE_IND*rh_finger3p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger3p2_right[i].ypos = Y_REVERSE_IND*rh_finger3p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger3p2_right[i].xpos, rh_finger3p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger3p2_right[i].xpos, rh_finger3p2_right[i].ypos)
	end if
next

integer RH_F4P1L=7
integer rh_finger4p1_left_list[] = {2151,56,2119,80,2083,124,2074,192,2110,252,2170,300,2174,328}
str_mousepos rh_finger4p1_left[]
for i=1 to RH_F4P1L
	rh_finger4p1_left[i].xpos = X_REVERSE_IND*rh_finger4p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger4p1_left[i].ypos = Y_REVERSE_IND*rh_finger4p1_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger4p1_left[i].xpos, rh_finger4p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger4p1_left[i].xpos, rh_finger4p1_left[i].ypos)
	end if
next

integer RH_F4P1R=6
integer rh_finger4p1_right_list[] = {2151,56,2229,68,2279,96,2416,132,2540,352,2540,396}
str_mousepos rh_finger4p1_right[]
for i=1 to RH_F4P1R
	rh_finger4p1_right[i].xpos = X_REVERSE_IND*rh_finger4p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger4p1_right[i].ypos = Y_REVERSE_IND*rh_finger4p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger4p1_right[i].xpos, rh_finger4p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger4p1_right[i].xpos, rh_finger4p1_right[i].ypos)
	end if
next

integer RH_F4P2L=7
integer rh_finger4p2_left_list[] = {2174,328,2156,416,2156,476,2160,536,2174,600,2124,764,2069,928}
str_mousepos rh_finger4p2_left[]
for i=1 to RH_F4P2L
	rh_finger4p2_left[i].xpos = X_REVERSE_IND*rh_finger4p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger4p2_left[i].ypos = Y_REVERSE_IND*rh_finger4p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger4p2_left[i].xpos, rh_finger4p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger4p2_left[i].xpos, rh_finger4p2_left[i].ypos)
	end if
next

integer RH_F4P2R=7
integer rh_finger4p2_right_list[] = {2540,396,2544,504,2547,620,2552,792,2565,900,2580,1000,2590,1016}
str_mousepos rh_finger4p2_right[]
for i=1 to RH_F4P2R
	rh_finger4p2_right[i].xpos = X_REVERSE_IND*rh_finger4p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger4p2_right[i].ypos = Y_REVERSE_IND*rh_finger4p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger4p2_right[i].xpos, rh_finger4p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger4p2_right[i].xpos, rh_finger4p2_right[i].ypos)
	end if
next



integer RH_F5P1L=8
integer rh_finger5p1_left_list[] = {2743,312,2725,316,2674,352,2656,384,2670,424,2670,448,2720,480,2775,524}
str_mousepos rh_finger5p1_left[]
for i=1 to RH_F5P1L
	rh_finger5p1_left[i].xpos = X_REVERSE_IND*rh_finger5p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger5p1_left[i].ypos = Y_REVERSE_IND*rh_finger5p1_left_list[i*2]*Y_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger5p1_left[i].xpos, rh_finger5p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger5p1_left[i].xpos, rh_finger5p1_left[i].ypos)
	end if
next

integer RH_F5P1R=6
integer rh_finger5p1_right_list[] = {2743,312,2834,348,2898,380,3022,428,3058,468,3081,576}
str_mousepos rh_finger5p1_right[]
for i=1 to RH_F5P1R
	rh_finger5p1_right[i].xpos = X_REVERSE_IND*rh_finger5p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger5p1_right[i].ypos = Y_REVERSE_IND*rh_finger5p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger5p1_right[i].xpos, rh_finger5p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger5p1_right[i].xpos, rh_finger5p1_right[i].ypos)
	end if
next

integer RH_F5P2L=8
integer rh_finger5p2_left_list[] = {2775,524,2770,568,2752,616,2757,680,2761,760,2679,864,2633,944,2592,1004}
str_mousepos rh_finger5p2_left[]
for i=1 to RH_F5P2L
	rh_finger5p2_left[i].xpos = X_REVERSE_IND*rh_finger5p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger5p2_left[i].ypos = Y_REVERSE_IND*rh_finger5p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger5p2_left[i].xpos, rh_finger5p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger5p2_left[i].xpos, rh_finger5p2_left[i].ypos)
	end if
next

integer RH_F5P2R=6
integer rh_finger5p2_right_list[] = {3081,576,3122,692,3109,780,3095,860,3068,936,3008,1060}
str_mousepos rh_finger5p2_right[]
for i=1 to RH_F5P2R
	rh_finger5p2_right[i].xpos = X_REVERSE_IND*rh_finger5p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger5p2_right[i].ypos = Y_REVERSE_IND*rh_finger5p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger5p2_right[i].xpos, rh_finger5p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger5p2_right[i].xpos, rh_finger5p2_right[i].ypos)
	end if
next

integer RH_LEFT_NUM=5
integer rh_left_list[] = {800,1534,658,1334,594,1206,540,1050,498,902}
str_mousepos rh_left[]
for i=1 to RH_LEFT_NUM
	rh_left[i].xpos = X_REVERSE_IND*rh_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_left[i].ypos = Y_REVERSE_IND*rh_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_left[i].xpos, rh_left[i].ypos, p)
	else
		LineTo(ul_device, rh_left[i].xpos, rh_left[i].ypos)
	end if
next


integer RH_RIGHT_NUM=9
integer rh_right_list[] = {3008,1060,2962,1144,2953,1192,2935,1264,2930,1344,2926,1456,2903,1528,2917,1588,2898,1656}
str_mousepos rh_right[]
for i=1 to RH_RIGHT_NUM
	rh_right[i].xpos = X_REVERSE_IND*rh_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_right[i].ypos = Y_REVERSE_IND*rh_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_right[i].xpos, rh_right[i].ypos, p)
	else
		LineTo(ul_device, rh_right[i].xpos, rh_right[i].ypos)
	end if
next







return 1
end function

public function integer wf_draw_fingers2 (integer ax_resize_numerator, integer ax_resize_denominator, integer ay_resize_numerator, integer ay_resize_denominator, integer ax_reverse_ind, integer ay_reverse_ind, integer ax_offset, integer ay_offset);long i,li_x, li_y
ulong ul_win_handle, ul_device, ul_color
integer li_num, li_image_width, li_image_height, li_i,li_j, li_pos
string ls_buf, ls_sub
integer X_RESIZE_NUMERATOR,X_RESIZE_DENOMINATOR,Y_RESIZE_NUMERATOR,Y_RESIZE_DENOMINATOR
integer X_REVERSE_IND, Y_REVERSE_IND, X_OFFSET, Y_OFFSET
X_RESIZE_NUMERATOR = ax_resize_numerator
X_RESIZE_DENOMINATOR = ax_resize_denominator
Y_RESIZE_NUMERATOR = ay_resize_numerator
Y_RESIZE_DENOMINATOR = ay_resize_denominator
X_REVERSE_IND = ax_reverse_ind
Y_REVERSE_IND = ay_reverse_ind
X_OFFSET = ax_offset
Y_OFFSET = ay_offset


ul_win_handle = handle(p_1)

ul_device = GetDC(ul_win_handle)

integer RH_F1P1L =5
integer rh_finger1p1_left_list[] = {626 - 20,198 - 20,576 - 20,218 - 20,544 - 10,254 - 20,549 - 20,334 - 20,544 - 20,462 - 20}
str_mousepos rh_finger1p1_left[], p
for i=1 to RH_F1P1L
	rh_finger1p1_left[i].xpos = X_REVERSE_IND*rh_finger1p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger1p1_left[i].ypos = Y_REVERSE_IND*rh_finger1p1_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger1p1_left[i].xpos, rh_finger1p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger1p1_left[i].xpos, rh_finger1p1_left[i].ypos)
	end if
next

integer RH_F1P1R=5
integer rh_finger1p1_right_list[] = {626,198,709,214,764,254,805,418,828,518}
str_mousepos rh_finger1p1_right[]
for i=1 to RH_F1P1R
	rh_finger1p1_right[i].xpos = X_REVERSE_IND*rh_finger1p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger1p1_right[i].ypos = Y_REVERSE_IND*rh_finger1p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger1p1_right[i].xpos, rh_finger1p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger1p1_right[i].xpos, rh_finger1p1_right[i].ypos)
	end if
next

integer RH_F1P2L=6
integer rh_finger1p2_left_list[] = {544,462,508,554,448,678,434,710,457,814,498,902}
str_mousepos rh_finger1p2_left[]
for i=1 to RH_F1P2L
	rh_finger1p2_left[i].xpos = X_REVERSE_IND*rh_finger1p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET - 40
	rh_finger1p2_left[i].ypos = Y_REVERSE_IND*rh_finger1p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger1p2_left[i].xpos, rh_finger1p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger1p2_left[i].xpos, rh_finger1p2_left[i].ypos)
	end if
next

integer RH_F1P2R=3

integer rh_finger1p2_right_list[] = {828,518,815,678,950,1024}
str_mousepos rh_finger1p2_right[]
for i=1 to RH_F1P2R
	rh_finger1p2_right[i].xpos = X_REVERSE_IND*rh_finger1p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger1p2_right[i].ypos = Y_REVERSE_IND*rh_finger1p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger1p2_right[i].xpos, rh_finger1p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger1p2_right[i].xpos, rh_finger1p2_right[i].ypos)
	end if
next


integer RH_F2P1L=6
integer rh_finger2p1_left_list[] = {1376,44,1220,70,1120,128,1037,188,973,312,923,448}
str_mousepos rh_finger2p1_left[]
for i=1 to RH_F2P1L
	rh_finger2p1_left[i].xpos = X_REVERSE_IND*rh_finger2p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger2p1_left[i].ypos = Y_REVERSE_IND*rh_finger2p1_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger2p1_left[i].xpos, rh_finger2p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger2p1_left[i].xpos, rh_finger2p1_left[i].ypos)
	end if
next


integer RH_F2P1R=6
integer rh_finger2p1_right_list[] = {1376,52,1422,96,1422,156,1399,192,1298,276,1294,388}
str_mousepos rh_finger2p1_right[]
for i=1 to RH_F2P1R
	rh_finger2p1_right[i].xpos = X_REVERSE_IND*rh_finger2p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET 
	rh_finger2p1_right[i].ypos = Y_REVERSE_IND*rh_finger2p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger2p1_right[i].xpos, rh_finger2p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger2p1_right[i].xpos, rh_finger2p1_right[i].ypos)
	end if
next


integer RH_F2P2L=4
integer rh_finger2p2_left_list[] = {923,448,877,600,928,792,969,1024}
str_mousepos rh_finger2p2_left[]
for i=1 to RH_F2P2L
	rh_finger2p2_left[i].xpos = X_REVERSE_IND*rh_finger2p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger2p2_left[i].ypos = Y_REVERSE_IND*rh_finger2p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger2p2_left[i].xpos, rh_finger2p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger2p2_left[i].xpos, rh_finger2p2_left[i].ypos)
	end if
next

integer RH_F2P2R=4
integer rh_finger2p2_right_list[] = {1294,388,1253,532,1330,680,1399,836}
str_mousepos rh_finger2p2_right[]
for i=1 to RH_F2P2R
	rh_finger2p2_right[i].xpos = X_REVERSE_IND*rh_finger2p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger2p2_right[i].ypos = Y_REVERSE_IND*rh_finger2p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger2p2_right[i].xpos, rh_finger2p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger2p2_right[i].xpos, rh_finger2p2_right[i].ypos)
	end if
next


integer RH_F3P1L=6
integer rh_finger3p1_left_list[] = {1815,0,1719,12,1641,60,1600,152,1550,244,1509,376}
str_mousepos rh_finger3p1_left[]
for i=1 to RH_F3P1L
	rh_finger3p1_left[i].xpos = X_REVERSE_IND*rh_finger3p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger3p1_left[i].ypos = Y_REVERSE_IND*rh_finger3p1_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger3p1_left[i].xpos, rh_finger3p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger3p1_left[i].xpos, rh_finger3p1_left[i].ypos)
	end if
next

integer RH_F3P1R=5
integer rh_finger3p1_right_list[] = {1815,0,1897,60,1934,168,1961,288,1970,420}
str_mousepos rh_finger3p1_right[]
for i=1 to RH_F3P1R
	rh_finger3p1_right[i].xpos = X_REVERSE_IND*rh_finger3p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger3p1_right[i].ypos = Y_REVERSE_IND*rh_finger3p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger3p1_right[i].xpos, rh_finger3p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger3p1_right[i].xpos, rh_finger3p1_right[i].ypos)
	end if
next

integer RH_F3P2L=5
integer rh_finger3p2_left_list[] = {1509,376,1490,448,1481,584,1472,728,1413,848}
str_mousepos rh_finger3p2_left[]
for i=1 to RH_F3P2L
	rh_finger3p2_left[i].xpos = X_REVERSE_IND*rh_finger3p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger3p2_left[i].ypos = Y_REVERSE_IND*rh_finger3p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger3p2_left[i].xpos, rh_finger3p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger3p2_left[i].xpos, rh_finger3p2_left[i].ypos)
	end if
next

integer RH_F3P2R=5
integer rh_finger3p2_right_list[] = {1970,420,1993,596,2007,708,2030,908,2069,928}
str_mousepos rh_finger3p2_right[]
for i=1 to RH_F3P2L
	rh_finger3p2_right[i].xpos = X_REVERSE_IND*rh_finger3p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger3p2_right[i].ypos = Y_REVERSE_IND*rh_finger3p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger3p2_right[i].xpos, rh_finger3p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger3p2_right[i].xpos, rh_finger3p2_right[i].ypos)
	end if
next

integer RH_F4P1L=7
integer rh_finger4p1_left_list[] = {2151,56,2119,80,2083,124,2074,192,2110,252,2170,300,2174,328}
str_mousepos rh_finger4p1_left[]
for i=1 to RH_F4P1L
	rh_finger4p1_left[i].xpos = X_REVERSE_IND*rh_finger4p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger4p1_left[i].ypos = Y_REVERSE_IND*rh_finger4p1_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger4p1_left[i].xpos, rh_finger4p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger4p1_left[i].xpos, rh_finger4p1_left[i].ypos)
	end if
next

integer RH_F4P1R=6
integer rh_finger4p1_right_list[] = {2151,56,2229,68,2279,96,2416,132,2540,352,2540,396}
str_mousepos rh_finger4p1_right[]
for i=1 to RH_F4P1R
	rh_finger4p1_right[i].xpos = X_REVERSE_IND*rh_finger4p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger4p1_right[i].ypos = Y_REVERSE_IND*rh_finger4p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger4p1_right[i].xpos, rh_finger4p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger4p1_right[i].xpos, rh_finger4p1_right[i].ypos)
	end if
next

integer RH_F4P2L=7
integer rh_finger4p2_left_list[] = {2174,328,2156,416,2156,476,2160,536,2174,600,2124,764,2069,928}
str_mousepos rh_finger4p2_left[]
for i=1 to RH_F4P2L
	rh_finger4p2_left[i].xpos = X_REVERSE_IND*rh_finger4p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger4p2_left[i].ypos = Y_REVERSE_IND*rh_finger4p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger4p2_left[i].xpos, rh_finger4p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger4p2_left[i].xpos, rh_finger4p2_left[i].ypos)
	end if
next

integer RH_F4P2R=7
integer rh_finger4p2_right_list[] = {2540,396,2544,504,2547,620,2552,792,2565,900,2580,1000,2590,1016}
str_mousepos rh_finger4p2_right[]
for i=1 to RH_F4P2R
	rh_finger4p2_right[i].xpos = X_REVERSE_IND*rh_finger4p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger4p2_right[i].ypos = Y_REVERSE_IND*rh_finger4p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger4p2_right[i].xpos, rh_finger4p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger4p2_right[i].xpos, rh_finger4p2_right[i].ypos)
	end if
next



integer RH_F5P1L=8
integer rh_finger5p1_left_list[] = {2743,312,2725,316,2674,352,2656,384,2670,424,2670,448,2720,480,2775,524}
str_mousepos rh_finger5p1_left[]
for i=1 to RH_F5P1L
	rh_finger5p1_left[i].xpos = X_REVERSE_IND*rh_finger5p1_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger5p1_left[i].ypos = Y_REVERSE_IND*rh_finger5p1_left_list[i*2]*Y_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger5p1_left[i].xpos, rh_finger5p1_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger5p1_left[i].xpos, rh_finger5p1_left[i].ypos)
	end if
next

integer RH_F5P1R=6
integer rh_finger5p1_right_list[] = {2743,312,2834,348,2898,380,3022,428,3058,468,3081,576}
str_mousepos rh_finger5p1_right[]
for i=1 to RH_F5P1R
	rh_finger5p1_right[i].xpos = X_REVERSE_IND*rh_finger5p1_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger5p1_right[i].ypos = Y_REVERSE_IND*rh_finger5p1_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger5p1_right[i].xpos, rh_finger5p1_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger5p1_right[i].xpos, rh_finger5p1_right[i].ypos)
	end if
next

integer RH_F5P2L=8
integer rh_finger5p2_left_list[] = {2775,524,2770,568,2752,616,2757,680,2761,760,2679,864,2633,944,2592,1004}
str_mousepos rh_finger5p2_left[]
for i=1 to RH_F5P2L
	rh_finger5p2_left[i].xpos = X_REVERSE_IND*rh_finger5p2_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger5p2_left[i].ypos = Y_REVERSE_IND*rh_finger5p2_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger5p2_left[i].xpos, rh_finger5p2_left[i].ypos, p)
	else
		LineTo(ul_device, rh_finger5p2_left[i].xpos, rh_finger5p2_left[i].ypos)
	end if
next

integer RH_F5P2R=6
integer rh_finger5p2_right_list[] = {3081,576,3122,692,3109,780,3095,860,3068,936,3008,1060}
str_mousepos rh_finger5p2_right[]
for i=1 to RH_F5P2R
	rh_finger5p2_right[i].xpos = X_REVERSE_IND*rh_finger5p2_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_finger5p2_right[i].ypos = Y_REVERSE_IND*rh_finger5p2_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_finger5p2_right[i].xpos, rh_finger5p2_right[i].ypos, p)
	else
		LineTo(ul_device, rh_finger5p2_right[i].xpos, rh_finger5p2_right[i].ypos)
	end if
next

integer RH_LEFT_NUM=5
integer rh_left_list[] = {800,1534,658,1334,594,1206,540,1050,498,902}
str_mousepos rh_left[]
for i=1 to RH_LEFT_NUM
	rh_left[i].xpos = X_REVERSE_IND*rh_left_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_left[i].ypos = Y_REVERSE_IND*rh_left_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_left[i].xpos, rh_left[i].ypos, p)
	else
		LineTo(ul_device, rh_left[i].xpos, rh_left[i].ypos)
	end if
next


integer RH_RIGHT_NUM=9
integer rh_right_list[] = {3008,1060,2962,1144,2953,1192,2935,1264,2930,1344,2926,1456,2903,1528,2917,1588,2898,1656}
str_mousepos rh_right[]
for i=1 to RH_RIGHT_NUM
	rh_right[i].xpos = X_REVERSE_IND*rh_right_list[i*2 - 1]*X_RESIZE_NUMERATOR/X_RESIZE_DENOMINATOR + X_OFFSET
	rh_right[i].ypos = Y_REVERSE_IND*rh_right_list[i*2]*X_RESIZE_NUMERATOR/Y_RESIZE_DENOMINATOR + Y_OFFSET
	if i= 1 then
		MoveToEx(ul_device, rh_right[i].xpos, rh_right[i].ypos, p)
	else
		LineTo(ul_device, rh_right[i].xpos, rh_right[i].ypos)
	end if
next







return 1
end function

public function integer wf_getderivatives (ref double adb_xarr_list[], ref double adb_yarr_list[], integer ai_n, ref double adb_deriv_list[], ref double adb_h_list[], double adb_tolerance); double ldb_a_list[]
 double ldb_b_list[]
 double ldb_c_list[]
 
 int i, j, k, result

//MessageBox("upperbound(adb_h_list)", upperbound(adb_h_list))
//MessageBox("upperbound(adb_xarr_list)", upperbound(adb_xarr_list))
//MessageBox("upperbound(adb_yarr_list)", upperbound(adb_yarr_list))
//MessageBox("upperbound(adb_deriv_list)", upperbound(adb_deriv_list))

for i=2 to ai_n
	j = i - 1
	adb_h_list[i] = adb_xarr_list[i] - adb_xarr_list[j]
	if adb_h_list[i] = 0 then return -9999
	adb_deriv_list[i] = (adb_yarr_list[i] - adb_yarr_list[j])/adb_h_list[i]
 next

for i = 2 to (ai_n - 1)
	j = i - 1
	k = i + 1
	ldb_b_list[j] = 2
	if (adb_h_list[i]+adb_h_list[k]) = 0 then return -9999
	ldb_c_list[j] = adb_h_list[k]/(adb_h_list[i]+adb_h_list[k])
	ldb_a_list[j] = 1 - ldb_c_list[j]
	adb_deriv_list[j] = 6*(adb_deriv_list[k] - adb_deriv_list[i])/(adb_h_list[i]+adb_h_list[k] ) 
next

result = wf_tridiagonal(ai_n - 2, ldb_a_list, ldb_b_list, ldb_c_list, adb_deriv_list, adb_tolerance)

return result

//int getDerivatives(double* xarr, double* yarr, int n,
//                   double* deriv, double* h,
//		   double tolerance)
//{
//  double* a;
//  double* b;
//  double* c;
//  int i, j, k, result;
//
//  a = (double*)malloc(n * sizeof(double));
//  b = (double*)malloc(n * sizeof(double));
//  c = (double*)malloc(n * sizeof(double));
//
//  for (i = 1; i < n; i++) {
//    j = i - 1;
//    *(h + i) = *(xarr + i) - *(xarr + j);
//    *(deriv + i) = (*(yarr + i) - *(yarr + j)) / *(h + i);
//  }
//
//  for (i = 1; i < (n - 1); i++) {
//    j = i - 1;
//    k = i + 1;
//    *(b + j) = 2;
//    *(c + j) = *(h + k)/(*(h + i) + *(h + k));
//    *(a + j) = 1 - *(c + j);
//    *(deriv + j) = 6 * (*(deriv + k) - *(deriv + i)) /
//                   (*(h + i) + *(h + k));
//  }
//
//  /* solve for the second derivatives */
//  result = tridiagonal(n - 2, a, b, c, deriv, tolerance);
//
//  /* deallocate the dynamic arrays */
//  free(a);
//  free(b);
//  free(c);
//
//  return result;
//}
end function

public function double wf_spline (ref double adb_xarr_list[], ref double adb_yarr_list[], ref double adb_deriv_list[], ref double adb_h_list[], integer ai_n, double adb_x);int j, i = 1
double adb_delta1, adb_delta2, ldb_y, term0, term1

/* locate subinterval containing x */

string msg
do while true
	if i = ai_n then exit
	if (adb_x >= adb_xarr_list[i]) and (adb_x <= adb_xarr_list[i + 1]) then exit
	if (adb_x <= adb_xarr_list[i]) and (adb_x >= adb_xarr_list[i + 1]) then exit
//	((adb_x < adb_xarr_list[i]) or (adb_x > adb_xarr_list[i + 1]) and  i < ai_n)
//	msg = "adb_x: " + string(adb_x) + "adb_xarr_list[" + string(i) + "] adb_xarr_list[" + string(i+1) + "]"
//	MessageBox("msg", msg)
   i++ 
loop

//MessageBox("i", i)
if i >= ai_n then return -9999.0

j = i + 1;
adb_delta1 = adb_x - adb_xarr_list[i]
adb_delta2 = adb_xarr_list[j] - adb_x

//if i - 1 < 1 then return -9999.0

	
	
//term0 = 	adb_deriv_list[i]
//term0 = 	adb_h_list[j]
//term0 = 	adb_yarr_list[i]
//term0 = 	adb_yarr_list[j]
//term0 = 	adb_deriv_list[i]
//term0 = 	adb_deriv_list[i]
//term0 = 	adb_deriv_list[i]


if adb_h_list[j] = 0 then return -9999.0
if (i - 1) < 1 then
	ldb_y = (adb_yarr_list[j]/adb_h_list[j] - adb_deriv_list[i]*adb_h_list[j]/6) * adb_delta1 + &
				(adb_yarr_list[i]/adb_h_list[j] - term0*adb_h_list[j]/6) * adb_delta2
else				
	ldb_y = (adb_deriv_list[i - 1]*adb_delta2*adb_delta2*adb_delta2)/(6*adb_h_list[j]) + &
				(adb_deriv_list[i]*adb_delta1*adb_delta1*adb_delta1)/(6*adb_h_list[j]) + &
				(adb_yarr_list[j]/adb_h_list[j] - adb_deriv_list[i]*adb_h_list[j]/6) * adb_delta1 + &
				(adb_yarr_list[i]/adb_h_list[j] - term0*adb_h_list[j]/6) * adb_delta2
end if
return ldb_y


//double Spline(double* xarr, double* yarr, double* deriv,
//              double* h, int n, double x)
//{
//  int j, i = 0;
//  double delta1, delta2, y;
//
//  /* locate subinterval containing x */
//  while ((x < *(xarr + i) || x > *(xarr + i + 1)) && i < (n - 1))
//    i++;
//
//  if (i >= (n - 1)) return BAD_RESULT;
//
//  j = i + 1;
//  delta1 = x - *(xarr + i);
//  delta2 = *(xarr + j) - x;
//  y = (*(deriv + i - 1) * delta2 * delta2 * delta2)/(6 * *(h + j)) +
//      (*(deriv + i) * delta1 * delta1 * delta1)/(6 * *(h + j)) +
//      (*(yarr + j) / *(h + j) - *(deriv + i)* *(h + j) / 6) * delta1 +    
//      (*(yarr + i) / *(h + j) - *(deriv + i - 1) * *(h + j) / 6) * delta2;
//      
//
//  return y;
//}
end function

public function integer wf_tridiagonal (integer ai_n, ref double adb_a_list[], ref double adb_b_list[], ref double adb_c_list[], ref double adb_d_list[], double adb_epsilon);int isSingular
int i

if adb_b_list[1] < adb_epsilon then
	isSingular = 1
else
	isSingular = 0
end if	

/* carry out LU factorization */
for i = 2 to ai_n
	if isSingular = 1 then exit
	adb_a_list[i] = adb_a_list[i]/adb_b_list[i - 1]
	adb_b_list[i] = adb_b_list[i] - adb_a_list[i]*adb_c_list[i - 1]
 /* determine if diagonal element is too small */
	if adb_b_list[1] < adb_epsilon then
		isSingular = 1
	else
		isSingular = 0
	end if	
	adb_d_list[i] = adb_d_list[i] - adb_a_list[i]*adb_d_list[i - 1]
next

if isSingular = 0 then
 /* carry out backward substitution */
	adb_d_list[ai_n - 1] = adb_d_list[ai_n - 1]/adb_b_list[ai_n - 1]
	for i = (ai_n - 1) to 1 step -1
		adb_d_list[i] = (adb_d_list[i] - adb_c_list[i]*adb_d_list[i + 1])/adb_b_list[i]
	next
	return 1
else
	return 0
end if

//int tridiagonal(int n, double* a, double* b, double* c,
//                double* d, double epsilon)
//{
//  int isSingular;
//  int i;
//
//  isSingular = (*b < epsilon) ? TRUE : FALSE;
//
//  /* carry out LU factorization */
//  for (i = 1; i < n && !isSingular; i++) {
//    *(a + i) = *(a + i) / *(b + i - 1);
//    *(b + i) = *(b + i) - *(a +i) * *(c + i - 1);
//    /* determine if diagonal element is too small */
//    isSingular = (*(b + i) < epsilon) ? TRUE : FALSE;
//    *(d + i) = *(d + i) - *(a + i) * *(d + i - 1);
//  }
//
//  if (!isSingular) {
//    /* carry out backward substitution */
//    *(d + n - 1) = *(d + n - 1) / *(b + n - 1);
//    for (i = n - 2; i >= 0; i--)
//      *(d + i) = (*(d + i) - *(c + i) * *(d + i + 1)) / *(b + i);
//    return TRUE;
//  }
//  else
//    return FALSE;
//}
//

end function

public function boolean isnaturalnote (integer ai_note);integer li_mod_remain

li_mod_remain =  mod(ai_note, 12)
choose case li_mod_remain
	case 0, 2, 4, 5, 7, 9, 11 // a natural key
		return true
end choose

return false
end function

public function integer getarrayrange (long al_array[]);integer li_i

long ll_min = 9999, ll_max = -9999

if upperbound(al_array) = 0 then return -1

for li_i = 1 to upperbound(al_array)
	if al_array[li_i] < ll_min then ll_min = al_array[li_i]
	if al_array[li_i] > ll_max then ll_max = al_array[li_i]
next

return ll_max - ll_min + 1
end function

public function integer wf_send_note ();long ll_lh_id[],ll_lh_note_id[],ll_lh_note_x[],ll_lh_note_y[],ll_lh_w_pct_y[],ll_lh_h_pct_y[],ll_lh_size
long ll_rh_id[],ll_rh_note_id[],ll_rh_note_x[],ll_rh_note_y[],ll_rh_w_pct_y[],ll_rh_h_pct_y[],ll_rh_size

string ls_entry, ls_note, ls_finger_attr, ls_atom
integer li_pos1, li_pos2, li_n, li_i, li_l = 0, li_r = 0, li_fingering_ind
//constant integer REAPEAT_FINGERING = 9
//constant integer NO_FINGERING = 0
//constant integer LEFTHAND_FINGERING = 1
//constant integer RIGHTHAND_FINGERING = 2

if ii_current_i < 1 or ii_current_i > upperbound(is_entry_list) then return 0 // end of array
do while pos(is_entry_list[ii_current_i], "repeat") > 0 and ii_current_i <= upperbound(is_entry_list)
	ii_current_i++ // repeat note indicator, skip it
loop

if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
	MessageBox("Error", "No Hand Selected, Cannot Send Note!")
	return 0
end if

if cbx_append_left_hand.checked and cbx_append_right_hand.checked then
	ls_entry = is_entry_list[ii_current_i]
elseif cbx_append_left_hand.checked then
	ls_entry = is_lh_text_list[ii_current_i]
else
	ls_entry = is_rh_text_list[ii_current_i]	
end if


li_pos1 = pos(ls_entry, "FB")
if li_pos1 = 0 then return 0 // NOT A VALID ENTRY 
li_pos2 = pos(ls_entry, "FE")
li_fingering_ind = integer(mid(ls_entry, li_pos1 + 2, 1))
ls_note = right(ls_entry, len(ls_entry) - (li_pos2 + 1)) 


//is_rh_text_list[], is_lh_text_list[], is_bh_text_list[]

ls_finger_attr = mid(ls_entry, li_pos1 + 2, li_pos2 - li_pos1 - 2)
li_n = len(ls_finger_attr)/17
//MessageBox("ls_finger_attr", ls_finger_attr)
if li_fingering_ind = LEFTHAND_FINGERING or li_fingering_ind = RIGHTHAND_FINGERING then
	for li_i = 1 to li_n
		ls_atom = mid(ls_finger_attr, (li_i - 1)*17 + 1, 17)
		if left(ls_atom, 1) = "1" and cbx_append_left_hand.checked then
			li_l++
			ll_lh_id[li_l] = long(left(ls_atom, 4))
			ll_lh_note_id[li_l] = long(mid(ls_atom, 5, 3))
			ll_lh_note_x[li_l] = long(mid(ls_atom, 8, 2))
			ll_lh_note_y[li_l] = long(mid(ls_atom, 10, 2))
			ll_lh_w_pct_y[li_l] = long(mid(ls_atom, 12, 3))
			ll_lh_h_pct_y[li_l] = long(mid(ls_atom, 15, 3))
		end if
		if left(ls_atom, 1) = "2" and cbx_append_right_hand.checked then
			li_r++
			ll_rh_id[li_r] = long(left(ls_atom, 4))
			ll_rh_note_id[li_r] = long(mid(ls_atom, 5, 3))
			ll_rh_note_x[li_r] = long(mid(ls_atom, 8, 2))
			ll_rh_note_y[li_r] = long(mid(ls_atom, 10, 2))
			ll_rh_w_pct_y[li_r] = long(mid(ls_atom, 12, 3))
			ll_rh_h_pct_y[li_r] = long(mid(ls_atom, 15, 3))
		end if
	next
	extCurrentEntry(ll_lh_id,ll_lh_note_id,ll_lh_note_x,ll_lh_note_y,ll_lh_w_pct_y,ll_lh_h_pct_y,upperbound(ll_lh_id),ll_rh_id,ll_rh_note_id,ll_rh_note_x,ll_rh_note_y,ll_rh_w_pct_y,ll_rh_h_pct_y,upperbound(ll_rh_id))
end if

if li_fingering_ind = NO_FINGERING then // clear the fingering
//	MessageBox("NO_FINGERING", NO_FINGERING)
	extClearCurGraph()
end if
// else if ls_finger_attr = REAPEAT_FINGERING, DO NOTHING AS THE PREVIOUS FINGERING WILL BE USED

ls_note = right(ls_note, len(ls_note) - 16)	// note attribues are 16 chars after note cooordinate attr
extSetCurrentNote(ls_note) 

//MessageBox(ls_note, il_thread_id)
extPostThreadMessage(il_thread_id, 1025, 0, 0)	// send message to the music player to inform Next Note to play data in sharemory


return 1
end function

public function integer wf_get_finger_entry_id (ref long al_entry_id_list[], ref string as_entry_id_list[]);integer li_i, li_j, li_k, li_pos1, li_pos2, li_fingering_ind
string ls_entry,ls_id, ls_finger_attr
long ll_id
boolean lb_found = false

constant integer REAPEAT_FINGERING = 9
constant integer NO_FINGERING = 0
constant integer LEFTHAND_FINGERING = 1
constant integer RIGHTHAND_FINGERING = 2


for li_i = 2 to upperbound(is_entry_list)
	ls_entry = is_entry_list[li_i]
	if pos(ls_entry, "repeat") > 0 then continue
	li_pos1 = pos(ls_entry, "FB")
	li_pos2 = pos(ls_entry, "FE")
	li_fingering_ind = integer(mid(ls_entry, li_pos1 + 2, 1))
	if li_fingering_ind = REAPEAT_FINGERING or li_fingering_ind = NO_FINGERING then continue
	ls_finger_attr = mid(ls_entry, li_pos1 + 2, li_pos2 - li_pos1 - 2)
	for li_j = 1 to len(ls_finger_attr)/17
		ls_id = mid(ls_finger_attr, 17*(li_j - 1) + 1, 4)
		ll_id = long(ls_id)
		lb_found = false
		for li_k = 1 to upperbound(al_entry_id_list) 
			if ll_id = al_entry_id_list[li_k] then
				lb_found = true
				exit
			end if
		next
		if not lb_found then
			as_entry_id_list[upperbound(as_entry_id_list) + 1] = ls_id
			al_entry_id_list[upperbound(al_entry_id_list) + 1]  = ll_id
		end if
	next	
next

return 1
end function

public function integer wf_fingering_test (string as_finger_attr, string as_entry);long ll_lh_id[],ll_lh_note_id[],ll_lh_note_x[],ll_lh_note_y[],ll_lh_w_pct_y[],ll_lh_h_pct_y[],ll_lh_size
long ll_rh_id[],ll_rh_note_id[],ll_rh_note_x[],ll_rh_note_y[],ll_rh_w_pct_y[],ll_rh_h_pct_y[],ll_rh_size

string ls_entry, ls_note, ls_finger_attr, ls_atom, ls_note_sent_to_keyboard
integer li_pos1, li_pos2, li_n, li_i, li_j, li_l = 0, li_r = 0, li_fingering_ind, li_finger

string ls_note_coordinate,ls_note_to_keyboard, ls_empty_list[]
string ls_rh_time_fraction[],ls_rh_note_value[],ls_rh_note_char[],ls_rh_note_finger[]
string ls_lh_time_fraction[],ls_lh_note_value[],ls_lh_note_char[],ls_lh_note_finger[]
string ls_rh_time_fraction1[],ls_rh_note_value1[],ls_rh_note_char1[],ls_rh_note_finger1[]
string ls_lh_time_fraction1[],ls_lh_note_value1[],ls_lh_note_char1[],ls_lh_note_finger1[]
string ls_rh_time_fraction0[],ls_rh_note_value0[],ls_rh_note_char0[],ls_rh_note_finger0[]
string ls_lh_time_fraction0[],ls_lh_note_value0[],ls_lh_note_char0[],ls_lh_note_finger0[]
string ls_rh_time_fraction00[],ls_rh_note_value00[],ls_rh_note_char00[],ls_rh_note_finger00[]
string ls_lh_time_fraction00[],ls_lh_note_value00[],ls_lh_note_char00[],ls_lh_note_finger00[]
string ls_finger_entry_list[]
integer li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, li_note_set_count
integer li_total_note_set_count1,li_rh_note_set_count1,li_lh_note_set_count1
integer li_total_note_set_count0=0,li_rh_note_set_count0=0,li_lh_note_set_count0=0
integer li_total_note_set_count00=0,li_rh_note_set_count00=0,li_lh_note_set_count00=0
integer li_current_note, li_entry_count, ii_rh_note_tmp, ii_lh_note_tmp


//if ii_current_i < 1 or ii_current_i > upperbound(is_fingering_list) then return 0 // end of array
//if pos(is_fingering_list[ii_current_i], "repeat") > 0 then return 0 // ignore it 
//if trim(is_fingering_list[ii_current_i]) = "" then return 0 // ignore it 
//ls_entry = is_fingering_list[ii_current_i]


ls_entry = as_finger_attr
li_pos1 = pos(ls_entry, "FB")
if li_pos1 = 0 then return 0 // NOT A VALID ENTRY 
li_pos2 = pos(ls_entry, "FE")
li_fingering_ind = integer(mid(ls_entry, li_pos1 + 2, 1))
ls_note = right(ls_entry, len(ls_entry) - (li_pos2 + 1)) 
ls_finger_attr = mid(ls_entry, li_pos1 + 2, li_pos2 - li_pos1 - 2)
li_n = len(ls_finger_attr)/17
//MessageBox("ls_finger_attr", ls_finger_attr)
if li_fingering_ind = LEFTHAND_FINGERING or li_fingering_ind = RIGHTHAND_FINGERING then
	
	if cbx_activate_animation.checked then	
		wf_parse_note_attribute(as_entry,ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, &
				ls_rh_time_fraction,ls_lh_time_fraction,ls_rh_note_value,ls_lh_note_value,ls_rh_note_char,ls_lh_note_char,ls_rh_note_finger,ls_lh_note_finger)						
	end if
	for li_i = 1 to li_n
		ls_atom = mid(ls_finger_attr, (li_i - 1)*17 + 1, 17)
		li_finger = integer(mid(ls_atom, 2, 1))
		if left(ls_atom, 1) = "1" and cbx_append_left_hand.checked then
			li_l++
			ll_lh_id[li_l] = long(left(ls_atom, 4))
			ll_lh_note_id[li_l] = long(mid(ls_atom, 5, 3))
			ll_lh_note_x[li_l] = long(mid(ls_atom, 8, 2))
			ll_lh_note_y[li_l] = long(mid(ls_atom, 10, 2))
			ll_lh_w_pct_y[li_l] = long(mid(ls_atom, 12, 3))
			ll_lh_h_pct_y[li_l] = long(mid(ls_atom, 15, 3))
		end if
		if left(ls_atom, 1) = "2" and cbx_append_right_hand.checked then
			li_r++
			ll_rh_id[li_r] = long(left(ls_atom, 4))
			ll_rh_note_id[li_r] = long(mid(ls_atom, 5, 3))
			ll_rh_note_x[li_r] = long(mid(ls_atom, 8, 2))
			ll_rh_note_y[li_r] = long(mid(ls_atom, 10, 2))
			ll_rh_w_pct_y[li_r] = long(mid(ls_atom, 12, 3))
			ll_rh_h_pct_y[li_r] = long(mid(ls_atom, 15, 3))
		end if
	next
	
	extCurrentEntry(ll_lh_id,ll_lh_note_id,ll_lh_note_x,ll_lh_note_y,ll_lh_w_pct_y,ll_lh_h_pct_y,upperbound(ll_lh_id),ll_rh_id,ll_rh_note_id,ll_rh_note_x,ll_rh_note_y,ll_rh_w_pct_y,ll_rh_h_pct_y,upperbound(ll_rh_id))
end if

if li_fingering_ind = NO_FINGERING then // clear the fingering
//	MessageBox("NO_FINGERING", NO_FINGERING)
	extClearCurGraph()
end if
if cbx_note_on.checked and len(as_entry) > 18 then
//	MessageBox("as_entry", as_entry)
	li_pos2 = pos(as_entry, "FE")
	if li_pos2 > 0 then
		ls_note = right(as_entry, len(as_entry) - (li_pos2 + 1)) 
	else
		ls_note = as_entry 
	end if
//	MessageBox("ls_note", ls_note)
	ls_note_sent_to_keyboard = right(ls_note, len(ls_note) - 18)
//	MessageBox("ls_note_sent_to_keyboard", ls_note_sent_to_keyboard)
	extSetCurrentNote(ls_note_sent_to_keyboard) 	// place the note string in the global memory
	extPostThreadMessage(il_thread_id, 1025, 0, 0)	// send message to the music player to inform Next Note to pick up data in global memory
else
	if li_fingering_ind = REAPEAT_FINGERING then return 1 // DO NOTHING AS THE PREVIOUS FINGERING WILL BE USED
	extPostThreadMessage(il_thread_id, 1099, 0, 0)	// send message 1099 a dummy message so that the keyboard will draw the finger graph w/o
end if																// bothering the note


return 1
end function

public function string wf_make_entry (string as_note, string as_coord, string as_finger);integer li_i, li_j,li_seq, li_begin, li_pos, li_len, li_left_note_list[], li_right_note_list[], li_empty_list[]
integer li_left_count, li_right_count, li_max_count
string ls_tmp, ls_line, ls_note_list[], ls_coord_list[],ls_f_attr_list[], ls_left_note_list[], ls_right_note_list[], ls_empty_list[]
string ls_entry

ls_entry = ""
ls_entry = ls_entry + as_finger + as_coord
//MessageBox("ls_entry 1", ls_entry)
li_left_note_list = li_empty_list
li_right_note_list = li_empty_list
wf_get_note_list("R", as_note, li_right_note_list, ls_right_note_list)
wf_get_note_list("L", as_note, li_left_note_list, ls_left_note_list)
li_right_count = upperbound(li_right_note_list)
if li_right_count > upperbound(ls_right_note_list) then li_right_count = upperbound(ls_right_note_list)
li_left_count = upperbound(li_left_note_list)
if li_left_count > upperbound(ls_left_note_list) then li_left_count = upperbound(ls_left_note_list)
if li_right_count > li_left_count then
	li_max_count = li_right_count
else
	li_max_count = li_left_count
end if

for li_i = 1 to li_right_count
	if ii_rh_lo_note > li_right_note_list[li_i] and li_right_note_list[li_i] <> 0 then
		ii_rh_lo_note = li_right_note_list[li_i]
	end if
	if ii_rh_hi_note < li_right_note_list[li_i] then
		ii_rh_hi_note = li_right_note_list[li_i]
	end if
next
for li_i = 1 to li_left_count
	if ii_lh_lo_note > li_left_note_list[li_i] and li_left_note_list[li_i] <> 0 then
		ii_lh_lo_note = li_left_note_list[li_i]
	end if
	if ii_lh_hi_note < li_left_note_list[li_i] then
		ii_lh_hi_note = li_left_note_list[li_i]
	end if
next

for li_j = 1 to li_max_count
	if li_j <= li_right_count then
		if cbx_new_format.checked then
			ls_entry = ls_entry + left(ls_right_note_list[li_j], 4) + string(li_right_note_list[li_j], "000") + right(ls_right_note_list[li_j], 2)
		else
			ls_entry = ls_entry + left(ls_right_note_list[li_j], 4) + string(li_right_note_list[li_j], "00") + right(ls_right_note_list[li_j], 2)
		end if
	else
		if cbx_new_format.checked then
			ls_entry = ls_entry + "000000000"
		else
			ls_entry = ls_entry + "00000000"
		end if
	end if			
	if li_j <= li_left_count then
		ls_entry = ls_entry + left(ls_left_note_list[li_j], 4) + string(li_left_note_list[li_j], "000") + right(ls_left_note_list[li_j], 2) 
	elseif li_j < li_max_count then
		if cbx_new_format.checked then
			ls_entry = ls_entry + "000000000"
		else
			ls_entry = ls_entry + "00000000"
		end if
	end if			
next
//MessageBox("ls_entry 2", ls_entry)
return ls_entry
end function

public function double wf_string_to_fraction (string as_input);// convert fraction time in string into double data type
//if double(left(as_input, 2)) = 0.0 then
double ld_numerator, ld_denominator
if isnull(left(as_input, 2)) then 
	ld_denominator = 0.0
else
	ld_denominator = double(left(as_input, 2))
end if
if isnull(right(as_input, 2)) then 
	ld_numerator = 0.0
else
	ld_numerator = double(right(as_input, 2))
end if
if ld_denominator = 0.0 or ld_denominator = 0.0 then
	return 0.0
else
	return ld_numerator/ld_denominator
end if


end function

public function string wf_fraction_to_string (double adb_input);double ldb_tmp, ldb_input
integer li_denominator = 1, li_numerator, li_i = 0

ldb_input = round(adb_input, 5)
do while true
	if truncate(ldb_input*2^li_i, 0) = ldb_input*2^li_i then
		li_numerator = integer(ldb_input*2^li_i)
		li_denominator = 2^li_i
		exit
	end if
	if li_i > 100 then
		exit
	end if
	li_i ++
loop

return string(li_denominator, "00") + string(li_numerator, "00")
end function

public function integer wf_get_note_list ();
// function name: wf_get_rh_lh_note_list
// description: to get note lists of left hand, right hand, and both hand from the input list, is_text_list

string msg, ls_fingering = ""
string ls_note_coordinate,ls_note_to_keyboard, ls_empty_list[]
string ls_rh_time_fraction[],ls_rh_note_value[],ls_rh_note_char[],ls_rh_note_finger[]
string ls_lh_time_fraction[],ls_lh_note_value[],ls_lh_note_char[],ls_lh_note_finger[]
string ls_rh_time_fraction1[],ls_rh_note_value1[],ls_rh_note_char1[],ls_rh_note_finger1[]
string ls_lh_time_fraction1[],ls_lh_note_value1[],ls_lh_note_char1[],ls_lh_note_finger1[]
string ls_rh_time_fraction0[],ls_rh_note_value0[],ls_rh_note_char0[],ls_rh_note_finger0[]
string ls_lh_time_fraction0[],ls_lh_note_value0[],ls_lh_note_char0[],ls_lh_note_finger0[]
string ls_rh_time_fraction00[],ls_rh_note_value00[],ls_rh_note_char00[],ls_rh_note_finger00[]
string ls_lh_time_fraction00[],ls_lh_note_value00[],ls_lh_note_char00[],ls_lh_note_finger00[]
string ls_finger_entry_list[], ls_finger_attr
integer li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, li_note_set_count
integer li_total_note_set_count1,li_rh_note_set_count1,li_lh_note_set_count1
integer li_total_note_set_count0=0,li_rh_note_set_count0=0,li_lh_note_set_count0=0
integer li_total_note_set_count00=0,li_rh_note_set_count00=0,li_lh_note_set_count00=0
integer li_current_note, li_entry_count, li_pos1, li_pos2, li_fingering_ind, ii_rh_note_tmp, ii_lh_note_tmp

integer li_i, li_j,li_k,li_k1, li_first_head = 0, li_second_head = 0, li_first_tail = 0, li_second_tail = 0
integer li_l,li_r,li_b,li_l_begin,li_r_begin,li_b_begin,li_l_end,li_r_end,li_b_end
integer li_total_note_count, li_right_hand_note_count, li_left_hand_note_count
integer li_num3, li_num1, li_num2, li_num
string ls_note, ls_note_wing, ls_finger_entry
boolean lb_true_note, lb_rh_true_note, lb_lh_true_note
string ls_measure_size, ls_header
double ldb_measure_size, ldb_right_offset, ldb_left_offset, ldb_both_offset
double ldb_right, ldb_left, ldb_right_cur, ldb_left_cur, ldb_tmp, ldb_tmp1

is_text_list = is_empty_list
is_rh_text_list = is_empty_list
is_lh_text_list = is_empty_list
is_bh_text_list = is_empty_list
is_lh_finger_list = is_empty_list
is_bh_finger_list = is_empty_list

ii_bh_to_rh = ii_empty_list
ii_bh_to_lh = ii_empty_list

//integer ii_measure_begin_index[], ii_measure_end_index[]
for li_i = 1 to dw_1.RowCount()
	is_text_list[li_i] = dw_1.GetItemString(li_i, "entry")
	is_finger_list[li_i] = dw_1.GetItemString(li_i, "finger")
next

for li_i = 2 to upperbound(is_text_list)
	if pos(is_text_list[li_i], "repeat") > 0 then 
		continue
	end if
	li_pos1 = pos(is_text_list[li_i], "FB")
	li_pos2 = pos(is_text_list[li_i], "FE")
	if li_pos1 < 1 or li_pos2 < 1 or li_pos2 < li_pos1 then
		MessageBox(string(li_pos1) + " " + string(li_pos2), is_text_list[li_i])
		MessageBox("Error", "Line - " + string(li_i) + " Corrupted Data!")
		return 0
	end if
	is_text_list[li_i] = right(is_text_list[li_i], len(is_text_list[li_i]) - (li_pos2 + 1))
next


return 0



if len(is_text_list[1]) < 48 then
	MessageBox("Error", "Header, the first row, is not specified")
	return 0
end if
ls_header = is_text_list[1]
//ls_measure_size = mid(ls_header, 2, 4)
ls_measure_size = mid(ls_header, 19, 4)


ldb_measure_size = wf_string_to_fraction(ls_measure_size)
//	FileWrite(li_num, "b")
ldb_right_offset = wf_string_to_fraction(mid(ls_header, 6, 4))
//	FileWrite(li_num, "c")
ldb_left_offset = wf_string_to_fraction(mid(ls_header, 10, 4))
//	FileWrite(li_num, "d")

if ldb_right_offset > ldb_left_offset then
	ldb_both_offset = ldb_right_offset
else
	ldb_both_offset = ldb_left_offset
end if

for li_i = 1 to 5
	idb_right_note_duration0[li_i] = 0.0
	idb_left_note_duration0[li_i] = 0.0
next

//		li_num1 = FileOpen("right.txt", LineMode!, Write!, LockWrite!, Replace!)
//		li_num2 = FileOpen("left.txt", LineMode!, Write!, LockWrite!, Replace!)
//		li_num3 = FileOpen("both.txt", LineMode!, Write!, LockWrite!, Replace!)
//		li_num = FileOpen("dummy.txt", LineMode!, Write!, LockWrite!, Append!)


// to find the existence of RH, LH, and Both hand note
for li_i = 2 to upperbound(is_text_list)
	if pos(is_text_list[li_i], "repeat") > 0 then continue
	ls_rh_time_fraction = ls_empty_list
	ls_rh_note_value = ls_empty_list
	ls_rh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	ls_lh_time_fraction = ls_empty_list
	ls_lh_note_value = ls_empty_list
	ls_lh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	li_total_note_set_count = 0
	li_total_note_set_count = 0
	li_lh_note_set_count = 0
	wf_parse_note_attribute(is_text_list[li_i],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, &
		ls_rh_time_fraction,ls_lh_time_fraction,ls_rh_note_value,ls_lh_note_value,ls_rh_note_char,ls_lh_note_char,ls_rh_note_finger,ls_lh_note_finger)	
	for li_j = 1 to li_rh_note_set_count
		if ls_rh_note_value[li_j] <> "000" then ib_right_exists = true
	next
	for li_j = 1 to li_lh_note_set_count
		if ls_lh_note_value[li_j] <> "000" then ib_left_hand_exists = true
	next
next

if ib_left_hand_exists and ib_right_exists then ib_both_exists = true


li_l_begin = 2
li_r_begin = 2
li_b_begin = 2

//MessageBox("title", title)
//MessageBox("upperbound(is_text_list)", upperbound(is_text_list))

//MessageBox("upperbound(is_text_list)", upperbound(is_text_list))
is_rh_text_list[1] = is_text_list[1]
is_lh_text_list[1] = is_text_list[1]
is_bh_text_list[1] = is_text_list[1]
is_rh_finger_list[1] = is_finger_list[1]
is_lh_finger_list[1] = is_finger_list[1]
is_bh_finger_list[1] = is_finger_list[1]

try
for li_i = 2 to upperbound(is_text_list)
//	FileWrite(li_num, string(li_i))
	//note attribute redistribution
	//
	//1) merge last note attributes with the current note attributes
	//2) build the new note attributes with minimum time duration for the attributes
	//3) generate the remaining attributes which are those notes that have the 
	//   remaining time duration greater than 0
	//4) repeat the loop	
	//get repeat note information
	if trim(is_text_list[li_i]) = "repeatBegin" then
		if upperbound(is_lh_text_list) > 1 then
			li_l_begin = upperbound(is_lh_text_list) + 1
		end if
		if upperbound(is_rh_text_list) > 1 then
			li_r_begin = upperbound(is_rh_text_list) + 1
		end if
		if upperbound(is_bh_text_list) > 1 then
			li_b_begin = upperbound(is_bh_text_list) + 1
		end if
		continue
	end if
	if ib_both_exists then
		if is_finger_list[li_i] <> "FB9FE" then ls_fingering = is_finger_list[li_i] 
		is_bh_finger_list[upperbound(is_bh_finger_list) + 1] = ls_fingering
	end if
	
	ls_rh_time_fraction = ls_empty_list
	ls_rh_note_value = ls_empty_list
	ls_rh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	ls_lh_time_fraction = ls_empty_list
	ls_lh_note_value = ls_empty_list
	ls_lh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	ls_lh_note_finger = ls_empty_list
	li_total_note_set_count = 0
	li_lh_note_set_count = 0
	li_rh_note_set_count = 0
	ls_rh_time_fraction1 = ls_empty_list
	ls_rh_note_value1 = ls_empty_list
	ls_rh_note_char1 = ls_empty_list
	ls_rh_note_finger1 = ls_empty_list
	ls_lh_time_fraction1 = ls_empty_list
	ls_lh_note_value1 = ls_empty_list
	ls_lh_note_char1 = ls_empty_list
	ls_rh_note_finger1 = ls_empty_list
	ls_lh_note_finger1 = ls_empty_list
	li_total_note_set_count1 = 0
	li_lh_note_set_count1 = 0
	li_rh_note_set_count1 = 0
	wf_parse_note_attribute(is_text_list[li_i],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, &
		ls_rh_time_fraction,ls_lh_time_fraction,ls_rh_note_value,ls_lh_note_value,ls_rh_note_char,ls_lh_note_char,ls_rh_note_finger,ls_lh_note_finger)
	wf_parse_note_attribute(is_text_list[li_i],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count1,li_rh_note_set_count1,li_lh_note_set_count1, &
		ls_rh_time_fraction1,ls_lh_time_fraction1,ls_rh_note_value1,ls_lh_note_value1,ls_rh_note_char1,ls_lh_note_char1,ls_rh_note_finger1,ls_lh_note_finger1)
	 
	// process measure count information
	ii_rh_note_tmp = 0 
	ii_lh_note_tmp = 0
	ldb_right_cur = 0
	if ib_right_exists then	// use righthand info
		//  find max time
//		ldb_right_cur = 0
		for li_j = 1 to upperbound(ls_rh_time_fraction)
			ldb_tmp = wf_string_to_fraction(ls_rh_time_fraction[li_j])
			if ldb_tmp = 0.0 then
				MessageBox(string(li_i), ls_rh_time_fraction[li_j])
			end if
			if ldb_right_cur < ldb_tmp then ldb_right_cur = ldb_tmp
		next
	end if
	ldb_right = ldb_right + ldb_right_cur
	ldb_left_cur = 0
	if ib_left_hand_exists then
		//  find max time
		ldb_left_cur = 0
		for li_j = 1 to upperbound(ls_lh_time_fraction)
			ldb_tmp = wf_string_to_fraction(ls_lh_time_fraction[li_j])
			if ldb_left_cur < ldb_tmp then ldb_left_cur = ldb_tmp
		next	
	end if
	ldb_left = ldb_left + ldb_left_cur
	

	// reset time duration
	for li_j = 1 to 5
		idb_right_note_duration[li_j] = 0.0
		idb_left_note_duration[li_j] = 0.0
	next
	idb_min_duration = 10.0
	idb_left_min_duration = 10.0
	idb_right_min_duration = 10.0
	// convert time fraction
	for li_j = 1 to li_rh_note_set_count
		ii_rh_note_tmp = ii_rh_note_tmp + integer(ls_rh_note_value[li_j])
		idb_right_note_duration[li_j] = wf_string_to_fraction(ls_rh_time_fraction[li_j])
		idb_right_note_duration1[li_j] = wf_string_to_fraction(ls_rh_time_fraction1[li_j])
	next
//	if li_rh_note_set_count > 0 then
//		FileWrite(li_num, string(li_i) + " " + ls_rh_time_fraction[1] + " " + string(idb_right_note_duration[1]))
//	end if
	for li_j = 1 to li_lh_note_set_count
		idb_left_note_duration[li_j] = wf_string_to_fraction(ls_lh_time_fraction[li_j])
		idb_left_note_duration1[li_j] = wf_string_to_fraction(ls_lh_time_fraction1[li_j])
	next
	// merge previous righthand note set with current note set for righthand only
	for li_j = 1 to li_rh_note_set_count	
		if li_rh_note_set_count0 > 0 then
			for li_k = 1 to li_rh_note_set_count0
				if ls_rh_note_value[li_j] = ls_rh_note_value0[li_k] then
					idb_right_note_duration[li_j] = idb_right_note_duration[li_j] + idb_right_note_duration0[li_k]
					idb_right_note_duration0[li_k] = 0
				end if
			next
		end if
	next
	// merge previous righthand note set with current note set for both hand
	for li_j = 1 to li_rh_note_set_count1	
		if li_rh_note_set_count00 > 0 then
			for li_k = 1 to li_rh_note_set_count00
				if ls_rh_note_value1[li_j] = ls_rh_note_value00[li_k] then
					idb_right_note_duration1[li_j] = idb_right_note_duration1[li_j] + idb_right_note_duration00[li_k]
					idb_right_note_duration00[li_k] = 0
				end if
			next
		end if
	next
	li_k = li_rh_note_set_count
	// add previous note set that are not found in the current note set to the the current note set for right hand only
	for li_j = 1 to li_rh_note_set_count0
		if idb_right_note_duration0[li_j] > 0 then
			li_k = li_k + 1
			ls_rh_note_value[li_k] = ls_rh_note_value0[li_j]
			ls_rh_time_fraction[li_k] = wf_fraction_to_string(idb_right_note_duration0[li_j])
			ls_rh_note_finger[li_k] = ls_rh_note_finger0[li_j]
			ls_rh_note_char[li_k] = "2"
		end if
	next
	li_rh_note_set_count = li_k
	li_k = li_rh_note_set_count1
	// add previous note set that are not found in the current note set to the the current note set for both hand
	for li_j = 1 to li_rh_note_set_count00
		if idb_right_note_duration00[li_j] > 0 then
			li_k = li_k + 1
			ls_rh_note_value1[li_k] = ls_rh_note_value00[li_j]
			ls_rh_time_fraction1[li_k] = wf_fraction_to_string(idb_right_note_duration00[li_j])
			ls_rh_note_finger1[li_k] =   ls_rh_note_finger00[li_j]
			ls_rh_note_char1[li_k] = "2"
		end if
	next
	li_rh_note_set_count1 = li_k
	// find the minimum time duration
	idb_right_min_duration = 10.0
	for li_j = 1 to li_rh_note_set_count	
		if idb_right_min_duration > idb_right_note_duration[li_j] and idb_right_note_duration[li_j] > 0.0 then 
			idb_right_min_duration = idb_right_note_duration[li_j]
		end if
	next	
	idb_right_min_duration1 = 10.0
	for li_j = 1 to li_rh_note_set_count1	
		if idb_right_min_duration1 > idb_right_note_duration1[li_j] and idb_right_note_duration1[li_j] > 0.0 then 
			idb_right_min_duration1 = idb_right_note_duration1[li_j]
		end if
	next	
	
	// convert time fraction
	for li_j = 1 to li_lh_note_set_count
		ii_lh_note_tmp = ii_lh_note_tmp + integer(ls_lh_note_value[li_j])
		idb_left_note_duration[li_j] = wf_string_to_fraction(ls_lh_time_fraction[li_j])
		idb_left_note_duration1[li_j] = wf_string_to_fraction(ls_lh_time_fraction1[li_j])
	next
	// merge previous left note set with current note set
	for li_j = 1 to li_lh_note_set_count	
		if li_lh_note_set_count0 > 0 then
			for li_k = 1 to li_lh_note_set_count0
				if ls_lh_note_value[li_j] = ls_lh_note_value0[li_k] then
					idb_left_note_duration[li_j] = idb_left_note_duration[li_j] + idb_left_note_duration0[li_k]
					idb_left_note_duration0[li_k] = 0
				end if
			next
		end if
	next
	for li_j = 1 to li_lh_note_set_count1	
		if li_lh_note_set_count00 > 0 then
			for li_k = 1 to li_lh_note_set_count00
				if ls_lh_note_value1[li_j] = ls_lh_note_value00[li_k] then
					idb_left_note_duration1[li_j] = idb_left_note_duration1[li_j] + idb_left_note_duration00[li_k]
					idb_left_note_duration00[li_k] = 0
				end if
			next
		end if
	next
	li_k = li_lh_note_set_count
	// add previous note set that are not found in the current note set to the the current note set
	for li_j = 1 to li_lh_note_set_count0
		if idb_left_note_duration0[li_j] > 0 then 
			li_k = li_k + 1
			ls_lh_note_value[li_k] = ls_lh_note_value0[li_j]
			ls_lh_time_fraction[li_k] = wf_fraction_to_string(idb_left_note_duration0[li_j])
			ls_lh_note_finger[li_k] = ls_lh_note_finger0[li_j]
			ls_lh_note_char[li_k] = "2"		// continuous note
		end if
	next
	li_lh_note_set_count = li_k
	
	li_k = li_lh_note_set_count1
	for li_j = 1 to li_lh_note_set_count00
		if idb_left_note_duration00[li_j] > 0 then
			li_k = li_k + 1
			ls_lh_note_value1[li_k] = ls_lh_note_value00[li_j]
			ls_lh_time_fraction1[li_k] = wf_fraction_to_string(idb_left_note_duration00[li_j])
			ls_lh_note_finger1[li_k] = ls_lh_note_finger00[li_j]
			ls_lh_note_char1[li_k] = "2"
		end if
	next
	li_lh_note_set_count1 = li_k
	// find the minimum time duration
	idb_left_min_duration = 10.0
	for li_j = 1 to li_lh_note_set_count	
		if idb_left_min_duration > idb_left_note_duration[li_j] and idb_left_note_duration[li_j] > 0.0 then 
			idb_left_min_duration = idb_left_note_duration[li_j]
		end if
	next	
	
	idb_min_duration = 10.0
	for li_j = 1 to li_rh_note_set_count1
		if idb_min_duration > idb_right_note_duration1[li_j] and idb_right_note_duration1[li_j] > 0.0 then 
			idb_min_duration = idb_right_note_duration1[li_j]
		end if
	next	
	for li_j = 1 to li_lh_note_set_count1
		if idb_min_duration > idb_left_note_duration1[li_j] and idb_left_note_duration1[li_j] > 0.0 then 
			idb_min_duration = idb_left_note_duration1[li_j]
		end if
	next	
	
	// generate new right hand set
	for li_j = 1 to 5
		idb_left_note_duration0[li_j] = 0.0
		idb_right_note_duration0[li_j] = 0.0
		idb_left_note_duration00[li_j] = 0.0
		idb_right_note_duration00[li_j] = 0.0
	next				

	if li_rh_note_set_count > 0 then
		ls_rh_time_fraction[1] = wf_fraction_to_string(idb_right_min_duration) 	
//		FileWrite(li_num, string(li_i) + " ls_rh_time_fraction[1] " + ls_rh_time_fraction[1] + " idb_right_min_duration" + string(idb_right_min_duration))
//		FileWrite(li_num, string(li_i) + " ls_rh_time_fraction1[1] " + ls_rh_time_fraction[1] + " idb_min_duration" + string(idb_min_duration))
		li_k = 0
		for li_j = 1 to li_rh_note_set_count	
			ls_rh_time_fraction[li_j] = ls_rh_time_fraction[1]
			idb_right_note_duration[li_j] = idb_right_note_duration[li_j] - idb_right_min_duration
			if idb_right_note_duration[li_j] > 0 then // create remaining note set
				li_k = li_k + 1
				idb_right_note_duration0[li_k] = idb_right_note_duration[li_j]
				ls_rh_note_value0[li_k] = ls_rh_note_value[li_j]
				ls_rh_note_finger0[li_k] = ls_rh_note_finger[li_j]
			end if 
		next	
		li_rh_note_set_count0 = li_k
	else
		li_rh_note_set_count0 = 0
	end if
	
	if li_rh_note_set_count1 > 0 then
		ls_rh_time_fraction1[1] = wf_fraction_to_string(idb_min_duration) 	
		li_k = 0
		for li_j = 1 to li_rh_note_set_count1	
			ls_rh_time_fraction1[li_j] = ls_rh_time_fraction1[1]
			idb_right_note_duration1[li_j] = idb_right_note_duration1[li_j] - idb_min_duration
			if idb_right_note_duration1[li_j] > 0 then // create remaining note set
				li_k = li_k + 1
				idb_right_note_duration00[li_k] = idb_right_note_duration1[li_j]
				ls_rh_note_value00[li_k] = ls_rh_note_value1[li_j]
				ls_rh_note_finger00[li_k] = ls_rh_note_finger1[li_j]
			end if 
		next		
		li_rh_note_set_count00 = li_k	
	else
		li_rh_note_set_count00 = 0
	end if
	
	if li_lh_note_set_count > 0 then
		ls_lh_time_fraction[1] = wf_fraction_to_string(idb_left_min_duration) 	
//		FileWrite(li_num, string(li_i) + " ls_lh_time_fraction[1] " + ls_lh_time_fraction[1] + " idb_left_min_duration" + string(idb_left_min_duration))
//		FileWrite(li_num, string(li_i) + " ls_lh_time_fraction1[1] " + ls_lh_time_fraction[1] + " idb_min_duration" + string(idb_min_duration))
		li_k = 0
		for li_j = 1 to li_lh_note_set_count	
			ls_lh_time_fraction[li_j] = ls_lh_time_fraction[1]
			idb_left_note_duration[li_j] = idb_left_note_duration[li_j] - idb_left_min_duration
			if idb_left_note_duration[li_j] > 0 then // create remaining note set
				li_k = li_k + 1
				idb_left_note_duration0[li_k] = idb_left_note_duration[li_j]
				ls_lh_note_value0[li_k] = ls_lh_note_value[li_j]
				ls_lh_note_finger0[li_k] = ls_lh_note_finger[li_j]
			end if 
		next	
		li_lh_note_set_count0 = li_k
	else
		li_lh_note_set_count0 = 0
	end if
	
	if li_lh_note_set_count1 > 0 then
		ls_lh_time_fraction1[1] = wf_fraction_to_string(idb_min_duration) 	
		li_k = 0
		for li_j = 1 to li_lh_note_set_count1	
			ls_lh_time_fraction1[li_j] = ls_lh_time_fraction1[1]
			idb_left_note_duration1[li_j] = idb_left_note_duration1[li_j] - idb_min_duration
			if idb_left_note_duration1[li_j] > 0 then // create remaining note set
				li_k = li_k + 1
				idb_left_note_duration00[li_k] = idb_left_note_duration1[li_j]
				ls_lh_note_value00[li_k] = ls_lh_note_value1[li_j]
				ls_lh_note_finger00[li_k] = ls_lh_note_finger1[li_j]
			end if 
		next		
		li_lh_note_set_count00 = li_k	
	else
		li_lh_note_set_count00 = 0
	end if	
		
	lb_rh_true_note = false
	ls_note_wing = ""
	for li_j = 1 to li_rh_note_set_count		
		if ls_rh_note_value[li_j] <> "000" then lb_rh_true_note = true 
		ls_note = ls_rh_time_fraction[li_j] + ls_rh_note_value[li_j] + ls_rh_note_char[li_j] + ls_rh_note_finger[li_j]
		ls_note_wing = ls_note_wing + ls_note
		if li_j < li_rh_note_set_count then		// pat the note attribute
			ls_note_wing = ls_note_wing + "000000000"
		end if
	next
	if lb_rh_true_note then // there are righthand notes
//		is_rh_text_list[upperbound(is_rh_text_list) + 1] = ls_note_coordinate + ls_note_wing
		is_rh_text_list[li_i] = ls_note_coordinate + ls_note_wing
		// get right hand fingering graph ID
		if is_finger_list[li_i] <> "FB9FE" then ls_fingering = is_finger_list[li_i] 
		ls_finger_entry = ls_fingering
		li_pos1 = pos(ls_finger_entry, "FB")
		li_pos2 = pos(ls_finger_entry, "FE")		
		li_fingering_ind = integer(mid(ls_finger_entry, li_pos1 + 2, 1))
		if li_fingering_ind = REAPEAT_FINGERING or li_fingering_ind = NO_FINGERING then //
			is_rh_finger_list[upperbound(is_rh_finger_list)+1] = ls_fingering
		else
			ls_finger_attr = mid(ls_finger_entry, li_pos1 + 2, li_pos2 - li_pos1 - 2)
			ls_finger_entry_list = ls_empty_list
			li_entry_count = wf_parse_finger_entry(ls_finger_attr, ls_finger_entry_list)
			if li_entry_count = 0 then 
				MessageBox("Error", "Finger Attribute Error At Line " + string(li_i))
				return 0
			end if
			ls_finger_entry = "FB"
			for li_j = 1 to li_entry_count
				if left(ls_finger_entry_list[li_j], 1) = "2" then // get right finger entries
					ls_finger_entry = ls_finger_entry + ls_finger_entry_list[li_j] 
				end if
			next
			ls_finger_entry = ls_finger_entry + "FE"
			is_rh_finger_list[upperbound(is_rh_finger_list)+1] = 	ls_finger_entry	
		end if
	else
		if upperbound(ls_rh_time_fraction) > 0 then
			is_rh_text_list[li_i] = ls_note_coordinate + ls_rh_time_fraction[1] + "00000"
		else
			is_rh_text_list[li_i] = ""	
		end if
	end if
	
	lb_lh_true_note = false
	ls_note_wing = ""
	for li_j = 1 to li_lh_note_set_count
		if ls_lh_note_value[li_j] <> "000" then lb_lh_true_note = true
		ls_note = ls_lh_time_fraction[li_j] + ls_lh_note_value[li_j] + ls_lh_note_char[li_j] + ls_lh_note_finger[li_j]
		ls_note_wing = ls_note_wing + "000000000" + ls_note 
	next
//	MessageBox("ls_note_wing", ls_note_wing)
	if lb_lh_true_note then
//		is_lh_text_list[upperbound(is_lh_text_list) + 1] = ls_note_coordinate + ls_note_wing
		is_lh_text_list[li_i] = ls_note_coordinate + ls_note_wing
		
		// get left hand fingering graph ID

		if is_finger_list[li_i] <> "FB9FE" then ls_fingering = is_finger_list[li_i] 
		ls_finger_entry = ls_fingering
		li_pos1 = pos(ls_finger_entry, "FB")
		li_pos2 = pos(ls_finger_entry, "FE")		
		li_fingering_ind = integer(mid(ls_finger_entry, li_pos1 + 2, 1))
		if li_fingering_ind = REAPEAT_FINGERING or li_fingering_ind = NO_FINGERING then 
			is_lh_finger_list[upperbound(is_lh_finger_list)+1] = ls_fingering
		else
			ls_finger_attr = mid(ls_finger_entry, li_pos1 + 2, li_pos2 - li_pos1 - 2)
			ls_finger_entry_list = ls_empty_list
			li_entry_count = wf_parse_finger_entry(ls_finger_attr, ls_finger_entry_list)
			ls_finger_entry = "FB"
			for li_j = 1 to li_entry_count
				if left(ls_finger_entry_list[li_j], 1) = "1" then
					ls_finger_entry = ls_finger_entry + ls_finger_entry_list[li_j] 
				end if
			next
			ls_finger_entry = ls_finger_entry + "FE"
			is_lh_finger_list[upperbound(is_lh_finger_list)+1] = 	ls_finger_entry					
		end if
	else
		if upperbound(ls_lh_time_fraction) > 0 then
			is_lh_text_list[li_i] = ls_note_coordinate + ls_lh_time_fraction[1] + "00000"
		else
			is_lh_text_list[li_i] = ""	
		end if
	end if
	
	if ib_both_exists then
		ls_note_wing = ""
		if not lb_lh_true_note then li_lh_note_set_count = 0
		if not lb_rh_true_note then li_rh_note_set_count = 0
		if li_rh_note_set_count1 > li_lh_note_set_count1 then
			li_note_set_count = li_rh_note_set_count1
		else
			li_note_set_count = li_lh_note_set_count1
		end if
		if li_note_set_count = 0 then 
			ls_note_wing = "000000000000000000"
		else
			for li_j = 1 to li_note_set_count
				if li_j <= li_rh_note_set_count1 then 
					ls_note = ls_rh_time_fraction1[li_j] + ls_rh_note_value1[li_j] + ls_rh_note_char1[li_j] + ls_rh_note_finger1[li_j]
					ls_note_wing = ls_note_wing + ls_note 
				else
					ls_note_wing = ls_note_wing + "000000000"
				end if
				if li_j <= li_lh_note_set_count1 then
					ls_note = ls_lh_time_fraction1[li_j] + ls_lh_note_value1[li_j] + ls_lh_note_char1[li_j] + ls_lh_note_finger1[li_j]
					ls_note_wing = ls_note_wing + ls_note 
				else
					ls_note_wing = ls_note_wing + "000000000"
				end if
			next
		end if
//		is_bh_text_list[upperbound(is_bh_text_list) + 1] = ls_note_coordinate + ls_note_wing
		is_bh_text_list[li_i] = ls_note_coordinate + ls_note_wing
	else
		is_bh_text_list[li_i] = ls_note_coordinate
		if upperbound(ls_rh_time_fraction) > 0 then
			is_bh_text_list[li_i] = is_bh_text_list[li_i] + ls_rh_time_fraction[1] + "00000"
		else
			is_bh_text_list[li_i] = is_bh_text_list[li_i] + "000000000"
		end if

		if upperbound(ls_lh_time_fraction) > 0 then
			is_bh_text_list[li_i] = is_bh_text_list[li_i] + ls_lh_time_fraction[1] + "00000"
		else
			is_bh_text_list[li_i] = is_bh_text_list[li_i] + "000000000"
		end if
	end if	
	
	if ii_rh_note_tmp > 0 and upperbound(ii_measure_right_begin_index) = upperbound(ii_measure_right_end_index) then
		ii_measure_right_begin_index[upperbound(ii_measure_right_begin_index) + 1] = upperbound(is_rh_text_list)
	end if
	if ii_lh_note_tmp > 0 and upperbound(ii_measure_left_begin_index) = upperbound(ii_measure_left_end_index) then
		ii_measure_left_begin_index[upperbound(ii_measure_left_begin_index) +1] = upperbound(is_lh_text_list)
	end if
	if (ii_rh_note_tmp > 0 or ii_lh_note_tmp > 0) and upperbound(ii_measure_both_begin_index) = upperbound(ii_measure_both_end_index) then
		ii_measure_both_begin_index[upperbound(ii_measure_both_begin_index) +1] = upperbound(is_bh_text_list)
	end if
	
	if ib_right_exists then	
		if ldb_right > 0 and mod(ldb_right - ldb_right_offset, ldb_measure_size) = 0 and &
				upperbound(ii_measure_right_begin_index) - 1 = upperbound(ii_measure_right_end_index) then  // end of a right hand measure
			ii_measure_right_end_index[upperbound(ii_measure_right_end_index) + 1] = upperbound(is_rh_text_list)
		end if
	end if
		
	if ib_left_hand_exists then		
		if ldb_left > 0 and mod(ldb_left - ldb_left_offset, ldb_measure_size) = 0 and &
				upperbound(ii_measure_left_begin_index) - 1 = upperbound(ii_measure_left_end_index) then  // end of a left hand measure
			ii_measure_left_end_index[upperbound(ii_measure_left_end_index) + 1] = upperbound(is_lh_text_list)
		end if
	end if
	
	if ib_both_exists then	
		if ((ldb_right > 0 and mod(ldb_right - ldb_right_offset, ldb_measure_size) = 0) and &
				(ldb_left > 0 and mod(ldb_left - ldb_left_offset, ldb_measure_size) = 0)) and &
				(upperbound(ii_measure_both_begin_index) - 1 = upperbound(ii_measure_both_end_index)) then //end of a both hand measure
			ii_measure_both_end_index[upperbound(ii_measure_both_end_index) + 1] = upperbound(is_bh_text_list)
		end if
	end if	
//	FileWrite(li_num, string(ldb_right) + " " + string(ldb_left))
next


if ib_right_exists then	
	if upperbound(ii_measure_right_end_index) < upperbound(ii_measure_right_begin_index) then
		ii_measure_right_end_index[upperbound(ii_measure_right_end_index) + 1]   = upperbound(is_rh_text_list)
	end if
end if
if ib_left_hand_exists then	
	if upperbound(ii_measure_left_end_index) < upperbound(ii_measure_left_begin_index) then
		ii_measure_left_end_index[upperbound(ii_measure_left_end_index) + 1]   = upperbound(is_lh_text_list)
	end if
end if
if ib_both_exists then	
	if upperbound(ii_measure_both_end_index) < upperbound(ii_measure_both_begin_index) then
		ii_measure_both_end_index[upperbound(ii_measure_both_end_index) + 1]   = upperbound(is_bh_text_list)
	end if
end if

if not ib_both_exists then
	if ib_right_exists then
		is_bh_text_list = is_rh_text_list
	elseif ib_left_hand_exists then
		is_bh_text_list = is_lh_text_list
	end if
end if 

//	FileWrite(li_num, "right begin count=" + string(upperbound(ii_measure_right_begin_index)) + "right end count=" + string(upperbound(ii_measure_right_end_index)))
//	FileWrite(li_num, "left begin count=" + string(upperbound(ii_measure_left_begin_index)) + "left end count=" + string(upperbound(ii_measure_left_end_index)))
//	FileWrite(li_num, "both begin count=" + string(upperbound(ii_measure_both_begin_index)) + "right end count=" + string(upperbound(ii_measure_both_end_index)))
//FileClose(li_num)
//FileClose(li_num1)
//FileClose(li_num2)
//FileClose(li_num3)
CATCH(RuntimeError re1)
//FileClose(li_num1)
//FileClose(li_num2)
//FileClose(li_num3)
	msg = "Class=" + re1.Class + " Line=" + string(re1.Line) + " Number=" + string(re1.Number) + " RoutineName=" + re1.RoutineName + " Text=" + re1.Text
	msg = msg + " li_i:" + string(li_i)
	MessageBox("msg", msg)
	MessageBox("ldb_measure_size", ldb_measure_size)
	
	msg = "ls_header=" + ls_header + " ldb_right=" + string(ldb_right) + " ldb_right_offset=" + string(ldb_right_offset) + " ldb_measure_size=" + string(ldb_measure_size)
	MessageBox("msg", msg)
//	MessageBox("wf_get_note_list: Line=" + string(re1.Line) + " li_i=" + string(li_i), is_text_list[li_i])
END TRY
ii_rh_text_count = upperbound(is_rh_text_list)
ii_lh_text_count = upperbound(is_lh_text_list)
ii_bh_text_count = upperbound(is_bh_text_list)

//MessageBox("Info", "ii_bh_text_count=" + string(ii_bh_text_count) + "ii_rh_text_count=" + string(ii_rh_text_count) + " ii_lh_text_count" + string(ii_lh_text_count))
return 1
end function

public function integer wf_parse_finger_entry (string as_input, ref string as_output_list[]);// function name: wf_parse_finger_entry
//	parms: string as_input = the string to be parsed
//        string as_output_list[], the array of parsed string
//as_input
//as_output_list[]

integer li_i
if mod(len(as_input), FINGERING_ATTR_LEN) > 0 then return 0

for li_i = 1 to len(as_input)/FINGERING_ATTR_LEN
	as_output_list[li_i] = mid(as_input, FINGERING_ATTR_LEN*(li_i - 1) + 1, FINGERING_ATTR_LEN)
	if left(as_output_list[li_i], 1) <> "1" and left(as_output_list[li_i], 1) <> "2" then
		return 0
	end if
next

return len(as_input)/FINGERING_ATTR_LEN

end function

public function integer wf_parse_note_attribute (string as_current_note_entry, ref string as_note_coordinate, ref string as_note_to_keyboard, ref integer ai_total_note_set_count, ref integer ai_rh_note_set_count, ref integer ai_lh_note_set_count, ref string as_rh_time_fraction[], ref string as_lh_time_fraction[], ref string as_rh_note_value[], ref string as_lh_note_value[], ref string as_rh_note_char[], ref string as_lh_note_char[], ref string as_rh_note_finger[], ref string as_lh_note_finger[]);// function name: wf_parse_note_attribute
// input parms:
//				as_current_note_entry = input note entry string to be parsed
//				as_note_coordinate = the note coordinate returned
//				as_note_to_keyboard = the note attribute to be sent to keyboard returned
//				ai_total_note_set_count = total note set count returned
//				ai_rh_note_set_count = total right hand note set count returned
//				ai_lh_note_set_count = total left hand note set count returned
//				as_rh_time_fraction[] = array of time fraction for right hand note returned
//				as_lh_time_fraction[] = array of time fraction for left hand note returned
//				as_rh_note_value[] = array of note value for right hand note returned
//				as_lh_note_value[] = array of note value for left hand note returned
//				as_rh_note_char[] = array of note character for right hand note returned
//				as_lh_note_char[] = array of note character for left hand note returned
//				as_rh_note_finger[] = array of finger number for right hand note returned
//				as_lh_note_finger[] = array of finger number for left hand note returned
// description: to parse note attributes of an input note entry	

constant integer COORDINATE_LEN = 18
constant integer NOTE_UNIT_LEN = 9
constant integer  NOTE_LEN = 9  	// It was 8, and changed to 9
constant integer	TIME_FRACTION_LEN	= 4
constant integer	NOTE_VALUE_LEN	= 3 // it was 2 changed to 3
constant integer	NOTE_CHAR_LEN	= 1
constant integer	NOTE_FINGER_LEN = 1
integer li_i, li_offset, li_j

as_note_coordinate = left(as_current_note_entry, COORDINATE_LEN)
as_note_to_keyboard = right(as_current_note_entry, len(as_current_note_entry) - COORDINATE_LEN)
ai_total_note_set_count = len(as_note_to_keyboard)/NOTE_UNIT_LEN
ai_rh_note_set_count = ai_total_note_set_count/2
if mod(ai_total_note_set_count, 2) = 1 then
	ai_rh_note_set_count++
end if
ai_lh_note_set_count = ai_total_note_set_count/2

li_j = 0
for li_i=1 to ai_rh_note_set_count
	li_offset = NOTE_UNIT_LEN*2*(li_i - 1) + 1
	if mid(as_note_to_keyboard, li_offset, NOTE_UNIT_LEN) <> "000000000" then
		li_j = li_j + 1
		as_rh_time_fraction[upperbound(as_rh_time_fraction) + 1] = mid(as_note_to_keyboard, li_offset, TIME_FRACTION_LEN)
		li_offset = li_offset + TIME_FRACTION_LEN	
		as_rh_note_value[upperbound(as_rh_note_value) + 1] = mid(as_note_to_keyboard, li_offset, NOTE_VALUE_LEN)
		li_offset = li_offset + NOTE_VALUE_LEN
		as_rh_note_char[upperbound(as_rh_note_char) + 1] = mid(as_note_to_keyboard, li_offset, NOTE_CHAR_LEN)
		li_offset = li_offset + NOTE_CHAR_LEN
		as_rh_note_finger[upperbound(as_rh_note_finger) + 1] = mid(as_note_to_keyboard, li_offset, NOTE_FINGER_LEN)
	end if
next
ai_rh_note_set_count = li_j
li_j = 0 
for li_i=1 to ai_lh_note_set_count
	li_offset = NOTE_UNIT_LEN*2*(li_i - 1) + NOTE_UNIT_LEN + 1
	if mid(as_note_to_keyboard, li_offset, NOTE_UNIT_LEN) <> "000000000" then
		li_j = li_j + 1
		as_lh_time_fraction[upperbound(as_lh_time_fraction) + 1] = mid(as_note_to_keyboard, li_offset, TIME_FRACTION_LEN)
		li_offset = li_offset + TIME_FRACTION_LEN	
		as_lh_note_value[upperbound(as_lh_note_value) + 1] = mid(as_note_to_keyboard, li_offset, NOTE_VALUE_LEN)
		li_offset = li_offset + NOTE_VALUE_LEN
		as_lh_note_char[upperbound(as_lh_note_char) + 1] = mid(as_note_to_keyboard, li_offset, NOTE_CHAR_LEN)
		li_offset = li_offset + NOTE_CHAR_LEN
		as_lh_note_finger[upperbound(as_lh_note_finger) + 1] = mid(as_note_to_keyboard, li_offset, NOTE_FINGER_LEN)
	end if
next
ai_lh_note_set_count = li_j

return 1


end function

public subroutine wf_load_finger_proportionally ();// Get Width and Height Percentage of fingering to key width and key height
// get Name Entry ID

integer li_i, li_j, li_key_width, li_key_height, li_natural_note_count = 0, li_note1, li_min_note, li_max_note, li_array_range
long ll_array_size, ll_x_array[], ll_y_array[], ll_w_array[], ll_h_array[], ll_pct, ll_x_pct1, ll_y_pct1 , ll_note1, ll_y_pct,  ll_empty_list[]
integer li_natural_note_list[]
string ls_name_id[], ls_x_pct[], ls_y_pct[], ls_w_pct[], ls_h_pct[]

integer li_tip_x[5], li_tip_y[5], li_natural_note_diff, li_x_offset1, li_y_offset1, li_x_offset, li_y_offset, li_x_diff, li_y_diff 
li_min_note = integer(sle_min_note.text)
li_max_note = integer(sle_max_note.text)

// 1. maker sure the spcified key range is valid
if not IsNaturalNote(li_min_note) then
	MessageBox("Error", "Min Note Is Not A Natural Note, Please Validate It!");
	return
end if
if not IsNaturalNote(li_max_note) then
	MessageBox("Error", "Max Note Is Not A Natural Note, Please Validate It!");
	return
end if
if li_min_note > li_max_note then
	MessageBox("Error", "Note Range Error, Please Validate It!");
	return
end if

// 2. calculate the number of natural keys
for li_i = li_min_note to li_max_note
	if IsNaturalNote(li_i) then
		li_natural_note_count ++
		li_natural_note_list[li_natural_note_count] = li_i
	end if
next
//li_key_height = UnitsToPixels((ii_p1_height_orig/2)*2/3, YUnitsToPixels!)

// 3. calculate key width and key height
li_key_height = UnitsToPixels(ii_p1_height_orig*2/3, YUnitsToPixels!)
li_key_width = UnitsToPixels(ii_p1_width_orig/li_natural_note_count, XUnitsToPixels!)

if cbx_append_left_hand.checked then
	ls_name_id[1] = ddlb_lh_1.text
	ls_name_id[2] = ddlb_lh_2.text
	ls_name_id[3] = ddlb_lh_3.text
	ls_name_id[4] = ddlb_lh_4.text
	ls_name_id[5] = ddlb_lh_5.text
	li_note1 = integer(sle_lh_1_note.text)
	ll_x_pct1 = integer(sle_lh_1_x.text)
	ll_y_pct1 = integer(sle_lh_1_y.text)
	li_x_offset1 = li_key_width*ll_x_pct1/100
	li_y_offset1 = li_key_height*ll_y_pct1/100
	for li_i = 1 to upperbound(ls_name_id) 		//sle_dest_lib
		// get array size
		ll_array_size = extGetCoordGraphCount(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", ls_name_id[li_i])
		ll_x_array = ll_empty_list
		ll_y_array = ll_empty_list
		for li_j = 1 to ll_array_size
			ll_x_array[li_j] = 0
			ll_y_array[li_j] = 0
		next
		if ll_array_size > 0 then
			// given fingering name to retrieve array of the fingering coordinates
			extGetCoordGraphFile(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", ll_x_array, ll_y_array, ll_array_size, ls_name_id[li_i])
			li_array_range = GetArrayRange(ll_x_array)
			// key width is equal to key X array range
			ll_pct = li_array_range*100/li_key_width
			isle_lh_w[li_i].text = string(ll_pct)
			li_array_range = GetArrayRange(ll_y_array)
			// key height is equal to key Y array rage
			ll_pct = li_array_range*100/li_key_height
			isle_lh_h[li_i].text = string(ll_pct)	
			li_tip_x[li_i] = ll_x_array[1]
			li_tip_y[li_i] = ll_y_array[1]
			if li_i > 1 then 
				li_natural_note_count = 0
				li_x_diff = li_tip_x[li_i] - li_tip_x[1]  
				if li_x_diff > 0 then	// the finger li_i is at the right of finger 1
					li_natural_note_diff = (li_x_diff + (li_key_width - li_x_offset1))/li_key_width
					isle_lh_note[li_i].text = string(wf_naturalnote_to_note_seq(li_note1, li_natural_note_diff))
					isle_lh_note[li_i].event modified()
					if mod(li_x_diff, li_key_width) < (li_key_width - li_x_offset1) then
						li_x_offset = li_key_width - mod(li_x_diff, li_key_width)
					else
						li_x_offset = mod(li_x_diff, li_key_width) - li_x_offset1
					end if
					if li_x_offset >= li_key_width then li_x_offset = li_key_width - 1
					if li_x_offset = 0 then li_x_offset = 1
				else							// the finger li_i is at the left of finger 1
					if abs(mod(li_x_diff, li_key_width)) < li_x_offset1 then
						li_natural_note_diff = li_x_diff/li_key_width
						li_x_offset =  li_x_offset1 - abs(mod(li_x_diff, li_key_width))
					else
						li_natural_note_diff = li_x_diff/li_key_width - 1
						li_x_offset = li_key_width - abs(mod(li_x_diff, li_key_width)) + li_x_offset1
					end if					
					isle_lh_note[li_i].text = string(wf_naturalnote_to_note_seq(li_note1, li_natural_note_diff))
					isle_lh_note[li_i].event modified()
				end if				
				ll_pct = li_x_offset*100/li_key_width
				if ll_pct >= 100 then ll_pct = 99
				if ll_pct = 0 then ll_pct = 1				
				isle_lh_x[li_i].text = string(ll_pct)					
				// process Y PCT
				li_y_diff = li_tip_y[li_i] -  li_tip_y[1]
				li_y_offset = li_y_offset1 + li_y_diff
				if li_y_offset > li_key_height then // use negative number to represent
					if (li_y_offset - li_key_height)*100/li_key_height < 127 then
						ll_pct = 0 - ((li_y_offset - li_key_height)*100/(li_key_height*3))
					else
						ll_pct = -9
					end if
				else
					ll_pct = li_y_offset*100/li_key_height
					if ll_pct = 100 then ll_pct = 99
					if ll_pct <= 0 then ll_pct = 1
				end if								
				isle_lh_y[li_i].text = string(ll_pct)
			end if
		else
			isle_lh_w[li_i].text = "0"
			isle_lh_h[li_i].text = "0"
			MessageBox("Error", ls_name_id[li_i] + " not found in the resource file!")
		end if
	next
end if

if cbx_append_right_hand.checked then
	ls_name_id[1] = ddlb_rh_1.text
	ls_name_id[2] = ddlb_rh_2.text
	ls_name_id[3] = ddlb_rh_3.text
	ls_name_id[4] = ddlb_rh_4.text
	ls_name_id[5] = ddlb_rh_5.text
	li_note1 = integer(sle_rh_1_note.text)
	ll_x_pct1 = integer(sle_rh_1_x.text)
	ll_y_pct1 = integer(sle_rh_1_y.text)
	li_x_offset1 = li_key_width*ll_x_pct1/100
	li_y_offset1 = li_key_height*ll_y_pct1/100
	for li_i = 1 to upperbound(ls_name_id)
		// get array size
		ll_array_size = extGetCoordGraphCount(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", ls_name_id[li_i])
		ll_x_array = ll_empty_list
		ll_y_array = ll_empty_list
		for li_j = 1 to ll_array_size
			ll_x_array[li_j] = 0
			ll_y_array[li_j] = 0
		next
		if ll_array_size > 0 then
			// given fingering name to retrieve array of the fingering coordinates
			extGetCoordGraphFile(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", ll_x_array, ll_y_array, ll_array_size, ls_name_id[li_i])
			li_array_range = GetArrayRange(ll_x_array)
			// key width is equal to key X array range
			ll_pct = li_array_range*100/li_key_width
			isle_rh_w[li_i].text = string(ll_pct)
			li_array_range = GetArrayRange(ll_y_array)
			// key height is equal to key Y array rage
			ll_pct = li_array_range*100/li_key_height
			isle_rh_h[li_i].text = string(ll_pct)	
			li_tip_x[li_i] = ll_x_array[1]
			li_tip_y[li_i] = ll_y_array[1]
			if li_i > 1 then 
				li_natural_note_count = 0
				li_x_diff = li_tip_x[li_i] - li_tip_x[1]  
				if li_x_diff > 0 then	// the finger li_i is at the right of finger 1
					if mod(li_x_diff, li_key_width) > (li_key_width - li_x_offset1) then
						li_natural_note_diff = li_x_diff/li_key_width + 1
						li_x_offset = mod(li_x_diff, li_key_width) + li_x_offset1 - li_key_width
					else
						li_natural_note_diff = li_x_diff/li_key_width
						li_x_offset = mod(li_x_diff, li_key_width) + li_x_offset1
					end if
					if li_x_offset >= li_key_width then li_x_offset = li_key_width - 1
					if li_x_offset = 0 then li_x_offset = 1
				else							// the finger li_i is at the left of finger 1
					li_natural_note_diff = (li_x_diff - (li_key_width - li_x_offset1))/li_key_width
					if abs(mod(li_x_diff, li_key_width)) < (li_key_width - li_x_offset1) then
						li_x_offset = li_x_offset1 + mod(li_x_diff, li_key_width)
					else
						li_x_offset = li_key_width + (mod(li_x_diff, li_key_width) + li_x_offset1)	
					end if					
				end if				
				isle_rh_note[li_i].text = string(wf_naturalnote_to_note_seq(li_note1, li_natural_note_diff))
				isle_rh_note[li_i].event modified()
				ll_pct = li_x_offset*100/li_key_width
				if ll_pct >= 100 then ll_pct = 99
				if ll_pct = 0 then ll_pct = 1				
				isle_rh_x[li_i].text = string(ll_pct)					
				// process Y PCT
				li_y_diff = li_tip_y[li_i] -  li_tip_y[1]
				li_y_offset = li_y_offset1 + li_y_diff
				if li_y_offset > li_key_height then // use negative number to represent
					if (li_y_offset - li_key_height)*100/li_key_height < 127 then
						ll_pct = 0 - ((li_y_offset - li_key_height)*100/(li_key_height*3))
					else
						ll_pct = -9
					end if
				else
					ll_pct = li_y_offset*100/li_key_height
					if ll_pct = 100 then ll_pct = 99
					if ll_pct <= 0 then ll_pct = 1
				end if								
				isle_rh_y[li_i].text = string(ll_pct)
			end if
		else
			isle_rh_w[li_i].text = "0"
			isle_rh_h[li_i].text = "0"
			MessageBox("Error", ls_name_id[li_i] + " not found in the resource file!")
		end if
	next
end if



end subroutine

public function integer wf_naturalnote_to_note_seq (integer ai_note_id, integer ai_naturalnote_diff);// get note sequence id based on current note id and natureal note difference
integer li_i, li_natural_note_count = 0, li_current_note
if ai_naturalnote_diff = 0 then return ai_note_id

li_current_note = ai_note_id
if ai_naturalnote_diff > 0 then
	for li_i = ai_note_id + 1 to 100
		if IsNaturalNote(li_i) then
			li_natural_note_count = li_natural_note_count + 1
			if li_natural_note_count = ai_naturalnote_diff then return li_i
		end if
	next
else
//	for li_i = ai_note_id - 1 to 0 step -1
	do while li_natural_note_count <> ai_naturalnote_diff
		li_current_note = li_current_note - 1
		if IsNaturalNote(li_current_note) then
			li_natural_note_count = li_natural_note_count - 1
			if li_natural_note_count = ai_naturalnote_diff then return li_current_note
		end if
	loop	
//	next	
end if

return 0
end function

public subroutine wf_show_graph ();string ls_bmp = "tttmmmppp.bmp", ls_tmp
long graphW, graphH

if pos(lower(sle_file_name.text), ".png") > 0 then // convert to BMP
	ConvertGraphFile(sle_file_name.text, ls_bmp)
	uo_1.uo_1.p_1.PictureName = ls_bmp
else
	uo_1.uo_1.p_1.PictureName = sle_file_name.text		
//	MessageBox("uo_1.uo_1.p_1.PictureName", uo_1.uo_1.p_1.PictureName)
end if
//DllTest()
//GraphicDllTest()
//return
GetGraphDim(sle_file_name.text, graphW, graphH)
graphW = PixelsToUnits(graphW, XPixelsToUnits!)
graphH = PixelsToUnits(graphH, YPixelsToUnits!)
ls_tmp = "graphW=" + string(graphW) + " graphH=" + string(graphH)
//MessageBox("ls_tmp", ls_tmp)

uo_1.UnitsPerLine = graphH/100
uo_1.uo_1.x = 0
uo_1.uo_1.y = 0
uo_1.uo_1.p_1.x = 0
uo_1.uo_1.p_1.y = 0
uo_1.LinesPerPage = 10
uo_1.uo_1.width = graphW
uo_1.uo_1.height = graphH
uo_1.uo_1.p_1.width = graphW
uo_1.uo_1.p_1.height = graphH



//if upperbound(is_picture_list) > 1 then // obtain original picture demension
//	uo_1.uo_1.is_picture_name = is_picture_list[2]
//	ls_local_filename = gn_appman.is_sys_temp + "\music_sheet" + String(Today(), "yymd") + right(uo_1.uo_1.is_picture_name, 4)
//	if pos(lower(uo_1.uo_1.is_picture_name),".jpg") > 0 or &
//		pos(lower(uo_1.uo_1.is_picture_name),".bmp") > 0 or &
//		pos(lower(uo_1.uo_1.is_picture_name),".gif") > 0 or &
//		pos(lower(uo_1.uo_1.is_picture_name),".png") > 0 then
//		f_set_picture_with_cache_resource2(uo_1.uo_1.is_picture_name, uo_1.uo_1.p_1, ll_width, ll_height)
//		uo_1.uo_1.il_width = PixelsToUnits(ll_width, XPixelsToUnits!)
//		uo_1.uo_1.il_height = PixelsToUnits(ll_height, YPixelsToUnits!)
//		idb_width_ratio = 1.0
//		idb_height_ratio = 1.0
//		uo_1.uo_1.height = uo_1.uo_1.il_height
//		uo_1.uo_1.p_1.width = uo_1.uo_1.il_width
//		uo_1.uo_1.p_1.height = uo_1.uo_1.il_height
//
//		uo_1.uo_1.x = 0
//		uo_1.uo_1.y = 0
//		uo_1.uo_1.p_1.x = 0
//		uo_1.uo_1.p_1.y = 0
//		uo_1.UnitsPerLine = (uo_1.uo_1.il_height + 100 - uo_1.height)/100 	// 
//		uo_1.LinesPerPage = 2								// UnitsPerPage = UnitsPerLine*LinesPerPage
//
//	end if
//end if
end subroutine

public function integer wf_parse_finger_entry (string as_input, ref string as_lh_output, ref string as_rh_output, ref string as_lh_output_list[], ref string as_rh_output_list[]);// function name: wf_parse_finger_entry
//	parms: string as_input = the string to be parsed
//        string as_lh_output[] the array of parsed left hand string
//        string as_rh_output[] the array of parsed right hand string
//        string as_lh_output_list[] the array of parsed left hand string
//        string as_rh_output_list[] the array of parsed right hand string

integer li_i, li_pos1, li_pos2
string ls_input, ls_entry

li_pos1 = pos(as_input, "FB")
li_pos2 = pos(as_input, "FE")		

if li_pos1 > 0 and li_pos2 > 0 then
	ls_input = mid(as_input, li_pos1 + 2, li_pos2 - li_pos1 - 2)
else
	ls_input = as_input
end if

if mod(len(ls_input), FINGERING_ATTR_LEN) > 0 then return 0

for li_i = 1 to len(as_input)/FINGERING_ATTR_LEN
	ls_entry = mid(ls_input, FINGERING_ATTR_LEN*(li_i - 1) + 1, FINGERING_ATTR_LEN)
	if left(ls_entry, 1) = "1" then // left hand fingering
		as_lh_output_list[upperbound(as_lh_output_list) + 1] = ls_entry
		as_lh_output = as_lh_output + ls_entry
	elseif left(ls_entry, 1) = "2" then // right hand fingering
		as_rh_output_list[upperbound(as_rh_output_list) + 1] = ls_entry
		as_rh_output = as_rh_output + ls_entry
	else
		return 0
	end if
next

return 1
end function

public function integer wf_goto_rec (integer ai_x, integer ai_y);// to the record and finger, key position directly from x, y coordinates
integer li_row, li_begin_x, li_begin_y, li_end_x, li_end_y
string ls_coord
dwobject dwo
for li_row = 2 to dw_1.RowCount()
	ls_coord = dw_1.GetItemString(li_row, "coord")
	li_begin_x = integer(mid(ls_coord, 1, 4))
	li_begin_y = integer(mid(ls_coord, 5, 5))
	li_end_x = integer(mid(ls_coord, 10, 4))
	li_end_y = integer(mid(ls_coord, 14, 5))
	if ai_x >= li_begin_x and ai_x <= li_end_x and ai_y >= li_begin_y and ai_y <= li_end_y then
		dw_1.event clicked(0,0,li_row,dwo)
		dw_1.event doubleclicked(0,0,li_row,dwo)
		ii_current_row = li_row
//		wf_rec_move(ls_coord)
		dw_1.ScrollToRow(ii_current_row)
		dw_1.SelectRow(0, false)
		dw_1.SelectRow(ii_current_row, true)
		exit
	end if
next	
return 1
end function

public subroutine wf_play_note ();string ls_note_coordinate,ls_note_to_keyboard
string ls_rh_time_fraction[],ls_rh_note_value[],ls_rh_note_char[],ls_rh_note_finger[]
string ls_lh_time_fraction[],ls_lh_note_value[],ls_lh_note_char[],ls_lh_note_finger[]
integer li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, li_note_set_count
integer li_current_note, li_entry_count, ii_rh_note_tmp, ii_lh_note_tmp

integer li_i, li_j,li_k,li_k1, li_first_head = 0, li_second_head = 0, li_first_tail = 0, li_second_tail = 0
integer li_l,li_r,li_b,li_l_begin,li_r_begin,li_b_begin,li_l_end,li_r_end,li_b_end
integer li_total_note_count, li_right_hand_note_count, li_left_hand_note_count
string ls_note, ls_note_wing, ls_finger_entry
double ldb_min, ldb_tmp, ldb_tmp1

//if ii_moving_inteval_ind = 0 then // there is a continuous note advancing, let's play notes
//	return
//end if


integer li_retain_notes[]
wf_parse_note_attribute(is_cur_text_list[ii_current_row],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, &
	ls_rh_time_fraction,ls_lh_time_fraction,ls_rh_note_value,ls_lh_note_value,ls_rh_note_char,ls_lh_note_char,ls_rh_note_finger,ls_lh_note_finger)

// add extending note to retain note list
for li_i = 1 to li_rh_note_set_count
	if integer(ls_rh_note_value[li_i]) > 0 then
		for li_j = 1 to upperbound(ii_played_notes)
			if integer(ls_rh_note_value[li_i]) = ii_played_notes[li_j] and ls_rh_note_char[li_i] = "2" then // retain note
				li_retain_notes[upperbound(li_retain_notes) + 1] = ii_played_notes[li_j]
			end if
		next
	end if
next
for li_i = 1 to li_lh_note_set_count
	if integer(ls_lh_note_value[li_i]) > 0 then
		for li_j = 1 to upperbound(ii_played_notes)
			if integer(ls_lh_note_value[li_i]) = ii_played_notes[li_j] and ls_lh_note_char[li_i] = "2" then // retain note
				li_retain_notes[upperbound(li_retain_notes) + 1] = ii_played_notes[li_j]
			end if
		next
	end if
next	

// traverse through retain note list, if a played note is not in the retain note list, then remove(release) the key, message 1041
boolean lb_found = false
for li_i = 1 to upperbound(ii_played_notes)
	lb_found = false
	for li_j = 1 to upperbound(li_retain_notes)
		if ii_played_notes[li_i] = li_retain_notes[li_j] then lb_found = true
	next
	if not lb_found then // release the play note key
		wf_remove_played_note(ii_played_notes[li_i])
		extPostThreadMessage(il_thread_id, 1041, ii_played_notes[li_i], 0)
	end if
next

// play new note
for li_i = 1 to li_rh_note_set_count
	if integer(ls_rh_note_value[li_i]) > 0 and ls_rh_note_char[li_i] <> "2" then
		wf_add_played_note(integer(ls_rh_note_value[li_i]))
		extPostThreadMessage(il_thread_id, 1040, integer(ls_rh_note_value[li_i]), long(sle_right_volume.text))		// play the note
	end if
next
for li_i = 1 to li_lh_note_set_count
	if integer(ls_lh_note_value[li_i]) > 0 and ls_lh_note_char[li_i] <> "2" then
		wf_add_played_note(integer(ls_lh_note_value[li_i]))
		extPostThreadMessage(il_thread_id, 1040, integer(ls_lh_note_value[li_i]), long(sle_left_volume.text))		// play the note
	end if
next

return 

end subroutine

public subroutine wf_add_played_note (integer ai_note);integer li_i = 0

for li_i = 1 to upperbound(ii_played_notes)
	if ii_played_notes[li_i] = 0 then exit
next

if li_i > 0 then 
	ii_played_notes[li_i] = ai_note
else
	ii_played_notes[upperbound(ii_played_notes) + 1] = ai_note
end if


end subroutine

public function double wf_get_min_time ();string ls_note_coordinate,ls_note_to_keyboard
string ls_rh_time_fraction[],ls_rh_note_value[],ls_rh_note_char[],ls_rh_note_finger[]
string ls_lh_time_fraction[],ls_lh_note_value[],ls_lh_note_char[],ls_lh_note_finger[]
integer li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, li_note_set_count
integer li_current_note, li_entry_count, ii_rh_note_tmp, ii_lh_note_tmp

integer li_i, li_j
integer li_l,li_r,li_b,li_l_begin,li_r_begin,li_b_begin,li_l_end,li_r_end,li_b_end
integer li_total_note_count, li_right_hand_note_count, li_left_hand_note_count
string ls_note, ls_note_wing, ls_finger_entry
double ldb_min_duration = 10.0, ldb_tmp, ldb_seconds_per_bit, ldb_bits_per_minute


wf_parse_note_attribute(is_cur_text_list[ii_current_row],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, &
	ls_rh_time_fraction,ls_lh_time_fraction,ls_rh_note_value,ls_lh_note_value,ls_rh_note_char,ls_lh_note_char,ls_rh_note_finger,ls_lh_note_finger)

// reset time duration
for li_j = 1 to 5
	idb_right_note_duration[li_j] = 0.0
	idb_left_note_duration[li_j] = 0.0
next

idb_min_duration = 10.0

for li_j = 1 to upperbound(ls_rh_time_fraction)	
//	if integer(ls_rh_note_value[li_j]) > 0 then
		ldb_tmp = wf_string_to_fraction(ls_rh_time_fraction[li_j])
		if ldb_tmp > 0 then
			if ldb_tmp < ldb_min_duration then ldb_min_duration = ldb_tmp
		end if
//	end if
next

for li_j = 1 to upperbound(ls_lh_time_fraction)	
//	if integer(ls_lh_note_value[li_j]) > 0 then
		ldb_tmp = wf_string_to_fraction(ls_lh_time_fraction[li_j])
		if ldb_tmp > 0 then
			if ldb_tmp < ldb_min_duration then ldb_min_duration = ldb_tmp
		end if
//	end if
next

ldb_bits_per_minute = integer(sle_tempo.text)

ldb_seconds_per_bit = 60.0/ldb_bits_per_minute

ldb_min_duration = (ldb_min_duration/0.25)*ldb_seconds_per_bit

return ldb_min_duration


end function

public subroutine wf_remove_played_note (integer ai_note);integer li_i

for li_i = 1 to upperbound(ii_played_notes)
	if ii_played_notes[li_i] = ai_note then ii_played_notes[li_i] = 0
next


end subroutine

public subroutine wf_remove_all_played_notes ();integer li_i

for li_i = 1 to upperbound(ii_played_notes)
	if ii_played_notes[li_i] > 0 then
		extPostThreadMessage(il_thread_id, 1041, ii_played_notes[li_i], 0)
	end if
next

ii_played_notes = ii_empty_list



end subroutine

public subroutine wf_capture_image_set ();// function: capture keyboard image, add it to the _kb_pane_images library and save the file
// revision: 10/13/2014 - save the individual file in the c:\temp library rather than the google share drive

long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j, li_flag
long ll_file_size, ll_seq
string ls_token, ls_seq_list = ""
string ls_lesson_prefix = ""

if not DirectoryExists("c:\temp") then CreateDirectory(is_deploy_directory + "c:\temp")
if not DirectoryExists("c:\temp\keyboard_images") then CreateDirectory("c:\temp\keyboard_images")


//for li_i = 1 to len(sle_dw_path.text)
//	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
//	if ls_token = "\" then exit
//	ls_lesson_prefix = ls_token + ls_lesson_prefix 
//next
//ls_lesson_prefix = left(ls_lesson_prefix, len(is_res_file_name) - 4) + "_kb_pane_images"


ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

ll_width = UnitsToPixels(p_1.width, XUnitsToPixels!)
ll_height = UnitsToPixels(p_1.height, YUnitsToPixels!)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if

// we need to stop image flashing during image capturing
extTransFinger(NONE_ANIMATION_MODE)

if cbx_activate_animation.checked then	// cbx_activate_animation checkbox is used to capture the image of key release in image flashing-animating
	extTransFinger(KEY_RELEASED_MODE)
else
	extTransFinger(KEY_PRESSED_MODE)
end if

ll_dc = GetDC(handle(p_1))

for ll_i = 2 to dw_1.RowCount()
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			continue
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if
	ib_keyboard_draw = false
	li_j = 0
	dw_1.event clicked(0,0,ll_i,dwo)
	dw_1.event doubleclicked(0,0,ll_i,dwo)
//	Yield()
	do while not ib_keyboard_draw 
		li_j ++
		Yield()
		sleeping(5)
		if li_j > 1000 then exit
	loop
	if li_j > 1000 then
		MessageBox("Error", "Waiting too long for keyboard to draw, exit")
		continue
	end if
	CaptureImageRegion(ll_dc, ls_file_name, 0, 0, ll_width, ll_height)	
	ll_file_size = FileLength(ls_file_name)
	if cbx_image_lib.checked then
		extPutImageFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", ls_file_name, ls_file_name, ls_time_stamp, ll_file_size)	
	end if
//	if cbx_delete_tmp_img.checked then	
//		FileDelete(ls_file_name)
//	else
//		if not DirectoryExists(is_deploy_directory + "\images") then CreateDirectory(is_deploy_directory + "\images")
//		if not DirectoryExists(is_deploy_directory + "\images\" + ls_lesson_prefix) then CreateDirectory(is_deploy_directory + "\images\" + ls_lesson_prefix)
//		If FileExists(is_deploy_directory + "\images\" + ls_lesson_prefix + "\" + ls_file_name) then FileDelete(is_deploy_directory + "\images\" + ls_lesson_prefix + "\" + ls_file_name)
//		FileMove(ls_file_name, is_deploy_directory + "\images\" + ls_lesson_prefix + "\" + ls_file_name)
		if not FileExists(ls_file_name) then
			MessageBox(ls_file_name, " does not exist!")
			return
		else
			if FileExists("c:\temp\keyboard_images\" + ls_file_name) then
				FileDelete("c:\temp\keyboard_images\" + ls_file_name)
			end if
			li_flag = FileMove(ls_file_name, "c:\temp\keyboard_images\" + ls_file_name)
//			MessageBox("li_flag", li_flag)
		end if
//	end if
next

extTransFinger(KEY_PRESSED_MODE)

//long ll_i, ll_width, ll_height, ll_dc
//string ls_file_name, ls_time_stamp
//DateTime ldt_tmp
//dwobject dwo
//integer li_i, li_j
//long ll_file_size, ll_seq
//string ls_res_file_name = "", ls_token, ls_seq_list = ""
//
////	ls_file_name = "C:\Users\hzhang\AppData\Local\Temp\" + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
//
//if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
//	MessageBox("Error", "No Hand Selected, Cannot Capture Images!")
//	return
//end if
//
//for li_i = 1 to len(sle_dw_path.text)
//	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
//	if ls_token = "\" then exit
//	ls_res_file_name = ls_token + ls_res_file_name 
//next
//
//ldt_tmp = DateTime(today(), now())
//
//ls_time_stamp = string(ldt_tmp)
//
//ll_width = UnitsToPixels(p_1.width, XUnitsToPixels!)
//ll_height = UnitsToPixels(p_1.height, YUnitsToPixels!)
//ls_res_file_name = left(ls_res_file_name, len(ls_res_file_name) - 4) + "_fingering_image"
//
//if not cbx_append_right_hand.checked then
//	ls_res_file_name = ls_res_file_name + "_left"
//elseif not cbx_append_left_hand.checked then
//	ls_res_file_name = ls_res_file_name + "_right"
//end if
//
//if cbx_activate_animation.checked then
//	if (not FileExists(ls_res_file_name + ".lhi")) or (not FileExists(ls_res_file_name + ".lhm")) then
//		MessageBox("Error", "Create None Active Animation First!")
//		return 0
//	else
//		if extGetImageFile(ls_res_file_name + ".lhi", ls_res_file_name +  ".lhm", "1000020", "ttmmpp.dummy") = 1 then
//			MessageBox("Error", "Animation Images Existing, Cannot Create Them!")				
//			return 0
//		end if
//	end if
//else
//	extCreateResourceFile(ls_res_file_name + ".lhi", ls_res_file_name + ".lhm")
//end if
//
//// we need to stop image flashing during image capturing
//extTransFinger(NONE_ANIMATION_MODE)
//
//if cbx_activate_animation.checked then	// cbx_activate_animation checkbox is used to capture the image of key release in image flashing-animating
//	extTransFinger(KEY_RELEASED_MODE)
//else
//	extTransFinger(KEY_PRESSED_MODE)
//end if
//
//ll_dc = GetDC(handle(p_1))
//
////ls_seq_list
//for ll_i = 2 to dw_1.RowCount()
//	ls_seq_list = ls_seq_list + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000")
//next
//
//extPutImage(ls_res_file_name + ".lhi", ls_res_file_name + ".lhm", "SEQUENCE_NUMBER", ls_seq_list, ls_time_stamp, len(ls_seq_list))	
//
//for ll_i = 2 to dw_1.RowCount()
////for ll_i = 2 to 5
//	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
//	if cbx_activate_animation.checked then
//		if mod(ll_seq, 10) = 0 then // the active fingering entry
//			ls_file_name = string(1000000 + ll_seq) + ".png"
//		else
//			continue
//		end if
//	else
//		ls_file_name = string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
//	end if
//	dw_1.event clicked(0,0,ll_i,dwo)
//	dw_1.event doubleclicked(0,0,ll_i,dwo)
//	Yield()
//	sleep(2)
//	CaptureImageRegion(ll_dc, ls_file_name, 0, 0, ll_width, ll_height)	
//	ll_file_size = FileLength(ls_file_name)
//	extPutImageFile(ls_res_file_name + ".lhi", ls_res_file_name + ".lhm", ls_file_name, ls_file_name, ls_time_stamp, ll_file_size)	
//	if cbx_delete_tmp_img.checked then	
//		FileDelete(ls_file_name)
//	else
//		if not cbx_append_right_hand.checked then
//			FileMove(ls_file_name, "left_" + ls_file_name)
//		elseif not cbx_append_left_hand.checked then
//			FileMove(ls_file_name, "right_" + ls_file_name)
//		end if		
//	end if
//next
//
////for ll_i = 1 to upperbound(ls_path)
////	extGetImageFile("finger_graphic.lhi", "finger_graphic.lhm", ls_path[ll_i], ls_local_filename)
////	ll_file_size = FileLength(ls_local_filename)
////	extPutImageFile("tmp.lhi", "tmp.lhm", ls_local_filename, ls_path[ll_i], ls_tstamp[ll_i], ll_file_size)	
////next
//
//extTransFinger(ANIMATION_MODE)
//extTransFinger(KEY_PRESSED_MODE)
//
end subroutine

public subroutine wf_capture_image_single ();//

long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = ""


is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

ll_width = UnitsToPixels(p_1.width, XUnitsToPixels!)
ll_height = UnitsToPixels(p_1.height, YUnitsToPixels!)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if

// we need to stop image flashing during image capturing
extTransFinger(NONE_ANIMATION_MODE)

if cbx_activate_animation.checked then	// cbx_activate_animation checkbox is used to capture the image of key release in image flashing-animating
	extTransFinger(KEY_RELEASED_MODE)
else
	extTransFinger(KEY_PRESSED_MODE)
end if

ll_dc = GetDC(handle(p_1))

	ll_i = ii_current_row
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			return
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if

	li_j = 0
	dw_1.event clicked(0,0,ll_i,dwo)
	dw_1.event doubleclicked(0,0,ll_i,dwo)
	ib_keyboard_draw = false
//	Yield()
	do while not ib_keyboard_draw 
		li_j ++
		Yield()
		sleeping(5)
		if li_j > 1000 then exit
	loop
	if li_j > 1000 then
		MessageBox("Error", "Waiting too long for keyboard to draw, exit")
		return
	end if
	CaptureImageRegion(ll_dc, ls_file_name, 0, 0, ll_width, ll_height)	
	if not DirectoryExists("images\" + is_res_file_name) then CreateDirectory("images\" + is_res_file_name)
	If FileExists("images\" + is_res_file_name + "\" + ls_file_name) then FileDelete("images\" + is_res_file_name + "\" + ls_file_name)
	FileMove(ls_file_name, "images\" + is_res_file_name + "\" + ls_file_name)

extTransFinger(KEY_PRESSED_MODE)


end subroutine

public function integer wf_build_image ();// build collection from the individual sequence graphs, the sequence graphs-images must be previously captured or modified
// this function is useful when some sequence graphs need to be modified, and rebuilt into the _kb_pane_images

long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_file_path, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = ""


is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if

for ll_i = 2 to dw_1.RowCount()
//for ll_i = 2 to 5
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			continue
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if
	ls_file_path = "images\" + is_res_file_name + "\" + ls_file_name
	If not FileExists(ls_file_path) then
		MessageBox("Error", "File: " + ls_file_path + " NOT FOUND")
		return 0
	end if
	extPutImageFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", ls_file_path, ls_file_name, ls_time_stamp, ll_file_size)	
next

return 1
end function

public function integer wf_retrieve_image ();long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_file_path, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = ""


is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if

for ll_i = 2 to dw_1.RowCount()
//for ll_i = 2 to 5
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			continue
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if
	ls_file_path = "images\" + is_res_file_name + "\" + ls_file_name
//	If FileExists(ls_file_path) then FileDelete(ls_file_path)
	if not DirectoryExists("images\" + is_res_file_name) then CreateDirectory("images\" + is_res_file_name)
	if extGetImageFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", ls_file_name, ls_file_path) = 0 then	
		MessageBox("Error", "File: " + ls_file_name + " NOT FOUND In the library!")
	end if
next

return 1
end function

public subroutine wf_display_single_image ();//

long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = ""

is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"


//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if

	ll_i = ii_current_row
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			return
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if
	ls_file_name = "images\" + is_res_file_name + "\" + ls_file_name
	if Not FileExists(ls_file_name) then
		MessageBox("Error: The File Does Not Exist", ls_file_name)
	else
		f_set_picture_with_any_format(ls_file_name, p_1, ll_width, ll_height)
	end if

end subroutine

public function integer wf_build_image_library ();// build _image_lib from the individual sequence graphs

long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_file_path, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = "", ls_res_directory, ls_res_file_name_temp

ls_res_file_name_temp = "C:\temp\keyboard_images\" + is_lesson_output_prefix + "_image_lib"


/*
is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

ls_res_directory = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_image_lib"
is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_image_lib"
*/

//string ls_lesson_prefix = ""
//
//for li_i = 1 to len(sle_dw_path.text)
//	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
//	if ls_token = "\" then exit
//	ls_lesson_prefix = ls_token + ls_lesson_prefix 
//next
//ls_lesson_prefix = left(ls_lesson_prefix, len(is_res_file_name) - 4) + "_kb_pane_images"


ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if



//string SeqGraphic, GraphicLibIndexFile, GraphicLibImageFile
//long SectionIndex, SectionCount, LibIndex
//long ll_i, ll_mem_handle
//
//SectionCount = 38
//SeqGraphic = "key_only_prompt_both_000100.png"
//GraphicLibIndexFile = "key_only_prompt_both_000100.lhi"
//GraphicLibImageFile = "key_only_prompt_both_000100.lhm"
//
//if not FileExists(GraphicLibIndexFile) or not FileExists(GraphicLibImageFile) then
//	extCreateResourceFile(GraphicLibIndexFile, GraphicLibImageFile)
//	MessageBox(GraphicLibIndexFile, GraphicLibImageFile)
//end if	
//
//extMkGraphicLib(SeqGraphic, GraphicLibIndexFile,GraphicLibImageFile, SectionCount)

for ll_i = 2 to dw_1.RowCount()
//for ll_i = 2 to 3
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			continue
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if

	//ls_file_path = is_deploy_directory + "\images\" + ls_lesson_prefix + "\" + ls_file_name
	ls_file_path =  "c:\temp\keyboard_images\" + ls_file_name
	If not FileExists(ls_file_path) then
		MessageBox("Error", "File: " + ls_file_path + " NOT FOUND")
		return 0
	end if
//	MessageBox("ls_file_name", ls_file_name)
//	extMkGraphicLib(ls_file_path, ls_file_name, is_res_file_name + ".lhi", is_res_file_name + ".lhm", SectionCount)
	extMkGraphicLib(ls_file_path, ls_file_name, ls_res_file_name_temp + ".lhi", ls_res_file_name_temp + ".lhm", SectionCount)
	
//	extMkGraphicLib(SeqGraphic, GraphicLibIndexFile,GraphicLibImageFile, SectionCount)
//	extPutImageFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", ls_file_path, ls_file_name, ls_time_stamp, ll_file_size)	
next

return 1
end function

public function integer wf_rebuild_image ();// build collection from the individual sequence graphs

long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_file_path, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = "", ls_res_directory


is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

ls_res_directory = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"
is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_image_lib"
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_lesson_lib"

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if



//string SeqGraphic, GraphicLibIndexFile, GraphicLibImageFile
//long SectionIndex, SectionCount, LibIndex
//long ll_i, ll_mem_handle
//
//SectionCount = 38
//SeqGraphic = "key_only_prompt_both_000100.png"
//GraphicLibIndexFile = "key_only_prompt_both_000100.lhi"
//GraphicLibImageFile = "key_only_prompt_both_000100.lhm"
//
//if not FileExists(GraphicLibIndexFile) or not FileExists(GraphicLibImageFile) then
//	extCreateResourceFile(GraphicLibIndexFile, GraphicLibImageFile)
//	MessageBox(GraphicLibIndexFile, GraphicLibImageFile)
//end if	
//
//extMkGraphicLib(SeqGraphic, GraphicLibIndexFile,GraphicLibImageFile, SectionCount)

for ll_i = 2 to dw_1.RowCount()
//for ll_i = 2 to 3
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			continue
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if
	
	if not DirectoryExists("images") then CreateDirectory("images")
	if not DirectoryExists("images\" + ls_res_directory) then CreateDirectory("images\" + ls_res_directory)
	
	ls_file_path = "images\" + ls_res_directory + "\" + ls_file_name
//	MessageBox("ls_file_name", ls_file_name)
	extPNGRetrieveFullMem(ls_file_name, il_mem_handle)
	FileMove(ls_file_name, ls_file_path)
next

return 1
end function

public function integer wf_build_lesson ();// build collection from the individual sequence graphs

long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_file_path, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = "", ls_res_directory


is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

ls_res_directory = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_image_lib"
is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_lesson_lib"

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if



//string SeqGraphic, GraphicLibIndexFile, GraphicLibImageFile
//long SectionIndex, SectionCount, LibIndex
//long ll_i, ll_mem_handle
//
//SectionCount = 38
//SeqGraphic = "key_only_prompt_both_000100.png"
//GraphicLibIndexFile = "key_only_prompt_both_000100.lhi"
//GraphicLibImageFile = "key_only_prompt_both_000100.lhm"
//
//if not FileExists(GraphicLibIndexFile) or not FileExists(GraphicLibImageFile) then
//	extCreateResourceFile(GraphicLibIndexFile, GraphicLibImageFile)
//	MessageBox(GraphicLibIndexFile, GraphicLibImageFile)
//end if	
//
//extMkGraphicLib(SeqGraphic, GraphicLibIndexFile,GraphicLibImageFile, SectionCount)

for ll_i = 2 to dw_1.RowCount()
//for ll_i = 2 to 3
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			continue
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if
	
	if not DirectoryExists("images") then CreateDirectory("images")
	if not DirectoryExists("images\" + ls_res_directory) then CreateDirectory("images\" + ls_res_directory)
	
	ls_file_path = "images\" + ls_res_directory + "\" + ls_file_name
//	MessageBox("ls_file_name", ls_file_name)
	extPNGRetrieveFullMem(ls_file_name, il_mem_handle)
	FileMove(ls_file_name, ls_file_path)
next

return 1
end function

public function integer wf_make_section_images ();// build collection from the individual sequence graphs

long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_file_path, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = "", ls_res_directory


is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

ls_res_directory = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_image_lib"
is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_sec_image_lib"

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if



//string SeqGraphic, GraphicLibIndexFile, GraphicLibImageFile
//long SectionIndex, SectionCount, LibIndex
//long ll_i, ll_mem_handle
//
//SectionCount = 38
//SeqGraphic = "key_only_prompt_both_000100.png"
//GraphicLibIndexFile = "key_only_prompt_both_000100.lhi"
//GraphicLibImageFile = "key_only_prompt_both_000100.lhm"
//
//if not FileExists(GraphicLibIndexFile) or not FileExists(GraphicLibImageFile) then
//	extCreateResourceFile(GraphicLibIndexFile, GraphicLibImageFile)
//	MessageBox(GraphicLibIndexFile, GraphicLibImageFile)
//end if	
//
//extMkGraphicLib(SeqGraphic, GraphicLibIndexFile,GraphicLibImageFile, SectionCount)

for ll_i = 2 to dw_1.RowCount()
//for ll_i = 2 to 3
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			continue
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if
	ls_file_path = "images\" + ls_res_directory + "\" + ls_file_name
	If not FileExists(ls_file_path) then
		MessageBox("Error", "File: " + ls_file_path + " NOT FOUND")
		return 0
	end if
//	MessageBox("ls_file_name", ls_file_name)
	extMkSectionLib(ls_file_path, ls_file_name, is_res_file_name + ".lhi", is_res_file_name + ".lhm", SectionCount)
//	extMkGraphicLib(SeqGraphic, GraphicLibIndexFile,GraphicLibImageFile, SectionCount)
//	extPutImageFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", ls_file_path, ls_file_name, ls_time_stamp, ll_file_size)	
next

return 1
end function

public function integer wf_display_music_sheet ();integer li_i, li_j, li_seq, li_begin, li_pos, li_len, li_value
string ls_tmp, ls_line, ls_Docname, ls_named, ls_path, ls_cur_dir, ls_bmp = "tttmmmppp.bmp"
long graphW, graphH
ls_cur_dir = GetCurrentDirectory()

ChangeDirectory(ls_cur_dir)
if pos(lower(sle_file_name.text), ".png") > 0 then // convert to BMP
	ConvertGraphFile(sle_file_name.text, ls_bmp)
//		MessageBox(ls_named, ls_tmp)
	uo_1.uo_1.p_1.PictureName = ls_bmp
else
	uo_1.uo_1.p_1.PictureName = sle_file_name.text		
end if
//sle_file_name.text = "C:\Han\SOFTWARE DEVELOPMENT\Music\score_bitmap\oh_usanna.bmp"
//MessageBox("sle_file_name.text", sle_file_name.text)
GetGraphDim(sle_file_name.text, graphW, graphH)
graphW = PixelsToUnits(graphW, XPixelsToUnits!)
graphH = PixelsToUnits(graphH, YPixelsToUnits!)
//	uo_1.uo_1.p_1.PictureName = sle_file_name.text
uo_1.UnitsPerLine = graphH/100
uo_1.uo_1.x = 0
uo_1.uo_1.y = 0
uo_1.uo_1.p_1.x = 0
uo_1.uo_1.p_1.y = 0
uo_1.LinesPerPage = 10
uo_1.uo_1.width = graphW
uo_1.uo_1.height = graphH
uo_1.uo_1.p_1.width = graphW
uo_1.uo_1.p_1.height = graphH
return 1
end function

public function integer wf_get_rh_lh_note_list ();
// function name: wf_get_rh_lh_note_list
// description: to get note lists of left hand, right hand, and both hand from the input list, is_text_list

string msg, ls_fingering = ""
string ls_note_coordinate,ls_note_to_keyboard, ls_empty_list[]
string ls_rh_time_fraction[],ls_rh_note_value[],ls_rh_note_char[],ls_rh_note_finger[]
string ls_lh_time_fraction[],ls_lh_note_value[],ls_lh_note_char[],ls_lh_note_finger[]
string ls_rh_time_fraction1[],ls_rh_note_value1[],ls_rh_note_char1[],ls_rh_note_finger1[]
string ls_lh_time_fraction1[],ls_lh_note_value1[],ls_lh_note_char1[],ls_lh_note_finger1[]
string ls_rh_time_fraction0[],ls_rh_note_value0[],ls_rh_note_char0[],ls_rh_note_finger0[]
string ls_lh_time_fraction0[],ls_lh_note_value0[],ls_lh_note_char0[],ls_lh_note_finger0[]
string ls_rh_time_fraction00[],ls_rh_note_value00[],ls_rh_note_char00[],ls_rh_note_finger00[]
string ls_lh_time_fraction00[],ls_lh_note_value00[],ls_lh_note_char00[],ls_lh_note_finger00[]
string ls_finger_entry_list[], ls_finger_attr
integer li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, li_note_set_count
integer li_total_note_set_count1,li_rh_note_set_count1,li_lh_note_set_count1
integer li_total_note_set_count0=0,li_rh_note_set_count0=0,li_lh_note_set_count0=0
integer li_total_note_set_count00=0,li_rh_note_set_count00=0,li_lh_note_set_count00=0
integer li_current_note, li_entry_count, li_pos1, li_pos2, li_fingering_ind, ii_rh_note_tmp, ii_lh_note_tmp

integer li_i, li_j,li_k,li_k1, li_first_head = 0, li_second_head = 0, li_first_tail = 0, li_second_tail = 0
integer li_l,li_r,li_b,li_l_begin,li_r_begin,li_b_begin,li_l_end,li_r_end,li_b_end
integer li_total_note_count, li_right_hand_note_count, li_left_hand_note_count
string ls_note, ls_note_wing, ls_finger_entry
boolean lb_true_note, lb_rh_true_note, lb_lh_true_note
string ls_measure_size, ls_header
double ldb_measure_size, ldb_right_offset, ldb_left_offset, ldb_both_offset
double ldb_right, ldb_left, ldb_right_cur, ldb_left_cur, ldb_tmp, ldb_tmp1

//integer ii_measure_begin_index[], ii_measure_end_index[]

ls_header = is_text_list[1]
ls_measure_size = mid(ls_header, 2, 4)
ldb_measure_size = wf_string_to_fraction(ls_measure_size)
ldb_right_offset = wf_string_to_fraction(mid(ls_header, 6, 4))
ldb_left_offset = wf_string_to_fraction(mid(ls_header, 10, 4))

if ldb_right_offset > ldb_left_offset then
	ldb_both_offset = ldb_right_offset
else
	ldb_both_offset = ldb_left_offset
end if

for li_i = 1 to 5
	idb_right_note_duration0[li_i] = 0.0
	idb_left_note_duration0[li_i] = 0.0
next

integer li_num3, li_num1, li_num2, li_num
//		li_num1 = FileOpen("right.txt", LineMode!, Write!, LockWrite!, Replace!)
//		li_num2 = FileOpen("left.txt", LineMode!, Write!, LockWrite!, Replace!)
//		li_num3 = FileOpen("both.txt", LineMode!, Write!, LockWrite!, Replace!)
		li_num = FileOpen("dummy.txt", LineMode!, Write!, LockWrite!, Replace!)


// to find the existence of RH, LH, and Both hand note
for li_i = 2 to upperbound(is_text_list)
	if pos(is_text_list[li_i], "repeat") > 0 then continue
	ls_rh_time_fraction = ls_empty_list
	ls_rh_note_value = ls_empty_list
	ls_rh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	ls_lh_time_fraction = ls_empty_list
	ls_lh_note_value = ls_empty_list
	ls_lh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	li_total_note_set_count = 0
	li_total_note_set_count = 0
	li_lh_note_set_count = 0
	wf_parse_note_attribute(is_text_list[li_i],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, &
		ls_rh_time_fraction,ls_lh_time_fraction,ls_rh_note_value,ls_lh_note_value,ls_rh_note_char,ls_lh_note_char,ls_rh_note_finger,ls_lh_note_finger)	
//	MessageBox("is_text_list[li_i]", is_text_list[li_i])
	for li_j = 1 to li_rh_note_set_count
		if ls_rh_note_value[li_j] <> "000" then ib_right_exists = true
	next
	for li_j = 1 to li_lh_note_set_count
		if ls_lh_note_value[li_j] <> "000" then ib_left_hand_exists = true
	next
next

if ib_left_hand_exists and ib_right_exists then ib_both_exists = true


li_l_begin = 2
li_r_begin = 2
li_b_begin = 2

//MessageBox("title", title)
//MessageBox("upperbound(is_text_list)", upperbound(is_text_list))

//MessageBox("upperbound(is_text_list)", upperbound(is_text_list))
is_rh_text_list[1] = is_text_list[1]
is_lh_text_list[1] = is_text_list[1]
is_bh_text_list[1] = is_text_list[1]
//is_rh_wave_list[1] = is_wave_list[1]
//is_lh_wave_list[1] = is_wave_list[1]
//is_bh_wave_list[1] = is_wave_list[1]
//is_rh_picture_list[1] = is_picture_list[1]
//is_lh_picture_list[1] = is_picture_list[1]
//is_bh_picture_list[1] = is_picture_list[1]

is_rh_finger_list[1] = is_finger_list[1]
is_lh_finger_list[1] = is_finger_list[1]
is_bh_finger_list[1] = is_finger_list[1]
ii_rh_list_index[1] = 1
ii_lh_list_index[1] = 1
ii_bh_list_index[1] = 1
ii_bh_to_rh[1] = 1
ii_bh_to_lh[1] = 1
try
for li_i = 2 to upperbound(is_text_list)
	//note attribute redistribution
	//
	//1) merge last note attributes with the current note attributes
	//2) build the new note attributes with minimum time duration for the attributes
	//3) generate the remaining attributes which are those notes that have the 
	//   remaining time duration greater than 0
	//4) repeat the loop	
	//get repeat note information
	if trim(is_text_list[li_i]) = "repeatBegin" then
		if upperbound(is_lh_text_list) > 1 then
			li_l_begin = upperbound(is_lh_text_list) + 1
		end if
		if upperbound(is_rh_text_list) > 1 then
			li_r_begin = upperbound(is_rh_text_list) + 1
		end if
		if upperbound(is_bh_text_list) > 1 then
			li_b_begin = upperbound(is_bh_text_list) + 1
		end if
		continue
	end if
	if trim(is_text_list[li_i]) = "repeatEnd" then
		if upperbound(is_rh_text_list) > 1 then
			li_r = upperbound(istr_rh_repeat) + 1
			istr_rh_repeat[li_r].repeatEnd = upperbound(is_rh_text_list)
			istr_rh_repeat[li_r].repeatBegin = li_r_begin
			istr_rh_repeat[li_r].played = false
		end if
		if upperbound(is_lh_text_list) > 1 then
			li_l = upperbound(istr_lh_repeat) + 1
			istr_lh_repeat[li_l].repeatEnd = upperbound(is_lh_text_list)
			istr_lh_repeat[li_l].repeatBegin = li_l_begin
			istr_lh_repeat[li_l].played = false
		end if
		if upperbound(is_bh_text_list) > 1 then
			li_b = upperbound(istr_bh_repeat) + 1
			istr_bh_repeat[li_b].repeatEnd = upperbound(is_bh_text_list)
			istr_bh_repeat[li_b].repeatBegin = li_b_begin
			istr_bh_repeat[li_b].played = false
		end if
		continue
	end if
	if ib_both_exists then
//		is_bh_text_list[upperbound(is_bh_text_list) + 1] = is_text_list[li_i]
		if is_finger_list[li_i] <> "FB9FE" then ls_fingering = is_finger_list[li_i] 
		is_bh_finger_list[upperbound(is_bh_finger_list) + 1] = ls_fingering
	end if
	
	ls_rh_time_fraction = ls_empty_list
	ls_rh_note_value = ls_empty_list
	ls_rh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	ls_lh_time_fraction = ls_empty_list
	ls_lh_note_value = ls_empty_list
	ls_lh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	ls_lh_note_finger = ls_empty_list
	li_total_note_set_count = 0
	li_lh_note_set_count = 0
	li_rh_note_set_count = 0
	ls_rh_time_fraction1 = ls_empty_list
	ls_rh_note_value1 = ls_empty_list
	ls_rh_note_char1 = ls_empty_list
	ls_rh_note_finger1 = ls_empty_list
	ls_lh_time_fraction1 = ls_empty_list
	ls_lh_note_value1 = ls_empty_list
	ls_lh_note_char1 = ls_empty_list
	ls_rh_note_finger1 = ls_empty_list
	ls_lh_note_finger1 = ls_empty_list
	li_total_note_set_count1 = 0
	li_lh_note_set_count1 = 0
	li_rh_note_set_count1 = 0
	wf_parse_note_attribute(is_text_list[li_i],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, &
		ls_rh_time_fraction,ls_lh_time_fraction,ls_rh_note_value,ls_lh_note_value,ls_rh_note_char,ls_lh_note_char,ls_rh_note_finger,ls_lh_note_finger)
	wf_parse_note_attribute(is_text_list[li_i],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count1,li_rh_note_set_count1,li_lh_note_set_count1, &
		ls_rh_time_fraction1,ls_lh_time_fraction1,ls_rh_note_value1,ls_lh_note_value1,ls_rh_note_char1,ls_lh_note_char1,ls_rh_note_finger1,ls_lh_note_finger1)

	// process measure count information
	ii_rh_note_tmp = 0 
	ii_lh_note_tmp = 0
	if ib_right_exists then	// use righthand info
		//  find max time
		ldb_right_cur = 0
		for li_j = 1 to upperbound(ls_rh_time_fraction)
			ldb_tmp = wf_string_to_fraction(ls_rh_time_fraction[li_j])
			if ldb_right_cur < ldb_tmp then ldb_right_cur = ldb_tmp
		next
	end if
	ldb_right = ldb_right + ldb_right_cur
	if ib_left_hand_exists then
		//  find max time
		ldb_left_cur = 0
		for li_j = 1 to upperbound(ls_lh_time_fraction)
			ldb_tmp = wf_string_to_fraction(ls_lh_time_fraction[li_j])
			if ldb_left_cur < ldb_tmp then ldb_left_cur = ldb_tmp
		next	
	end if
	ldb_left = ldb_left + ldb_left_cur
	

	// reset time duration
	for li_j = 1 to 5
		idb_right_note_duration[li_j] = 0.0
		idb_left_note_duration[li_j] = 0.0
	next
	idb_min_duration = 10.0
	idb_left_min_duration = 10.0
	idb_right_min_duration = 10.0
	// convert time fraction
	for li_j = 1 to li_rh_note_set_count
//		ii_rh_note_tmp = ii_rh_note_tmp + integer(ls_rh_note_value[li_j])
		idb_right_note_duration[li_j] = wf_string_to_fraction(ls_rh_time_fraction[li_j])
		idb_right_note_duration1[li_j] = wf_string_to_fraction(ls_rh_time_fraction1[li_j])
	next
//	if li_rh_note_set_count > 0 then
//		FileWrite(li_num, string(li_i) + " " + ls_rh_time_fraction[1] + " " + string(idb_right_note_duration[1]))
//	end if
	for li_j = 1 to li_lh_note_set_count
		idb_left_note_duration[li_j] = wf_string_to_fraction(ls_lh_time_fraction[li_j])
		idb_left_note_duration1[li_j] = wf_string_to_fraction(ls_lh_time_fraction1[li_j])
	next
	// merge previous righthand note set with current note set
	for li_j = 1 to li_rh_note_set_count	
		if li_rh_note_set_count0 > 0 then
			for li_k = 1 to li_rh_note_set_count0
				if ls_rh_note_value[li_j] = ls_rh_note_value0[li_k] then
					idb_right_note_duration[li_j] = idb_right_note_duration[li_j] + idb_right_note_duration0[li_k]
					idb_right_note_duration0[li_k] = 0
				end if
			next
		end if
	next
	for li_j = 1 to li_rh_note_set_count1	
		if li_rh_note_set_count00 > 0 then
			for li_k = 1 to li_rh_note_set_count00
				if ls_rh_note_value1[li_j] = ls_rh_note_value00[li_k] then
					idb_right_note_duration1[li_j] = idb_right_note_duration1[li_j] + idb_right_note_duration00[li_k]
					idb_right_note_duration00[li_k] = 0
				end if
			next
		end if
	next
	li_k = li_rh_note_set_count
	// add previous note set that are not found in the current note set to the the current note set
	for li_j = 1 to li_rh_note_set_count0
		if idb_right_note_duration0[li_j] > 0 then
			li_k = li_k + 1
			ls_rh_note_value[li_k] = ls_rh_note_value0[li_j]
			ls_rh_time_fraction[li_k] = wf_fraction_to_string(idb_right_note_duration0[li_j])
			ls_rh_note_finger[li_k] = ls_rh_note_finger0[li_j]
			ls_rh_note_char[li_k] = "2"
		end if
	next
	li_rh_note_set_count = li_k
	li_k = li_rh_note_set_count1
	// add previous note set that are not found in the current note set to the the current note set
	for li_j = 1 to li_rh_note_set_count00
		if idb_right_note_duration00[li_j] > 0 then
			li_k = li_k + 1
			ls_rh_note_value1[li_k] = ls_rh_note_value00[li_j]
			ls_rh_time_fraction1[li_k] = wf_fraction_to_string(idb_right_note_duration00[li_j])
			ls_rh_note_finger1[li_k] =   ls_rh_note_finger00[li_j]
			ls_rh_note_char1[li_k] = "2"
		end if
	next
	li_rh_note_set_count1 = li_k
	// find the minimum time duration
	idb_right_min_duration = 10.0
	for li_j = 1 to li_rh_note_set_count	
		if idb_right_min_duration > idb_right_note_duration[li_j] and idb_right_note_duration[li_j] > 0.0 then 
			idb_right_min_duration = idb_right_note_duration[li_j]
		end if
	next	
	idb_right_min_duration1 = 10.0
	for li_j = 1 to li_rh_note_set_count1	
		if idb_right_min_duration1 > idb_right_note_duration1[li_j] and idb_right_note_duration1[li_j] > 0.0 then 
			idb_right_min_duration1 = idb_right_note_duration1[li_j]
		end if
	next	
	
	// convert time fraction
	for li_j = 1 to li_lh_note_set_count
		ii_lh_note_tmp = ii_lh_note_tmp + integer(ls_lh_note_value[li_j])
		idb_left_note_duration[li_j] = wf_string_to_fraction(ls_lh_time_fraction[li_j])
		idb_left_note_duration1[li_j] = wf_string_to_fraction(ls_lh_time_fraction1[li_j])
	next
	// merge previous left note set with current note set
	for li_j = 1 to li_lh_note_set_count	
		if li_lh_note_set_count0 > 0 then
			for li_k = 1 to li_lh_note_set_count0
				if ls_lh_note_value[li_j] = ls_lh_note_value0[li_k] then
					idb_left_note_duration[li_j] = idb_left_note_duration[li_j] + idb_left_note_duration0[li_k]
					idb_left_note_duration0[li_k] = 0
				end if
			next
		end if
	next
	for li_j = 1 to li_lh_note_set_count1	
		if li_lh_note_set_count00 > 0 then
			for li_k = 1 to li_lh_note_set_count00
				if ls_lh_note_value1[li_j] = ls_lh_note_value00[li_k] then
					idb_left_note_duration1[li_j] = idb_left_note_duration1[li_j] + idb_left_note_duration00[li_k]
					idb_left_note_duration00[li_k] = 0
				end if
			next
		end if
	next
	li_k = li_lh_note_set_count
	// add previous note set that are not found in the current note set to the the current note set
	for li_j = 1 to li_lh_note_set_count0
		if idb_left_note_duration0[li_j] > 0 then 
			li_k = li_k + 1
			ls_lh_note_value[li_k] = ls_lh_note_value0[li_j]
			ls_lh_time_fraction[li_k] = wf_fraction_to_string(idb_left_note_duration0[li_j])
			ls_lh_note_finger[li_k] = ls_lh_note_finger0[li_j]
			ls_lh_note_char[li_k] = "2"		// continuous note
		end if
	next
	li_lh_note_set_count = li_k
	
	li_k = li_lh_note_set_count1
	for li_j = 1 to li_lh_note_set_count00
		if idb_left_note_duration00[li_j] > 0 then
			li_k = li_k + 1
			ls_lh_note_value1[li_k] = ls_lh_note_value00[li_j]
			ls_lh_time_fraction1[li_k] = wf_fraction_to_string(idb_left_note_duration00[li_j])
			ls_lh_note_finger1[li_k] = ls_lh_note_finger00[li_j]
			ls_lh_note_char1[li_k] = "2"
		end if
	next
	li_lh_note_set_count1 = li_k
	// find the minimum time duration
	idb_left_min_duration = 10.0
	for li_j = 1 to li_lh_note_set_count	
		if idb_left_min_duration > idb_left_note_duration[li_j] and idb_left_note_duration[li_j] > 0.0 then 
			idb_left_min_duration = idb_left_note_duration[li_j]
		end if
	next	
	
	idb_min_duration = 10.0
	for li_j = 1 to li_rh_note_set_count1
		if idb_min_duration > idb_right_note_duration1[li_j] and idb_right_note_duration1[li_j] > 0.0 then 
			idb_min_duration = idb_right_note_duration1[li_j]
		end if
	next	
	for li_j = 1 to li_lh_note_set_count1
		if idb_min_duration > idb_left_note_duration1[li_j] and idb_left_note_duration1[li_j] > 0.0 then 
			idb_min_duration = idb_left_note_duration1[li_j]
		end if
	next	
	
	// generate new right hand set
	for li_j = 1 to 5
		idb_left_note_duration0[li_j] = 0.0
		idb_right_note_duration0[li_j] = 0.0
		idb_left_note_duration00[li_j] = 0.0
		idb_right_note_duration00[li_j] = 0.0
	next				

	if li_rh_note_set_count > 0 then
		ls_rh_time_fraction[1] = wf_fraction_to_string(idb_right_min_duration) 	
//		FileWrite(li_num, string(li_i) + " ls_rh_time_fraction[1] " + ls_rh_time_fraction[1] + " idb_right_min_duration" + string(idb_right_min_duration))
//		FileWrite(li_num, string(li_i) + " ls_rh_time_fraction1[1] " + ls_rh_time_fraction[1] + " idb_min_duration" + string(idb_min_duration))
		li_k = 0
		for li_j = 1 to li_rh_note_set_count	
			ls_rh_time_fraction[li_j] = ls_rh_time_fraction[1]
			idb_right_note_duration[li_j] = idb_right_note_duration[li_j] - idb_right_min_duration
			if idb_right_note_duration[li_j] > 0 then // create remaining note set
				li_k = li_k + 1
				idb_right_note_duration0[li_k] = idb_right_note_duration[li_j]
				ls_rh_note_value0[li_k] = ls_rh_note_value[li_j]
				ls_rh_note_finger0[li_k] = ls_rh_note_finger[li_j]
			end if 
		next	
		li_rh_note_set_count0 = li_k
	else
		li_rh_note_set_count0 = 0
	end if
	
	if li_rh_note_set_count1 > 0 then
		ls_rh_time_fraction1[1] = wf_fraction_to_string(idb_min_duration) 	
		li_k = 0
		for li_j = 1 to li_rh_note_set_count1	
			ls_rh_time_fraction1[li_j] = ls_rh_time_fraction1[1]
			idb_right_note_duration1[li_j] = idb_right_note_duration1[li_j] - idb_min_duration
			if idb_right_note_duration1[li_j] > 0 then // create remaining note set
				li_k = li_k + 1
				idb_right_note_duration00[li_k] = idb_right_note_duration1[li_j]
				ls_rh_note_value00[li_k] = ls_rh_note_value1[li_j]
				ls_rh_note_finger00[li_k] = ls_rh_note_finger1[li_j]
			end if 
		next		
		li_rh_note_set_count00 = li_k	
	else
		li_rh_note_set_count00 = 0
	end if
	
	if li_lh_note_set_count > 0 then
		ls_lh_time_fraction[1] = wf_fraction_to_string(idb_left_min_duration) 	
//		FileWrite(li_num, string(li_i) + " ls_lh_time_fraction[1] " + ls_lh_time_fraction[1] + " idb_left_min_duration" + string(idb_left_min_duration))
//		FileWrite(li_num, string(li_i) + " ls_lh_time_fraction1[1] " + ls_lh_time_fraction[1] + " idb_min_duration" + string(idb_min_duration))
		li_k = 0
		for li_j = 1 to li_lh_note_set_count	
			ls_lh_time_fraction[li_j] = ls_lh_time_fraction[1]
			idb_left_note_duration[li_j] = idb_left_note_duration[li_j] - idb_left_min_duration
			if idb_left_note_duration[li_j] > 0 then // create remaining note set
				li_k = li_k + 1
				idb_left_note_duration0[li_k] = idb_left_note_duration[li_j]
				ls_lh_note_value0[li_k] = ls_lh_note_value[li_j]
				ls_lh_note_finger0[li_k] = ls_lh_note_finger[li_j]
			end if 
		next	
		li_lh_note_set_count0 = li_k
	else
		li_lh_note_set_count0 = 0
	end if
	
	if li_lh_note_set_count1 > 0 then
		ls_lh_time_fraction1[1] = wf_fraction_to_string(idb_min_duration) 	
		li_k = 0
		for li_j = 1 to li_lh_note_set_count1	
			ls_lh_time_fraction1[li_j] = ls_lh_time_fraction1[1]
			idb_left_note_duration1[li_j] = idb_left_note_duration1[li_j] - idb_min_duration
			if idb_left_note_duration1[li_j] > 0 then // create remaining note set
				li_k = li_k + 1
				idb_left_note_duration00[li_k] = idb_left_note_duration1[li_j]
				ls_lh_note_value00[li_k] = ls_lh_note_value1[li_j]
				ls_lh_note_finger00[li_k] = ls_lh_note_finger1[li_j]
			end if 
		next		
		li_lh_note_set_count00 = li_k	
	else
		li_lh_note_set_count00 = 0
	end if	
		
	lb_rh_true_note = false
	ls_note_wing = ""
	for li_j = 1 to li_rh_note_set_count		
		if ls_rh_note_value[li_j] <> "000" then lb_rh_true_note = true 
		ls_note = ls_rh_time_fraction[li_j] + ls_rh_note_value[li_j] + ls_rh_note_char[li_j] + ls_rh_note_finger[li_j]
		ls_note_wing = ls_note_wing + ls_note
		if li_j < li_rh_note_set_count then		// pat the note attribute
			ls_note_wing = ls_note_wing + "000000000"
		end if
	next
	if lb_rh_true_note then // there are righthand notes
		ii_rh_list_index[upperbound(ii_rh_list_index) + 1] = li_i
		is_rh_text_list[upperbound(is_rh_text_list) + 1] = ls_note_coordinate + ls_note_wing
		// get right hand fingering graph ID
		if is_finger_list[li_i] <> "FB9FE" then ls_fingering = is_finger_list[li_i] 
		ls_finger_entry = ls_fingering
		li_pos1 = pos(ls_finger_entry, "FB")
		li_pos2 = pos(ls_finger_entry, "FE")		
		li_fingering_ind = integer(mid(ls_finger_entry, li_pos1 + 2, 1))
		if li_fingering_ind = REAPEAT_FINGERING or li_fingering_ind = NO_FINGERING then //
			is_rh_finger_list[upperbound(is_rh_finger_list)+1] = ls_fingering
		else
			ls_finger_attr = mid(ls_finger_entry, li_pos1 + 2, li_pos2 - li_pos1 - 2)
			ls_finger_entry_list = ls_empty_list
			li_entry_count = wf_parse_finger_entry(ls_finger_attr, ls_finger_entry_list)
			ls_finger_entry = "FB"
			for li_j = 1 to li_entry_count
				if left(ls_finger_entry_list[li_j], 1) = "2" then // get right finger entries
					ls_finger_entry = ls_finger_entry + ls_finger_entry_list[li_j] 
				end if
			next
			ls_finger_entry = ls_finger_entry + "FE"
			is_rh_finger_list[upperbound(is_rh_finger_list)+1] = 	ls_finger_entry	
			end if
	end if
	ii_bh_to_rh[li_i] = upperbound(is_rh_text_list)
	
	lb_lh_true_note = false
	ls_note_wing = ""
//	MessageBox(is_text_list[li_i], li_i)
//	MessageBox("'li_lh_note_set_count", li_lh_note_set_count)
//	MessageBox("Debug", "ls_lh_time_fraction:" + string(upperbound(ls_lh_time_fraction)) + " ls_lh_note_value:" + string(upperbound(ls_lh_note_value)) + &
//			" ls_lh_note_char:" + string(upperbound(ls_lh_note_char)) + " ls_lh_note_finger:" + string(upperbound(ls_lh_note_finger)))
	for li_j = 1 to li_lh_note_set_count
		if ls_lh_note_value[li_j] <> "000" then lb_lh_true_note = true
		ls_note = ls_lh_time_fraction[li_j] + ls_lh_note_value[li_j] + ls_lh_note_char[li_j] + ls_lh_note_finger[li_j]
		ls_note_wing = ls_note_wing + "000000000" + ls_note 
	next
//	MessageBox("ls_note_wing", ls_note_wing)
	if lb_lh_true_note then
		ii_lh_list_index[upperbound(ii_lh_list_index) + 1] = li_i
		is_lh_text_list[upperbound(is_lh_text_list) + 1] = ls_note_coordinate + ls_note_wing
		
		// get left hand fingering graph ID

		if is_finger_list[li_i] <> "FB9FE" then ls_fingering = is_finger_list[li_i] 
		ls_finger_entry = ls_fingering
		li_pos1 = pos(ls_finger_entry, "FB")
		li_pos2 = pos(ls_finger_entry, "FE")		
		li_fingering_ind = integer(mid(ls_finger_entry, li_pos1 + 2, 1))
		if li_fingering_ind = REAPEAT_FINGERING or li_fingering_ind = NO_FINGERING then 
			is_lh_finger_list[upperbound(is_lh_finger_list)+1] = ls_fingering
		else
			ls_finger_attr = mid(ls_finger_entry, li_pos1 + 2, li_pos2 - li_pos1 - 2)
			ls_finger_entry_list = ls_empty_list
			li_entry_count = wf_parse_finger_entry(ls_finger_attr, ls_finger_entry_list)
			ls_finger_entry = "FB"
			for li_j = 1 to li_entry_count
				if left(ls_finger_entry_list[li_j], 1) = "1" then
					ls_finger_entry = ls_finger_entry + ls_finger_entry_list[li_j] 
				end if
			next
			ls_finger_entry = ls_finger_entry + "FE"
			is_lh_finger_list[upperbound(is_lh_finger_list)+1] = 	ls_finger_entry					
		end if
	end if
	ii_bh_to_lh[li_i] = upperbound(is_lh_text_list)

	if ib_both_exists then
		ls_note_wing = ""
		if not lb_lh_true_note then li_lh_note_set_count = 0
		if not lb_rh_true_note then li_rh_note_set_count = 0
		if li_rh_note_set_count1 > li_lh_note_set_count1 then
			li_note_set_count = li_rh_note_set_count1
		else
			li_note_set_count = li_lh_note_set_count1
		end if
		if li_note_set_count = 0 then 
			ls_note_wing = "000000000000000000"
		else
			for li_j = 1 to li_note_set_count
				if li_j <= li_rh_note_set_count1 then 
					ls_note = ls_rh_time_fraction1[li_j] + ls_rh_note_value1[li_j] + ls_rh_note_char1[li_j] + ls_rh_note_finger1[li_j]
					ls_note_wing = ls_note_wing + ls_note 
				else
					ls_note_wing = ls_note_wing + "000000000"
				end if
				if li_j <= li_lh_note_set_count1 then
					ls_note = ls_lh_time_fraction1[li_j] + ls_lh_note_value1[li_j] + ls_lh_note_char1[li_j] + ls_lh_note_finger1[li_j]
					ls_note_wing = ls_note_wing + ls_note 
				else
					ls_note_wing = ls_note_wing + "000000000"
				end if
			next
		end if
		is_bh_text_list[upperbound(is_bh_text_list) + 1] = ls_note_coordinate + ls_note_wing
		ii_bh_list_index[upperbound(ii_bh_list_index) + 1] = li_i
	end if	

	if ib_right_exists and ib_left_hand_exists then
		ii_sheet_type = BOTH_HAND
	elseif ib_right_exists then
		ii_sheet_type = RIGHT_HAND
	else
		ii_sheet_type = LEFT_HAND
	end if
	FileWrite(li_num, string(ldb_right) + " " + string(ldb_left))
	
//	if li_i <= upperbound(is_rh_text_list) then FileWrite(li_num1, is_rh_text_list[li_i])
//	if li_i <= upperbound(is_lh_text_list) then FileWrite(li_num2, is_lh_text_list[li_i])
//	if li_i <= upperbound(is_bh_text_list) then FileWrite(li_num3, is_bh_text_list[li_i])
//	if upperbound(is_rh_text_list) > 0 then
////		FileWrite(li_num1, string(li_i) + " " + string(upperbound(is_rh_text_list)) + " " + is_rh_text_list[upperbound(is_rh_text_list)])
//		FileWrite(li_num1, is_rh_text_list[upperbound(is_rh_text_list)])
//	end if
//	if upperbound(is_lh_text_list) > 0 then
////		FileWrite(li_num2, string(li_i) + " " + string(upperbound(is_lh_text_list)) + " " + is_lh_text_list[upperbound(is_lh_text_list)])
//		FileWrite(li_num2, is_lh_text_list[upperbound(is_lh_text_list)])
//	end if
//	if upperbound(is_bh_text_list) > 0 then
////		FileWrite(li_num3, string(li_i) + " " + string(upperbound(is_bh_text_list)) + " " + is_bh_text_list[upperbound(is_bh_text_list)])
//		FileWrite(li_num3, is_bh_text_list[upperbound(is_bh_text_list)])
//	end if
next

if ib_right_exists then	
	if upperbound(ii_measure_right_end_index) < upperbound(ii_measure_right_begin_index) then
		ii_measure_right_end_index[upperbound(ii_measure_right_end_index) + 1]   = upperbound(is_rh_text_list)
	end if
end if
if ib_left_hand_exists then	
	if upperbound(ii_measure_left_end_index) < upperbound(ii_measure_left_begin_index) then
		ii_measure_left_end_index[upperbound(ii_measure_left_end_index) + 1]   = upperbound(is_lh_text_list)
	end if
end if
if ib_both_exists then	
	if upperbound(ii_measure_both_end_index) < upperbound(ii_measure_both_begin_index) then
		ii_measure_both_end_index[upperbound(ii_measure_both_end_index) + 1]   = upperbound(is_bh_text_list)
	end if
end if

	FileWrite(li_num, "right begin count=" + string(upperbound(ii_measure_right_begin_index)) + "right end count=" + string(upperbound(ii_measure_right_end_index)))
	FileWrite(li_num, "left begin count=" + string(upperbound(ii_measure_left_begin_index)) + "left end count=" + string(upperbound(ii_measure_left_end_index)))
	FileWrite(li_num, "both begin count=" + string(upperbound(ii_measure_both_begin_index)) + "right end count=" + string(upperbound(ii_measure_both_end_index)))
FileClose(li_num)
//FileClose(li_num1)
//FileClose(li_num2)
//FileClose(li_num3)
CATCH(RuntimeError re1)
//FileClose(li_num1)
//FileClose(li_num2)
//FileClose(li_num3)
	msg = "Class=" + re1.Class + " Line=" + string(re1.Line) + " Number=" + string(re1.Number) + " RoutineName=" + re1.RoutineName + " Text=" + re1.Text
	msg = msg + " li_i:" + string(li_i)
	MessageBox("msg", msg)
END TRY

if not ib_both_exists then
	if ib_right_exists then
		is_bh_text_list = is_rh_text_list
	elseif ib_left_hand_exists then
		is_bh_text_list = is_lh_text_list
	end if
end if 
ii_rh_text_count = upperbound(is_rh_text_list)
ii_lh_text_count = upperbound(is_lh_text_list)
ii_bh_text_count = upperbound(is_bh_text_list)

//MessageBox("ii_rh_text_count", ii_rh_text_count)
//MessageBox("ii_lh_text_count", ii_lh_text_count)
//MessageBox("ii_bh_text_count", ii_bh_text_count)
//
//for li_i = 2 to ii_lh_text_count
//	MessageBox(is_lh_text_list[li_i], li_i)
//next
//if ib_left_hand_exists and ib_right_exists then ib_both_exists = true


return 1


end function

public function integer wf_set_current_data_array ();// description: set right, left, or both as the current data array

//string is_rh_text_list[], is_lh_text_list[]
//integer ii_rh_text_count = 0, ii_lh_text_count = 0

integer li_i

if cbx_append_left_hand.checked and cbx_append_right_hand.checked then // both hand
	ii_cur_list_index = ii_bh_list_index
//	is_cur_fingering_image = is_bh_fingering_image
	is_cur_text_list = is_bh_text_list
	is_cur_finger_list = is_bh_finger_list
	ii_cur_piece = 3
	istr_cur_repeat = istr_bh_repeat	
elseif cbx_append_right_hand.checked then // right hand
	ii_cur_list_index = ii_rh_list_index
	is_cur_text_list = is_rh_text_list
	is_cur_finger_list = is_rh_finger_list
	ii_cur_piece = 1
	istr_cur_repeat = istr_rh_repeat
elseif cbx_append_left_hand.checked then // left hand
	ii_cur_list_index = ii_lh_list_index
	is_cur_text_list = is_lh_text_list
	is_cur_finger_list = is_lh_finger_list
	ii_cur_piece = 2
	istr_cur_repeat = istr_lh_repeat
end if
//MessageBox("wf_set_current_data_array", upperbound(ii_cur_phrase_list))

//MessageBox("upperbound(is_cur_text_list)", upperbound(is_cur_text_list))
//MessageBox("upperbound(is_rh_text_list)", upperbound(is_rh_text_list))
//MessageBox("upperbound(is_lh_text_list)", upperbound(is_lh_text_list))
//MessageBox("upperbound(is_text_list)", upperbound(is_text_list))
//MessageBox("wf_set_current_data_array is_cur_text_list", upperbound(is_cur_text_list))
//MessageBox("wf_set_current_data_array is_text_list", upperbound(is_text_list))
return 1 
end function

public subroutine wf_get_high_low_notes ();// function name: wf_get_high_low_notes
// description: get high and low notes for this lesson

string ls_note_coordinate,ls_note_to_keyboard, ls_empty_list[], ls_note_list
string ls_rh_time_fraction[],ls_rh_note_value[],ls_rh_note_char[],ls_rh_note_finger[]
string ls_lh_time_fraction[],ls_lh_note_value[],ls_lh_note_char[],ls_lh_note_finger[]
integer li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count
integer li_current_note,li_total_increment,i,li_i,li_min_note,li_max_note
string ls_header

ii_high_note = 0
ii_low_note = 120
integer file_num
//file_num = FileOpen("t1.txt", LineMode!, Write!, LockWrite!, Replace!)
//for li_i = 2 to upperbound(is_cur_text_list)
for li_i = 2 to upperbound(is_text_list)
	ls_rh_time_fraction = ls_empty_list
	ls_rh_note_value = ls_empty_list
	ls_rh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	ls_lh_time_fraction = ls_empty_list
	ls_lh_note_value = ls_empty_list
	ls_lh_note_char = ls_empty_list
	ls_rh_note_finger = ls_empty_list
	li_total_note_set_count = 0
	li_lh_note_set_count = 0
	wf_parse_note_attribute(is_text_list[li_i],ls_note_coordinate,ls_note_to_keyboard,li_total_note_set_count,li_rh_note_set_count,li_lh_note_set_count, &
		ls_rh_time_fraction,ls_lh_time_fraction,ls_rh_note_value,ls_lh_note_value,ls_rh_note_char,ls_lh_note_char,ls_rh_note_finger,ls_lh_note_finger)	
	ls_note_list = ""
	for i=1 to li_rh_note_set_count
		if integer(ls_rh_note_value[i]) > 0 then
			if integer(ls_rh_note_value[i]) > ii_high_note and integer(ls_rh_note_value[i]) > 0 then ii_high_note = integer(ls_rh_note_value[i])
			if integer(ls_rh_note_value[i]) < ii_low_note and integer(ls_rh_note_value[i]) > 0 then ii_low_note = integer(ls_rh_note_value[i])
			ls_note_list = ls_note_list + ls_rh_note_value[i] + " "
		end if
	next
	for i=1 to li_lh_note_set_count
		if integer(ls_lh_note_value[i]) > 0 then
			if integer(ls_lh_note_value[i]) > ii_high_note and integer(ls_lh_note_value[i]) > 0 then ii_high_note = integer(ls_lh_note_value[i])
			if integer(ls_lh_note_value[i]) < ii_low_note and integer(ls_lh_note_value[i]) > 0 then ii_low_note = integer(ls_lh_note_value[i])
			ls_note_list = ls_note_list + ls_lh_note_value[i] + " "
		end if
	next
//	FileWrite(file_num, string(li_i, "000") + " " + ls_note_list + " ii_low_note:" + string(ii_low_note) + " ii_high_note:" + string(ii_high_note))
next
li_min_note = ii_low_note
li_max_note = ii_high_note
//MessageBox(string(ii_low_note), ii_high_note)

li_total_increment = li_max_note - li_min_note + 1

if li_total_increment < 34 then
	li_max_note = li_max_note + (34 - li_total_increment)/2
	li_min_note = li_min_note - (34 - li_total_increment)/2
end if

if not IsNaturalNote(li_min_note) then 
	li_min_note = li_min_note - 1
end if

if not IsNaturalNote(li_max_note) then 
	li_max_note = li_max_note + 1
end if

ii_low_note = li_min_note
ii_high_note = li_max_note

ls_header = is_text_list[1]
//MessageBox("ls_header", ls_header)
if len(ls_header) = 19 then
	li_min_note = integer(left(right(ls_header, 6), 3))
	li_max_note = integer(right(ls_header, 3))
	if li_min_note <= ii_low_note and li_max_note >= ii_high_note then
		ii_low_note = li_min_note
		ii_high_note = li_max_note		
	end if
end if
//FileWrite(file_num, "999 " + " ii_low_note:" + string(ii_low_note) + " ii_high_note:" + string(ii_high_note))
//FileClose(file_num)

end subroutine

on w_music_composer_fingering.create
this.cbx_phrase_op_indicator=create cbx_phrase_op_indicator
this.cbx_define_phrase=create cbx_define_phrase
this.cb_mk_entry=create cb_mk_entry
this.cbx_image_lib=create cbx_image_lib
this.cb_28=create cb_28
this.cb_21=create cb_21
this.cb_22=create cb_22
this.cb_compile_lesson=create cb_compile_lesson
this.cb_18=create cb_18
this.cb_populate_loudness=create cb_populate_loudness
this.sle_note_char_to=create sle_note_char_to
this.sle_note_char_from=create sle_note_char_from
this.cb_17=create cb_17
this.cb_16=create cb_16
this.cb_7=create cb_7
this.pb_16=create pb_16
this.cbx_key_only=create cbx_key_only
this.cb_play_notes=create cb_play_notes
this.st_19=create st_19
this.st_18=create st_18
this.st_17=create st_17
this.sle_right_volume=create sle_right_volume
this.sle_left_volume=create sle_left_volume
this.cbx_delete_tmp_img=create cbx_delete_tmp_img
this.cbx_replace=create cbx_replace
this.cbx_entry=create cbx_entry
this.cbx_note=create cbx_note
this.cbx_fingering=create cbx_fingering
this.cb_batch_copy=create cb_batch_copy
this.sle_dest_from=create sle_dest_from
this.sle_source_to=create sle_source_to
this.sle_source_from=create sle_source_from
this.cb_15=create cb_15
this.cb_save_project=create cb_save_project
this.cb_browse_project=create cb_browse_project
this.sle_project_file=create sle_project_file
this.st_16=create st_16
this.cb_reload_library=create cb_reload_library
this.sle_tempo=create sle_tempo
this.cbx_mix_image=create cbx_mix_image
this.cbx_view_image=create cbx_view_image
this.cbx_activate_animation=create cbx_activate_animation
this.cbx_1=create cbx_1
this.cb_27=create cb_27
this.st_15=create st_15
this.sle_h_inc=create sle_h_inc
this.sle_w_inc=create sle_w_inc
this.sle_y_inc=create sle_y_inc
this.sle_x_inc=create sle_x_inc
this.sle_3=create sle_3
this.pb_15=create pb_15
this.pb_14=create pb_14
this.pb_13=create pb_13
this.pb_12=create pb_12
this.pb_11=create pb_11
this.pb_10=create pb_10
this.pb_9=create pb_9
this.pb_8=create pb_8
this.pb_7=create pb_7
this.pb_6=create pb_6
this.st_14=create st_14
this.cb_26=create cb_26
this.cb_25=create cb_25
this.cb_24=create cb_24
this.cb_23=create cb_23
this.sle_dest_lib=create sle_dest_lib
this.cb_input_lib=create cb_input_lib
this.cb_20=create cb_20
this.sle_source_lib=create sle_source_lib
this.cb_19=create cb_19
this.cb_delete_row=create cb_delete_row
this.cb_get_list=create cb_get_list
this.cb_dup_row=create cb_dup_row
this.cb_capture_image=create cb_capture_image
this.pb_5=create pb_5
this.cb_6=create cb_6
this.sle_dw_path=create sle_dw_path
this.cb_get_time=create cb_get_time
this.pb_4=create pb_4
this.pb_3=create pb_3
this.cbx_note_on=create cbx_note_on
this.cb_restore_dw=create cb_restore_dw
this.cb_save_dw=create cb_save_dw
this.cb_copy_to_dw=create cb_copy_to_dw
this.cb_copy_from_dw=create cb_copy_from_dw
this.cbx_dw_visible=create cbx_dw_visible
this.cb_13=create cb_13
this.ddlb_note_level_range_max=create ddlb_note_level_range_max
this.ddlb_note_name_range_max=create ddlb_note_name_range_max
this.ddlb_note_level_range_min=create ddlb_note_level_range_min
this.ddlb_note_name_range_min=create ddlb_note_name_range_min
this.ddlb_rh_note_name_5=create ddlb_rh_note_name_5
this.ddlb_rh_note_level_5=create ddlb_rh_note_level_5
this.ddlb_rh_note_name_4=create ddlb_rh_note_name_4
this.ddlb_rh_note_level_4=create ddlb_rh_note_level_4
this.ddlb_rh_note_name_3=create ddlb_rh_note_name_3
this.ddlb_rh_note_level_3=create ddlb_rh_note_level_3
this.ddlb_rh_note_name_2=create ddlb_rh_note_name_2
this.ddlb_rh_note_level_2=create ddlb_rh_note_level_2
this.ddlb_rh_note_name_1=create ddlb_rh_note_name_1
this.ddlb_rh_note_level_1=create ddlb_rh_note_level_1
this.ddlb_lh_note_name_5=create ddlb_lh_note_name_5
this.ddlb_lh_note_level_5=create ddlb_lh_note_level_5
this.ddlb_lh_note_name_4=create ddlb_lh_note_name_4
this.ddlb_lh_note_level_4=create ddlb_lh_note_level_4
this.ddlb_lh_note_name_3=create ddlb_lh_note_name_3
this.ddlb_lh_note_level_3=create ddlb_lh_note_level_3
this.ddlb_lh_note_name_2=create ddlb_lh_note_name_2
this.ddlb_lh_note_level_2=create ddlb_lh_note_level_2
this.ddlb_lh_note_level_1=create ddlb_lh_note_level_1
this.ddlb_lh_note_name_1=create ddlb_lh_note_name_1
this.ddlb_rh_5=create ddlb_rh_5
this.ddlb_rh_4=create ddlb_rh_4
this.ddlb_rh_3=create ddlb_rh_3
this.ddlb_rh_2=create ddlb_rh_2
this.ddlb_rh_1=create ddlb_rh_1
this.ddlb_lh_5=create ddlb_lh_5
this.ddlb_lh_4=create ddlb_lh_4
this.ddlb_lh_3=create ddlb_lh_3
this.ddlb_lh_2=create ddlb_lh_2
this.ddlb_lh_1=create ddlb_lh_1
this.cb_finger_attr_default=create cb_finger_attr_default
this.cb_12=create cb_12
this.uo_1=create uo_1
this.cb_append_clear=create cb_append_clear
this.cb_append_repeat=create cb_append_repeat
this.cbx_all_finger=create cbx_all_finger
this.cb_play_note=create cb_play_note
this.cb_4=create cb_4
this.cbx_origin_size=create cbx_origin_size
this.cbx_append_right_hand=create cbx_append_right_hand
this.cbx_append_left_hand=create cbx_append_left_hand
this.cbx_new_format=create cbx_new_format
this.cb_11=create cb_11
this.st_13=create st_13
this.cb_10=create cb_10
this.cb_9=create cb_9
this.pb_2=create pb_2
this.pb_1=create pb_1
this.rb_14=create rb_14
this.rb_13=create rb_13
this.rb_12=create rb_12
this.rb_11=create rb_11
this.rb_10=create rb_10
this.rb_9=create rb_9
this.rb_8=create rb_8
this.rb_rh_3=create rb_rh_3
this.rb_rh_2=create rb_rh_2
this.rb_rh_1=create rb_rh_1
this.sle_lh_1_h=create sle_lh_1_h
this.sle_lh_5_h=create sle_lh_5_h
this.sle_lh_4_h=create sle_lh_4_h
this.sle_lh_3_h=create sle_lh_3_h
this.sle_lh_2_h=create sle_lh_2_h
this.sle_rh_2_h=create sle_rh_2_h
this.sle_rh_3_h=create sle_rh_3_h
this.sle_rh_4_h=create sle_rh_4_h
this.sle_rh_5_h=create sle_rh_5_h
this.sle_rh_1_h=create sle_rh_1_h
this.sle_rh_1_w=create sle_rh_1_w
this.sle_rh_5_w=create sle_rh_5_w
this.sle_rh_4_w=create sle_rh_4_w
this.sle_rh_3_w=create sle_rh_3_w
this.sle_rh_2_w=create sle_rh_2_w
this.sle_lh_2_w=create sle_lh_2_w
this.sle_lh_3_w=create sle_lh_3_w
this.sle_lh_4_w=create sle_lh_4_w
this.sle_lh_5_w=create sle_lh_5_w
this.sle_lh_1_w=create sle_lh_1_w
this.st_12=create st_12
this.sle_min_note=create sle_min_note
this.sle_max_note=create sle_max_note
this.sle_note_id=create sle_note_id
this.cbx_collect_ind=create cbx_collect_ind
this.cb_draw=create cb_draw
this.st_11=create st_11
this.sle_y_pct=create sle_y_pct
this.sle_x_pct=create sle_x_pct
this.sle_rh_2_note=create sle_rh_2_note
this.sle_rh_3_note=create sle_rh_3_note
this.sle_rh_4_note=create sle_rh_4_note
this.sle_rh_5_note=create sle_rh_5_note
this.sle_rh_1_note=create sle_rh_1_note
this.sle_lh_1_note=create sle_lh_1_note
this.sle_lh_5_note=create sle_lh_5_note
this.sle_lh_4_note=create sle_lh_4_note
this.sle_lh_3_note=create sle_lh_3_note
this.sle_lh_2_note=create sle_lh_2_note
this.sle_lh_1_x=create sle_lh_1_x
this.sle_lh_5_x=create sle_lh_5_x
this.sle_lh_4_x=create sle_lh_4_x
this.sle_lh_3_x=create sle_lh_3_x
this.sle_lh_2_x=create sle_lh_2_x
this.sle_rh_2_x=create sle_rh_2_x
this.sle_rh_3_x=create sle_rh_3_x
this.sle_rh_4_x=create sle_rh_4_x
this.sle_rh_5_x=create sle_rh_5_x
this.sle_rh_1_x=create sle_rh_1_x
this.sle_rh_1_y=create sle_rh_1_y
this.sle_rh_5_y=create sle_rh_5_y
this.sle_rh_4_y=create sle_rh_4_y
this.sle_rh_3_y=create sle_rh_3_y
this.sle_rh_2_y=create sle_rh_2_y
this.sle_lh_2_y=create sle_lh_2_y
this.sle_lh_3_y=create sle_lh_3_y
this.sle_lh_4_y=create sle_lh_4_y
this.sle_lh_5_y=create sle_lh_5_y
this.sle_lh_1_y=create sle_lh_1_y
this.cb_stop_keyboard=create cb_stop_keyboard
this.cb_start_keyboard=create cb_start_keyboard
this.cb_8=create cb_8
this.cb_5=create cb_5
this.sle_file_name=create sle_file_name
this.cb_new_format=create cb_new_format
this.cb_3=create cb_3
this.rb_3=create rb_3
this.st_6=create st_6
this.st_5=create st_5
this.sle_2=create sle_2
this.rb_5=create rb_5
this.rb_4=create rb_4
this.rb_2=create rb_2
this.st_4=create st_4
this.st_3=create st_3
this.st_2=create st_2
this.cb_2=create cb_2
this.cb_1=create cb_1
this.sle_1=create sle_1
this.st_1=create st_1
this.p_1=create p_1
this.gb_1=create gb_1
this.gb_2=create gb_2
this.mle_finger_attributes=create mle_finger_attributes
this.mle_note=create mle_note
this.mle_note_coord=create mle_note_coord
this.mle_entry=create mle_entry
this.dw_1=create dw_1
this.Control[]={this.cbx_phrase_op_indicator,&
this.cbx_define_phrase,&
this.cb_mk_entry,&
this.cbx_image_lib,&
this.cb_28,&
this.cb_21,&
this.cb_22,&
this.cb_compile_lesson,&
this.cb_18,&
this.cb_populate_loudness,&
this.sle_note_char_to,&
this.sle_note_char_from,&
this.cb_17,&
this.cb_16,&
this.cb_7,&
this.pb_16,&
this.cbx_key_only,&
this.cb_play_notes,&
this.st_19,&
this.st_18,&
this.st_17,&
this.sle_right_volume,&
this.sle_left_volume,&
this.cbx_delete_tmp_img,&
this.cbx_replace,&
this.cbx_entry,&
this.cbx_note,&
this.cbx_fingering,&
this.cb_batch_copy,&
this.sle_dest_from,&
this.sle_source_to,&
this.sle_source_from,&
this.cb_15,&
this.cb_save_project,&
this.cb_browse_project,&
this.sle_project_file,&
this.st_16,&
this.cb_reload_library,&
this.sle_tempo,&
this.cbx_mix_image,&
this.cbx_view_image,&
this.cbx_activate_animation,&
this.cbx_1,&
this.cb_27,&
this.st_15,&
this.sle_h_inc,&
this.sle_w_inc,&
this.sle_y_inc,&
this.sle_x_inc,&
this.sle_3,&
this.pb_15,&
this.pb_14,&
this.pb_13,&
this.pb_12,&
this.pb_11,&
this.pb_10,&
this.pb_9,&
this.pb_8,&
this.pb_7,&
this.pb_6,&
this.st_14,&
this.cb_26,&
this.cb_25,&
this.cb_24,&
this.cb_23,&
this.sle_dest_lib,&
this.cb_input_lib,&
this.cb_20,&
this.sle_source_lib,&
this.cb_19,&
this.cb_delete_row,&
this.cb_get_list,&
this.cb_dup_row,&
this.cb_capture_image,&
this.pb_5,&
this.cb_6,&
this.sle_dw_path,&
this.cb_get_time,&
this.pb_4,&
this.pb_3,&
this.cbx_note_on,&
this.cb_restore_dw,&
this.cb_save_dw,&
this.cb_copy_to_dw,&
this.cb_copy_from_dw,&
this.cbx_dw_visible,&
this.cb_13,&
this.ddlb_note_level_range_max,&
this.ddlb_note_name_range_max,&
this.ddlb_note_level_range_min,&
this.ddlb_note_name_range_min,&
this.ddlb_rh_note_name_5,&
this.ddlb_rh_note_level_5,&
this.ddlb_rh_note_name_4,&
this.ddlb_rh_note_level_4,&
this.ddlb_rh_note_name_3,&
this.ddlb_rh_note_level_3,&
this.ddlb_rh_note_name_2,&
this.ddlb_rh_note_level_2,&
this.ddlb_rh_note_name_1,&
this.ddlb_rh_note_level_1,&
this.ddlb_lh_note_name_5,&
this.ddlb_lh_note_level_5,&
this.ddlb_lh_note_name_4,&
this.ddlb_lh_note_level_4,&
this.ddlb_lh_note_name_3,&
this.ddlb_lh_note_level_3,&
this.ddlb_lh_note_name_2,&
this.ddlb_lh_note_level_2,&
this.ddlb_lh_note_level_1,&
this.ddlb_lh_note_name_1,&
this.ddlb_rh_5,&
this.ddlb_rh_4,&
this.ddlb_rh_3,&
this.ddlb_rh_2,&
this.ddlb_rh_1,&
this.ddlb_lh_5,&
this.ddlb_lh_4,&
this.ddlb_lh_3,&
this.ddlb_lh_2,&
this.ddlb_lh_1,&
this.cb_finger_attr_default,&
this.cb_12,&
this.uo_1,&
this.cb_append_clear,&
this.cb_append_repeat,&
this.cbx_all_finger,&
this.cb_play_note,&
this.cb_4,&
this.cbx_origin_size,&
this.cbx_append_right_hand,&
this.cbx_append_left_hand,&
this.cbx_new_format,&
this.cb_11,&
this.st_13,&
this.cb_10,&
this.cb_9,&
this.pb_2,&
this.pb_1,&
this.rb_14,&
this.rb_13,&
this.rb_12,&
this.rb_11,&
this.rb_10,&
this.rb_9,&
this.rb_8,&
this.rb_rh_3,&
this.rb_rh_2,&
this.rb_rh_1,&
this.sle_lh_1_h,&
this.sle_lh_5_h,&
this.sle_lh_4_h,&
this.sle_lh_3_h,&
this.sle_lh_2_h,&
this.sle_rh_2_h,&
this.sle_rh_3_h,&
this.sle_rh_4_h,&
this.sle_rh_5_h,&
this.sle_rh_1_h,&
this.sle_rh_1_w,&
this.sle_rh_5_w,&
this.sle_rh_4_w,&
this.sle_rh_3_w,&
this.sle_rh_2_w,&
this.sle_lh_2_w,&
this.sle_lh_3_w,&
this.sle_lh_4_w,&
this.sle_lh_5_w,&
this.sle_lh_1_w,&
this.st_12,&
this.sle_min_note,&
this.sle_max_note,&
this.sle_note_id,&
this.cbx_collect_ind,&
this.cb_draw,&
this.st_11,&
this.sle_y_pct,&
this.sle_x_pct,&
this.sle_rh_2_note,&
this.sle_rh_3_note,&
this.sle_rh_4_note,&
this.sle_rh_5_note,&
this.sle_rh_1_note,&
this.sle_lh_1_note,&
this.sle_lh_5_note,&
this.sle_lh_4_note,&
this.sle_lh_3_note,&
this.sle_lh_2_note,&
this.sle_lh_1_x,&
this.sle_lh_5_x,&
this.sle_lh_4_x,&
this.sle_lh_3_x,&
this.sle_lh_2_x,&
this.sle_rh_2_x,&
this.sle_rh_3_x,&
this.sle_rh_4_x,&
this.sle_rh_5_x,&
this.sle_rh_1_x,&
this.sle_rh_1_y,&
this.sle_rh_5_y,&
this.sle_rh_4_y,&
this.sle_rh_3_y,&
this.sle_rh_2_y,&
this.sle_lh_2_y,&
this.sle_lh_3_y,&
this.sle_lh_4_y,&
this.sle_lh_5_y,&
this.sle_lh_1_y,&
this.cb_stop_keyboard,&
this.cb_start_keyboard,&
this.cb_8,&
this.cb_5,&
this.sle_file_name,&
this.cb_new_format,&
this.cb_3,&
this.rb_3,&
this.st_6,&
this.st_5,&
this.sle_2,&
this.rb_5,&
this.rb_4,&
this.rb_2,&
this.st_4,&
this.st_3,&
this.st_2,&
this.cb_2,&
this.cb_1,&
this.sle_1,&
this.st_1,&
this.p_1,&
this.gb_1,&
this.gb_2,&
this.mle_finger_attributes,&
this.mle_note,&
this.mle_note_coord,&
this.mle_entry,&
this.dw_1}
end on

on w_music_composer_fingering.destroy
destroy(this.cbx_phrase_op_indicator)
destroy(this.cbx_define_phrase)
destroy(this.cb_mk_entry)
destroy(this.cbx_image_lib)
destroy(this.cb_28)
destroy(this.cb_21)
destroy(this.cb_22)
destroy(this.cb_compile_lesson)
destroy(this.cb_18)
destroy(this.cb_populate_loudness)
destroy(this.sle_note_char_to)
destroy(this.sle_note_char_from)
destroy(this.cb_17)
destroy(this.cb_16)
destroy(this.cb_7)
destroy(this.pb_16)
destroy(this.cbx_key_only)
destroy(this.cb_play_notes)
destroy(this.st_19)
destroy(this.st_18)
destroy(this.st_17)
destroy(this.sle_right_volume)
destroy(this.sle_left_volume)
destroy(this.cbx_delete_tmp_img)
destroy(this.cbx_replace)
destroy(this.cbx_entry)
destroy(this.cbx_note)
destroy(this.cbx_fingering)
destroy(this.cb_batch_copy)
destroy(this.sle_dest_from)
destroy(this.sle_source_to)
destroy(this.sle_source_from)
destroy(this.cb_15)
destroy(this.cb_save_project)
destroy(this.cb_browse_project)
destroy(this.sle_project_file)
destroy(this.st_16)
destroy(this.cb_reload_library)
destroy(this.sle_tempo)
destroy(this.cbx_mix_image)
destroy(this.cbx_view_image)
destroy(this.cbx_activate_animation)
destroy(this.cbx_1)
destroy(this.cb_27)
destroy(this.st_15)
destroy(this.sle_h_inc)
destroy(this.sle_w_inc)
destroy(this.sle_y_inc)
destroy(this.sle_x_inc)
destroy(this.sle_3)
destroy(this.pb_15)
destroy(this.pb_14)
destroy(this.pb_13)
destroy(this.pb_12)
destroy(this.pb_11)
destroy(this.pb_10)
destroy(this.pb_9)
destroy(this.pb_8)
destroy(this.pb_7)
destroy(this.pb_6)
destroy(this.st_14)
destroy(this.cb_26)
destroy(this.cb_25)
destroy(this.cb_24)
destroy(this.cb_23)
destroy(this.sle_dest_lib)
destroy(this.cb_input_lib)
destroy(this.cb_20)
destroy(this.sle_source_lib)
destroy(this.cb_19)
destroy(this.cb_delete_row)
destroy(this.cb_get_list)
destroy(this.cb_dup_row)
destroy(this.cb_capture_image)
destroy(this.pb_5)
destroy(this.cb_6)
destroy(this.sle_dw_path)
destroy(this.cb_get_time)
destroy(this.pb_4)
destroy(this.pb_3)
destroy(this.cbx_note_on)
destroy(this.cb_restore_dw)
destroy(this.cb_save_dw)
destroy(this.cb_copy_to_dw)
destroy(this.cb_copy_from_dw)
destroy(this.cbx_dw_visible)
destroy(this.cb_13)
destroy(this.ddlb_note_level_range_max)
destroy(this.ddlb_note_name_range_max)
destroy(this.ddlb_note_level_range_min)
destroy(this.ddlb_note_name_range_min)
destroy(this.ddlb_rh_note_name_5)
destroy(this.ddlb_rh_note_level_5)
destroy(this.ddlb_rh_note_name_4)
destroy(this.ddlb_rh_note_level_4)
destroy(this.ddlb_rh_note_name_3)
destroy(this.ddlb_rh_note_level_3)
destroy(this.ddlb_rh_note_name_2)
destroy(this.ddlb_rh_note_level_2)
destroy(this.ddlb_rh_note_name_1)
destroy(this.ddlb_rh_note_level_1)
destroy(this.ddlb_lh_note_name_5)
destroy(this.ddlb_lh_note_level_5)
destroy(this.ddlb_lh_note_name_4)
destroy(this.ddlb_lh_note_level_4)
destroy(this.ddlb_lh_note_name_3)
destroy(this.ddlb_lh_note_level_3)
destroy(this.ddlb_lh_note_name_2)
destroy(this.ddlb_lh_note_level_2)
destroy(this.ddlb_lh_note_level_1)
destroy(this.ddlb_lh_note_name_1)
destroy(this.ddlb_rh_5)
destroy(this.ddlb_rh_4)
destroy(this.ddlb_rh_3)
destroy(this.ddlb_rh_2)
destroy(this.ddlb_rh_1)
destroy(this.ddlb_lh_5)
destroy(this.ddlb_lh_4)
destroy(this.ddlb_lh_3)
destroy(this.ddlb_lh_2)
destroy(this.ddlb_lh_1)
destroy(this.cb_finger_attr_default)
destroy(this.cb_12)
destroy(this.uo_1)
destroy(this.cb_append_clear)
destroy(this.cb_append_repeat)
destroy(this.cbx_all_finger)
destroy(this.cb_play_note)
destroy(this.cb_4)
destroy(this.cbx_origin_size)
destroy(this.cbx_append_right_hand)
destroy(this.cbx_append_left_hand)
destroy(this.cbx_new_format)
destroy(this.cb_11)
destroy(this.st_13)
destroy(this.cb_10)
destroy(this.cb_9)
destroy(this.pb_2)
destroy(this.pb_1)
destroy(this.rb_14)
destroy(this.rb_13)
destroy(this.rb_12)
destroy(this.rb_11)
destroy(this.rb_10)
destroy(this.rb_9)
destroy(this.rb_8)
destroy(this.rb_rh_3)
destroy(this.rb_rh_2)
destroy(this.rb_rh_1)
destroy(this.sle_lh_1_h)
destroy(this.sle_lh_5_h)
destroy(this.sle_lh_4_h)
destroy(this.sle_lh_3_h)
destroy(this.sle_lh_2_h)
destroy(this.sle_rh_2_h)
destroy(this.sle_rh_3_h)
destroy(this.sle_rh_4_h)
destroy(this.sle_rh_5_h)
destroy(this.sle_rh_1_h)
destroy(this.sle_rh_1_w)
destroy(this.sle_rh_5_w)
destroy(this.sle_rh_4_w)
destroy(this.sle_rh_3_w)
destroy(this.sle_rh_2_w)
destroy(this.sle_lh_2_w)
destroy(this.sle_lh_3_w)
destroy(this.sle_lh_4_w)
destroy(this.sle_lh_5_w)
destroy(this.sle_lh_1_w)
destroy(this.st_12)
destroy(this.sle_min_note)
destroy(this.sle_max_note)
destroy(this.sle_note_id)
destroy(this.cbx_collect_ind)
destroy(this.cb_draw)
destroy(this.st_11)
destroy(this.sle_y_pct)
destroy(this.sle_x_pct)
destroy(this.sle_rh_2_note)
destroy(this.sle_rh_3_note)
destroy(this.sle_rh_4_note)
destroy(this.sle_rh_5_note)
destroy(this.sle_rh_1_note)
destroy(this.sle_lh_1_note)
destroy(this.sle_lh_5_note)
destroy(this.sle_lh_4_note)
destroy(this.sle_lh_3_note)
destroy(this.sle_lh_2_note)
destroy(this.sle_lh_1_x)
destroy(this.sle_lh_5_x)
destroy(this.sle_lh_4_x)
destroy(this.sle_lh_3_x)
destroy(this.sle_lh_2_x)
destroy(this.sle_rh_2_x)
destroy(this.sle_rh_3_x)
destroy(this.sle_rh_4_x)
destroy(this.sle_rh_5_x)
destroy(this.sle_rh_1_x)
destroy(this.sle_rh_1_y)
destroy(this.sle_rh_5_y)
destroy(this.sle_rh_4_y)
destroy(this.sle_rh_3_y)
destroy(this.sle_rh_2_y)
destroy(this.sle_lh_2_y)
destroy(this.sle_lh_3_y)
destroy(this.sle_lh_4_y)
destroy(this.sle_lh_5_y)
destroy(this.sle_lh_1_y)
destroy(this.cb_stop_keyboard)
destroy(this.cb_start_keyboard)
destroy(this.cb_8)
destroy(this.cb_5)
destroy(this.sle_file_name)
destroy(this.cb_new_format)
destroy(this.cb_3)
destroy(this.rb_3)
destroy(this.st_6)
destroy(this.st_5)
destroy(this.sle_2)
destroy(this.rb_5)
destroy(this.rb_4)
destroy(this.rb_2)
destroy(this.st_4)
destroy(this.st_3)
destroy(this.st_2)
destroy(this.cb_2)
destroy(this.cb_1)
destroy(this.sle_1)
destroy(this.st_1)
destroy(this.p_1)
destroy(this.gb_1)
destroy(this.gb_2)
destroy(this.mle_finger_attributes)
destroy(this.mle_note)
destroy(this.mle_note_coord)
destroy(this.mle_entry)
destroy(this.dw_1)
end on

event open;window w_this
w_this = this

invo_music_phrase.iw_lesson_music = this
invo_music_phrase.iuo_music_sheet = uo_1.uo_1


sle_min_note.text = "41"
sle_max_note.text = "84"
sle_min_note.event modified()
sle_max_note.event modified()

is_deploy_directory =  ""

sle_project_file.text = ProfileString("music_compose_fingering.ini", "PATH", "PROJECT_FILE", "")

//is_graph_path = ProfileString("music_compose_fingering.ini", "PATH", "GRAPH_PATH", "")
//is_dw_path = ProfileString("music_compose_fingering.ini", "PATH", "DW_PATH", "")
//sle_source_lib.text = ProfileString("music_compose_fingering.ini", "PATH", "FINGERING_LIB_SOURCE_PATH", "")
//sle_dest_lib.text = ProfileString("music_compose_fingering.ini", "PATH", "FINGERING_LIB_DEST_PATH", "")

if FileExists(sle_project_file.text) then
	// create deploy directory
	is_deploy_directory = left(sle_project_file.text, len(sle_project_file.text) - 4)
	if not DirectoryExists(is_deploy_directory) then CreateDirectory(is_deploy_directory)
	is_graph_path = ProfileString(sle_project_file.text, "PATH", "GRAPH_PATH", "")
	is_dw_path = ProfileString(sle_project_file.text, "PATH", "DW_PATH", "")
	is_category_path = ProfileString(sle_project_file.text, "PATH", "CATEGORY_PATH", "")	
	is_lesson_name_prefix = ProfileString(sle_project_file.text, "PATH", "LESSON_NAME_PREFIX", "")	
	is_lesson_output_prefix = ProfileString(sle_project_file.text, "PATH", "OUTPUT_PREFIX", "")	
	
	sle_source_lib.text = ProfileString(sle_project_file.text, "PATH", "FINGERING_LIB_SOURCE_PATH", "")
	sle_dest_lib.text = ProfileString(sle_project_file.text, "PATH", "FINGERING_LIB_DEST_PATH", "")	
	sle_min_note.text = ProfileString(sle_project_file.text, "DATA", "KEYBOARD_NOTE_MIN", "")	
	sle_max_note.text = ProfileString(sle_project_file.text, "DATA", "KEYBOARD_NOTE_MAX", "")	
	
	sle_min_note.event modified()
	sle_max_note.event modified()
end if


sle_file_name.text = is_graph_path
sle_dw_path.text = is_dw_path

if FileExists(is_graph_path) then
	wf_show_graph()                    //**********************************************
end if
ids_1 = create datastore
ids_1.dataobject = "d_finger_attr_buf"

if FileExists(sle_dw_path.text) then
	cb_restore_dw.event clicked()
end if

move(1,1)
string ls_chapter_dir
//iw_window = Message.PowerObjectParm
ii_p1_width_orig = p_1.width
ii_p1_height_orig = p_1.height

p_1.PictureName = ""
//f_center_window(w_this)
extToGetFingerCoord(1)
//extToggleMIDI(1)
window lw_dummy
lw_dummy = this
uo_1.uo_1.iw_parent = lw_dummy


String ls_ts[]
integer li_i,li_count

isle_lh_note[1] = sle_lh_1_note
isle_lh_note[2] = sle_lh_2_note
isle_lh_note[3] = sle_lh_3_note
isle_lh_note[4] = sle_lh_4_note
isle_lh_note[5] = sle_lh_5_note

isle_lh_x[1] = sle_lh_1_x
isle_lh_x[2] = sle_lh_2_x
isle_lh_x[3] = sle_lh_3_x
isle_lh_x[4] = sle_lh_4_x
isle_lh_x[5] = sle_lh_5_x

isle_lh_y[1] = sle_lh_1_y
isle_lh_y[2] = sle_lh_2_y
isle_lh_y[3] = sle_lh_3_y
isle_lh_y[4] = sle_lh_4_y
isle_lh_y[5] = sle_lh_5_y

isle_lh_w[1] = sle_lh_1_w
isle_lh_w[2] = sle_lh_2_w
isle_lh_w[3] = sle_lh_3_w
isle_lh_w[4] = sle_lh_4_w
isle_lh_w[5] = sle_lh_5_w

isle_lh_h[1] = sle_lh_1_h
isle_lh_h[2] = sle_lh_2_h
isle_lh_h[3] = sle_lh_3_h
isle_lh_h[4] = sle_lh_4_h
isle_lh_h[5] = sle_lh_5_h

isle_rh_note[1] = sle_rh_1_note
isle_rh_note[2] = sle_rh_2_note
isle_rh_note[3] = sle_rh_3_note
isle_rh_note[4] = sle_rh_4_note
isle_rh_note[5] = sle_rh_5_note

isle_rh_x[1] = sle_rh_1_x
isle_rh_x[2] = sle_rh_2_x
isle_rh_x[3] = sle_rh_3_x
isle_rh_x[4] = sle_rh_4_x
isle_rh_x[5] = sle_rh_5_x

isle_rh_y[1] = sle_rh_1_y
isle_rh_y[2] = sle_rh_2_y
isle_rh_y[3] = sle_rh_3_y
isle_rh_y[4] = sle_rh_4_y
isle_rh_y[5] = sle_rh_5_y

isle_rh_w[1] = sle_rh_1_w
isle_rh_w[2] = sle_rh_2_w
isle_rh_w[3] = sle_rh_3_w
isle_rh_w[4] = sle_rh_4_w
isle_rh_w[5] = sle_rh_5_w

isle_rh_h[1] = sle_rh_1_h
isle_rh_h[2] = sle_rh_2_h
isle_rh_h[3] = sle_rh_3_h
isle_rh_h[4] = sle_rh_4_h
isle_rh_h[5] = sle_rh_5_h

ls_ts[1] = space(20)
//li_count = extResIndexCount("finger_graphic.lhi", ls_ts[1])
li_count = extResIndexCount(sle_dest_lib.text + ".lhi", ls_ts[1])


for li_i = 1 to li_count
	is_id[li_i] = space(500) 
	ls_ts[li_i] = space(20)
next
//extRetrieveResIndex("finger_graphic.lhi", is_id, ls_ts)
extRetrieveResIndex(sle_dest_lib.text + ".lhi", is_id, ls_ts)
for li_i = 1 to li_count
	is_id[li_i] = left(is_id[li_i], 4) 
next

for li_i = 1 to li_count
	if left(is_id[li_i], 1) = "1" then // left hand
		choose case mid(is_id[li_i], 2, 1) // finger number
			case "1" // finger 1
				ddlb_lh_1.AddItem(left(is_id[li_i], 4))
			case "2"
				ddlb_lh_2.AddItem(left(is_id[li_i], 4))
			case "3"
				ddlb_lh_3.AddItem(left(is_id[li_i], 4))
			case "4"
				ddlb_lh_4.AddItem(left(is_id[li_i], 4))
			case "5"
				ddlb_lh_5.AddItem(left(is_id[li_i], 4))
		end choose
	else
		choose case mid(is_id[li_i], 2, 1) // finger number
			case "1" // finger 1
				ddlb_rh_1.AddItem(left(is_id[li_i], 4))
			case "2"
				ddlb_rh_2.AddItem(left(is_id[li_i], 4))
			case "3"
				ddlb_rh_3.AddItem(left(is_id[li_i], 4))
			case "4"
				ddlb_rh_4.AddItem(left(is_id[li_i], 4))
			case "5"
				ddlb_rh_5.AddItem(left(is_id[li_i], 4))
		end choose
	end if
next

//return

cb_finger_attr_default.event clicked()



end event

event close;if cb_stop_keyboard.enabled then cb_stop_keyboard.event clicked()

Sleep(1)


if SetProfileString("music_compose_fingering.ini", "PATH", "PROJECT_FILE", sle_project_file.text) = -1 then MessageBox("Error", "Cannot Update Profile")


if SetProfileString(sle_project_file.text, "PATH", "GRAPH_PATH", sle_file_name.text) = -1 then MessageBox("Error", "Cannot Update GRAPH_PATH on Project File")
if SetProfileString(sle_project_file.text, "PATH", "DW_PATH", sle_dw_path.text) = -1 then MessageBox("Error", "Cannot Update Project File")
if SetProfileString(sle_project_file.text, "PATH", "FINGERING_LIB_SOURCE_PATH", sle_source_lib.text) = -1 then MessageBox("Error", "Cannot Update DW_PATH on Project File")
if SetProfileString(sle_project_file.text, "PATH", "FINGERING_LIB_DEST_PATH", sle_dest_lib.text) = -1 then MessageBox("Error", "Cannot Update FINGERING_LIB_SOURCE_PATH on Project File")
if SetProfileString(sle_project_file.text, "PATH", "CATEGORY_PATH", is_category_path) = -1 then MessageBox("Error", "Cannot Update CATEGORY_PATH on Project File")
if SetProfileString(sle_project_file.text, "PATH", "OUTPUT_PREFIX", is_lesson_output_prefix) = -1 then MessageBox("Error", "Cannot Update OUTPUT_PREFIX on Project File")
if SetProfileString(sle_project_file.text, "PATH", "LESSON_NAME_PREFIX", is_lesson_name_prefix) = -1 then MessageBox("Error", "Cannot Update LESSON_NAME_PREFIX on Project File")

if SetProfileString(sle_project_file.text, "DATA", "KEYBOARD_NOTE_MIN", sle_min_note.text) = -1 then MessageBox("Error", "Cannot Update KEYBOARD_NOTE_MIN on Project File")
if SetProfileString(sle_project_file.text, "DATA", "KEYBOARD_NOTE_MAX", sle_max_note.text) = -1 then MessageBox("Error", "Cannot Update KEYBOARD_NOTE_MAX on Project File")



destroy ids_1
call super::close;if il_thread_id <> 0 then extPostThreadMessage(il_thread_id,18,0,0)



end event

event timer;long ll_width, ll_height
if ib_animate_fingering then	//
	f_set_picture_with_lhm(is_image_prefix, string(il_animate_id) + ".png", p_1, ll_width, ll_height)
	ib_animate_fingering = false
end if

double ldb_min_timer
dwobject dwo
//if ib_auto_fingering 
if ib_note_playing then
	if ii_current_row >= ii_row_source_from and ii_current_row <= ii_row_source_to then
		if ii_current_row = integer(sle_source_to.text) then // end note
			ib_note_playing = false
			// release all keys
			wf_remove_all_played_notes()
			timer(0, this)
		else					// note playing is in progress
			if ii_current_row < upperbound(is_cur_text_list) then
				ii_current_row++
				do while is_cur_text_list[ii_current_row] = "" and ii_current_row < upperbound(is_cur_text_list)
					ii_current_row++
				loop
				dw_1.event doubleclicked(0,0,ii_current_row,dwo)
//				wf_rec_move(is_cur_text_list[ii_current_row])
				ldb_min_timer = wf_get_min_time()
				wf_play_note()
				timer(ldb_min_timer, this)		
			end if
		end if
	end if
end if


end event

type cbx_phrase_op_indicator from checkbox within w_music_composer_fingering
integer x = 1888
integer width = 649
integer height = 52
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Phrase Operation (Checked Split)"
boolean checked = true
end type

event clicked;string ls_phrase_def = ""
if checked then // start phrase definition
	if cbx_append_left_hand.checked and cbx_append_right_hand.checked then
		ii_cur_piece = BOTH_HAND
	end if
	if cbx_append_left_hand.checked then
		ii_cur_piece = LEFT_HAND
	end if		
	if cbx_append_right_hand.checked then
		ii_cur_piece = RIGHT_HAND
	end if		
	if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then // both hand
		MessageBox("Error", "No Hand Selected")
		checked = false
		return
	end if
	// 1. set hand indicator, call wf_get_rh_lh_note_list, wf_set_current_data_array, wf_get_high_low_notes
	wf_get_rh_lh_note_list()
	wf_set_current_data_array()
	wf_get_high_low_notes()
	ls_phrase_def = dw_1.GetItemString(1, "sheet_graph")
	if isnull(ls_phrase_def) then ls_phrase_def = ""
	if len(ls_phrase_def) < 4 then
		if upperbound(is_rh_text_list) > 1 then
			ls_phrase_def =  "R" + right(string(1000 + upperbound(is_rh_text_list)), 3)
		end if
		if upperbound(is_lh_text_list) > 1 then
			ls_phrase_def = ls_phrase_def + "L" + right(string(1000 + upperbound(is_lh_text_list)), 3)
		end if
		if upperbound(is_bh_text_list) > 1 then
			ls_phrase_def = ls_phrase_def + "B" + right(string(1000 + upperbound(is_bh_text_list)), 3)
		end if
		dw_1.SetItem(1, "sheet_graph", ls_phrase_def)
	end if
	invo_music_phrase.of_init_phrase_bar(ls_phrase_def)
	// 2. 
else				 // end phrase definition
	invo_music_phrase.of_save_phrase_def()
end if
end event

type cbx_define_phrase from checkbox within w_music_composer_fingering
integer x = 2565
integer y = 4
integer width = 352
integer height = 52
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Define Phrase"
end type

event clicked;string ls_phrase_def = ""
string ls_msg

//MessageBox("upperbound(is_rh_text_list)", upperbound(is_rh_text_list))
//MessageBox("upperbound(is_lh_text_list)", upperbound(is_lh_text_list))
//MessageBox("upperbound(is_bh_text_list)", upperbound(is_bh_text_list))
if checked then // start phrase definition
	if cbx_append_left_hand.checked and cbx_append_right_hand.checked then
		ii_cur_piece = BOTH_HAND
	end if
	if cbx_append_left_hand.checked then
		ii_cur_piece = LEFT_HAND
	end if		
	if cbx_append_right_hand.checked then
		ii_cur_piece = RIGHT_HAND
	end if		
	if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then // both hand
		MessageBox("Error", "No Hand Selected")
		checked = false
		return
	end if
	
	if ii_cur_piece = BOTH_HAND and ii_sheet_type <> BOTH_HAND then
		if ii_sheet_type = RIGHT_HAND then
			ls_msg = "It is Right Hand sheet, Cannot Define Both Hand phrase!"
		else
			ls_msg = "It is Left Hand sheet, Cannot Define Both Hand phrase!"
		end if
		MessageBox("Error", ls_msg)
		checked = false
		return
	elseif ii_cur_piece = RIGHT_HAND then
		if ii_sheet_type = LEFT_HAND then
			ls_msg = "It is Right Hand sheet, Cannot Define Left Hand phrase!"
			MessageBox("Error", ls_msg)
			checked = false
			return
		end if
	elseif ii_cur_piece = LEFT_HAND then
		if ii_sheet_type = RIGHT_HAND then
			ls_msg = "It is Left Hand sheet, Cannot Define Right Hand phrase!"
			MessageBox("Error", ls_msg)
			checked = false
			return
		end if		
	end if
	
	// 1. set hand indicator, call wf_get_rh_lh_note_list, wf_set_current_data_array, wf_get_high_low_notes
	cb_mk_entry.event clicked()
	if upperbound(is_text_list) < 2 then
		cb_get_list.event clicked()
		wf_get_rh_lh_note_list()
	end if
//	wf_get_rh_lh_note_list()
	wf_set_current_data_array()
	wf_get_high_low_notes()
	ls_phrase_def = dw_1.GetItemString(1, "sheet_graph")
	if isnull(ls_phrase_def) then ls_phrase_def = ""
	if len(ls_phrase_def) < 4 then
		if upperbound(is_rh_text_list) > 1 then
			ls_phrase_def =  "R" + right(string(1000 + upperbound(is_rh_text_list)), 3)
		end if
		if upperbound(is_lh_text_list) > 1 then
			ls_phrase_def = ls_phrase_def + "L" + right(string(1000 + upperbound(is_lh_text_list)), 3)
		end if
		if upperbound(is_bh_text_list) > 1 then
			ls_phrase_def = ls_phrase_def + "B" + right(string(1000 + upperbound(is_bh_text_list)), 3)
		end if
		dw_1.SetItem(1, "sheet_graph", ls_phrase_def)
	end if
	invo_music_phrase.of_init_phrase_bar(ls_phrase_def)
	// 2. 
else				 // end phrase definition
	invo_music_phrase.of_save_phrase_def()
end if
end event

type cb_mk_entry from commandbutton within w_music_composer_fingering
integer x = 3936
integer width = 233
integer height = 68
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "mk entry"
end type

event clicked;integer li_row
string ls_note, ls_coord, ls_finger_attr, ls_entry

ii_rh_lo_note = 120
ii_rh_hi_note = -10
ii_lh_lo_note = 120
ii_lh_hi_note = -10

for li_row = 2 to dw_1.RowCount()
	ls_note = dw_1.GetItemString(li_row, "note")
//	if li_row = 1 then
//		dw_1.SetItem(li_row, "entry", ls_note)
//		continue
//	end if
	ls_coord = dw_1.GetItemString(li_row, "coord")
	ls_finger_attr = dw_1.GetItemString(li_row, "finger")
	ls_entry = dw_1.GetItemString(li_row, "entry")
	if IsNull(ls_note) then ls_note = "" 
	if IsNull(ls_coord) then ls_coord = "" 
	if IsNull(ls_finger_attr) then ls_finger_attr = ""
	if ls_coord = ""  then continue
	if ls_note = ""  then continue
	if ls_finger_attr = ""  then continue	
	ls_entry = wf_make_entry(ls_note, ls_coord, ls_finger_attr)
	if trim(ls_entry) = "" then continue
	dw_1.SetItem(li_row, "entry", ls_entry)
next

integer li_i, li_len
string ls_hi_lo_notes, ls_orig_note_header
ls_orig_note_header = dw_1.GetItemString(1, "note")
li_len =  len(ls_orig_note_header)
if li_len > 13 then
	ls_orig_note_header = left(ls_orig_note_header, 13)
elseif li_len < 13 then
	for li_i = 1 to (13 - li_len)
		ls_orig_note_header = ls_orig_note_header + "0"
	next
end if

ls_hi_lo_notes = string(ii_rh_lo_note, "000") + string(ii_rh_hi_note, "000") + string(ii_lh_lo_note, "000") + string(ii_lh_hi_note, "000")
ls_hi_lo_notes = ls_orig_note_header + ls_hi_lo_notes
dw_1.SetItem(1, "note", ls_hi_lo_notes)

end event

type cbx_image_lib from checkbox within w_music_composer_fingering
integer x = 3314
integer y = 4
integer width = 352
integer height = 52
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Create Image Lib"
end type

type cb_28 from commandbutton within w_music_composer_fingering
integer x = 1934
integer y = 784
integer width = 192
integer height = 80
integer taborder = 130
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "MkSec"
end type

event clicked;// Compress Prompting PNG file into section library

integer li_i, li_low_note,li_high_note, li_natural_note_count, li_divider
li_low_note =  long(sle_min_note.text)
li_high_note =  long(sle_max_note.text)

for li_i = li_low_note to li_high_note
	if IsNaturalNote(li_i) then
		li_natural_note_count ++
	end if
next

li_divider = 2*li_natural_note_count
SectionCount = li_divider

// Build the image library 

string ls_seq_list = "", ls_token, ls_time_stamp
DateTime ldt_tmp

if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
	MessageBox("Error", "No Hand Selected, Cannot Capture Images!")
	return
end if

is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next
if DirectoryExists(is_deploy_directory) then
	is_res_file_name = is_deploy_directory + "\" + is_res_file_name
end if

//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_image_lib"
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_lesson_lib"
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kbimage_lib"
is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_sec_image_lib"

If FileExists(is_res_file_name + ".lhm") then
 	If MessageBox("Warning", "File: " + is_res_file_name + ".lhm EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
	FileDelete(is_res_file_name + ".lhm")
end if
If FileExists(is_res_file_name + ".lhi") then
 	If MessageBox("Warning", "File: " + is_res_file_name + ".lhi EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
	FileDelete(is_res_file_name + ".lhi")
end if

extCreateResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm")

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//ls_seq_list
for li_i = 2 to dw_1.RowCount()
	ls_seq_list = ls_seq_list + string(dw_1.GetItemNumber(li_i,"SEQ"), "000000")
next

//extInitResourceMemory()


//when need to capture 12 set of image
//REBUILD IMAGE LIBRARY
//1 - both hands (hand together) at key pressed mode
cbx_key_only.checked = false
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 1 - both hands (hand together) at key pressed mode", "debug")
// 2 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 2 - both hands (hand together) at key release mode", "debug")

// 3 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 3 - left hand at key pressed mode", "debug")

// 4 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 4 - left hand at key release mode", "debug")

// 5 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 5 - right hand at key pressed mode", "debug")

// 6 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 6 - right hand at key release mode", "debug")

long ll_array_3[3], ll_data_count = 3

ll_array_3[1] = SectionCount
ll_array_3[2] = UnitsToPixels(p_1.width, XUnitsToPixels!)
ll_array_3[3] = UnitsToPixels(p_1.height, YUnitsToPixels!)

extAddLongArrayToResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "graphic_dimension", ll_array_3, ll_data_count, ls_time_stamp) 


MessageBox("Info", "Complete Rebuilding Image Library!")

return // not build key only

// REBUILD KEY ONLY IMAGES
cbx_key_only.checked = true
// 7 - both hands (hand together) at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 7 - both hands (hand together) at key pressed mode", "debug")

// 8 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 8 - both hands (hand together) at key release mode", "debug")

// 9 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 9 - left hand at key pressed mode", "debug")

// 10 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 10 - left hand at key release mode", "debug")

// 11 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 11 - right hand at key pressed mode", "debug")

// 12 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_make_section_images() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 12 - right hand at key release mode", "debug")

cbx_key_only.checked = false



MessageBox("Info", "Complete Rebuilding Image Library!")



end event

type cb_21 from commandbutton within w_music_composer_fingering
integer x = 4288
integer y = 568
integer width = 110
integer height = 104
integer taborder = 110
integer textsize = -12
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "H"
end type

event clicked;window lw_window
lw_window = parent
OpenWithParm(w_music_header, lw_window)

end event

type cb_22 from commandbutton within w_music_composer_fingering
integer x = 2117
integer y = 784
integer width = 133
integer height = 80
integer taborder = 120
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Rebd"
end type

event clicked;// rebuild image files from section library

integer li_i, li_low_note,li_high_note, li_natural_note_count, li_divider
li_low_note =  long(sle_min_note.text)
li_high_note =  long(sle_max_note.text)

for li_i = li_low_note to li_high_note
	if IsNaturalNote(li_i) then
		li_natural_note_count ++
	end if
next

li_divider = 2*li_natural_note_count
SectionCount = li_divider

// Build the image library 

string ls_seq_list = "", ls_token, ls_time_stamp
DateTime ldt_tmp

if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
	MessageBox("Error", "No Hand Selected, Cannot Capture Images!")
	return
end if

is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

if DirectoryExists(is_deploy_directory) then
	is_res_file_name = is_deploy_directory + "\" + is_res_file_name
end if

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_image_lib"

If not FileExists(is_res_file_name + ".lhm") then
 	MessageBox("Warning", "File: " + is_res_file_name + ".lhm Does Not EXIST, Cannot Generate Images?") 
	 return
end if
If not FileExists(is_res_file_name + ".lhi") then
 	MessageBox("Warning", "File: " + is_res_file_name + ".lhi Does Not EXIST, Cannot Generate Images?") 
	return
end if


extInitResourceMemory()
il_mem_handle = extMakeResourceMemory(is_res_file_name + ".lhi", is_res_file_name + ".lhm")


ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//ls_seq_list
for li_i = 2 to dw_1.RowCount()
	ls_seq_list = ls_seq_list + string(dw_1.GetItemNumber(li_i,"SEQ"), "000000")
next


//when need to capture 12 set of image
//REBUILD IMAGE LIBRARY
//1 - both hands (hand together) at key pressed mode
cbx_key_only.checked = false
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 1 - both hands (hand together) at key pressed mode", "debug")
// 2 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 2 - both hands (hand together) at key release mode", "debug")

// 3 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 3 - left hand at key pressed mode", "debug")

// 4 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 4 - left hand at key release mode", "debug")

// 5 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 5 - right hand at key pressed mode", "debug")

// 6 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 6 - right hand at key release mode", "debug")

// REBUILD KEY ONLY IMAGES
cbx_key_only.checked = true
// 7 - both hands (hand together) at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 7 - both hands (hand together) at key pressed mode", "debug")

// 8 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 8 - both hands (hand together) at key release mode", "debug")

// 9 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 9 - left hand at key pressed mode", "debug")

// 10 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 10 - left hand at key release mode", "debug")

// 11 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 11 - right hand at key pressed mode", "debug")

// 12 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_rebuild_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if
//MessageBox("Processed 12 - right hand at key release mode", "debug")

cbx_key_only.checked = false

extReleaseResourceMemory(is_res_file_name + ".lhi", is_res_file_name + ".lhm")

MessageBox("Info", "Complete Rebuilding Image Library!")



end event

type cb_compile_lesson from commandbutton within w_music_composer_fingering
integer x = 2249
integer y = 780
integer width = 229
integer height = 80
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "b Lesson"
end type

event clicked;// compile default phrase definition, music graphic file into lesson library index files

integer li_i
string ls_token
string ls_phrase_def

//is_res_file_name = "" 
//for li_i = 1 to len(sle_dw_path.text)
//	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
//	if ls_token = "\" then exit
//	is_res_file_name = ls_token + is_res_file_name 
//next

string ls_lesson_path, ls_output_prefix
ls_lesson_path = is_category_path + "\Lesson\" + is_lesson_name_prefix
if not DirectoryExists(ls_lesson_path) then CreateDirectory(ls_lesson_path)
is_res_file_name = ls_lesson_path + "/" + is_lesson_output_prefix + "_lesson_lib"

//ls_phrase_def = left(sle_dw_path.text, len(sle_dw_path.text) - 4) + "_phrase"
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_lesson_lib"

//if DirectoryExists(is_deploy_directory) then
//	is_res_file_name = is_deploy_directory + "\" + is_res_file_name
//end if

If FileExists(is_res_file_name + ".lhm") then
 	If MessageBox("Warning", "File: " + is_res_file_name + ".lhm EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
	FileDelete(is_res_file_name + ".lhm")
end if
If FileExists(is_res_file_name + ".lhi") then
 	If MessageBox("Warning", "File: " + is_res_file_name + ".lhi EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
	FileDelete(is_res_file_name + ".lhi")
end if
extCreateResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm")

string ls_music_header
string ls_time_stamp = space(20)
if dw_1.RowCount() > 2 then
//	ls_music_header = dw_1.GetItemString(1,"coord")
	ls_music_header = dw_1.GetItemString(1,"entry")
	ls_music_header = ls_music_header + space(100 - len(ls_music_header))
	extPutImage(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "music_header", ls_music_header, ls_time_stamp, 100)
else
	MessageBox("Error", "No Music Data Available!")
	return
end if

string ls_data_count, ls_sheet_graph
long ll_data_count, ll_seq
long ll_array_1[], ll_array_n[]
long ll_picture_count = 0
long ll_picture_array[], ll_empty[]
string ls_picture_path[]

ls_time_stamp = space(20)
ll_data_count = dw_1.RowCount() - 1
ll_array_1[1] = ll_data_count
extAddLongArrayToResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "data_count", ll_array_1, 1, ls_time_stamp) 

string ls_image_buf = "", ls_entry
for li_i = 2 to dw_1.RowCount()
	ll_seq = dw_1.GetItemNumber(li_i, "seq")
	ll_array_n[upperbound(ll_array_n) + 1] = ll_seq
	ls_entry = dw_1.GetItemString(li_i, "entry")
	if len(ls_entry) > 250 then 
		MessageBox("error", "entry exceed the max")
		return
	end if
	ls_image_buf = ls_image_buf + ls_entry + space(250 - len(ls_entry))
	ls_sheet_graph = dw_1.GetItemString(li_i, "sheet_graph")
	if isnull(ls_sheet_graph) then ls_sheet_graph = ""
	if ls_sheet_graph <> "" and FileExists(ls_sheet_graph) then
		ll_picture_count = ll_picture_count + 1
		ll_picture_array[ll_picture_count] = ll_seq
		ls_picture_path[ll_picture_count] = ls_sheet_graph
	end if
next

extAddLongArrayToResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "data_seq", ll_array_n, ll_data_count, ls_time_stamp) 
extPutImage(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "data_detail", ls_image_buf, ls_time_stamp, ll_data_count*250) 
ll_array_1[1] = ll_picture_count
extAddLongArrayToResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "sheet_count", ll_array_1, 1, ls_time_stamp) 
extAddLongArrayToResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "sheet_array", ll_picture_array, ll_picture_count, ls_time_stamp) 
long ll_file_size
for li_i = 1 to ll_picture_count
	ll_file_size = FileLength(ls_picture_path[li_i])
	extPutImageFile2(is_res_file_name + ".lhi", is_res_file_name + ".lhm", ls_picture_path[li_i], "sheet_" + string(li_i, "000"), ls_time_stamp, ll_file_size)
next

// store phrase definition

string ls_data_segment
long ll_bh_phrase_list[], ll_rh_phrase_list[], ll_lh_phrase_list[], ll_phrase_empty[], ll_len = 0

ls_phrase_def = dw_1.GetItemString(1, "sheet_graph")

for li_i = 1 to len(ls_phrase_def)/4
	ls_data_segment = mid(ls_phrase_def, (li_i - 1)*4 + 1, 4)
//	MessageBox("ls_data_segment", ls_data_segment)
	if left(ls_data_segment, 1) = "B" then
		ll_bh_phrase_list[upperbound(ll_bh_phrase_list)+1] = long(right(ls_data_segment, 3))
	elseif left(ls_data_segment, 1) = "R" then
		ll_rh_phrase_list[upperbound(ll_rh_phrase_list)+1] = long(right(ls_data_segment, 3))
	elseif left(ls_data_segment, 1) = "L" then
		ll_lh_phrase_list[upperbound(ll_lh_phrase_list)+1] = long(right(ls_data_segment, 3))
	end if
next

if upperbound(ll_bh_phrase_list) > 0 then
	ll_len = upperbound(ll_bh_phrase_list)
	extAddLongArrayToResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "phrase_bh", ll_bh_phrase_list, ll_len, ls_time_stamp) 
end if
if upperbound(ll_rh_phrase_list) > 0 then
	ll_len = upperbound(ll_rh_phrase_list)
	extAddLongArrayToResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "phrase_rh", ll_rh_phrase_list, ll_len, ls_time_stamp) 
end if
if upperbound(ll_lh_phrase_list) > 0 then
	ll_len = upperbound(ll_lh_phrase_list)
	extAddLongArrayToResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "phrase_lh", ll_lh_phrase_list, ll_len, ls_time_stamp) 
end if


//int extPutImage(string IndexFile, string ImageFile, string RemoteFileName, string ImageBuf, string Timestamp, long ImageSize) LIBRARY "Internet.DLL" ALIAS FOR  "_extPutImage@24" 

//music data structure
//
//entry_name	data size
//music_header 	char[100];
//data_count 	long - char[4]
//data_index	long[data_count]
//detail_data	unsigned char[data_count*250]
//picture_count	long
//picture_index	long[picture_count]
//picture_data_xxx	unsigned char[]

return

//string SeqGraphic, GraphicLibIndexFile, GraphicLibImageFile
////key_only_prompt_both_000020
//SeqGraphic = "key_only_prompt_both_000100.png"
//GraphicLibIndexFile = "Beginner 1 - hot cross buns_image_lib.lhi"
//GraphicLibImageFile = "Beginner 1 - hot cross buns_image_lib.lhm"
//
//string ls_graph
//long ll_i, ll_mem_handle
//extInitResourceMemory()
//ll_mem_handle = extMakeResourceMemory(GraphicLibIndexFile,GraphicLibImageFile)
//
//SeqGraphic = "key_only_prompt_both_000100.png"
//extPNGRetrieveFullMem(SeqGraphic, ll_mem_handle)
//SeqGraphic = "key_only_prompt_both_000110.png"
//extPNGRetrieveFullMem(SeqGraphic, ll_mem_handle)
//SeqGraphic = "key_only_prompt_both_000120.png"
//extPNGRetrieveFullMem(SeqGraphic, ll_mem_handle)
//SeqGraphic = "key_only_prompt_both_000130.png"
//extPNGRetrieveFullMem(SeqGraphic, ll_mem_handle)
//
//extReleaseResourceMemory(GraphicLibIndexFile,GraphicLibImageFile)
//
//
//return

end event

type cb_18 from commandbutton within w_music_composer_fingering
integer x = 1783
integer y = 784
integer width = 146
integer height = 80
integer taborder = 130
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Cmpr"
end type

event clicked;// Compress Prompting PNG file into section library

integer li_i, li_low_note,li_high_note, li_natural_note_count, li_divider
li_low_note =  long(sle_min_note.text)
li_high_note =  long(sle_max_note.text)


cb_mk_entry.event clicked()
cb_get_list.event clicked()


for li_i = li_low_note to li_high_note
	if IsNaturalNote(li_i) then
		li_natural_note_count ++
	end if
next

li_divider = 2*li_natural_note_count
SectionCount = li_divider

// Build the image library 

string ls_seq_list = "", ls_token, ls_time_stamp
DateTime ldt_tmp

if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
	MessageBox("Error", "No Hand Selected, Cannot Capture Images!")
	return
end if

is_res_file_name = "" 

//for li_i = 1 to len(sle_dw_path.text)
//	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
//	if ls_token = "\" then exit
//	is_res_file_name = ls_token + is_res_file_name 
//next
//
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_image_lib"

string ls_lesson_path, ls_output_prefix, ls_res_file_name_temp
ls_lesson_path = is_category_path + "\Lesson\" + is_lesson_name_prefix
if not DirectoryExists(ls_lesson_path) then CreateDirectory(ls_lesson_path)
is_res_file_name = ls_lesson_path + "\" + is_lesson_output_prefix + "_image_lib"

ls_res_file_name_temp = "C:\temp\keyboard_images\" + is_lesson_output_prefix + "_image_lib"
if isnull(is_res_file_name) then messagebox("is_res_file_name", "IS NULL")


//MessageBox(ls_res_file_name_temp, is_res_file_name)




//return

//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_lesson_lib"
//is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kbimage_lib"
//if DirectoryExists(is_deploy_directory) then
//	is_res_file_name = is_deploy_directory + "\" + is_res_file_name
//end if

If FileExists(is_res_file_name + ".lhm") then
 	If MessageBox("Warning", "File: " + is_res_file_name + ".lhm EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
	FileDelete(is_res_file_name + ".lhm")
end if
If FileExists(is_res_file_name + ".lhi") then
 	If MessageBox("Warning", "File: " + is_res_file_name + ".lhi EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
	FileDelete(is_res_file_name + ".lhi")
end if

//extCreateResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm")
extCreateResourceFile(ls_res_file_name_temp + ".lhi", ls_res_file_name_temp + ".lhm")

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//ls_seq_list
for li_i = 2 to dw_1.RowCount()
	ls_seq_list = ls_seq_list + string(dw_1.GetItemNumber(li_i,"SEQ"), "000000")
next

extInitResourceMemory()


if ii_sheet_type = BOTH_HAND then
	//when need to capture 12 set of image
	//REBUILD IMAGE LIBRARY
	//1 - both hands (hand together) at key pressed mode
	cbx_key_only.checked = false
	cbx_append_left_hand.checked = true
	cbx_append_right_hand.checked = true
	cbx_activate_animation.checked = false
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 1 - both hands (hand together) at key pressed mode", "debug")
	// 2 - both hands (hand together) at key release mode
	cbx_append_left_hand.checked = true
	cbx_append_right_hand.checked = true
	cbx_activate_animation.checked = true
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 2 - both hands (hand together) at key release mode", "debug")
end if

if ii_sheet_type = BOTH_HAND or ii_sheet_type = LEFT_HAND then
	// 3 - left hand at key pressed mode
	cbx_append_left_hand.checked = true
	cbx_append_right_hand.checked = false
	cbx_activate_animation.checked = false
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 3 - left hand at key pressed mode", "debug")
	
	// 4 - left hand at key release mode
	cbx_append_left_hand.checked = true
	cbx_append_right_hand.checked = false
	cbx_activate_animation.checked = true
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 4 - left hand at key release mode", "debug")
end if

if ii_sheet_type = BOTH_HAND or ii_sheet_type = RIGHT_HAND then
	// 5 - right hand at key pressed mode
	cbx_append_left_hand.checked = false
	cbx_append_right_hand.checked = true
	cbx_activate_animation.checked = false
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 5 - right hand at key pressed mode", "debug")
	
	// 6 - right hand at key release mode
	cbx_append_left_hand.checked = false
	cbx_append_right_hand.checked = true
	cbx_activate_animation.checked = true
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 6 - right hand at key release mode", "debug")
end if

//MessageBox("Info", "Complete Rebuilding Image Library!")
//
//return // not build key only

if ii_sheet_type = BOTH_HAND then

	// REBUILD KEY ONLY IMAGES
	cbx_key_only.checked = true
	// 7 - both hands (hand together) at key pressed mode
	cbx_append_left_hand.checked = true
	cbx_append_right_hand.checked = true
	cbx_activate_animation.checked = false
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 7 - both hands (hand together) at key pressed mode", "debug")
	
	// 8 - both hands (hand together) at key release mode
	cbx_append_left_hand.checked = true
	cbx_append_right_hand.checked = true
	cbx_activate_animation.checked = true
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 8 - both hands (hand together) at key release mode", "debug")
end if

if ii_sheet_type = BOTH_HAND or ii_sheet_type = LEFT_HAND then

// 9 - left hand at key pressed mode
	cbx_append_left_hand.checked = true
	cbx_append_right_hand.checked = false
	cbx_activate_animation.checked = false
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 9 - left hand at key pressed mode", "debug")
	
	// 10 - left hand at key release mode
	cbx_append_left_hand.checked = true
	cbx_append_right_hand.checked = false
	cbx_activate_animation.checked = true
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 10 - left hand at key release mode", "debug")
end if

if ii_sheet_type = BOTH_HAND or ii_sheet_type = RIGHT_HAND then

	// 11 - right hand at key pressed mode
	cbx_append_left_hand.checked = false
	cbx_append_right_hand.checked = true
	cbx_activate_animation.checked = false
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 11 - right hand at key pressed mode", "debug")
	
	// 12 - right hand at key release mode
	cbx_append_left_hand.checked = false
	cbx_append_right_hand.checked = true
	cbx_activate_animation.checked = true
	cbx_view_image.checked = false
	cbx_mix_image.checked = false
	if wf_build_image_library() = 0 then
		MessageBox("Error", "Rebuild Fails!")
		return
	end if
	//MessageBox("Processed 12 - right hand at key release mode", "debug")
end if

cbx_key_only.checked = false
if isnull(ls_res_file_name_temp) then messagebox("ls_res_file_name_temp", "IS NULL")
if isnull(is_res_file_name) then messagebox("is_res_file_name", "IS NULL")

//MessageBox(ls_res_file_name_temp, is_res_file_name)

FileMove(ls_res_file_name_temp + ".lhi", is_res_file_name + ".lhi")
FileMove(ls_res_file_name_temp + ".lhm", is_res_file_name + ".lhm")
MessageBox("Info", "Complete Rebuilding Image Library!")



end event

type cb_populate_loudness from commandbutton within w_music_composer_fingering
integer x = 4983
integer y = 1244
integer width = 334
integer height = 68
integer taborder = 120
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Populate Char"
end type

event clicked;// batch copy
integer li_i, li_j, li_row, li_row_source, li_row_dest, li_seq, li_row_source_from = 0, li_rows_to_be_copied = 0, li_row_dest_from = 0
string ls_empty = "", ls_empty_list[], ls_fingering_source, ls_fingering_dest
string ls_lh_output_source, ls_rh_output_source, ls_lh_output_list_source[], ls_rh_output_list_source[]
string ls_lh_output_dest, ls_rh_output_dest, ls_lh_output_list_dest[], ls_rh_output_list_dest[]
string ls_note_source,ls_note_dest,ls_left_note_list_source[], ls_right_note_list_source[], ls_left_note_list_dest[], ls_right_note_list_dest[]
string ls_note_char_from, ls_note_char_to, ls_char, ls_finger, ls_right_portion
integer li_note_char_from, li_note_char_to, li_char

ls_note_char_from = sle_note_char_from.text
ls_note_char_to = sle_note_char_to.text
li_note_char_from = Asc(ls_note_char_from)
li_note_char_to = Asc(ls_note_char_to)

//Asc('A') = 65
//Asc('P') = 80
//Asc('a') = 97
//Asc('p') = 112

if li_note_char_from < 65 or li_note_char_from > 112 or (li_note_char_from > 80 and li_note_char_from < 97) then
	MessageBox("Error", "Invalid From Char!")
	return 0
end if

if li_note_char_to < 65 or li_note_char_to > 112 or (li_note_char_to > 80 and li_note_char_to < 97) then
	MessageBox("Error", "Invalid To Char!")
	return 0
end if

// Got the row range
for li_row = 1 to dw_1.RowCount()
	li_seq = dw_1.GetItemNumber(li_row, "seq")
	if li_seq = integer(sle_source_from.text) then li_row_source_from = li_row
	if li_seq = integer(sle_source_to.text) then li_rows_to_be_copied = li_row - li_row_source_from + 1
next

if li_row_source_from = 0 then
	MessageBox("Error", "Source From Is Invalid!")
	return 0
end if

if li_rows_to_be_copied <= 0 then
	MessageBox("Error", "Rows To Be Copied Are Not Specified Or Invalid!")
	return 0
end if

//Note Character
//MIDI sound loundness (streng) range from 1-127
//'0' = default legato note, default to sound value 127
//'2' = continue sound
//A-P sound value for legreto  A=7, P=127
//calculation method: (asc(note_char) - 65)*8 + 7
//a-p sound value for Staccato a=7, p=127
//calculation method: (asc(note_char) - 97)*8 + 7 
//Asc('0') = 48
//Asc('1') = 49 
//Asc('2') = 50
//Asc('A') = 65
//Asc('P') = 80
//Asc('a') = 97
//Asc('p') = 112


//li_note_char_from, li_note_char_to
for li_row = 1 to li_rows_to_be_copied
	li_row_source = li_row_source_from + li_row - 1
	li_row_dest = li_row_source
	ls_note_source = dw_1.GetItemString(li_row_source, "note")
//	ls_note_dest
	if isnull(ls_note_source) then ls_note_source = ""
	if li_rows_to_be_copied = 1 then
		li_char = li_note_char_from
	else
		li_char = (li_note_char_to - li_note_char_from)*(li_row - 1)/(li_rows_to_be_copied - 1) + li_note_char_from
	end if
	ls_char = char(li_char)
	
	ls_lh_output_source = ""
	ls_rh_output_source = ""
	ls_lh_output_list_source = ls_empty_list
	ls_rh_output_list_source = ls_empty_list
	ls_lh_output_dest = ""
	ls_rh_output_dest = ""
	ls_lh_output_list_dest = ls_empty_list
	ls_rh_output_list_dest = ls_empty_list
	ls_right_note_list_source = ls_empty_list
	ls_left_note_list_source = ls_empty_list
	ls_right_note_list_dest = ls_empty_list
	ls_left_note_list_dest = ls_empty_list
	
	if ls_note_source <> "" then 
		wf_get_note_list("R", ls_note_source, ls_right_note_list_source)
		wf_get_note_list("L", ls_note_source, ls_left_note_list_source)
		for li_j = 1 to upperbound(ls_left_note_list_source)
			ls_finger = right(ls_left_note_list_source[li_j], 1)
			ls_right_portion = left(ls_left_note_list_source[li_j], len(ls_left_note_list_source[li_j]) - 2)
			ls_lh_output_source = ls_lh_output_source + ls_right_portion + ls_char + ls_finger
		next
		for li_j = 1 to upperbound(ls_right_note_list_source)
			ls_finger = right(ls_right_note_list_source[li_j], 1)
			ls_right_portion = left(ls_right_note_list_source[li_j], len(ls_right_note_list_source[li_j]) - 2)
			ls_rh_output_source = ls_rh_output_source + ls_right_portion + ls_char + ls_finger
		next
		if cbx_append_left_hand.checked and cbx_append_right_hand.checked then // both hands, always replace
			ls_note_dest =  ls_rh_output_source + ls_lh_output_source
		elseif cbx_append_left_hand.checked then
			ls_note_dest = ls_lh_output_source
		elseif cbx_append_right_hand.checked then
			ls_note_dest = ls_rh_output_source
		end if
	end if
	dw_1.SetItem(li_row_source, "note", ls_note_dest)	
next
return 1
end event

type sle_note_char_to from singlelineedit within w_music_composer_fingering
integer x = 5490
integer y = 1248
integer width = 146
integer height = 64
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "P"
borderstyle borderstyle = stylelowered!
end type

type sle_note_char_from from singlelineedit within w_music_composer_fingering
integer x = 5321
integer y = 1248
integer width = 146
integer height = 64
integer taborder = 220
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "P"
borderstyle borderstyle = stylelowered!
end type

type cb_17 from commandbutton within w_music_composer_fingering
integer x = 5637
integer y = 1400
integer width = 261
integer height = 76
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Next Img. "
end type

event clicked;long li_i
string ls_seq_list = "", ls_token, ls_time_stamp
DateTime ldt_tmp

// display 12 set of image
//REBUILD IMAGE LIBRARY

GraphicDllTest()

return

choose case ii_next_picture_index
	case 1
		// 1 - both hands (hand together) at key pressed mode
		cbx_key_only.checked = false
		cbx_append_left_hand.checked = true
		cbx_append_right_hand.checked = true
		cbx_activate_animation.checked = false
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 2
	
	// 2 - both hands (hand together) at key release mode
		cbx_append_left_hand.checked = true
		cbx_append_right_hand.checked = true
		cbx_activate_animation.checked = true
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 3
		// 3 - left hand at key pressed mode
		cbx_append_left_hand.checked = true
		cbx_append_right_hand.checked = false
		cbx_activate_animation.checked = false
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 4		
		// 4 - left hand at key release mode
		cbx_append_left_hand.checked = true
		cbx_append_right_hand.checked = false
		cbx_activate_animation.checked = true
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 5
		// 5 - right hand at key pressed mode
		cbx_append_left_hand.checked = false
		cbx_append_right_hand.checked = true
		cbx_activate_animation.checked = false
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 6
		// 6 - right hand at key release mode
		cbx_append_left_hand.checked = false
		cbx_append_right_hand.checked = true
		cbx_activate_animation.checked = true
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 7
		// REBUILD KEY ONLY IMAGES
		cbx_key_only.checked = true
		// 7 - both hands (hand together) at key pressed mode
		cbx_append_left_hand.checked = true
		cbx_append_right_hand.checked = true
		cbx_activate_animation.checked = false
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 8
		// 8 - both hands (hand together) at key release mode
		cbx_append_left_hand.checked = true
		cbx_append_right_hand.checked = true
		cbx_activate_animation.checked = true
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 9
		// 9 - left hand at key pressed mode
		cbx_append_left_hand.checked = true
		cbx_append_right_hand.checked = false
		cbx_activate_animation.checked = false
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 10
		// 10 - left hand at key release mode
		cbx_append_left_hand.checked = true
		cbx_append_right_hand.checked = false
		cbx_activate_animation.checked = true
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 11
		// 11 - right hand at key pressed mode
		cbx_append_left_hand.checked = false
		cbx_append_right_hand.checked = true
		cbx_activate_animation.checked = false
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index++

	case 12
		// 12 - right hand at key release mode
		cbx_append_left_hand.checked = false
		cbx_append_right_hand.checked = true
		cbx_activate_animation.checked = true
		cbx_view_image.checked = false
		cbx_mix_image.checked = false
		wf_display_single_image()
		ii_next_picture_index = 1
end choose

end event

type cb_16 from commandbutton within w_music_composer_fingering
integer x = 5582
integer y = 1464
integer width = 343
integer height = 76
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Retrieve Img. "
end type

event clicked;long li_i
string ls_seq_list = "", ls_token, ls_time_stamp
DateTime ldt_tmp

If MessageBox("Warning", "You are to retrieve images, which will overwrite existing files, Do you want to continue?", Question!, YesNo!) = 2 then return


if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
	MessageBox("Error", "No Hand Selected, Cannot Capture Images!")
	return
end if

is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"

If not FileExists(is_res_file_name + ".lhm") then
 	MessageBox("Error", "File: " + is_res_file_name + ".lhm Does Not EXIST!")
	 return
end if
If not FileExists(is_res_file_name + ".lhi") then
 	MessageBox("Error", "File: " + is_res_file_name + ".lhi Does Not EXIST!")
	 return
end if


// when need to capture 12 set of image
//REBUILD IMAGE LIBRARY
// 1 - both hands (hand together) at key pressed mode
cbx_key_only.checked = false
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 2 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 3 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 4 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 5 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 6 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// REBUILD KEY ONLY IMAGES
cbx_key_only.checked = true
// 7 - both hands (hand together) at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 8 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 9 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 10 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 11 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

// 12 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_retrieve_image()

cbx_key_only.checked = false

MessageBox("Info", "Complete Image Retrieval!")
end event

type cb_7 from commandbutton within w_music_composer_fingering
integer y = 80
integer width = 384
integer height = 76
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Rebuild Img. Lib"
end type

event clicked;// rebuild _kb_pane_images files from individual keyboard image files

long li_i
string ls_seq_list = "", ls_token, ls_time_stamp
DateTime ldt_tmp

if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
	MessageBox("Error", "No Hand Selected, Cannot Capture Images!")
	return
end if

is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next
if DirectoryExists(is_deploy_directory) then
	is_res_file_name = is_deploy_directory + "\" + is_res_file_name
end if

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"

If FileExists(is_res_file_name + ".lhm") then
 	If MessageBox("Warning", "File: " + is_res_file_name + ".lhm EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
	FileDelete(is_res_file_name + ".lhm")
end if
If FileExists(is_res_file_name + ".lhi") then
 	If MessageBox("Warning", "File: " + is_res_file_name + ".lhi EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
	FileDelete(is_res_file_name + ".lhi")
end if

extCreateResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm")

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//ls_seq_list
for li_i = 2 to dw_1.RowCount()
	ls_seq_list = ls_seq_list + string(dw_1.GetItemNumber(li_i,"SEQ"), "000000")
next

extPutImage(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "SEQUENCE_NUMBER", ls_seq_list, ls_time_stamp, len(ls_seq_list))	


// when need to capture 12 set of image
//REBUILD IMAGE LIBRARY
// 1 - both hands (hand together) at key pressed mode
cbx_key_only.checked = false
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 2 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 3 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 4 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 5 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 6 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// REBUILD KEY ONLY IMAGES
cbx_key_only.checked = true
// 7 - both hands (hand together) at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 8 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 9 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 10 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 11 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

// 12 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
if wf_build_image() = 0 then
	MessageBox("Error", "Rebuild Fails!")
	return
end if

cbx_key_only.checked = false

MessageBox("Info", "Complete Rebuilding Image Library!")

end event

type pb_16 from picturebutton within w_music_composer_fingering
string tag = "Capture Single"
integer x = 347
integer y = 160
integer width = 78
integer height = 76
integer taborder = 120
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string picturename = "Custom028!"
alignment htextalign = left!
end type

event clicked;long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = ""

if ii_current_row < 2 or ii_current_row > dw_1.RowCount() then
	MessageBox("Error", "Invalid Row, Cannot Capture Image")
	return 0
end if

is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

ll_width = UnitsToPixels(p_1.width, XUnitsToPixels!)
ll_height = UnitsToPixels(p_1.height, YUnitsToPixels!)

extSetPrompt(3)
cbx_key_only.checked = false
// 1 - both hands (hand together) at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_capture_image_single()

// 2 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_capture_image_single()

// 3 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_capture_image_single()

// 4 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_capture_image_single()

// 5 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_capture_image_single()

// 6 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
wf_capture_image_single()

// CAPTURE KEY ONLY
extSetPrompt(2)
cbx_key_only.checked = true
// 7 - both hands (hand together) at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
extSetPrompt(2)
wf_capture_image_single()

// 8 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
extSetPrompt(2)
wf_capture_image_single()

// 9 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
extSetPrompt(2)
wf_capture_image_single()

// 10 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
extSetPrompt(2)
wf_capture_image_single()

// 11 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
extSetPrompt(2)
wf_capture_image_single()

// 12 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
extSetPrompt(2)
wf_capture_image_single()

// reset
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
extSetPrompt(3)

cbx_key_only.checked = false

//
end event

type cbx_key_only from checkbox within w_music_composer_fingering
integer x = 4187
integer width = 274
integer height = 72
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "key only"
end type

type cb_play_notes from commandbutton within w_music_composer_fingering
integer x = 5010
integer y = 1332
integer width = 288
integer height = 64
integer taborder = 220
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Play Notes"
end type

event clicked;// play note
// Got the row range

//	if li_seq = integer(sle_source_from.text) then li_row_source_from = li_row
//	if li_seq = integer(sle_source_to.text) then li_rows_to_be_copied = li_row - li_row_source_from + 1

long ll_i, ll_interval, ll_units_per_scroll_uo_1
integer li_row, li_measuer_count, li_begin_measure, li_end_measure, li_seq
double ldb_min_timer

// Got the row range
for li_row = 1 to dw_1.RowCount()
	li_seq = dw_1.GetItemNumber(li_row, "seq")
	if li_seq = integer(sle_source_from.text) then ii_row_source_from = li_row
	if li_seq = integer(sle_source_to.text) then ii_row_source_to = li_row
next

//MessageBox(string(ii_row_source_from), ii_row_source_to)
if ii_row_source_from < 2 or ii_row_source_to > dw_1.rowcount() or ii_row_source_from > ii_row_source_to then
	MessageBox("Error", "Cannot play the notes, invalid range specified!")
	return
end if

if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
	MessageBox("Error", "No Hand Selected, Cannot play the notes!")
	return
end if

if not cbx_append_right_hand.checked then	// Left hand note
	is_cur_text_list = is_lh_text_list
elseif not cbx_append_left_hand.checked then	// right hand note
	is_cur_text_list = is_rh_text_list
else
	is_cur_text_list = is_bh_text_list
end if

ib_note_playing = true
ii_current_row = ii_row_source_from
if upperbound(ii_played_notes) > 0 then // clean up ii_played_note list
	for ll_i = 1 to upperbound(ii_played_notes)
		extPostThreadMessage(il_thread_id, 1041, ii_played_notes[ll_i], 0)
	next
	ii_played_notes = ii_empty_list
end if

dwobject dwo
ldb_min_timer = wf_get_min_time()
//wf_rec_move(is_cur_text_list[ii_current_row])
dw_1.event doubleclicked(0,0,ii_current_row,dwo)
wf_play_note()
timer(ldb_min_timer, parent)

end event

type st_19 from statictext within w_music_composer_fingering
integer x = 2990
integer width = 165
integer height = 56
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "tempo"
alignment alignment = center!
boolean focusrectangle = false
end type

type st_18 from statictext within w_music_composer_fingering
integer x = 5609
integer y = 1324
integer width = 146
integer height = 68
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "r. vol"
alignment alignment = center!
boolean focusrectangle = false
end type

type st_17 from statictext within w_music_composer_fingering
integer x = 5326
integer y = 1328
integer width = 146
integer height = 68
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "l. vol"
alignment alignment = center!
boolean focusrectangle = false
end type

type sle_right_volume from singlelineedit within w_music_composer_fingering
integer x = 5746
integer y = 1320
integer width = 128
integer height = 64
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "127"
borderstyle borderstyle = stylelowered!
end type

type sle_left_volume from singlelineedit within w_music_composer_fingering
integer x = 5463
integer y = 1324
integer width = 128
integer height = 64
integer taborder = 220
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "127"
borderstyle borderstyle = stylelowered!
end type

type cbx_delete_tmp_img from checkbox within w_music_composer_fingering
boolean visible = false
integer x = 2880
integer y = 4
integer width = 338
integer height = 52
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Delete Tmp Image"
end type

type cbx_replace from checkbox within w_music_composer_fingering
integer x = 5029
integer y = 1104
integer width = 238
integer height = 64
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Replace"
boolean checked = true
end type

type cbx_entry from checkbox within w_music_composer_fingering
integer x = 5723
integer y = 1100
integer width = 165
integer height = 64
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Entry"
end type

type cbx_note from checkbox within w_music_composer_fingering
integer x = 5550
integer y = 1104
integer width = 165
integer height = 64
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Note"
end type

type cbx_fingering from checkbox within w_music_composer_fingering
integer x = 5298
integer y = 1104
integer width = 238
integer height = 64
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Fingering"
boolean checked = true
end type

type cb_batch_copy from commandbutton within w_music_composer_fingering
integer x = 5024
integer y = 1164
integer width = 288
integer height = 68
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Batch Copy"
end type

event clicked;// batch copy
integer li_i, li_j, li_row, li_row_source, li_row_dest, li_seq, li_row_source_from = 0, li_rows_to_be_copied = 0, li_row_dest_from = 0
string ls_empty = "", ls_empty_list[], ls_fingering_source, ls_fingering_dest
string ls_lh_output_source, ls_rh_output_source, ls_lh_output_list_source[], ls_rh_output_list_source[]
string ls_lh_output_dest, ls_rh_output_dest, ls_lh_output_list_dest[], ls_rh_output_list_dest[]
string ls_note_source,ls_note_dest,ls_left_note_list_source[], ls_right_note_list_source[], ls_left_note_list_dest[], ls_right_note_list_dest[]

// Got the row range
for li_row = 1 to dw_1.RowCount()
	li_seq = dw_1.GetItemNumber(li_row, "seq")
	if li_seq = integer(sle_source_from.text) then li_row_source_from = li_row
	if li_seq = integer(sle_source_to.text) then li_rows_to_be_copied = li_row - li_row_source_from + 1
	if li_seq = integer(sle_dest_from.text) then li_row_dest_from = li_row
next

if li_row_source_from = 0 then
	MessageBox("Error", "Source From Is Invalid!")
	return 0
end if

if li_rows_to_be_copied <= 0 then
	MessageBox("Error", "Rows To Be Copied Are Not Specified Or Invalid!")
	return 0
end if

if li_row_dest_from + li_rows_to_be_copied - 1 >  dw_1.RowCount() then
	MessageBox("Error", "The Destination Rows Are Out of range!")
	return 0
end if

if cbx_fingering.checked then
	for li_row = 1 to li_rows_to_be_copied
		li_row_source = li_row_source_from + li_row - 1
		li_row_dest = li_row_dest_from + li_row - 1
		ls_fingering_source = dw_1.GetItemString(li_row_source, "finger")
		ls_fingering_dest = dw_1.GetItemString(li_row_dest, "finger")
		ls_lh_output_source = ""
		ls_rh_output_source = ""
		ls_lh_output_list_source = ls_empty_list
		ls_rh_output_list_source = ls_empty_list
		ls_lh_output_dest = ""
		ls_rh_output_dest = ""
		ls_lh_output_list_dest = ls_empty_list
		ls_rh_output_list_dest = ls_empty_list
		if ls_fingering_source = "FB9FE" then 
			ls_fingering_dest = "FB9FE"
		else
			wf_parse_finger_entry(ls_fingering_source, ls_lh_output_source, ls_rh_output_source, ls_lh_output_list_source, ls_rh_output_list_source)
			if ls_fingering_dest <> "FB9FE" then
				wf_parse_finger_entry(ls_fingering_dest, ls_lh_output_dest, ls_rh_output_dest, ls_lh_output_list_dest, ls_rh_output_list_dest)
			end if
			if cbx_append_left_hand.checked and cbx_append_right_hand.checked then // both hands, always replace
				ls_fingering_dest = "FB" + ls_lh_output_source + ls_rh_output_source + "FE"
			elseif cbx_append_left_hand.checked then
				if cbx_replace.checked then // replacement
					ls_fingering_dest = "FB" + ls_lh_output_source + "FE"
				else		// append
					ls_fingering_dest = "FB" + ls_lh_output_source + ls_rh_output_dest + "FE"					
				end if
			elseif cbx_append_right_hand.checked then
				if cbx_replace.checked then // replacement
					ls_fingering_dest = "FB" + ls_rh_output_source + "FE"
				else		// append
					ls_fingering_dest = "FB" + ls_lh_output_dest + ls_rh_output_source + "FE"					
				end if
			end if
		end if
		dw_1.SetItem(li_row_dest, "finger", ls_fingering_dest)	
	next
end if
if cbx_note.checked then
	for li_row = 1 to li_rows_to_be_copied
		li_row_source = li_row_source_from + li_row - 1
		li_row_dest = li_row_dest_from + li_row - 1
		ls_note_source = dw_1.GetItemString(li_row_source, "note")
		ls_note_dest = dw_1.GetItemString(li_row_dest, "note")
		if isnull(ls_note_source) then ls_note_source = ""
		if isnull(ls_note_dest) then ls_note_dest = ""
		ls_lh_output_source = ""
		ls_rh_output_source = ""
		ls_lh_output_list_source = ls_empty_list
		ls_rh_output_list_source = ls_empty_list
		ls_lh_output_dest = ""
		ls_rh_output_dest = ""
		ls_lh_output_list_dest = ls_empty_list
		ls_rh_output_list_dest = ls_empty_list
		ls_right_note_list_source = ls_empty_list
		ls_left_note_list_source = ls_empty_list
		ls_right_note_list_dest = ls_empty_list
		ls_left_note_list_dest = ls_empty_list
		
		if ls_note_source <> "" then 
			wf_get_note_list("R", ls_note_source, ls_right_note_list_source)
			wf_get_note_list("L", ls_note_source, ls_left_note_list_source)
			if ls_note_dest <> "" then
				wf_get_note_list("R", ls_note_dest, ls_right_note_list_dest)
				wf_get_note_list("L", ls_note_dest, ls_left_note_list_dest)
			end if
			for li_j = 1 to upperbound(ls_left_note_list_source)
				ls_lh_output_source = ls_lh_output_source + ls_left_note_list_source[li_j]
			next
			for li_j = 1 to upperbound(ls_right_note_list_source)
				ls_rh_output_source = ls_rh_output_source + ls_right_note_list_source[li_j]
			next
			for li_j = 1 to upperbound(ls_right_note_list_dest)
				ls_lh_output_dest = ls_lh_output_dest + ls_right_note_list_dest[li_j]
			next
			for li_j = 1 to upperbound(ls_right_note_list_source)
				ls_rh_output_dest = ls_rh_output_dest + ls_right_note_list_source[li_j]
			next
			if cbx_append_left_hand.checked and cbx_append_right_hand.checked then // both hands, always replace
				ls_note_dest =  ls_rh_output_source + ls_lh_output_source
			elseif cbx_append_left_hand.checked then
				if cbx_replace.checked then // replacement
					ls_note_dest = ls_lh_output_source
				else		// append
					ls_note_dest =  ls_rh_output_dest + ls_lh_output_source				
				end if
			elseif cbx_append_right_hand.checked then
				if cbx_replace.checked then // replacement
					ls_note_dest = ls_rh_output_source
				else		// append
					ls_note_dest = ls_rh_output_source + ls_lh_output_dest 					
				end if
			end if
		end if
		dw_1.SetItem(li_row_dest, "note", ls_note_dest)	
	next
end if
return 1
end event

type sle_dest_from from singlelineedit within w_music_composer_fingering
integer x = 5696
integer y = 1168
integer width = 146
integer height = 64
integer taborder = 210
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

type sle_source_to from singlelineedit within w_music_composer_fingering
integer x = 5490
integer y = 1164
integer width = 146
integer height = 64
integer taborder = 210
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

event modified;if text = "j" then
	if ii_current_row > 0 and ii_current_row <= dw_1.RowCount() then
		text = string(dw_1.GetItemNumber(ii_current_row, "seq"))
	end if
end if
end event

type sle_source_from from singlelineedit within w_music_composer_fingering
integer x = 5326
integer y = 1168
integer width = 146
integer height = 64
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

event modified;if text = "j" then
	if ii_current_row > 0 and ii_current_row <= dw_1.RowCount() then
		text = string(dw_1.GetItemNumber(ii_current_row, "seq"))
	end if
end if
end event

type cb_15 from commandbutton within w_music_composer_fingering
integer y = 160
integer width = 347
integer height = 72
integer taborder = 140
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Capture Full Img"
end type

event clicked;long li_i
string ls_seq_list = "", ls_token, ls_time_stamp
DateTime ldt_tmp

if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
	MessageBox("Error", "No Hand Selected, Cannot Capture Images!")
	return
end if

//is_res_file_name = "" 
//
//for li_i = 1 to len(sle_dw_path.text)
//	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
//	if ls_token = "\" then exit
//	is_res_file_name = ls_token + is_res_file_name 
//next
//if DirectoryExists(is_deploy_directory) then
//	is_res_file_name = is_deploy_directory + "\" + is_res_file_name
//end if
string ls_lesson_path, ls_output_prefix
ls_lesson_path = is_category_path + "\Lesson\" + is_lesson_name_prefix
if not DirectoryExists(ls_lesson_path) then CreateDirectory(ls_lesson_path)

if cbx_image_lib.checked then
//	is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"
	is_res_file_name = ls_lesson_path + "/" + is_lesson_output_prefix + "_kb_pane_images"
	If FileExists(is_res_file_name + ".lhm") then
		If MessageBox("Warning", "File: " + is_res_file_name + ".lhm EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
		FileDelete(is_res_file_name + ".lhm")
	end if
	If FileExists(is_res_file_name + ".lhi") then
		If MessageBox("Warning", "File: " + is_res_file_name + ".lhi EXISTS, Do you want to continue (will be deleted)?", Question!, YesNo!) = 2 then return
		FileDelete(is_res_file_name + ".lhi")
	end if
	extCreateResourceFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm")
end if
ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

//ls_seq_list
for li_i = 2 to dw_1.RowCount()
	ls_seq_list = ls_seq_list + string(dw_1.GetItemNumber(li_i,"SEQ"), "000000")
next

if cbx_image_lib.checked then
	extPutImage(is_res_file_name + ".lhi", is_res_file_name + ".lhm", "SEQUENCE_NUMBER", ls_seq_list, ls_time_stamp, len(ls_seq_list))	
end if

// when need to capture 12 set of image
//CAPTURE FINGERING IMAGERS
extSetPrompt(3)
cbx_key_only.checked = false
if not cb_start_keyboard.enabled then // has been started, stop it, then restart
	cb_stop_keyboard.event clicked()
	Yield()
	Sleep(2)
end if
cb_start_keyboard.event clicked()
Yield()
Sleep(2)
// 1 - both hands (hand together) at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 2 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()


// 3 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 4 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 5 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 6 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// CAPTURE KEY ONLY
extSetPrompt(2)
cbx_key_only.checked = true
// 7 - both hands (hand together) at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 8 - both hands (hand together) at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 9 - left hand at key pressed mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 10 - left hand at key release mode
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = false
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 11 - right hand at key pressed mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// 12 - right hand at key release mode
cbx_append_left_hand.checked = false
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = true
cbx_view_image.checked = false
cbx_mix_image.checked = false
//cb_capture_image.event clicked()
wf_capture_image_set()

// RESET
cbx_key_only.checked = false
cbx_append_left_hand.checked = true
cbx_append_right_hand.checked = true
cbx_activate_animation.checked = false
cbx_view_image.checked = false
cbx_mix_image.checked = false

extSetPrompt(3)

MessageBox("Info", "Complete Full Image Capturing!")
end event

type cb_save_project from commandbutton within w_music_composer_fingering
integer x = 5614
integer y = 1948
integer width = 256
integer height = 72
integer taborder = 30
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Save PRJ"
end type

event clicked;//sle_project_file

integer li_dummy

if not FileExists(sle_project_file.text) then
	li_dummy = FileOpen(sle_project_file.text, LineMode!, Write!, LockWrite!, Replace!)
	FileWrite(li_dummy, " ")
	FileClose(li_dummy)
end if

if FileExists(sle_project_file.text) then
	// create deploy_files directory
	is_deploy_directory = left(sle_project_file.text, len(sle_project_file.text) - 4)
//	MessageBox("is_deploy_directory", is_deploy_directory)
	if not DirectoryExists(is_deploy_directory) then CreateDirectory(is_deploy_directory)
	if SetProfileString(sle_project_file.text, "PATH", "CATEGORY_PATH", is_category_path) = -1 then MessageBox("Error", "Cannot Update CATEGORY_PATH on Project File")

	if SetProfileString(sle_project_file.text, "PATH", "GRAPH_PATH", sle_file_name.text) = -1 then MessageBox("Error", "Cannot Update GRAPH_PATH on Project File")
	if SetProfileString(sle_project_file.text, "PATH", "DW_PATH", sle_dw_path.text) = -1 then MessageBox("Error", "Cannot Update Project File")
	if SetProfileString(sle_project_file.text, "PATH", "FINGERING_LIB_SOURCE_PATH", sle_source_lib.text) = -1 then MessageBox("Error", "Cannot Update DW_PATH on Project File")
	if SetProfileString(sle_project_file.text, "PATH", "FINGERING_LIB_DEST_PATH", sle_dest_lib.text) = -1 then MessageBox("Error", "Cannot Update FINGERING_LIB_SOURCE_PATH on Project File")

	if SetProfileString(sle_project_file.text, "DATA", "KEYBOARD_NOTE_MIN", sle_min_note.text) = -1 then MessageBox("Error", "Cannot Update KEYBOARD_NOTE_MIN on Project File")
	if SetProfileString(sle_project_file.text, "DATA", "KEYBOARD_NOTE_MAX", sle_max_note.text) = -1 then MessageBox("Error", "Cannot Update KEYBOARD_NOTE_MAX on Project File")

end if
//if cbx_1.checked then // a compldate DW
//	ids_1.Reset()
//	dw_1.RowsCopy(1, dw_1.RowCount(), Primary!, ids_1, 1, Primary!)
//end if
//if ids_1.SaveAs(sle_dw_path.text, Text!, False) = -1 then
//	MessageBox("Error", "Cannot Export The File")
//	return 0
//end if

return 1

end event

type cb_browse_project from commandbutton within w_music_composer_fingering
integer x = 5792
integer y = 2028
integer width = 101
integer height = 80
integer taborder = 240
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = ".."
end type

event clicked;integer li_i, li_j, li_seq, li_begin, li_pos, li_len, li_value
string ls_tmp, ls_line, ls_Docname, ls_named, ls_path, ls_cur_dir
long graphW, graphH

ls_cur_dir = GetCurrentDirectory()
li_j = 0
for li_i = 1 to len(sle_project_file.text)
	if mid(sle_project_file.text, len(sle_project_file.text) + 1 - li_i, 1) = "\" then exit
	li_j++
next

if li_j < len(sle_project_file.text) then
	ls_path = left(sle_project_file.text, len(sle_project_file.text) - li_j)
else
	ls_path = ".\"
end if
ChangeDirectory(ls_path)
li_value = GetFileOpenName("Select Music Edit Project File", ls_Docname, ls_named, "PRJ", "Project File (*.PRJ),*.PRJ,")
ChangeDirectory(ls_cur_dir)
if li_value = 1 then
//	sle_project_file.text = left(ls_Docname, len(ls_Docname) - 4)
	sle_project_file.text = ls_Docname
end if

ChangeDirectory(ls_cur_dir)

if FileExists(sle_project_file.text) then
	is_graph_path = ProfileString(sle_project_file.text, "PATH", "GRAPH_PATH", "")
	is_dw_path = ProfileString(sle_project_file.text, "PATH", "DW_PATH", "")
	sle_source_lib.text = ProfileString(sle_project_file.text, "PATH", "FINGERING_LIB_SOURCE_PATH", "")
	sle_dest_lib.text = ProfileString(sle_project_file.text, "PATH", "FINGERING_LIB_DEST_PATH", "")	
	sle_min_note.text = ProfileString(sle_project_file.text, "DATA", "KEYBOARD_NOTE_MIN", "")	
	sle_max_note.text = ProfileString(sle_project_file.text, "DATA", "KEYBOARD_NOTE_MAX", "")	
	sle_min_note.event modified()
	sle_max_note.event modified()	
end if


sle_file_name.text = is_graph_path
sle_dw_path.text = is_dw_path

if not FileExists(is_graph_path) then
	MessageBox("Is Not Available!", is_graph_path)
	return
end if
if not FileExists(is_dw_path) then
	MessageBox("Is Not Available!", is_dw_path)
	return
end if
if not FileExists(sle_dest_lib.text + ".lhi") then
	MessageBox("Is Not Available!", sle_dest_lib.text)
	return
end if
if not FileExists(sle_source_lib.text + ".lhi") then
	MessageBox("Is Not Available!", sle_source_lib.text)
	return
end if

wf_show_graph()
if FileExists(sle_dw_path.text) then
	cb_restore_dw.event clicked()
end if

end event

type sle_project_file from singlelineedit within w_music_composer_fingering
integer x = 5010
integer y = 2036
integer width = 777
integer height = 76
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type st_16 from statictext within w_music_composer_fingering
integer x = 5015
integer y = 1964
integer width = 558
integer height = 56
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Music Edit Project"
alignment alignment = center!
boolean focusrectangle = false
end type

type cb_reload_library from commandbutton within w_music_composer_fingering
integer x = 5563
integer y = 1696
integer width = 293
integer height = 80
integer taborder = 240
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Reset DDLB"
end type

event clicked;String ls_ts[]
integer li_i,li_count

do while ddlb_lh_1.TotalItems() > 0
	ddlb_lh_1.DeleteItem(1)
loop
do while ddlb_lh_2.TotalItems() > 0
	ddlb_lh_2.DeleteItem(1)
loop
do while ddlb_lh_3.TotalItems() > 0
	ddlb_lh_3.DeleteItem(1)
loop
do while ddlb_lh_4.TotalItems() > 0
	ddlb_lh_4.DeleteItem(1)
loop
do while ddlb_lh_5.TotalItems() > 0
	ddlb_lh_5.DeleteItem(1)
loop

do while ddlb_rh_1.TotalItems() > 0
	ddlb_rh_1.DeleteItem(1)
loop
do while ddlb_rh_2.TotalItems() > 0
	ddlb_rh_2.DeleteItem(1)
loop
do while ddlb_rh_3.TotalItems() > 0
	ddlb_rh_3.DeleteItem(1)
loop
do while ddlb_rh_4.TotalItems() > 0
	ddlb_rh_4.DeleteItem(1)
loop
do while ddlb_rh_5.TotalItems() > 0
	ddlb_rh_5.DeleteItem(1)
loop

ls_ts[1] = space(20)
li_count = extResIndexCount(sle_dest_lib.text + ".lhi", ls_ts[1])

for li_i = 1 to li_count
	is_id[li_i] = space(500) 
	ls_ts[li_i] = space(20)
next
//extRetrieveResIndex("finger_graphic.lhi", is_id, ls_ts)
extRetrieveResIndex(sle_dest_lib.text + ".lhi", is_id, ls_ts)
for li_i = 1 to li_count
	is_id[li_i] = left(is_id[li_i], 4) 
next

for li_i = 1 to li_count
	if left(is_id[li_i], 1) = "1" then // left hand
		choose case mid(is_id[li_i], 2, 1) // finger number
			case "1" // finger 1
				ddlb_lh_1.AddItem(left(is_id[li_i], 4))
			case "2"
				ddlb_lh_2.AddItem(left(is_id[li_i], 4))
			case "3"
				ddlb_lh_3.AddItem(left(is_id[li_i], 4))
			case "4"
				ddlb_lh_4.AddItem(left(is_id[li_i], 4))
			case "5"
				ddlb_lh_5.AddItem(left(is_id[li_i], 4))
		end choose
	else
		choose case mid(is_id[li_i], 2, 1) // finger number
			case "1" // finger 1
				ddlb_rh_1.AddItem(left(is_id[li_i], 4))
			case "2"
				ddlb_rh_2.AddItem(left(is_id[li_i], 4))
			case "3"
				ddlb_rh_3.AddItem(left(is_id[li_i], 4))
			case "4"
				ddlb_rh_4.AddItem(left(is_id[li_i], 4))
			case "5"
				ddlb_rh_5.AddItem(left(is_id[li_i], 4))
		end choose
	end if
next

cb_finger_attr_default.event clicked()
//sle_min_note.text = "41"
//sle_max_note.text = "84"
//sle_min_note.event modified()
//sle_max_note.event modified()



end event

type sle_tempo from singlelineedit within w_music_composer_fingering
integer x = 3159
integer width = 110
integer height = 84
integer taborder = 20
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "80"
borderstyle borderstyle = stylelowered!
end type

type cbx_mix_image from checkbox within w_music_composer_fingering
integer x = 974
integer width = 261
integer height = 64
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Mix Image"
end type

type cbx_view_image from checkbox within w_music_composer_fingering
integer x = 699
integer width = 261
integer height = 64
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "View Image"
end type

type cbx_activate_animation from checkbox within w_music_composer_fingering
integer x = 9
integer y = 240
integer width = 375
integer height = 56
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Anim. Alt Image"
end type

type cbx_1 from checkbox within w_music_composer_fingering
integer x = 393
integer y = 236
integer width = 302
integer height = 60
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "complete DW"
boolean checked = true
end type

event clicked;integer li_i, li_row
cb_dup_row.enabled = (checked)
cb_delete_row.enabled = (checked)
if checked then // It was not checked, now it is checked, copy data from datastore
	dw_1.Reset()
	ids_1.RowsCopy(1, ids_1.RowCount(), Primary!, dw_1, 1, Primary!)
	dw_1.object.note.protect = 0
	dw_1.object.coord.protect = 0
	dw_1.object.finger.protect = 0
	dw_1.object.entry.protect = 0
else		// It was not checked, so it is in a complete DW mode, copy to datastore first, then selectedly copy back to DW
	ids_1.Reset()
	dw_1.RowsCopy(1, dw_1.RowCount(), Primary!, ids_1, 1, Primary!)
	dw_1.Reset()	
	for li_i = 1 to ids_1.RowCount()
		if mod(ids_1.GetItemNumber(li_i, "seq"), 10) = 0 then 
			li_row = dw_1.InsertRow(0)
			dw_1.object.data[li_row] = ids_1.object.data[li_i]
		end if
	next
	dw_1.object.note.protect = 1
	dw_1.object.coord.protect = 1
	dw_1.object.finger.protect = 1
	dw_1.object.entry.protect = 1
end if


end event

type cb_27 from commandbutton within w_music_composer_fingering
integer x = 4992
integer y = 1404
integer width = 617
integer height = 68
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Load Finger Proportionally"
end type

event clicked;wf_load_finger_proportionally()

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type st_15 from statictext within w_music_composer_fingering
integer x = 5019
integer y = 1032
integer width = 215
integer height = 68
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "inc size"
alignment alignment = center!
boolean focusrectangle = false
end type

type sle_h_inc from singlelineedit within w_music_composer_fingering
integer x = 5737
integer y = 1032
integer width = 101
integer height = 76
integer taborder = 190
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

type sle_w_inc from singlelineedit within w_music_composer_fingering
integer x = 5582
integer y = 1032
integer width = 101
integer height = 76
integer taborder = 140
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

type sle_y_inc from singlelineedit within w_music_composer_fingering
integer x = 5422
integer y = 1032
integer width = 101
integer height = 76
integer taborder = 180
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

type sle_x_inc from singlelineedit within w_music_composer_fingering
integer x = 5257
integer y = 1032
integer width = 101
integer height = 76
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

type sle_3 from singlelineedit within w_music_composer_fingering
integer x = 5079
integer y = 796
integer width = 146
integer height = 76
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "67"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_rh_5_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_rh_note_name_5.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_rh_note_level_5.text = right(ls_note_name, 1)
end event

type pb_15 from picturebutton within w_music_composer_fingering
integer x = 5733
integer y = 860
integer width = 101
integer height = 84
integer taborder = 150
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom033!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
// move finger position up one scale
long ll_h[5], ll_i, ll_value

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_lh_h[ll_i].text)
			if ll_value + long(sle_h_inc.text) < 1000 then
				isle_lh_h[ll_i].text = string(ll_value + long(sle_h_inc.text), "000")
			end if			
		next
	end if
	if cbx_append_right_hand.checked then
		for ll_i = 1 to 5
		ll_value = long(isle_rh_h[ll_i].text)
		if ll_value + long(sle_w_inc.text) < 1000 then
				isle_rh_h[ll_i].text = string(ll_value + long(sle_h_inc.text), "000")
			end if			
		next
	end if
else			

	if ii_cur_f < 6 then
		ll_i = ii_cur_f
	else
		ll_i = ii_cur_f - 5
	end if
	
	choose case ii_cur_f
		case 1
			ll_h[ll_i] = long(sle_lh_1_h.text)
		case 2
			ll_h[ll_i] = long(sle_lh_2_h.text)
		case 3
			ll_h[ll_i] = long(sle_lh_3_h.text)
		case 4
			ll_h[ll_i] = long(sle_lh_4_h.text)
		case 5
			ll_h[ll_i] = long(sle_lh_5_h.text)
		case 6
			ll_h[ll_i] = long(sle_rh_1_h.text)
		case 7
			ll_h[ll_i] = long(sle_rh_2_h.text)
		case 8
			ll_h[ll_i] = long(sle_rh_3_h.text)
		case 9
			ll_h[ll_i] = long(sle_rh_4_h.text)
		case 10
			ll_h[ll_i] = long(sle_rh_5_h.text)
	end choose		
	
	if ll_h[ll_i] + long(sle_h_inc.text) >= 1000 then return
	
	ll_h[ll_i] = ll_h[ll_i] + long(sle_h_inc.text)
				
	choose case ii_cur_f
		case 1
			sle_lh_1_h.text = string(ll_h[1], "000")
		case 2
			sle_lh_2_h.text = string(ll_h[2], "000")
		case 3
			sle_lh_3_h.text = string(ll_h[3], "000")
		case 4
			sle_lh_4_h.text = string(ll_h[4], "000")
		case 5
			sle_lh_5_h.text = string(ll_h[5], "000")
		case 6
			sle_rh_1_h.text = string(ll_h[1], "000")
		case 7
			sle_rh_2_h.text = string(ll_h[2], "000")
		case 8
			sle_rh_3_h.text = string(ll_h[3], "000")
		case 9
			sle_rh_4_h.text = string(ll_h[4], "000")
		case 10
			sle_rh_5_h.text = string(ll_h[5], "000")
	end choose
end if

if cb_draw.enabled then
	cb_draw.post event clicked()
end if


end event

type pb_14 from picturebutton within w_music_composer_fingering
integer x = 5733
integer y = 944
integer width = 101
integer height = 84
integer taborder = 170
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom034!"
alignment htextalign = left!
end type

event clicked;long ll_h[5], ll_i, ll_value

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_lh_h[ll_i].text)
			if ll_value - long(sle_h_inc.text) > 0  then
				isle_lh_h[ll_i].text = string(ll_value - long(sle_h_inc.text), "000")
			end if			
		next
	end if
	if cbx_append_right_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_rh_h[ll_i].text)
			if ll_value - long(sle_h_inc.text) > 0  then
				isle_rh_h[ll_i].text = string(ll_value - long(sle_h_inc.text), "000")
			end if			
		next
	end if
else			

	if ii_cur_f < 6 then
		ll_i = ii_cur_f
	else
		ll_i = ii_cur_f - 5
	end if
	
	choose case ii_cur_f
		case 1
			ll_h[ll_i] = long(sle_lh_1_h.text)
		case 2
			ll_h[ll_i] = long(sle_lh_2_h.text)
		case 3
			ll_h[ll_i] = long(sle_lh_3_h.text)
		case 4
			ll_h[ll_i] = long(sle_lh_4_h.text)
		case 5
			ll_h[ll_i] = long(sle_lh_5_h.text)
		case 6
			ll_h[ll_i] = long(sle_rh_1_h.text)
		case 7
			ll_h[ll_i] = long(sle_rh_2_h.text)
		case 8
			ll_h[ll_i] = long(sle_rh_3_h.text)
		case 9
			ll_h[ll_i] = long(sle_rh_4_h.text)
		case 10
			ll_h[ll_i] = long(sle_rh_5_h.text)
	end choose		
	
	if ll_h[ll_i] - long(sle_h_inc.text) <= 0 then return
	
	ll_h[ll_i] = ll_h[ll_i] - long(sle_h_inc.text)
				
	choose case ii_cur_f
		case 1
			sle_lh_1_h.text = string(ll_h[1], "000")
		case 2
			sle_lh_2_h.text = string(ll_h[2], "000")
		case 3
			sle_lh_3_h.text = string(ll_h[3], "000")
		case 4
			sle_lh_4_h.text = string(ll_h[4], "000")
		case 5
			sle_lh_5_h.text = string(ll_h[5], "000")
		case 6
			sle_rh_1_h.text = string(ll_h[1], "000")
		case 7
			sle_rh_2_h.text = string(ll_h[2], "000")
		case 8
			sle_rh_3_h.text = string(ll_h[3], "000")
		case 9
			sle_rh_4_h.text = string(ll_h[4], "000")
		case 10
			sle_rh_5_h.text = string(ll_h[5], "000")
	end choose
end if

if cb_draw.enabled then
	cb_draw.post event clicked()
end if


end event

type pb_13 from picturebutton within w_music_composer_fingering
integer x = 5577
integer y = 860
integer width = 101
integer height = 84
integer taborder = 230
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom033!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
long ll_w[5], ll_i, ll_value

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_lh_w[ll_i].text)
			if ll_value + long(sle_w_inc.text) < 1000 then
				isle_lh_w[ll_i].text = string(ll_value + long(sle_w_inc.text), "000")
			end if			
		next
	end if
	if cbx_append_right_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_rh_w[ll_i].text)			
			if ll_value + long(sle_w_inc.text) < 1000 then
				isle_rh_w[ll_i].text = string(ll_value + long(sle_w_inc.text), "000")
			end if			
		next
	end if
else			

	if ii_cur_f < 6 then
		ll_i = ii_cur_f
	else
		ll_i = ii_cur_f - 5
	end if
	
	choose case ii_cur_f
		case 1
			ll_w[ll_i] = long(sle_lh_1_w.text)
		case 2
			ll_w[ll_i] = long(sle_lh_2_w.text)
		case 3
			ll_w[ll_i] = long(sle_lh_3_w.text)
		case 4
			ll_w[ll_i] = long(sle_lh_4_w.text)
		case 5
			ll_w[ll_i] = long(sle_lh_5_w.text)
		case 6
			ll_w[ll_i] = long(sle_rh_1_w.text)
		case 7
			ll_w[ll_i] = long(sle_rh_2_w.text)
		case 8
			ll_w[ll_i] = long(sle_rh_3_w.text)
		case 9
			ll_w[ll_i] = long(sle_rh_4_w.text)
		case 10
			ll_w[ll_i] = long(sle_rh_5_w.text)
	end choose		
			
	if ll_w[ll_i] + long(sle_w_inc.text) >= 1000 then return
		
	ll_w[ll_i] = ll_w[ll_i] + long(sle_w_inc.text)
	choose case ii_cur_f
		case 1
			sle_lh_1_w.text = string(ll_w[1], "000")
		case 2
			sle_lh_2_w.text = string(ll_w[2], "000")
		case 3
			sle_lh_3_w.text = string(ll_w[3], "000")
		case 4
			sle_lh_4_w.text = string(ll_w[4], "000")
		case 5
			sle_lh_5_w.text = string(ll_w[5], "000")
		case 6
			sle_rh_1_w.text = string(ll_w[1], "000")
		case 7
			sle_rh_2_w.text = string(ll_w[2], "000")
		case 8
			sle_rh_3_w.text = string(ll_w[3], "000")
		case 9
			sle_rh_4_w.text = string(ll_w[4], "000")
		case 10
			sle_rh_5_w.text = string(ll_w[5], "000")
	end choose
end if

if cb_draw.enabled then
	cb_draw.post event clicked()
end if


end event

type pb_12 from picturebutton within w_music_composer_fingering
integer x = 5577
integer y = 940
integer width = 101
integer height = 84
integer taborder = 160
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom034!"
alignment htextalign = left!
end type

event clicked;// down size
long ll_w[5], ll_i, ll_value

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_lh_w[ll_i].text)
			if ll_value - long(sle_w_inc.text) > 0 then
				isle_lh_w[ll_i].text = string(ll_value - long(sle_w_inc.text), "000")
			end if			
		next
	end if
	if cbx_append_right_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_rh_w[ll_i].text)
			if ll_value - long(sle_w_inc.text) > 0 then
				isle_rh_w[ll_i].text = string(ll_value - long(sle_w_inc.text), "000")
			end if			
		next
	end if
else			

	if ii_cur_f < 6 then
		ll_i = ii_cur_f
	else
		ll_i = ii_cur_f - 5
	end if
	
	choose case ii_cur_f
		case 1
			ll_w[ll_i] = long(sle_lh_1_w.text)
		case 2
			ll_w[ll_i] = long(sle_lh_2_w.text)
		case 3
			ll_w[ll_i] = long(sle_lh_3_w.text)
		case 4
			ll_w[ll_i] = long(sle_lh_4_w.text)
		case 5
			ll_w[ll_i] = long(sle_lh_5_w.text)
		case 6
			ll_w[ll_i] = long(sle_rh_1_w.text)
		case 7
			ll_w[ll_i] = long(sle_rh_2_w.text)
		case 8
			ll_w[ll_i] = long(sle_rh_3_w.text)
		case 9
			ll_w[ll_i] = long(sle_rh_4_w.text)
		case 10
			ll_w[ll_i] = long(sle_rh_5_w.text)
	end choose		
			
	if ll_w[ll_i] - long(sle_w_inc.text) <= 0 then return
	ll_w[ll_i] = ll_w[ll_i] - long(sle_w_inc.text)
	
	choose case ii_cur_f
		case 1
			sle_lh_1_w.text = string(ll_w[1], "000")
		case 2
			sle_lh_2_w.text = string(ll_w[2], "000")
		case 3
			sle_lh_3_w.text = string(ll_w[3], "000")
		case 4
			sle_lh_4_w.text = string(ll_w[4], "000")
		case 5
			sle_lh_5_w.text = string(ll_w[5], "000")
		case 6
			sle_rh_1_w.text = string(ll_w[1], "000")
		case 7
			sle_rh_2_w.text = string(ll_w[2], "000")
		case 8
			sle_rh_3_w.text = string(ll_w[3], "000")
		case 9
			sle_rh_4_w.text = string(ll_w[4], "000")
		case 10
			sle_rh_5_w.text = string(ll_w[5], "000")
	end choose
end if

if cb_draw.enabled then
	cb_draw.post event clicked()
end if


end event

type pb_11 from picturebutton within w_music_composer_fingering
integer x = 5417
integer y = 860
integer width = 101
integer height = 84
integer taborder = 140
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom033!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
long ll_y[5], ll_i, ll_value

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_lh_y[ll_i].text)
			if ll_value - long(sle_y_inc.text) > 0 then
				isle_lh_y[ll_i].text = string(ll_value - long(sle_y_inc.text), "00")
			end if			
		next
	end if
	if cbx_append_right_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_rh_y[ll_i].text)
			if ll_value - long(sle_y_inc.text) > 0 then
				isle_rh_y[ll_i].text = string(ll_value - long(sle_y_inc.text), "00")
			end if			
		next
	end if
else			
	if ii_cur_f < 6 then
		ll_i = ii_cur_f
	else
		ll_i = ii_cur_f - 5
	end if
	
	choose case ii_cur_f
		case 1
			ll_y[ll_i] = long(sle_lh_1_y.text)
		case 2
			ll_y[ll_i] = long(sle_lh_2_y.text)
		case 3
			ll_y[ll_i] = long(sle_lh_3_y.text)
		case 4
			ll_y[ll_i] = long(sle_lh_4_y.text)
		case 5
			ll_y[ll_i] = long(sle_lh_5_y.text)
		case 6
			ll_y[ll_i] = long(sle_rh_1_y.text)
		case 7
			ll_y[ll_i] = long(sle_rh_2_y.text)
		case 8
			ll_y[ll_i] = long(sle_rh_3_y.text)
		case 9
			ll_y[ll_i] = long(sle_rh_4_y.text)
		case 10
			ll_y[ll_i] = long(sle_rh_5_y.text)
	end choose		
			
	if ll_y[ll_i] - long(sle_y_inc.text) > 0 then return
	
	ll_y[ll_i] = ll_y[ll_i] - long(sle_y_inc.text)
				
	choose case ii_cur_f
		case 1
			sle_lh_1_y.text = string(ll_y[1], "00")
		case 2
			sle_lh_2_y.text = string(ll_y[2], "00")
		case 3
			sle_lh_3_y.text = string(ll_y[3], "00")
		case 4
			sle_lh_4_y.text = string(ll_y[4], "00")
		case 5
			sle_lh_5_y.text = string(ll_y[5], "00")
		case 6
			sle_rh_1_y.text = string(ll_y[1], "00")
		case 7
			sle_rh_2_y.text = string(ll_y[2], "00")
		case 8
			sle_rh_3_y.text = string(ll_y[3], "00")
		case 9
			sle_rh_4_y.text = string(ll_y[4], "00")
		case 10
			sle_rh_5_y.text = string(ll_y[5], "00")
	end choose
end if
if cb_draw.enabled then
	cb_draw.post event clicked()
end if





end event

type pb_10 from picturebutton within w_music_composer_fingering
integer x = 5417
integer y = 944
integer width = 101
integer height = 84
integer taborder = 150
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom034!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
long ll_y[5], ll_i, ll_value

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_lh_y[ll_i].text)
			if ll_value + long(sle_y_inc.text) <= 100 then
				isle_lh_y[ll_i].text = string(ll_value + long(sle_y_inc.text), "00")
			end if			
		next
	end if
	if cbx_append_right_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_rh_y[ll_i].text)
			if ll_value + long(sle_y_inc.text) <= 100 then
				isle_rh_y[ll_i].text = string(ll_value + long(sle_y_inc.text), "00")
			end if			
		next
	end if
else			
	if ii_cur_f < 6 then
		ll_i = ii_cur_f
	else
		ll_i = ii_cur_f - 5
	end if
	
	choose case ii_cur_f
		case 1
			ll_y[ll_i] = long(sle_lh_1_y.text)
		case 2
			ll_y[ll_i] = long(sle_lh_2_y.text)
		case 3
			ll_y[ll_i] = long(sle_lh_3_y.text)
		case 4
			ll_y[ll_i] = long(sle_lh_4_y.text)
		case 5
			ll_y[ll_i] = long(sle_lh_5_y.text)
		case 6
			ll_y[ll_i] = long(sle_rh_1_y.text)
		case 7
			ll_y[ll_i] = long(sle_rh_2_y.text)
		case 8
			ll_y[ll_i] = long(sle_rh_3_y.text)
		case 9
			ll_y[ll_i] = long(sle_rh_4_y.text)
		case 10
			ll_y[ll_i] = long(sle_rh_5_y.text)
	end choose		
			
	if ll_y[ll_i] + long(sle_y_inc.text) <= 100 then return
	
	ll_y[ll_i] = ll_y[ll_i] + long(sle_y_inc.text)
				
	choose case ii_cur_f
		case 1
			sle_lh_1_y.text = string(ll_y[1], "00")
		case 2
			sle_lh_2_y.text = string(ll_y[2], "00")
		case 3
			sle_lh_3_y.text = string(ll_y[3], "00")
		case 4
			sle_lh_4_y.text = string(ll_y[4], "00")
		case 5
			sle_lh_5_y.text = string(ll_y[5], "00")
		case 6
			sle_rh_1_y.text = string(ll_y[1], "00")
		case 7
			sle_rh_2_y.text = string(ll_y[2], "00")
		case 8
			sle_rh_3_y.text = string(ll_y[3], "00")
		case 9
			sle_rh_4_y.text = string(ll_y[4], "00")
		case 10
			sle_rh_5_y.text = string(ll_y[5], "00")
	end choose
end if
if cb_draw.enabled then
	cb_draw.post event clicked()
end if





end event

type pb_9 from picturebutton within w_music_composer_fingering
integer x = 5257
integer y = 860
integer width = 101
integer height = 84
integer taborder = 220
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom033!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
long ll_x[5], ll_i, ll_value

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_lh_x[ll_i].text)
			if ll_value + long(sle_x_inc.text) < 100 then
				isle_lh_x[ll_i].text = string(ll_value + long(sle_x_inc.text), "00")
			end if			
		next
	end if
	if cbx_append_right_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_rh_x[ll_i].text)
			if ll_value + long(sle_x_inc.text) < 100 then
				isle_rh_x[ll_i].text = string(ll_value + long(sle_x_inc.text), "00")
			end if			
		next
	end if
else			
	if ii_cur_f < 6 then
		ll_i = ii_cur_f
	else
		ll_i = ii_cur_f - 5
	end if
	
	choose case ii_cur_f
		case 1
			ll_x[ll_i] = long(sle_lh_1_x.text)
		case 2
			ll_x[ll_i] = long(sle_lh_2_x.text)
		case 3
			ll_x[ll_i] = long(sle_lh_3_x.text)
		case 4
			ll_x[ll_i] = long(sle_lh_4_x.text)
		case 5
			ll_x[ll_i] = long(sle_lh_5_x.text)
		case 6
			ll_x[ll_i] = long(sle_rh_1_x.text)
		case 7
			ll_x[ll_i] = long(sle_rh_2_x.text)
		case 8
			ll_x[ll_i] = long(sle_rh_3_x.text)
		case 9
			ll_x[ll_i] = long(sle_rh_4_x.text)
		case 10
			ll_x[ll_i] = long(sle_rh_5_x.text)
	end choose		
			
			
			
	if (ll_x[ll_i]  + long(sle_x_inc.text)) >= 100 then return
	
	ll_x[ll_i] = ll_x[ll_i] + long(sle_x_inc.text)
				
	choose case ii_cur_f
		case 1
			sle_lh_1_x.text = string(ll_x[1], "00")
		case 2
			sle_lh_2_x.text = string(ll_x[2], "00")
		case 3
			sle_lh_3_x.text = string(ll_x[3], "00")
		case 4
			sle_lh_4_x.text = string(ll_x[4], "00")
		case 5
			sle_lh_5_x.text = string(ll_x[5], "00")
		case 6
			sle_rh_1_x.text = string(ll_x[1], "00")
		case 7
			sle_rh_2_x.text = string(ll_x[2], "00")
		case 8
			sle_rh_3_x.text = string(ll_x[3], "00")
		case 9
			sle_rh_4_x.text = string(ll_x[4], "00")
		case 10
			sle_rh_5_x.text = string(ll_x[5], "00")
	end choose
end if
if cb_draw.enabled then
	cb_draw.post event clicked()
end if


end event

type pb_8 from picturebutton within w_music_composer_fingering
integer x = 5257
integer y = 944
integer width = 101
integer height = 84
integer taborder = 140
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom034!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
long ll_x[5], ll_i, ll_value

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_lh_x[ll_i].text)
			if ll_value - long(sle_x_inc.text) > 0 then
				isle_lh_x[ll_i].text = string(ll_value - long(sle_x_inc.text), "00")
			end if			
		next
	end if
	if cbx_append_right_hand.checked then
		for ll_i = 1 to 5
			ll_value = long(isle_rh_x[ll_i].text)
			if ll_value - long(sle_x_inc.text) > 0 then
				isle_rh_x[ll_i].text = string(ll_value - long(sle_x_inc.text), "00")
			end if			
		next
	end if
else			

	if ii_cur_f < 6 then
		ll_i = ii_cur_f
	else
		ll_i = ii_cur_f - 5
	end if
	
	choose case ii_cur_f
		case 1
			ll_x[ll_i] = long(sle_lh_1_x.text)
		case 2
			ll_x[ll_i] = long(sle_lh_2_x.text)
		case 3
			ll_x[ll_i] = long(sle_lh_3_x.text)
		case 4
			ll_x[ll_i] = long(sle_lh_4_x.text)
		case 5
			ll_x[ll_i] = long(sle_lh_5_x.text)
		case 6
			ll_x[ll_i] = long(sle_rh_1_x.text)
		case 7
			ll_x[ll_i] = long(sle_rh_2_x.text)
		case 8
			ll_x[ll_i] = long(sle_rh_3_x.text)
		case 9
			ll_x[ll_i] = long(sle_rh_4_x.text)
		case 10
			ll_x[ll_i] = long(sle_rh_5_x.text)
	end choose		
			
	if ll_x[ll_i] - long(sle_x_inc.text) <= 0 then return
	
	ll_x[ll_i] = ll_x[ll_i] - long(sle_x_inc.text)
				
	choose case ii_cur_f
		case 1
			sle_lh_1_x.text = string(ll_x[1], "00")
		case 2
			sle_lh_2_x.text = string(ll_x[2], "00")
		case 3
			sle_lh_3_x.text = string(ll_x[3], "00")
		case 4
			sle_lh_4_x.text = string(ll_x[4], "00")
		case 5
			sle_lh_5_x.text = string(ll_x[5], "00")
		case 6
			sle_rh_1_x.text = string(ll_x[1], "00")
		case 7
			sle_rh_2_x.text = string(ll_x[2], "00")
		case 8
			sle_rh_3_x.text = string(ll_x[3], "00")
		case 9
			sle_rh_4_x.text = string(ll_x[4], "00")
		case 10
			sle_rh_5_x.text = string(ll_x[5], "00")
	end choose
end if
if cb_draw.enabled then
	cb_draw.post event clicked()
end if


end event

type pb_7 from picturebutton within w_music_composer_fingering
integer x = 5106
integer y = 944
integer width = 101
integer height = 84
integer taborder = 130
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom034!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
long ll_note[5], ll_i

if ii_cur_f < 6 then
	ll_i = ii_cur_f
else
	ll_i = ii_cur_f - 5
end if

choose case ii_cur_f
	case 1
		ll_note[ll_i] = long(sle_lh_1_note.text)
	case 2
		ll_note[ll_i] = long(sle_lh_2_note.text)
	case 3
		ll_note[ll_i] = long(sle_lh_3_note.text)
	case 4
		ll_note[ll_i] = long(sle_lh_4_note.text)
	case 5
		ll_note[ll_i] = long(sle_lh_5_note.text)
	case 6
		ll_note[ll_i] = long(sle_rh_1_note.text)
	case 7
		ll_note[ll_i] = long(sle_rh_2_note.text)
	case 8
		ll_note[ll_i] = long(sle_rh_3_note.text)
	case 9
		ll_note[ll_i] = long(sle_rh_4_note.text)
	case 10
		ll_note[ll_i] = long(sle_rh_5_note.text)
end choose		
		
if IsNaturalNote(ll_note[ll_i]) then // Is a natural note, find the previous natural note
	ll_note[ll_i]--
	if not IsNaturalNote(ll_note[ll_i]) then ll_note[ll_i]--
else	// Not a natural note
	if not IsNaturalNote(ll_note[ll_i] - 2) then // there is a sharp note in a down skip, land on it
		ll_note[ll_i] = ll_note[ll_i] - 2
	else	// there is NO sharp in a down skip, land on previous note
		ll_note[ll_i]--
	end if
end if
		
choose case ii_cur_f
	case 1
		sle_lh_1_note.text = string(ll_note[1], "000")
		sle_lh_1_note.event modified()
	case 2
		sle_lh_2_note.text = string(ll_note[2], "000")
		sle_lh_2_note.event modified()
	case 3
		sle_lh_3_note.text = string(ll_note[3], "000")
		sle_lh_3_note.event modified()
	case 4
		sle_lh_4_note.text = string(ll_note[4], "000")
		sle_lh_4_note.event modified()
	case 5
		sle_lh_5_note.text = string(ll_note[5], "000")
		sle_lh_5_note.event modified()
	case 6
		sle_rh_1_note.text = string(ll_note[1], "000")
		sle_rh_1_note.event modified()
	case 7
		sle_rh_2_note.text = string(ll_note[2], "000")
		sle_rh_2_note.event modified()
	case 8
		sle_rh_3_note.text = string(ll_note[3], "000")
		sle_rh_3_note.event modified()
	case 9
		sle_rh_4_note.text = string(ll_note[4], "000")
		sle_rh_4_note.event modified()
	case 10
		sle_rh_5_note.text = string(ll_note[5], "000")
		sle_rh_5_note.event modified()			
end choose

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type pb_6 from picturebutton within w_music_composer_fingering
integer x = 5106
integer y = 860
integer width = 101
integer height = 84
integer taborder = 130
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom033!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
long ll_note[5], ll_i


//cbx_all_finger
//cbx_append_left_hand
//cbx_append_right_hand

if ii_cur_f < 6 then
	ll_i = ii_cur_f
else
	ll_i = ii_cur_f - 5
end if

choose case ii_cur_f
	case 1
		ll_note[ll_i] = long(sle_lh_1_note.text)
	case 2
		ll_note[ll_i] = long(sle_lh_2_note.text)
	case 3
		ll_note[ll_i] = long(sle_lh_3_note.text)
	case 4
		ll_note[ll_i] = long(sle_lh_4_note.text)
	case 5
		ll_note[ll_i] = long(sle_lh_5_note.text)
	case 6
		ll_note[ll_i] = long(sle_rh_1_note.text)
	case 7
		ll_note[ll_i] = long(sle_rh_2_note.text)
	case 8
		ll_note[ll_i] = long(sle_rh_3_note.text)
	case 9
		ll_note[ll_i] = long(sle_rh_4_note.text)
	case 10
		ll_note[ll_i] = long(sle_rh_5_note.text)
end choose		
		
if IsNaturalNote(ll_note[ll_i]) then // Is a natural note, find the next natural note
	ll_note[ll_i]++
	if not IsNaturalNote(ll_note[ll_i]) then ll_note[ll_i]++
else	// Not a natural note
	if not IsNaturalNote(ll_note[ll_i] + 2) then // there is a sharp note in a up skip, land on it
		ll_note[ll_i] = ll_note[ll_i] + 2
	else	// there is NO sharp not in a up skip, land on next note
		ll_note[ll_i]++
	end if
end if
			
choose case ii_cur_f
	case 1
		sle_lh_1_note.text = string(ll_note[1], "000")
		sle_lh_1_note.event modified()
	case 2
		sle_lh_2_note.text = string(ll_note[2], "000")
		sle_lh_2_note.event modified()
	case 3
		sle_lh_3_note.text = string(ll_note[3], "000")
		sle_lh_3_note.event modified()
	case 4
		sle_lh_4_note.text = string(ll_note[4], "000")
		sle_lh_4_note.event modified()
	case 5
		sle_lh_5_note.text = string(ll_note[5], "000")
		sle_lh_5_note.event modified()
	case 6
		sle_rh_1_note.text = string(ll_note[1], "000")
		sle_rh_1_note.event modified()
	case 7
		sle_rh_2_note.text = string(ll_note[2], "000")
		sle_rh_2_note.event modified()
	case 8
		sle_rh_3_note.text = string(ll_note[3], "000")
		sle_rh_3_note.event modified()
	case 9
		sle_rh_4_note.text = string(ll_note[4], "000")
		sle_rh_4_note.event modified()
	case 10
		sle_rh_5_note.text = string(ll_note[5], "000")
		sle_rh_5_note.event modified()			
end choose

if cb_draw.enabled then
	cb_draw.post event clicked()
end if


end event

type st_14 from statictext within w_music_composer_fingering
integer x = 5001
integer y = 1720
integer width = 558
integer height = 56
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Lesson Fingering Library"
alignment alignment = center!
boolean focusrectangle = false
end type

type cb_26 from commandbutton within w_music_composer_fingering
integer x = 5006
integer y = 1860
integer width = 841
integer height = 72
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Set Compatible Prefix From PRJ"
end type

event clicked;// copy compatible prefix from project to data file, graphic file, and graphic library

// 1. Get Prefix From Project File
// Project File Path: 
// C:\Users\Hanzhong\Google Drive\Software Business\Piano Teaching Software\Lesson Compiling\Categorized\002 finger exercises 1\Project\0001 practice_lh_c0_g0_01.prj
// Data File Path:
// C:\Users\Hanzhong\Google Drive\Software Business\Piano Teaching Software\Lesson Compiling\Categorized\002 finger exercises 1\Data\0001 practice_lh_c0_g0_01.txt
// Sheet File Path:
// C:\Users\Hanzhong\Google Drive\Software Business\Piano Teaching Software\Lesson Compiling\Categorized\002 finger exercises 1\Sheet\0001 practice_lh_c0_g0_01.png
// Icon File Path:
// C:\Users\Hanzhong\Google Drive\Software Business\Piano Teaching Software\Lesson Compiling\Categorized\002 finger exercises 1\Icon\0001 practice_lh_c0_g0_01.png
// Fingering Library File Path:
// C:\Users\Hanzhong\Google Drive\Software Business\Piano Teaching Software\Lesson Compiling\Categorized\002 finger exercises 1\Fingering Library\0001 practice_lh_c0_g0_01_finger_lib_001.lhi
// C:\Users\Hanzhong\Google Drive\Software Business\Piano Teaching Software\Lesson Compiling\Categorized\002 finger exercises 1\Fingering Library\0001 practice_lh_c0_g0_01_finger_lib_001.lhm

// Get Category Path and  Lesson Name Prefix
string ls_token
integer li_i, li_parent_path_count = 0, li_substring_index1 = 0, li_substring_index2 = 0, li_substring_index3

for li_i = 1 to len(sle_project_file.text)
	ls_token = mid(sle_project_file.text, len(sle_project_file.text) + 1 - li_i, 1)
	if ls_token = "\" then 
		li_parent_path_count++
	end if
	if li_parent_path_count = 1 and li_substring_index1 = 0 then li_substring_index1 = len(sle_project_file.text) + 1 - li_i
	if li_parent_path_count = 2 and li_substring_index2 = 0 then li_substring_index2 = len(sle_project_file.text) + 1 - li_i
	if li_parent_path_count = 3 then
		li_substring_index3 = len(sle_project_file.text) + 1 - li_i
		exit
	end if
next

is_category_path = left(sle_project_file.text,  li_substring_index2 - 1)
is_lesson_name_prefix = right(sle_project_file.text, len(sle_project_file.text) - li_substring_index1)
is_lesson_name_prefix = left(is_lesson_name_prefix, len(is_lesson_name_prefix) - 4)

string ls_category_dir_name, ls_cat_number, ls_cat_name, ls_lesson_number, ls_lesson_name

ls_category_dir_name = right(is_category_path, li_substring_index2 - li_substring_index3 - 1)
ls_cat_number = left(ls_category_dir_name, 3)
ls_cat_name = right(ls_category_dir_name, len(ls_category_dir_name) - 4)
ls_lesson_number = left(is_lesson_name_prefix, 4)
ls_lesson_name = right(is_lesson_name_prefix, len(is_lesson_name_prefix) - 5)
is_lesson_output_prefix = ls_cat_number + ls_lesson_number + " " + ls_cat_name + " - " + ls_lesson_name

//MessageBox("is_lesson_output_prefix", is_lesson_output_prefix)

// Get Data File Path and Copy File if current path is different existing path
string ls_data_file_path 
ls_data_file_path = is_category_path + "\Data\" + is_lesson_name_prefix + ".txt"
//MessageBox("ls_data_file_path", ls_data_file_path)
if ls_data_file_path <> sle_dw_path.text then
	if FileExists(sle_dw_path.text) then
		if FileExists(ls_data_file_path) then
			 If MessageBox("Warning", "File: " + is_lesson_name_prefix + ".txt EXISTS, Do you want to overwrite it?", Question!, YesNo!) = 1 then 
				FileDelete(ls_data_file_path)
				FileCopy(sle_dw_path.text, ls_data_file_path)
			end if
		else
			FileCopy(sle_dw_path.text, ls_data_file_path)
		end if
	end if
	sle_dw_path.text = ls_data_file_path
end if

if  FileExists(sle_dw_path.text) then
	cb_restore_dw.event clicked()
end if

// Get Sheet File Path
string ls_sheet_file_path 
boolean lb_copy = true
ls_sheet_file_path = is_category_path + "\Sheet\" + is_lesson_name_prefix + ".png"
if FileExists(sle_file_name.text) then
	if FileExists(ls_sheet_file_path) then
		 If MessageBox("Warning", "File: " + is_lesson_name_prefix + ".png EXISTS, Do you want to overwrite it?", Question!, YesNo!) = 1 then 
			FileDelete(ls_sheet_file_path)
		else
			lb_copy = false
		end if
	end if
	if lb_copy then
		if pos(lower(sle_file_name.text), ".png") > 0 then 
			FileCopy(sle_file_name.text, ls_sheet_file_path)
		else
			ConvertGraphFile(sle_file_name.text, ls_sheet_file_path)
		end if
		sle_file_name.text = ls_sheet_file_path
	end if
end if
if FileExists(sle_file_name.text) then
	wf_display_music_sheet()
else
	MessageBox("Warning", "Music Sheet Is Not Available")
end if

// Get Fingering Library File Path
string ls_fingering_libary_file_path
ls_fingering_libary_file_path = is_category_path + "\Fingering Library\" + is_lesson_name_prefix + "_finger_lib_001"
sle_dest_lib.text = ls_fingering_libary_file_path
//sle_dest_lib.text = left(sle_dw_path.text, len(sle_dw_path.text) - 4) + "_finger_lib_001"

end event

type cb_25 from commandbutton within w_music_composer_fingering
integer x = 5006
integer y = 1624
integer width = 718
integer height = 72
integer taborder = 130
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Copy Source Fingering Lib"
end type

event clicked;
If FileExists(sle_dest_lib.text + ".lhm") then
	if MessageBox("Confirmation", "Do you want to overwrite the existing files?", Question!, YesNo!) = 2 then return
end if
FileCopy ( sle_source_lib.text + ".lhm", sle_dest_lib.text + ".lhm", true)
FileCopy ( sle_source_lib.text + ".lhi", sle_dest_lib.text + ".lhi", true)
end event

type cb_24 from commandbutton within w_music_composer_fingering
integer x = 5723
integer y = 1776
integer width = 128
integer height = 80
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Lib"
end type

event clicked;any la_tmp, la_null

gn_appman.of_set_parm("Fingering Parent Window", parent)

gn_appman.of_set_parm("Fingering Library File", sle_dest_lib.text)

gn_appman.of_set_parm("Fingering Library Type", "INPUT")

if cbx_append_left_hand.checked then
	gn_appman.of_set_parm("Fingering Library For Hand", "LEFT")
else
	gn_appman.of_set_parm("Fingering Library For Hand", "RIGHT")
end if

gn_appman.of_get_parm("Listview Handle", la_tmp)

open(w_fingering_lib_list)

return


end event

type cb_23 from commandbutton within w_music_composer_fingering
integer x = 5623
integer y = 1776
integer width = 101
integer height = 80
integer taborder = 220
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = ".."
end type

event clicked;integer li_i, li_j, li_seq, li_begin, li_pos, li_len, li_value
string ls_tmp, ls_line, ls_Docname, ls_named, ls_path, ls_cur_dir, ls_bmp = "tttmmmppp.bmp"
long graphW, graphH

//ls_Docname = "c:\tmp\123"
ls_cur_dir = GetCurrentDirectory()
li_j = 0
for li_i = 1 to len(sle_dest_lib.text)
	if mid(sle_dest_lib.text, len(sle_dest_lib.text) + 1 - li_i, 1) = "\" then exit
	li_j++
next

if li_j < len(sle_dest_lib.text) then
	ls_path = left(sle_dest_lib.text, len(sle_dest_lib.text) - li_j)
else
	ls_path = ".\"
end if
ChangeDirectory(ls_path)
li_value = GetFileOpenName("Select Input Fingering Library File", ls_Docname, ls_named, "LHM", "LHM File (*.LHM),*.LHM,")
ChangeDirectory(ls_cur_dir)
if li_value = 1 then
	sle_dest_lib.text = left(ls_Docname, len(ls_Docname) - 4)
end if

ChangeDirectory(ls_cur_dir)

end event

type sle_dest_lib from singlelineedit within w_music_composer_fingering
integer x = 5001
integer y = 1776
integer width = 626
integer height = 76
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type cb_input_lib from commandbutton within w_music_composer_fingering
integer x = 5737
integer y = 1544
integer width = 128
integer height = 80
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Lib"
end type

event clicked;any la_tmp, la_null

gn_appman.of_set_parm("Fingering Parent Window", parent)

gn_appman.of_set_parm("Fingering Library File", sle_source_lib.text)

gn_appman.of_set_parm("Fingering Library Type", "INPUT")

if cbx_append_left_hand.checked then
	gn_appman.of_set_parm("Fingering Library For Hand", "LEFT")
else
	gn_appman.of_set_parm("Fingering Library For Hand", "RIGHT")
end if

open(w_fingering_lib_list)

return


end event

type cb_20 from commandbutton within w_music_composer_fingering
integer x = 5632
integer y = 1544
integer width = 101
integer height = 80
integer taborder = 60
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = ".."
end type

event clicked;integer li_i, li_j, li_seq, li_begin, li_pos, li_len, li_value
string ls_tmp, ls_line, ls_Docname, ls_named, ls_path, ls_cur_dir, ls_bmp = "tttmmmppp.bmp"
long graphW, graphH

//ls_Docname = "c:\tmp\123"
ls_cur_dir = GetCurrentDirectory()
li_j = 0
for li_i = 1 to len(sle_source_lib.text)
	if mid(sle_source_lib.text, len(sle_source_lib.text) + 1 - li_i, 1) = "\" then exit
	li_j++
next

if li_j < len(sle_source_lib.text) then
	ls_path = left(sle_source_lib.text, len(sle_source_lib.text) - li_j)
else
	ls_path = ".\"
end if
ChangeDirectory(ls_path)
li_value = GetFileOpenName("Select Input Fingering Library File", ls_Docname, ls_named, "LHM", "LHM File (*.LHM),*.LHM,")
ChangeDirectory(ls_cur_dir)
if li_value = 1 then
	sle_source_lib.text = left(ls_Docname, len(ls_Docname) - 4)
end if

ChangeDirectory(ls_cur_dir)

end event

type sle_source_lib from singlelineedit within w_music_composer_fingering
integer x = 5001
integer y = 1548
integer width = 626
integer height = 76
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type cb_19 from commandbutton within w_music_composer_fingering
integer x = 393
integer y = 88
integer width = 96
integer height = 64
integer taborder = 60
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Seq."
end type

event clicked;integer li_seq
for li_seq = 1 to dw_1.RowCount()
	dw_1.SetItem(li_seq, "seq", li_seq*10)
next

if dw_1.RowCount() > 1 then
	ii_current_row = 2
elseif dw_1.RowCount() > 0 then 
	ii_current_row = 1
end if
if ii_current_row > 0 then
	dw_1.SelectRow(0, false)
	dw_1.SelectRow(ii_current_row, true)					
end if
end event

type cb_delete_row from commandbutton within w_music_composer_fingering
integer x = 425
integer y = 156
integer width = 256
integer height = 72
integer taborder = 140
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Delete Row"
end type

event clicked;integer li_seq
if ii_current_row > 0 then
	dw_1.DeleteRow(ii_current_row)
	if ii_current_row <= dw_1.RowCount() then
		dw_1.SelectRow(0, false)
		dw_1.SelectRow(ii_current_row, true)		
	else
		if dw_1.RowCount() > 0 then
			ii_current_row = ii_current_row - 1
			dw_1.SelectRow(0, false)
			dw_1.SelectRow(ii_current_row, true)					
		end if
	end if
//	ids_1.Reset()
//	dw_1.RowsCopy(1, dw_1.RowCount(), Primary!, ids_1, 1, Primary!)		
end if


end event

type cb_get_list from commandbutton within w_music_composer_fingering
integer x = 503
integer y = 476
integer width = 187
integer height = 72
integer taborder = 70
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Get List"
end type

event clicked;//integer li_i, li_row_count
//li_row_count = dw_1.RowCount()
//
//for li_i = 1 to li_row_count
//	dw_1.SetItem(li_i, "seq", li_i*10)
//next

Parent.SetRedraw(false)
if cbx_1.checked then
	cbx_1.checked = false
	cbx_1.event clicked()
	
	wf_get_note_list()
	wf_get_rh_lh_note_list()
	
	cbx_1.checked = true
	cbx_1.event clicked()
else
	wf_get_note_list()	
end if

if ii_current_row > 0 and ii_current_row <= dw_1.RowCount() then
	dw_1.ScrollToRow(ii_current_row)
	dw_1.SelectRow(0, false)
	dw_1.SelectRow(ii_current_row, true)
end if
 


Parent.SetRedraw(true)

end event

type cb_dup_row from commandbutton within w_music_composer_fingering
integer x = 489
integer y = 84
integer width = 192
integer height = 72
integer taborder = 90
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Dup Row"
end type

event clicked;integer li_seq
if ii_current_row = 0 then
	li_seq = 10
else
	li_seq = dw_1.GetItemNumber(ii_current_row, "seq") + 1
end if
ii_current_row = dw_1.InsertRow(ii_current_row + 1)
if ii_current_row < dw_1.RowCount()then
	dw_1.object.data[ii_current_row] = dw_1.object.data[ii_current_row + 1]
end if
dw_1.SetItem(ii_current_row, "seq", li_seq)
dw_1.SelectRow(0, false)
dw_1.SelectRow(ii_current_row, true)
//ids_1.Reset()
//dw_1.RowsCopy(1, dw_1.RowCount(), Primary!, ids_1, 1, Primary!)
end event

type cb_capture_image from commandbutton within w_music_composer_fingering
boolean visible = false
integer y = 88
integer width = 379
integer height = 72
integer taborder = 130
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Capture Image"
end type

event clicked;long ll_i, ll_width, ll_height, ll_dc
string ls_file_name, ls_time_stamp, ls_prefix
DateTime ldt_tmp
dwobject dwo
integer li_i, li_j
long ll_file_size, ll_seq
string ls_token, ls_seq_list = ""


is_res_file_name = "" 

for li_i = 1 to len(sle_dw_path.text)
	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
	if ls_token = "\" then exit
	is_res_file_name = ls_token + is_res_file_name 
next

is_res_file_name = left(is_res_file_name, len(is_res_file_name) - 4) + "_kb_pane_images"

ldt_tmp = DateTime(today(), now())

ls_time_stamp = string(ldt_tmp)

ll_width = UnitsToPixels(p_1.width, XUnitsToPixels!)
ll_height = UnitsToPixels(p_1.height, YUnitsToPixels!)

//prefix for image item name
if not cbx_key_only.checked then // fingering prompt
	ls_prefix = "fingering_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
else										// key only prompt
	ls_prefix = "key_only_prompt"
	if cbx_append_right_hand.checked and cbx_append_left_hand.checked then
		ls_prefix = ls_prefix + "_both_"
	elseif cbx_append_right_hand.checked then
		ls_prefix = ls_prefix + "_right_"
	else
		ls_prefix = ls_prefix + "_left_"
	end if
end if

// we need to stop image flashing during image capturing
extTransFinger(NONE_ANIMATION_MODE)

if cbx_activate_animation.checked then	// cbx_activate_animation checkbox is used to capture the image of key release in image flashing-animating
	extTransFinger(KEY_RELEASED_MODE)
else
	extTransFinger(KEY_PRESSED_MODE)
end if

ll_dc = GetDC(handle(p_1))

for ll_i = 2 to dw_1.RowCount()
//for ll_i = 2 to 5
	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
	if cbx_activate_animation.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = ls_prefix + string(1000000 + ll_seq) + ".png"
		else
			continue
		end if
	else
		ls_file_name = ls_prefix + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
	end if
	dw_1.event clicked(0,0,ll_i,dwo)
	dw_1.event doubleclicked(0,0,ll_i,dwo)
	Yield()
	sleep(2)
	CaptureImageRegion(ll_dc, ls_file_name, 0, 0, ll_width, ll_height)	
	ll_file_size = FileLength(ls_file_name)
	extPutImageFile(is_res_file_name + ".lhi", is_res_file_name + ".lhm", ls_file_name, ls_file_name, ls_time_stamp, ll_file_size)	
//	if cbx_delete_tmp_img.checked then	
//		FileDelete(ls_file_name)
//	else
		if not DirectoryExists("images\" + is_res_file_name) then CreateDirectory("images\" + is_res_file_name)
		If FileExists("images\" + is_res_file_name + "\" + ls_file_name) then FileDelete("images\" + is_res_file_name + "\" + ls_file_name)
//		FileMove(ls_file_name, is_res_file_name + "_" + ls_file_name)
		FileMove(ls_file_name, "images\" + is_res_file_name + "\" + ls_file_name)
//	end if
next

extTransFinger(KEY_PRESSED_MODE)

//long ll_i, ll_width, ll_height, ll_dc
//string ls_file_name, ls_time_stamp
//DateTime ldt_tmp
//dwobject dwo
//integer li_i, li_j
//long ll_file_size, ll_seq
//string ls_res_file_name = "", ls_token, ls_seq_list = ""
//
////	ls_file_name = "C:\Users\hzhang\AppData\Local\Temp\" + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
//
//if not cbx_append_left_hand.checked and not cbx_append_right_hand.checked then
//	MessageBox("Error", "No Hand Selected, Cannot Capture Images!")
//	return
//end if
//
//for li_i = 1 to len(sle_dw_path.text)
//	ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
//	if ls_token = "\" then exit
//	ls_res_file_name = ls_token + ls_res_file_name 
//next
//
//ldt_tmp = DateTime(today(), now())
//
//ls_time_stamp = string(ldt_tmp)
//
//ll_width = UnitsToPixels(p_1.width, XUnitsToPixels!)
//ll_height = UnitsToPixels(p_1.height, YUnitsToPixels!)
//ls_res_file_name = left(ls_res_file_name, len(ls_res_file_name) - 4) + "_fingering_image"
//
//if not cbx_append_right_hand.checked then
//	ls_res_file_name = ls_res_file_name + "_left"
//elseif not cbx_append_left_hand.checked then
//	ls_res_file_name = ls_res_file_name + "_right"
//end if
//
//if cbx_activate_animation.checked then
//	if (not FileExists(ls_res_file_name + ".lhi")) or (not FileExists(ls_res_file_name + ".lhm")) then
//		MessageBox("Error", "Create None Active Animation First!")
//		return 0
//	else
//		if extGetImageFile(ls_res_file_name + ".lhi", ls_res_file_name +  ".lhm", "1000020", "ttmmpp.dummy") = 1 then
//			MessageBox("Error", "Animation Images Existing, Cannot Create Them!")				
//			return 0
//		end if
//	end if
//else
//	extCreateResourceFile(ls_res_file_name + ".lhi", ls_res_file_name + ".lhm")
//end if
//
//// we need to stop image flashing during image capturing
//extTransFinger(NONE_ANIMATION_MODE)
//
//if cbx_activate_animation.checked then	// cbx_activate_animation checkbox is used to capture the image of key release in image flashing-animating
//	extTransFinger(KEY_RELEASED_MODE)
//else
//	extTransFinger(KEY_PRESSED_MODE)
//end if
//
//ll_dc = GetDC(handle(p_1))
//
////ls_seq_list
//for ll_i = 2 to dw_1.RowCount()
//	ls_seq_list = ls_seq_list + string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000")
//next
//
//extPutImage(ls_res_file_name + ".lhi", ls_res_file_name + ".lhm", "SEQUENCE_NUMBER", ls_seq_list, ls_time_stamp, len(ls_seq_list))	
//
//for ll_i = 2 to dw_1.RowCount()
////for ll_i = 2 to 5
//	ll_seq = dw_1.GetItemNumber(ll_i,"SEQ")
//	if cbx_activate_animation.checked then
//		if mod(ll_seq, 10) = 0 then // the active fingering entry
//			ls_file_name = string(1000000 + ll_seq) + ".png"
//		else
//			continue
//		end if
//	else
//		ls_file_name = string(dw_1.GetItemNumber(ll_i,"SEQ"), "000000") + ".png"
//	end if
//	dw_1.event clicked(0,0,ll_i,dwo)
//	dw_1.event doubleclicked(0,0,ll_i,dwo)
//	Yield()
//	sleep(2)
//	CaptureImageRegion(ll_dc, ls_file_name, 0, 0, ll_width, ll_height)	
//	ll_file_size = FileLength(ls_file_name)
//	extPutImageFile(ls_res_file_name + ".lhi", ls_res_file_name + ".lhm", ls_file_name, ls_file_name, ls_time_stamp, ll_file_size)	
//	if cbx_delete_tmp_img.checked then	
//		FileDelete(ls_file_name)
//	else
//		if not cbx_append_right_hand.checked then
//			FileMove(ls_file_name, "left_" + ls_file_name)
//		elseif not cbx_append_left_hand.checked then
//			FileMove(ls_file_name, "right_" + ls_file_name)
//		end if		
//	end if
//next
//
////for ll_i = 1 to upperbound(ls_path)
////	extGetImageFile("finger_graphic.lhi", "finger_graphic.lhm", ls_path[ll_i], ls_local_filename)
////	ll_file_size = FileLength(ls_local_filename)
////	extPutImageFile("tmp.lhi", "tmp.lhm", ls_local_filename, ls_path[ll_i], ls_tstamp[ll_i], ll_file_size)	
////next
//
//extTransFinger(ANIMATION_MODE)
//extTransFinger(KEY_PRESSED_MODE)
//
end event

type pb_5 from picturebutton within w_music_composer_fingering
integer x = 5737
integer width = 114
integer height = 76
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string picturename = "Close!"
alignment htextalign = left!
end type

event clicked;close(parent)
end event

type cb_6 from commandbutton within w_music_composer_fingering
integer x = 613
integer y = 392
integer width = 78
integer height = 80
integer taborder = 80
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = ".."
end type

event clicked;integer li_i, li_j, li_seq, li_begin, li_pos, li_len, li_value
string ls_tmp, ls_line, ls_Docname, ls_named, ls_path, ls_cur_dir

is_dw_path = sle_dw_path.text
ls_cur_dir = GetCurrentDirectory()
li_j = 0
for li_i = 1 to len(is_dw_path)
	if mid(is_dw_path, len(is_dw_path) + 1 - li_i, 1) = "\" then exit
	li_j++
next

if li_j < len(is_dw_path) then
	ls_path = left(is_dw_path, len(is_dw_path) - li_j)
else
	ls_path = ".\"
end if
ChangeDirectory(ls_path)
li_value = GetFileOpenName("Select DW Import/Export File", ls_Docname, ls_named, "TXT", " TXT (*.TXT),*.TXT")

if li_value = 1 then
	is_dw_path = ls_Docname
	sle_dw_path.text = is_dw_path
end if
ChangeDirectory(ls_cur_dir)
end event

type sle_dw_path from singlelineedit within w_music_composer_fingering
integer y = 384
integer width = 613
integer height = 88
integer taborder = 30
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type cb_get_time from commandbutton within w_music_composer_fingering
integer x = 3680
integer width = 238
integer height = 68
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Get Time"
end type

event clicked;integer li_row, li_i, li_left_note_list[], li_right_note_list[], li_empty_list[]
string ls_note, ls_header, ls_entry, ls_right_measure_count, ls_right_offset, ls_left_measure_count, ls_left_offset, ls_measure_size
string ls_left_note_list[], ls_right_note_list[], ls_empty_list[]
double ldb_tempo, ldb_right_offset, ldb_left_offset, ldb_left = 0.0, ldb_right = 0.0, ldb_left_cur, ldb_right_cur, ldb_tmp
double ldb_tmp1, ldb_tmp2, ldb_remain
long ll_tmp1, ll_tmp2

if dw_1.RowCount() < 2 then return
ls_header = dw_1.GetItemString(1, "note")
if len(ls_header) < 13 then
	MessageBox("Error", "Invalid Header!")
	return 0
end if
ls_measure_size = mid(ls_header, 2, 4)
ldb_tempo = wf_string_to_fraction(ls_measure_size)
ldb_right_offset = wf_string_to_fraction(mid(ls_header, 6, 4))
ldb_left_offset = wf_string_to_fraction(mid(ls_header, 10, 4))
//wf_fraction_to_string
for li_row = 2 to dw_1.RowCount()
	ls_note = dw_1.GetItemString(li_row, "note")
	if IsNull(ls_note) then ls_note = "" 
	if ls_note = ""  then continue
	ls_right_note_list = ls_empty_list
	ls_left_note_list = ls_empty_list
	wf_get_note_list("R", ls_note, li_right_note_list, ls_right_note_list)
	wf_get_note_list("L", ls_note, li_left_note_list, ls_left_note_list)
	ldb_right_cur = 0.0
	ldb_left_cur = 0.0
	for li_i = 1 to upperbound(ls_right_note_list)
		ldb_tmp = wf_string_to_fraction(left(ls_right_note_list[li_i], 4))
		if li_i = 1 then 
			ldb_right_cur = ldb_tmp
		else
			if ldb_right_cur < ldb_tmp then ldb_right_cur = ldb_tmp
		end if
	next
	ldb_right = ldb_right + ldb_right_cur
	for li_i = 1 to upperbound(ls_left_note_list)
		ldb_tmp = wf_string_to_fraction(left(ls_left_note_list[li_i], 4))
		if li_i = 1 then 
			ldb_left_cur = ldb_tmp
		else
			if ldb_left_cur < ldb_tmp then ldb_left_cur = ldb_tmp
		end if
	next
	ldb_left = ldb_left + ldb_left_cur
	if ldb_right <= ldb_right_offset and ldb_right_offset > 0	then // still before offset
		ls_right_measure_count = "001"
		ldb_remain = ldb_right 
		if ldb_remain > 0.0 then
			ls_right_offset = wf_fraction_to_string(ldb_remain)
		else
			ls_right_offset = "0000"
		end if
	else
		ldb_tmp1 = (ldb_right - ldb_right_offset)/ldb_tempo
		if ldb_right_offset = 0 then
			ldb_tmp1 = ldb_tmp1
		else
			ldb_tmp1 = ldb_tmp1 + 1
		end if
		ll_tmp1 = long(ldb_tmp1)
		ldb_remain = (ldb_tmp1 - double(ll_tmp1))*ldb_tempo
		if ldb_remain > 0.0 then
			ls_right_measure_count = string(ll_tmp1 + 1, "000")
			ls_right_offset = wf_fraction_to_string(ldb_remain)
//			MessageBox(ls_right_offset, ldb_remain)
		else
			ls_right_measure_count = string(ll_tmp1, "000")
//			ls_right_offset = "0000"
			ls_right_offset = ls_measure_size
		end if		
	end if
	if ldb_left <= ldb_left_offset and ldb_left_offset > 0	then // still before offset
		ls_left_measure_count = "001"
		ldb_remain = ldb_left 
		if ldb_remain > 0.0 then
			ls_left_offset = wf_fraction_to_string(ldb_remain)
		else
			ls_left_offset = "0000"
		end if
	else
		ldb_tmp1 = (ldb_left - ldb_left_offset)/ldb_tempo
		if ldb_right_offset = 0 then
			ldb_tmp1 = ldb_tmp1
		else
			ldb_tmp1 = ldb_tmp1 + 1
		end if
		ll_tmp1 = long(ldb_tmp1)
		ldb_remain = (ldb_tmp1 - double(ll_tmp1))*ldb_tempo
		if ldb_remain > 0.0 then
			ls_left_measure_count = string(ll_tmp1 + 1, "000")
			ls_left_offset = wf_fraction_to_string(ldb_remain)
		else
			ls_left_measure_count = string(ll_tmp1, "000")
			ls_left_offset = ls_measure_size
		end if		
	end if
	ls_entry = ls_right_measure_count + " " + ls_right_offset + "  " + ls_left_measure_count + " " + ls_left_offset
	dw_1.SetItem(li_row, "time", ls_entry)
next


end event

type pb_4 from picturebutton within w_music_composer_fingering
integer x = 4293
integer y = 696
integer width = 101
integer height = 88
integer taborder = 120
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom034!"
alignment htextalign = left!
end type

event clicked;// move finger position down one scale
long ll_note[5], ll_i
// ajust notes that fingers positioning on one natural scale up
if cbx_append_left_hand.checked then
	ll_note[1] = long(sle_lh_1_note.text)
	ll_note[2] = long(sle_lh_2_note.text)
	ll_note[3] = long(sle_lh_3_note.text)
	ll_note[4] = long(sle_lh_4_note.text)
	ll_note[5] = long(sle_lh_5_note.text)
	for ll_i = 1 to 5 
		if IsNaturalNote(ll_note[ll_i]) then // Is a natural note, find the previous natural note
			ll_note[ll_i]--
			if not IsNaturalNote(ll_note[ll_i]) then ll_note[ll_i]--
		else	// Not a natural note
			if not IsNaturalNote(ll_note[ll_i] - 2) then // there is a sharp note in a down skip, land on it
				ll_note[ll_i] = ll_note[ll_i] - 2
			else	// there is NO sharp in a down skip, land on previous note
				ll_note[ll_i]--
			end if
		end if
	next
	
	sle_lh_1_note.text = string(ll_note[1], "000")
	sle_lh_2_note.text = string(ll_note[2], "000")
	sle_lh_3_note.text = string(ll_note[3], "000")
	sle_lh_4_note.text = string(ll_note[4], "000")
	sle_lh_5_note.text = string(ll_note[5], "000")
	sle_lh_1_note.event modified()
	sle_lh_2_note.event modified()
	sle_lh_3_note.event modified()
	sle_lh_4_note.event modified()
	sle_lh_5_note.event modified()
end if
	
if cbx_append_right_hand.checked then
	ll_note[1] = long(sle_rh_1_note.text)
	ll_note[2] = long(sle_rh_2_note.text)
	ll_note[3] = long(sle_rh_3_note.text)
	ll_note[4] = long(sle_rh_4_note.text)
	ll_note[5] = long(sle_rh_5_note.text)
	for ll_i = 1 to 5 
		if IsNaturalNote(ll_note[ll_i]) then // Is a natural note, find the previous natural note
			ll_note[ll_i]--
			if not IsNaturalNote(ll_note[ll_i]) then ll_note[ll_i]--
		else	// Not a natural note
			if not IsNaturalNote(ll_note[ll_i] - 2) then // there is a sharp note in a down skip, land on it
				ll_note[ll_i] = ll_note[ll_i] - 2
			else	// there is NO sharp in a down skip, land on previous note
				ll_note[ll_i]--
			end if
		end if
	next
	sle_rh_1_note.text = string(ll_note[1], "000")
	sle_rh_2_note.text = string(ll_note[2], "000")
	sle_rh_3_note.text = string(ll_note[3], "000")
	sle_rh_4_note.text = string(ll_note[4], "000")
	sle_rh_5_note.text = string(ll_note[5], "000")
	sle_rh_1_note.event modified()
	sle_rh_2_note.event modified()
	sle_rh_3_note.event modified()
	sle_rh_4_note.event modified()
	sle_rh_5_note.event modified()
end if

if cb_draw.enabled then
	cb_draw.post event clicked()
end if


end event

type pb_3 from picturebutton within w_music_composer_fingering
integer x = 4283
integer y = 148
integer width = 101
integer height = 88
integer taborder = 120
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
boolean originalsize = true
string picturename = "Custom033!"
alignment htextalign = left!
end type

event clicked;// move finger position up one scale
long ll_note[5], ll_i
// ajust notes that fingers positioning on one natural scale up
if cbx_append_left_hand.checked then
	ll_note[1] = long(sle_lh_1_note.text)
	ll_note[2] = long(sle_lh_2_note.text)
	ll_note[3] = long(sle_lh_3_note.text)
	ll_note[4] = long(sle_lh_4_note.text)
	ll_note[5] = long(sle_lh_5_note.text)
	for ll_i = 1 to 5 
		if IsNaturalNote(ll_note[ll_i]) then // Is a natural note, find the next natural note
			ll_note[ll_i]++
			if not IsNaturalNote(ll_note[ll_i]) then ll_note[ll_i]++
		else	// Not a natural note
			if not IsNaturalNote(ll_note[ll_i] + 2) then // there is a sharp note in a up skip, land on it
				ll_note[ll_i] = ll_note[ll_i] + 2
			else	// there is NO sharp not in a up skip, land on next note
				ll_note[ll_i]++
			end if
		end if
	next
	
	sle_lh_1_note.text = string(ll_note[1], "000")
	sle_lh_2_note.text = string(ll_note[2], "000")
	sle_lh_3_note.text = string(ll_note[3], "000")
	sle_lh_4_note.text = string(ll_note[4], "000")
	sle_lh_5_note.text = string(ll_note[5], "000")
	sle_lh_1_note.event modified()
	sle_lh_2_note.event modified()
	sle_lh_3_note.event modified()
	sle_lh_4_note.event modified()
	sle_lh_5_note.event modified()
end if
	
if cbx_append_right_hand.checked then
	ll_note[1] = long(sle_rh_1_note.text)
	ll_note[2] = long(sle_rh_2_note.text)
	ll_note[3] = long(sle_rh_3_note.text)
	ll_note[4] = long(sle_rh_4_note.text)
	ll_note[5] = long(sle_rh_5_note.text)
	for ll_i = 1 to 5 
		if IsNaturalNote(ll_note[ll_i]) then // Is a natural note, find the next natural note
			ll_note[ll_i]++
			if not IsNaturalNote(ll_note[ll_i]) then ll_note[ll_i]++
		else	// Not a natural note
			if not IsNaturalNote(ll_note[ll_i] + 2) then // there is a sharp note in a up skip, land on it
				ll_note[ll_i] = ll_note[ll_i] + 2
			else	// there is NO sharp not in a up skip, land on next note
				ll_note[ll_i]++
			end if
		end if
	next
	sle_rh_1_note.text = string(ll_note[1], "000")
	sle_rh_2_note.text = string(ll_note[2], "000")
	sle_rh_3_note.text = string(ll_note[3], "000")
	sle_rh_4_note.text = string(ll_note[4], "000")
	sle_rh_5_note.text = string(ll_note[5], "000")
	sle_rh_1_note.event modified()
	sle_rh_2_note.event modified()
	sle_rh_3_note.event modified()
	sle_rh_4_note.event modified()
	sle_rh_5_note.event modified()
end if

if cb_draw.enabled then
	cb_draw.post event clicked()
end if



end event

type cbx_note_on from checkbox within w_music_composer_fingering
integer x = 622
integer y = 556
integer width = 393
integer height = 72
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Note On"
boolean checked = true
end type

type cb_restore_dw from commandbutton within w_music_composer_fingering
integer x = 219
integer y = 308
integer width = 247
integer height = 72
integer taborder = 20
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Restore DW"
end type

event clicked;integer li_i, li_row, li_min, li_max
string ls_header
boolean lb_null = false


if not FileExists(sle_dw_path.text) then
	MessageBox("Error", "File Does Not Exist")
	return 0
end if

ids_1.Reset()
ids_1.ImportFile(sle_dw_path.text)

dw_1.Reset()
if cbx_1.checked then
	ids_1.RowsCopy(1, ids_1.RowCount(), Primary!, dw_1, 1, Primary!)
	dw_1.object.note.protect = 0
	dw_1.object.coord.protect = 0
	dw_1.object.finger.protect = 0
	dw_1.object.entry.protect = 0
else
	for li_i = 1 to ids_1.RowCount()
		li_row = dw_1.InsertRow(0)
		if mod(li_i, 10) = 0 then dw_1.object.data[li_row] = ids_1.object.data[li_i]
	next
	dw_1.object.note.protect = 1
	dw_1.object.coord.protect = 1
	dw_1.object.finger.protect = 1
	dw_1.object.entry.protect = 1
end if

//MessageBox("ids_1.RowCount()", ids_1.RowCount())
//MessageBox("dw_1.RowCount()", dw_1.RowCount())

if ids_1.RowCount() > 1 then 
	for li_row = 1 to ids_1.RowCount()
		if IsNull(ids_1.GetItemString(li_row, "entry")) then
			lb_null = true
			exit
		end if
	next
	if not lb_null then
		cb_get_list.event clicked()
	end if
//	ls_header = ids_1.GetItemString(1, "note")
	ls_header = ids_1.GetItemString(1, "entry")

//field_list = {music_piece_id,version,level,sheet_type,tempo,measure_size,rh_offset,lh_offset,rh_lo_note,rh_hi_note,lh_lo_note,lh_hi_note,bound_lo,bound_hi}

	
	if IsNull(ls_header) then ls_header = ""
	if len(ls_header) >= 48 then 
//		li_min = integer(mid(ls_header, 14, 3))
//		li_max = integer(mid(ls_header, 17, 3))
		li_min = integer(mid(ls_header, 43, 3))
		li_max = integer(mid(ls_header, 46, 3))
		if li_min < li_max and li_min > 0 and li_max < 100 then
			sle_min_note.text = string(li_min)
			sle_max_note.text = string(li_max)
			sle_min_note.event modified()
			sle_max_note.event modified()
			
		end if
	end if
//	if MessageBox("Confirmation", "Do You Want To Process wf_get_note_list",  Question!, YesNo!, 2) = 1 then
//		cb_get_list.event clicked()
//	end if
end if

dwobject dwo
if ii_current_row > 0 and ii_current_row <= dw_1.RowCount() then
	dw_1.ScrollToRow(ii_current_row)
	dw_1.SelectRow(0, false)
	dw_1.SelectRow(ii_current_row, true)
end if
 
return 1


end event

type cb_save_dw from commandbutton within w_music_composer_fingering
integer y = 308
integer width = 219
integer height = 72
integer taborder = 20
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Save DW"
end type

event clicked;
if cbx_1.checked then // a compldate DW
	ids_1.Reset()
	dw_1.RowsCopy(1, dw_1.RowCount(), Primary!, ids_1, 1, Primary!)
end if
if ids_1.SaveAs(sle_dw_path.text, Text!, False) = -1 then
	MessageBox("Error", "Cannot Export The File")
	return 0
end if

return 1

end event

type cb_copy_to_dw from commandbutton within w_music_composer_fingering
integer x = 357
integer y = 628
integer width = 288
integer height = 72
integer taborder = 120
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Copy To DW"
end type

event clicked;integer li_i, li_row, li_count = 0, li_seq
string ls_tmp, ls_entry_list[], ls_note_list[], ls_coord_list[], ls_finger_attr_list[]

if dw_1.RowCount() > 0 then
	If MessageBox("Warning", "Data in Datawindow will be overwritte, Continue?", Question!, YesNo!) = 2 then return
end if

if len(mle_note.text) > 0 then wf_make_string_list(mle_note.text, ls_note_list)
if len(mle_note_coord.text) > 0 then wf_make_string_list(mle_note_coord.text, ls_coord_list)
if len(mle_finger_attributes.text) > 0 then wf_make_string_list(mle_finger_attributes.text, ls_finger_attr_list)
if len(mle_entry.text) > 0 then wf_make_string_list(mle_entry.text, ls_entry_list)

if upperbound(ls_note_list) > li_count then li_count = upperbound(ls_note_list)
if upperbound(ls_coord_list) > li_count then li_count = upperbound(ls_coord_list)
if upperbound(ls_finger_attr_list) > li_count then li_count = upperbound(ls_finger_attr_list)
if upperbound(ls_entry_list) > li_count then li_count = upperbound(ls_entry_list)

if li_count = 0 then return

if dw_1.RowCount() < li_count then
	if dw_1.RowCount() = 0 then
		li_seq = 0
	else
		li_seq = dw_1.GetItemNumber(dw_1.RowCount(), "seq")/10
	end if
	for li_i = 1 to li_count - dw_1.RowCount()
		li_seq += li_seq
		li_row = dw_1.InsertRow(0)
		dw_1.SetItem(li_row, "seq", li_seq*10)
	next
end if
for li_i = 1 to upperbound(ls_note_list)
	dw_1.SetItem(li_i, "note", ls_note_list[li_i])
next

for li_i = 1 to upperbound(ls_coord_list)
	dw_1.SetItem(li_i, "coord", ls_coord_list[li_i])
next

for li_i = 1 to upperbound(ls_finger_attr_list)
	dw_1.SetItem(li_i, "finger", ls_finger_attr_list[li_i])
next

for li_i = 1 to upperbound(ls_entry_list)
	dw_1.SetItem(li_i, "entry", ls_entry_list[li_i])
next

end event

type cb_copy_from_dw from commandbutton within w_music_composer_fingering
integer y = 628
integer width = 343
integer height = 72
integer taborder = 110
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Copy From DW"
end type

event clicked;integer li_i, li_j, li_row, li_row_count = 0, li_note_row_count,li_coord_row_count,li_finger_attr_row_count,li_entry_row_count
integer li_row_count_list[4] = {0,0,0,0}
string ls_entry = "", ls_note = "", ls_coorde = "", ls_finger_attre = ""
string ls_col_list[4] = {"note","coord","finger","entry"}, ls_data_list[4] = {"","","",""}, ls_data

if dw_1.RowCount() = 0 then return

If MessageBox("Warning", "Data in Edit Boxes will be overwritte, Continue?", Question!, YesNo!) = 2 then return

li_row_count = dw_1.RowCount()

for li_i = 1 to li_row_count
//	if mod(dw_1.GetItemNumber(li_i, "seq"), 10) > 0 then continue
	for li_j = 1 to 4
		ls_data = dw_1.GetItemString(li_i, ls_col_list[li_j])
		if IsNull(ls_data) then ls_data = ""
		if trim(ls_data) <> "" then
			li_row_count_list[li_j] = li_i
		end if
	next
next

for li_i = 1 to li_row_count
//	if mod(dw_1.GetItemNumber(li_i, "seq"), 10) > 0 then continue
	for li_j = 1 to 4
		ls_data = dw_1.GetItemString(li_i, ls_col_list[li_j])
		if IsNull(ls_data) then ls_data = ""
		if li_i <= li_row_count_list[li_j] then
			ls_data_list[li_j] = ls_data_list[li_j] + ls_data + "~r~n"
		end if
	next
next

mle_note.text = ls_data_list[1]
mle_note_coord.text = ls_data_list[2]
mle_finger_attributes.text = ls_data_list[3]
mle_entry.text = ls_data_list[4]


end event

type cbx_dw_visible from checkbox within w_music_composer_fingering
integer x = 489
integer y = 308
integer width = 187
integer height = 72
integer textsize = -6
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "DataW"
boolean checked = true
end type

event clicked;if checked then
	dw_1.visible = true
	dw_1.BringToTop = true
else
	dw_1.visible = false
end if
end event

type cb_13 from commandbutton within w_music_composer_fingering
integer x = 270
integer y = 700
integer width = 407
integer height = 72
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Graph Digitize"
end type

event clicked;String ls_ts[]
integer li_i,li_j,li_finger,li_count
long ll_x_array[], ll_y_array[], ll_array_size
window lw_window
DropDownListBox lddlb_lh[5], lddlb_rh[5]
lw_window = parent
OpenWithParm(w_graph_digitize, lw_window)


lddlb_lh[1] = ddlb_lh_1
lddlb_lh[2] = ddlb_lh_2
lddlb_lh[3] = ddlb_lh_3
lddlb_lh[4] = ddlb_lh_4
lddlb_lh[5] = ddlb_lh_5

lddlb_rh[1] = ddlb_rh_1
lddlb_rh[2] = ddlb_rh_2
lddlb_rh[3] = ddlb_rh_3
lddlb_rh[4] = ddlb_rh_4
lddlb_rh[5] = ddlb_rh_5

for li_i = 1 to 5
// clearing existing dropdownlistbox
	li_count = lddlb_lh[li_i].TotalItems()
	for li_j = 1 to li_count
		lddlb_lh[li_i].DeleteItem(1)
	next
	li_count = lddlb_rh[li_i].TotalItems()
	for li_j = 1 to li_count
		lddlb_rh[li_i].DeleteItem(1)
	next
next
ls_ts[1] = space(20)
//li_count = extResIndexCount("finger_graphic.lhi", ls_ts[1])
li_count = extResIndexCount(sle_dest_lib.text + ".lhi", ls_ts[1])

for li_i = 1 to li_count
	is_id[li_i] = space(500) 
	ls_ts[li_i] = space(20)
next
//extRetrieveResIndex("finger_graphic.lhi", is_id, ls_ts)
extRetrieveResIndex(sle_dest_lib.text + ".lhi", is_id, ls_ts)
for li_i = 1 to li_count
	if left(is_id[li_i], 1) = "1" then // left hand
		li_finger = integer(mid(is_id[li_i], 2, 1)) // finger number
		lddlb_lh[li_finger].AddItem(is_id[li_i])
	else										// right hand
		li_finger = integer(mid(is_id[li_i], 2, 1)) // finger number
		lddlb_rh[li_finger].AddItem(is_id[li_i])
	end if
next

extClearGraphLib()
for li_i = 1 to upperbound(is_id)
//	ll_array_size = extGetCoordGraphCount("finger_graphic.lhi", "finger_graphic.lhm", is_id[li_i])
	ll_array_size = extGetCoordGraphCount(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", is_id[li_i])
	for li_j = 1 to ll_array_size
		ll_x_array[li_j] = 0
		ll_y_array[li_j] = 0
	next
	//MessageBox("ll_array_size", ll_array_size)
	if ll_array_size > 0 then
//		extGetCoordGraphFile("finger_graphic.lhi", "finger_graphic.lhm", ll_x_array, ll_y_array, ll_array_size, is_id[li_i])
		extGetCoordGraphFile(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", ll_x_array, ll_y_array, ll_array_size, is_id[li_i])
	else
		MessageBox("Error", is_id[li_i] + " not found in the resource file!")
		return
	end if
	extLoadGraphData(ll_x_array, ll_y_array, ll_array_size, long(is_id[li_i]))
next
end event

type ddlb_note_level_range_max from dropdownlistbox within w_music_composer_fingering
integer x = 608
integer y = 784
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_note_name_range_max.text + ddlb_note_level_range_max.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_max_note.text = string(li_note_seq )

string ls_header, ls_prefix, ls_hi_bound

if dw_1.RowCount() < 2 then return

ls_header = dw_1.GetItemString(1, "entry")

if isnull(ls_header) then ls_header = ""


ls_header = dw_1.GetItemString(1, "entry")

if len(ls_header) < 48 then return
ls_prefix = left(ls_header, 45)
ls_hi_bound = string(li_note_seq, "000")
ls_header = ls_prefix + ls_hi_bound
dw_1.SetItem(1, "entry", ls_header)

end event

type ddlb_note_name_range_max from dropdownlistbox within w_music_composer_fingering
integer x = 439
integer y = 784
integer width = 178
integer height = 936
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_note_name_range_max.text + ddlb_note_level_range_max.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_max_note.text = string(li_note_seq )

string ls_header, ls_prefix, ls_hi_bound

if dw_1.RowCount() < 2 then return

ls_header = dw_1.GetItemString(1, "entry")

if isnull(ls_header) then ls_header = ""


ls_header = dw_1.GetItemString(1, "entry")

if len(ls_header) < 48 then return
ls_prefix = left(ls_header, 45)
ls_hi_bound = string(li_note_seq, "000")
ls_header = ls_prefix + ls_hi_bound
dw_1.SetItem(1, "entry", ls_header)

end event

type ddlb_note_level_range_min from dropdownlistbox within w_music_composer_fingering
integer x = 174
integer y = 784
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_note_name_range_min.text + ddlb_note_level_range_min.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_min_note.text = string(li_note_seq )

string ls_header, ls_prefix, ls_lo_bound, ls_hi_bound

if dw_1.RowCount() < 2 then return

ls_header = dw_1.GetItemString(1, "entry")

if isnull(ls_header) then ls_header = ""


ls_header = dw_1.GetItemString(1, "entry")

if len(ls_header) < 48 then return
ls_prefix = left(ls_header, 42)
ls_lo_bound = string(li_note_seq, "000")
ls_hi_bound = mid(ls_header, 43, 3)
ls_header = ls_prefix + ls_lo_bound + ls_hi_bound
dw_1.SetItem(1, "entry", ls_header)

end event

type ddlb_note_name_range_min from dropdownlistbox within w_music_composer_fingering
integer y = 784
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_note_name_range_min.text + ddlb_note_level_range_min.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_min_note.text = string(li_note_seq )

string ls_header, ls_prefix, ls_lo_bound, ls_hi_bound

if dw_1.RowCount() < 2 then return

ls_header = dw_1.GetItemString(1, "entry")

if isnull(ls_header) then ls_header = ""

if len(ls_header) < 48 then return
ls_prefix = left(ls_header, 42)
ls_lo_bound = string(li_note_seq, "000")
ls_hi_bound = mid(ls_header, 43, 3)
ls_header = ls_prefix + ls_lo_bound + ls_hi_bound
dw_1.SetItem(1, "entry", ls_header)

end event

type ddlb_rh_note_name_5 from dropdownlistbox within w_music_composer_fingering
integer x = 4763
integer y = 796
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_5.text + ddlb_rh_note_level_5.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_5_note.text = string(li_note_seq )
end event

type ddlb_rh_note_level_5 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 796
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_5.text + ddlb_rh_note_level_5.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_5_note.text = string(li_note_seq )
end event

type ddlb_rh_note_name_4 from dropdownlistbox within w_music_composer_fingering
integer x = 4763
integer y = 724
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_4.text + ddlb_rh_note_level_4.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_4_note.text = string(li_note_seq )
end event

type ddlb_rh_note_level_4 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 724
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_4.text + ddlb_rh_note_level_4.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_4_note.text = string(li_note_seq )
end event

type ddlb_rh_note_name_3 from dropdownlistbox within w_music_composer_fingering
integer x = 4759
integer y = 652
integer width = 183
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_3.text + ddlb_rh_note_level_3.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_3_note.text = string(li_note_seq )
end event

type ddlb_rh_note_level_3 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 652
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_3.text + ddlb_rh_note_level_3.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_3_note.text = string(li_note_seq )
end event

type ddlb_rh_note_name_2 from dropdownlistbox within w_music_composer_fingering
integer x = 4759
integer y = 580
integer width = 183
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_2.text + ddlb_rh_note_level_2.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_2_note.text = string(li_note_seq )
end event

type ddlb_rh_note_level_2 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 580
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_2.text + ddlb_rh_note_level_2.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_2_note.text = string(li_note_seq )
end event

type ddlb_rh_note_name_1 from dropdownlistbox within w_music_composer_fingering
integer x = 4759
integer y = 508
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_1.text + ddlb_rh_note_level_1.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_1_note.text = string(li_note_seq )
end event

type ddlb_rh_note_level_1 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 504
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_rh_note_name_1.text + ddlb_rh_note_level_1.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_rh_1_note.text = string(li_note_seq )
end event

type ddlb_lh_note_name_5 from dropdownlistbox within w_music_composer_fingering
integer x = 4763
integer y = 416
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_5.text + ddlb_lh_note_level_5.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_5_note.text = string(li_note_seq )
end event

type ddlb_lh_note_level_5 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 416
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_5.text + ddlb_lh_note_level_5.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_5_note.text = string(li_note_seq )
end event

type ddlb_lh_note_name_4 from dropdownlistbox within w_music_composer_fingering
integer x = 4759
integer y = 344
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_4.text + ddlb_lh_note_level_4.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_4_note.text = string(li_note_seq )
end event

type ddlb_lh_note_level_4 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 340
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_4.text + ddlb_lh_note_level_4.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_4_note.text = string(li_note_seq )
end event

type ddlb_lh_note_name_3 from dropdownlistbox within w_music_composer_fingering
integer x = 4759
integer y = 268
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_3.text + ddlb_lh_note_level_3.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_3_note.text = string(li_note_seq )
end event

type ddlb_lh_note_level_3 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 268
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_3.text + ddlb_lh_note_level_3.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_3_note.text = string(li_note_seq )
end event

type ddlb_lh_note_name_2 from dropdownlistbox within w_music_composer_fingering
integer x = 4759
integer y = 196
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_2.text + ddlb_lh_note_level_2.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_2_note.text = string(li_note_seq )
end event

type ddlb_lh_note_level_2 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 196
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_2.text + ddlb_lh_note_level_2.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_2_note.text = string(li_note_seq )
end event

type ddlb_lh_note_level_1 from dropdownlistbox within w_music_composer_fingering
integer x = 4942
integer y = 112
integer width = 151
integer height = 720
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "5"
boolean allowedit = true
string item[] = {"1","2","3","4","5","6","7","8","9",""}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_1.text + ddlb_lh_note_level_1.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_1_note.text = string(li_note_seq )
end event

type ddlb_lh_note_name_1 from dropdownlistbox within w_music_composer_fingering
integer x = 4763
integer y = 112
integer width = 178
integer height = 936
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "C"
boolean allowedit = true
boolean sorted = false
string item[] = {"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;string ls_note_name
integer li_note_seq

ls_note_name = ddlb_lh_note_name_1.text + ddlb_lh_note_level_1.text
li_note_seq = wf_note_to_seq(ls_note_name)

sle_lh_1_note.text = string(li_note_seq )
end event

type ddlb_rh_5 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 796
integer width = 256
integer height = 380
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "2500"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_rh_4 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 724
integer width = 256
integer height = 364
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "2400"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_rh_3 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 652
integer width = 256
integer height = 304
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "2300"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_rh_2 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 580
integer width = 256
integer height = 276
integer taborder = 110
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "2200"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_rh_1 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 508
integer width = 256
integer height = 320
integer taborder = 120
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "2100"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_lh_5 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 416
integer width = 256
integer height = 320
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1500"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_lh_4 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 340
integer width = 256
integer height = 260
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1400"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_lh_3 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 268
integer width = 256
integer height = 340
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1300"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_lh_2 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 196
integer width = 256
integer height = 388
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1200"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type ddlb_lh_1 from dropdownlistbox within w_music_composer_fingering
integer x = 4507
integer y = 112
integer width = 256
integer height = 348
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "1100"
boolean allowedit = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type cb_finger_attr_default from commandbutton within w_music_composer_fingering
integer x = 4293
integer y = 436
integer width = 96
integer height = 100
integer taborder = 80
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "000"
end type

event clicked;// reset all fingering attributes

if cbx_append_left_hand.checked then
	ddlb_lh_1.text = "1100"
	ddlb_lh_2.text = "1200"
	ddlb_lh_3.text = "1300"
	ddlb_lh_4.text = "1400"
	ddlb_lh_5.text = "1500"
	
	sle_lh_1_note.text = "55"
	sle_lh_2_note.text = "53"
	sle_lh_3_note.text = "52"
	sle_lh_4_note.text = "50"
	sle_lh_5_note.text = "48"
	
	sle_lh_1_x.text = "50"
	sle_lh_2_x.text = "50"
	sle_lh_3_x.text = "50"
	sle_lh_4_x.text = "50"
	sle_lh_5_x.text = "50"
	
	sle_lh_1_y.text = "90"
	sle_lh_2_y.text = "75"
	sle_lh_3_y.text = "70"
	sle_lh_4_y.text = "75"
	sle_lh_5_y.text = "85"
	
	sle_lh_1_w.text = "0"
	sle_lh_2_w.text = "0"
	sle_lh_3_w.text = "0"
	sle_lh_4_w.text = "0"
	sle_lh_5_w.text = "0"
	
	sle_lh_1_h.text = "0"
	sle_lh_2_h.text = "0"
	sle_lh_3_h.text = "0"
	sle_lh_4_h.text = "0"
	sle_lh_5_h.text = "0"
	
	sle_lh_1_note.event modified()
	sle_lh_2_note.event modified()
	sle_lh_3_note.event modified()
	sle_lh_4_note.event modified()
	sle_lh_5_note.event modified()
end if
if cbx_append_right_hand.checked then
	ddlb_rh_1.text = "2100"
	ddlb_rh_2.text = "2200"
	ddlb_rh_3.text = "2300"
	ddlb_rh_4.text = "2400"
	ddlb_rh_5.text = "2500"
	
	sle_rh_1_note.text = "60"
	sle_rh_2_note.text = "62"
	sle_rh_3_note.text = "64"
	sle_rh_4_note.text = "65"
	sle_rh_5_note.text = "67"
	
	sle_rh_1_x.text = "50"
	sle_rh_2_x.text = "50"
	sle_rh_3_x.text = "50"
	sle_rh_4_x.text = "50"
	sle_rh_5_x.text = "50"
	
	sle_rh_1_y.text = "90"
	sle_rh_2_y.text = "75"
	sle_rh_3_y.text = "70"
	sle_rh_4_y.text = "75"
	sle_rh_5_y.text = "85"
	
	sle_rh_1_w.text = "0"
	sle_rh_2_w.text = "0"
	sle_rh_3_w.text = "0"
	sle_rh_4_w.text = "0"
	sle_rh_5_w.text = "0"
	
	sle_rh_1_h.text = "0"
	sle_rh_2_h.text = "0"
	sle_rh_3_h.text = "0"
	sle_rh_4_h.text = "0"
	sle_rh_5_h.text = "0"
	
	sle_rh_1_note.event modified()
	sle_rh_2_note.event modified()
	sle_rh_3_note.event modified()
	sle_rh_4_note.event modified()
	sle_rh_5_note.event modified()
end if
end event

type cb_12 from commandbutton within w_music_composer_fingering
integer x = 4293
integer y = 300
integer width = 96
integer height = 100
integer taborder = 150
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "-->"
end type

event clicked;//FB
//ID=1100
//Note=062
//Xpct=52
//Ypct=88
//Wpct=115
//Hpct=068
//120006064791180661300059477511104514000573980111053150005539860940802100067417811506822000695272118066230007162701110452400074507511105325000764773094080FE
string ls_buf, ls_entry
string ls_id,ls_note,ls_x_pct,ls_y_pct,ls_w_pct,ls_h_pct
integer li_i, li_line, li_attr_len = 17, li_offset, li_pos1, li_pos2

if dw_1.visible then
	if ii_current_row < 1 or ii_current_row > dw_1.RowCount() then
		MessageBox("Error", "Invalid Row Selected")
		return 0
	end if
	ls_buf = dw_1.GetItemString(ii_current_row, "finger")
else
	ls_buf = mle_finger_attributes.SelectedText()
end if

li_pos1 = pos(ls_buf, "FB")
li_pos2 = pos(ls_buf, "FE")
if len(ls_buf) < li_attr_len + 4 or li_pos1 = 0 or li_pos2 = 0 or li_pos2 < li_pos1 then
	MessageBox("Error", "String Length Error, Cannot Parse Selected Text!")
	return 0
end if

ls_entry = mid(ls_buf, li_pos1 + 2, li_pos2 - li_pos1 - 2)

if mod(len(ls_entry), li_attr_len) > 0 then
	MessageBox("Error", "String Length Error, Cannot Parse Selected Text!")
	return 0
end if

li_pos1 = pos(ls_buf, "FB")
li_pos2 = pos(ls_buf, "FE")


for li_i = 1 to len(ls_entry)/17 
	li_offset = li_attr_len*(li_i - 1) + 1
	ls_id = mid(ls_entry, li_offset, 4)
	li_offset = li_offset + 4
	ls_note = mid(ls_entry, li_offset, 3)
	li_offset = li_offset + 3
	ls_x_pct = mid(ls_entry, li_offset, 2)
	li_offset = li_offset + 2
	ls_y_pct = mid(ls_entry, li_offset, 2)
	li_offset = li_offset + 2
	ls_w_pct = mid(ls_entry, li_offset, 3)
	li_offset = li_offset + 3
	ls_h_pct = mid(ls_entry, li_offset, 3)
	if left(ls_id, 1) = "1" and cbx_append_left_hand.checked then // left hand
		choose case mid(ls_id, 2, 1) // finger number
			case "1" // finger 1
				ddlb_lh_1.text = ls_id
				sle_lh_1_note.text = ls_note
				sle_lh_1_x.text = ls_x_pct
				sle_lh_1_y.text = ls_y_pct
				sle_lh_1_w.text = ls_w_pct
				sle_lh_1_h.text = ls_h_pct
			case "2"
				ddlb_lh_2.text = ls_id
				sle_lh_2_note.text = ls_note
				sle_lh_2_x.text = ls_x_pct
				sle_lh_2_y.text = ls_y_pct
				sle_lh_2_w.text = ls_w_pct
				sle_lh_2_h.text = ls_h_pct
			case "3"
				ddlb_lh_3.text = ls_id
				sle_lh_3_note.text = ls_note
				sle_lh_3_x.text = ls_x_pct
				sle_lh_3_y.text = ls_y_pct
				sle_lh_3_w.text = ls_w_pct
				sle_lh_3_h.text = ls_h_pct
			case "4"
				ddlb_lh_4.text = ls_id
				sle_lh_4_note.text = ls_note
				sle_lh_4_x.text = ls_x_pct
				sle_lh_4_y.text = ls_y_pct
				sle_lh_4_w.text = ls_w_pct
				sle_lh_4_h.text = ls_h_pct
			case "5"
				ddlb_lh_5.text = ls_id
				sle_lh_5_note.text = ls_note
				sle_lh_5_x.text = ls_x_pct
				sle_lh_5_y.text = ls_y_pct
				sle_lh_5_w.text = ls_w_pct
				sle_lh_5_h.text = ls_h_pct
		end choose
	else
		if cbx_append_right_hand.checked then // right
			choose case mid(ls_id, 2, 1) // finger number
				case "1" // finger 1
					ddlb_rh_1.text = ls_id
					sle_rh_1_note.text = ls_note
					sle_rh_1_x.text = ls_x_pct
					sle_rh_1_y.text = ls_y_pct
					sle_rh_1_w.text = ls_w_pct
					sle_rh_1_h.text = ls_h_pct
				case "2"
					ddlb_rh_2.text = ls_id
					sle_rh_2_note.text = ls_note
					sle_rh_2_x.text = ls_x_pct
					sle_rh_2_y.text = ls_y_pct
					sle_rh_2_w.text = ls_w_pct
					sle_rh_2_h.text = ls_h_pct
				case "3"
					ddlb_rh_3.text = ls_id
					sle_rh_3_note.text = ls_note
					sle_rh_3_x.text = ls_x_pct
					sle_rh_3_y.text = ls_y_pct
					sle_rh_3_w.text = ls_w_pct
					sle_rh_3_h.text = ls_h_pct
				case "4"
					ddlb_rh_4.text = ls_id
					sle_rh_4_note.text = ls_note
					sle_rh_4_x.text = ls_x_pct
					sle_rh_4_y.text = ls_y_pct
					sle_rh_4_w.text = ls_w_pct
					sle_rh_4_h.text = ls_h_pct
				case "5"
					ddlb_rh_5.text = ls_id
					sle_rh_5_note.text = ls_note
					sle_rh_5_x.text = ls_x_pct
					sle_rh_5_y.text = ls_y_pct
					sle_rh_5_w.text = ls_w_pct
					sle_rh_5_h.text = ls_h_pct
			end choose
		end if
	end if
next
sle_lh_1_note.event modified()
sle_lh_2_note.event modified()
sle_lh_3_note.event modified()
sle_lh_4_note.event modified()
sle_lh_5_note.event modified()
sle_rh_1_note.event modified()
sle_rh_2_note.event modified()
sle_rh_3_note.event modified()
sle_rh_4_note.event modified()
sle_rh_5_note.event modified()


end event

type uo_1 from uo_music_container_dummy_fingering within w_music_composer_fingering
integer y = 884
integer width = 4992
integer height = 1216
integer taborder = 210
boolean hscrollbar = true
boolean vscrollbar = true
end type

on uo_1.destroy
call uo_music_container_dummy_fingering::destroy
end on

type cb_append_clear from commandbutton within w_music_composer_fingering
integer x = 3099
integer y = 788
integer width = 279
integer height = 76
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Add CLEAR"
end type

event clicked;integer li_line

if dw_1.visible then
	if ii_current_row < 1 or ii_current_row > dw_1.RowCount() then
		MessageBox("Error", "Invalid Row Selected")
		return 0
	end if
	dw_1.SetItem(ii_current_row, "finger", "FB0FE")
else
	mle_finger_attributes.text = mle_finger_attributes.text + "FB0FE~r~n"
	
	li_line = mle_finger_attributes.LineCount ( )
	
	mle_finger_attributes.Scroll ( li_line )
end if

end event

type cb_append_repeat from commandbutton within w_music_composer_fingering
integer x = 3378
integer y = 788
integer width = 288
integer height = 76
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Add Repeat"
end type

event clicked;integer li_line

if dw_1.visible then
	if ii_current_row < 1 or ii_current_row > dw_1.RowCount() then
		MessageBox("Error", "Invalid Row Selected")
		return 0
	end if
	dw_1.SetItem(ii_current_row, "finger", "FB9FE")
else
	mle_finger_attributes.text = mle_finger_attributes.text + "FB9FE~r~n"
	
	li_line = mle_finger_attributes.LineCount ( )
	
	mle_finger_attributes.Scroll ( li_line )
end if





end event

type cbx_all_finger from checkbox within w_music_composer_fingering
integer x = 4439
integer y = 56
integer width = 347
integer height = 72
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "All Fingers"
end type

type cb_play_note from commandbutton within w_music_composer_fingering
integer x = 5106
integer width = 219
integer height = 68
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Play Note"
end type

event clicked;string ls_shmem_buf, ls_right_dev_name, ls_prim_or_second = "01", ls_finger_prompt_ind = "01"
long ll_pb_win_handle, ll_kb_handle, ll_kb_dc
integer li_prompt_ind = 3
long li_high_note = 72
long li_low_note = 36
int li_i, li_j
long ll_id[], ll_x_array[], ll_y_array[], ll_array_size
integer ll_i
string ls_name_id[]// = {"1100","1200","1300","1400","1500","2100","2200","2300","2400","2500"}

//extDllTest()
//
//return 1

ib_playing_note = true

li_low_note =  long(sle_min_note.text)
li_high_note =  long(sle_max_note.text)


is_entry_list = is_empty_list
wf_make_string_list( mle_entry.text, is_entry_list)

if upperbound(is_entry_list) < 2 then
	MessageBox("Error", "Not Entries Available!")
	return
end if
wf_get_finger_entry_id(ll_id, ls_name_id)

enabled = false
cb_stop_keyboard.enabled = true

//extClearGraphLib()
//for li_i = 1 to upperbound(ls_name_id)
//	ll_array_size = extGetCoordGraphCount("finger_graphic.lhi", "finger_graphic.lhm", ls_name_id[li_i])
//	for li_j = 1 to ll_array_size
//		ll_x_array[li_j] = 0
//		ll_y_array[li_j] = 0
//	next
//	//MessageBox("ll_array_size", ll_array_size)
//	if ll_array_size > 0 then
//		extGetCoordGraphFile("finger_graphic.lhi", "finger_graphic.lhm", ll_x_array, ll_y_array, ll_array_size, ls_name_id[li_i])
//	else
//		MessageBox("Error", ls_name_id[li_i] + " not found in the resource file!")
//		return
//	end if
//	extLoadGraphData(ll_x_array, ll_y_array, ll_array_size, long(ls_name_id[li_i]))
////	MessageBox(ls_name_id[li_i], ll_array_size)
//next


ll_pb_win_handle = handle(parent)
ls_right_dev_name = "Digital Audio (S/PDIF) (High De"

long ll_lo_note
long ll_hi_note
long ll_prompt_ind
long ll_finger_prompt_ind, ll_prim_or_second
string ls_dev_name2
ll_prim_or_second = 1
ll_lo_note = long(sle_min_note.text)
ll_hi_note = long(sle_max_note.text)
ll_prompt_ind = long(li_prompt_ind)
ll_finger_prompt_ind = long(ls_finger_prompt_ind)
ls_dev_name2 =  "dummy"
//extSetKeyboardParms(ll_pb_win_handle,long(sle_min_note.text),long(sle_max_note.text),1,li_prompt_ind,long(ls_finger_prompt_ind),ls_right_dev_name,"dummy") 
//extSetKeyboardParms(ll_pb_win_handle,ll_lo_note,ll_hi_note,ll_prim_or_second,li_prompt_ind,ll_finger_prompt_ind,ls_right_dev_name,ls_dev_name2) 

if il_thread_id = 0 then
	//return
	p_1.height = ii_p1_height_orig
	ll_kb_handle = handle(p_1)
	ll_kb_dc = GetDC(ll_kb_handle)
//	extStartPianoThread2(ll_pb_win_handle,ll_kb_handle,ll_kb_dc,is_startupfile,il_thread_id)
	extSetKeyboardParms(ll_pb_win_handle,ll_lo_note,ll_hi_note,ll_prim_or_second,li_prompt_ind,ll_finger_prompt_ind,ls_right_dev_name,ls_dev_name2) 
end if
ii_current_i = 2

wf_send_note()

//cb_draw.enabled = true


end event

type cb_4 from commandbutton within w_music_composer_fingering
boolean visible = false
integer x = 2880
integer width = 475
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Extract Old To New"
end type

event clicked;integer li_i, li_r_count, li_l_count, li_j, li_note, li_pos, li_entry_note_divider = 8, li_note_len = 2
string ls_tmp, ls_entry_list[], ls_note_list[], ls_coord_list[], ls_empty_note = "00000000"
string ls_entry, ls_note, ls_coord, ls_f_attributes, ls_l_note,ls_r_note, ls_seq, ls_sub_note, ls_note_value, ls_note_entry

boolean lb_new_format_original

lb_new_format_original = cbx_new_format.checked

 cbx_new_format.checked = false
 

If len(mle_note.text) > 3 or len(mle_note_coord.text) > 3 then 
	If MessageBox("Warning", "Extracted Data Will Overwrite Existing Data", Question!, YesNo!) = 2 then return
end if



ls_tmp = mle_entry.text
if len(ls_tmp) > 0 then
	wf_make_string_list(ls_tmp, ls_entry_list)
	if upperbound(ls_entry_list) = 0 then
		MessageBox("Error", "Empty Note List, Cannot Extract!")
		return
	end if
end if	

if cbx_new_format.checked then 
	li_entry_note_divider = 9
	li_note_len = 3
	ls_empty_note = "000000000"
end if

if upperbound(ls_entry_list) > 0 then
	ls_coord = ls_entry_list[1]
	ls_note_entry = "H~r~n"
	if cbx_new_format.checked then 
		ls_f_attributes = "H~r~n"
	end if
end if
for li_i = 2 to upperbound(ls_entry_list)
	li_pos = pos(ls_entry_list[li_i], "FE")
	if cbx_new_format.checked then 
		if li_pos > 0 then
			ls_f_attributes = ls_f_attributes + left(ls_entry_list[li_i], li_pos + 1)
			ls_entry_list[li_i] = right(ls_entry_list[li_i], len(ls_entry_list[li_i]) - (li_pos + 1))
		end if	
		ls_f_attributes = ls_f_attributes +  + "H~r~n"
	end if
	ls_coord = ls_coord + "~r~n" + left(ls_entry_list[li_i], 16)
	ls_note = mid(ls_entry_list[li_i], 17, len(ls_entry_list[li_i]) - 16)
	for li_j = 1 to len(ls_note)/li_entry_note_divider
		ls_sub_note = mid(ls_note, (li_j - 1)*li_entry_note_divider + 1, li_entry_note_divider)
		if mod(li_j, 2) = 1 then // right note
			if ls_sub_note <> ls_empty_note then // real right note
				ls_seq = mid(ls_sub_note, 5, li_note_len)
				cbx_new_format.checked = true
				ls_note_value = wf_seq_to_note(integer(ls_seq))
				ls_note_entry = ls_note_entry + "R" + left(ls_sub_note, 4) + right(ls_sub_note, 2) + ls_note_value
				cbx_new_format.checked = false
			end if
		else		// left
			if ls_sub_note <> ls_empty_note then // real right note
				ls_seq = mid(ls_sub_note, 5, li_note_len)
				cbx_new_format.checked = true
				ls_note_value = wf_seq_to_note(integer(ls_seq))
				ls_note_entry = ls_note_entry + "L" + left(ls_sub_note, 4) + right(ls_sub_note, 2) + ls_note_value
				cbx_new_format.checked = false
			end if			
		end if		
	next
	ls_note_entry = ls_note_entry + "~r~n"
next

cbx_new_format.checked = lb_new_format_original


mle_note_coord.text = ls_coord
mle_note.text = ls_note_entry
mle_finger_attributes.text = ls_f_attributes
end event

type cbx_origin_size from checkbox within w_music_composer_fingering
boolean visible = false
integer x = 457
integer y = 612
integer width = 379
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Original Size"
boolean checked = true
end type

event clicked;if checked then
	p_1.OriginalSize = true
else
	p_1.OriginalSize = false
end if	
end event

type cbx_append_right_hand from checkbox within w_music_composer_fingering
integer x = 2779
integer y = 792
integer width = 320
integer height = 72
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Right Hand"
boolean checked = true
end type

event clicked;//
end event

type cbx_append_left_hand from checkbox within w_music_composer_fingering
integer x = 2478
integer y = 792
integer width = 297
integer height = 72
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Left Hand"
boolean checked = true
end type

event clicked;//
end event

type cbx_new_format from checkbox within w_music_composer_fingering
boolean visible = false
integer x = 14
integer y = 612
integer width = 384
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "New Format"
boolean checked = true
end type

event clicked;//
end event

type cb_11 from commandbutton within w_music_composer_fingering
integer x = 3666
integer y = 788
integer width = 361
integer height = 76
integer taborder = 190
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Add Finger Attr"
end type

event clicked;integer li_line
string ls_entry, ls_lh_entry, ls_rh_entry
long ll_lh_id[],ll_lh_note_id[],ll_lh_note_x[],ll_lh_note_y[],ll_lh_w_pct_y[],ll_lh_h_pct_y[],ll_lh_size
long ll_rh_id[],ll_rh_note_id[],ll_rh_note_x[],ll_rh_note_y[],ll_rh_w_pct_y[],ll_rh_h_pct_y[],ll_rh_size

integer li_i, li_row, li_row_source, li_row_dest, li_seq, li_row_source_from = 0, li_rows_to_be_copied = 0, li_row_dest_from = 0
string ls_empty = "", ls_empty_list[], ls_fingering_source, ls_fingering_dest
string ls_lh_output_source, ls_rh_output_source, ls_lh_output_list_source[], ls_rh_output_list_source[]
string ls_lh_output_dest, ls_rh_output_dest, ls_lh_output_list_dest[], ls_rh_output_list_dest[]

ll_lh_id[1] = long(ddlb_lh_1.text)
ll_lh_id[2] = long(ddlb_lh_2.text)
ll_lh_id[3] = long(ddlb_lh_3.text)
ll_lh_id[4] = long(ddlb_lh_4.text)
ll_lh_id[5] = long(ddlb_lh_5.text)
ll_lh_note_id[1] = long(sle_lh_1_note.text)
ll_lh_note_id[2] = long(sle_lh_2_note.text)
ll_lh_note_id[3] = long(sle_lh_3_note.text)
ll_lh_note_id[4] = long(sle_lh_4_note.text)
ll_lh_note_id[5] = long(sle_lh_5_note.text)
ll_lh_note_x[1] = long(sle_lh_1_x.text)
ll_lh_note_x[2] = long(sle_lh_2_x.text)
ll_lh_note_x[3] = long(sle_lh_3_x.text)
ll_lh_note_x[4] = long(sle_lh_4_x.text)
ll_lh_note_x[5] = long(sle_lh_5_x.text)
ll_lh_note_y[1] = long(sle_lh_1_y.text)
ll_lh_note_y[2] = long(sle_lh_2_y.text)
ll_lh_note_y[3] = long(sle_lh_3_y.text)
ll_lh_note_y[4] = long(sle_lh_4_y.text)
ll_lh_note_y[5] = long(sle_lh_5_y.text)
ll_lh_w_pct_y[1] = long(sle_lh_1_w.text)
ll_lh_w_pct_y[2] = long(sle_lh_2_w.text)
ll_lh_w_pct_y[3] = long(sle_lh_3_w.text)
ll_lh_w_pct_y[4] = long(sle_lh_4_w.text)
ll_lh_w_pct_y[5] = long(sle_lh_5_w.text)
ll_lh_h_pct_y[1] = long(sle_lh_1_h.text)
ll_lh_h_pct_y[2] = long(sle_lh_2_h.text)
ll_lh_h_pct_y[3] = long(sle_lh_3_h.text)
ll_lh_h_pct_y[4] = long(sle_lh_4_h.text)
ll_lh_h_pct_y[5] = long(sle_lh_5_h.text)

ll_rh_id[1] = long(ddlb_rh_1.text)
ll_rh_id[2] = long(ddlb_rh_2.text)
ll_rh_id[3] = long(ddlb_rh_3.text)
ll_rh_id[4] = long(ddlb_rh_4.text)
ll_rh_id[5] = long(ddlb_rh_5.text)
ll_rh_note_id[1] = long(sle_rh_1_note.text)
ll_rh_note_id[2] = long(sle_rh_2_note.text)
ll_rh_note_id[3] = long(sle_rh_3_note.text)
ll_rh_note_id[4] = long(sle_rh_4_note.text)
ll_rh_note_id[5] = long(sle_rh_5_note.text)
ll_rh_note_x[1] = long(sle_rh_1_x.text)
ll_rh_note_x[2] = long(sle_rh_2_x.text)
ll_rh_note_x[3] = long(sle_rh_3_x.text)
ll_rh_note_x[4] = long(sle_rh_4_x.text)
ll_rh_note_x[5] = long(sle_rh_5_x.text)
ll_rh_note_y[1] = long(sle_rh_1_y.text)
ll_rh_note_y[2] = long(sle_rh_2_y.text)
ll_rh_note_y[3] = long(sle_rh_3_y.text)
ll_rh_note_y[4] = long(sle_rh_4_y.text)
ll_rh_note_y[5] = long(sle_rh_5_y.text)
ll_rh_w_pct_y[1] = long(sle_rh_1_w.text)
ll_rh_w_pct_y[2] = long(sle_rh_2_w.text)
ll_rh_w_pct_y[3] = long(sle_rh_3_w.text)
ll_rh_w_pct_y[4] = long(sle_rh_4_w.text)
ll_rh_w_pct_y[5] = long(sle_rh_5_w.text)
ll_rh_h_pct_y[1] = long(sle_rh_1_h.text)
ll_rh_h_pct_y[2] = long(sle_rh_2_h.text)
ll_rh_h_pct_y[3] = long(sle_rh_3_h.text)
ll_rh_h_pct_y[4] = long(sle_rh_4_h.text)
ll_rh_h_pct_y[5] = long(sle_rh_5_h.text)


ls_entry = "FB"
ls_lh_entry = ""
if cbx_append_left_hand.checked then
	for li_i = 1 to 5
		if ll_lh_id[1] >= 1100 and ll_lh_id[1] < 1600 then
			ls_lh_entry = + ls_lh_entry + string(ll_lh_id[li_i], "0000")
			ls_lh_entry = + ls_lh_entry + string(ll_lh_note_id[li_i], "000")
			ls_lh_entry = + ls_lh_entry + string(ll_lh_note_x[li_i], "00")
			if ll_lh_note_y[li_i] < 0 then // for the coord away off the keyboard, not formatted into leadning 0, otherwise it will be become 3 chars
				ls_lh_entry = + ls_lh_entry + string(ll_lh_note_y[li_i])
			else
				ls_lh_entry = + ls_lh_entry + string(ll_lh_note_y[li_i], "00")
			end if
			ls_lh_entry = + ls_lh_entry + string(ll_lh_w_pct_y[li_i], "000")
			ls_lh_entry = + ls_lh_entry + string(ll_lh_h_pct_y[li_i], "000")
		end if
	next
end if
ls_rh_entry = ""
if cbx_append_right_hand.checked then
	for li_i = 1 to 5
		if ll_rh_id[1] >= 1200 and ll_rh_id[1] < 2600 then
			ls_rh_entry = + ls_rh_entry + string(ll_rh_id[li_i], "0000")
			ls_rh_entry = + ls_rh_entry + string(ll_rh_note_id[li_i], "000")
			ls_rh_entry = + ls_rh_entry + string(ll_rh_note_x[li_i], "00")
			if ll_rh_note_y[li_i] < 0 then // for the coord away off the keyboard, not formatted into leadning 0, otherwise it will be become 3 chars
				ls_rh_entry = + ls_rh_entry + string(ll_rh_note_y[li_i])
			else
				ls_rh_entry = + ls_rh_entry + string(ll_rh_note_y[li_i], "00")
			end if
			ls_rh_entry = + ls_rh_entry + string(ll_rh_w_pct_y[li_i], "000")
			ls_rh_entry = + ls_rh_entry + string(ll_rh_h_pct_y[li_i], "000")
		end if	
	next
end if

ls_lh_output_source = ls_lh_entry
ls_rh_output_dest = ls_rh_entry

ls_fingering_source = "FB" + ls_lh_entry+ ls_rh_entry + "FE"
ls_fingering_dest = dw_1.GetItemString(ii_current_row, "finger")
if isnull(ls_fingering_dest) then ls_fingering_dest = ""
ls_lh_output_source = ""
ls_rh_output_source = ""
ls_lh_output_list_source = ls_empty_list
ls_rh_output_list_source = ls_empty_list
ls_lh_output_dest = ""
ls_rh_output_dest = ""
ls_lh_output_list_dest = ls_empty_list
ls_rh_output_list_dest = ls_empty_list
wf_parse_finger_entry(ls_fingering_source, ls_lh_output_source, ls_rh_output_source, ls_lh_output_list_source, ls_rh_output_list_source)
if ls_fingering_dest <> "FB9FE" and len(ls_fingering_dest) >= 17 then
	wf_parse_finger_entry(ls_fingering_dest, ls_lh_output_dest, ls_rh_output_dest, ls_lh_output_list_dest, ls_rh_output_list_dest)
end if
if cbx_append_left_hand.checked and cbx_append_right_hand.checked then // both hands, always replace
	ls_fingering_dest = "FB" + ls_lh_output_source + ls_rh_output_source + "FE"
elseif cbx_append_left_hand.checked then
	if cbx_replace.checked then // replacement
		ls_fingering_dest = "FB" + ls_lh_output_source + "FE"
	else		// append
		ls_fingering_dest = "FB" + ls_lh_output_source + ls_rh_output_dest + "FE"					
	end if
elseif cbx_append_right_hand.checked then
	if cbx_replace.checked then // replacement
		ls_fingering_dest = "FB" + ls_rh_output_source + "FE"
	else		// append
		ls_fingering_dest = "FB" + ls_lh_output_dest + ls_rh_output_source + "FE"					
	end if
end if
dw_1.SetItem(ii_current_row, "finger", ls_fingering_dest)	


//if dw_1.visible then
//	if ii_current_row < 1 or ii_current_row > dw_1.RowCount() then
//		MessageBox("Error", "Invalid Row Selected")
//		return 0
//	end if
//	ls_entry = "FB" + ls_lh_entry+ ls_rh_entry + "FE"
//	dw_1.SetItem(ii_current_row, "finger", ls_entry)
//else
//	ls_entry = "FB" + ls_lh_entry+ ls_rh_entry + "FE~r~n"
//	mle_finger_attributes.text = mle_finger_attributes.text + ls_entry	
//	li_line = mle_finger_attributes.LineCount ( )		
//	mle_finger_attributes.Scroll ( li_line )
//end if

return 1


//HaaaabbbccddeeefffHaaaabbbccddeeefffaaaabbbccddeeefffHaaaabbbccddeeefffaaaabbbccddeeefffHaaaabbbccddeeefffaaaabbbccddeeefffHaaaabbbccddeeefffaaaabbbccddeeefffHaaaabbbccddeeefff
//
//H=L(left hand) or R(right hand)
//aaaa=Finger Entry ID
//bbb=music note ID for the finger
//cc=finger tip away from the left edge of the note in percentage
//dd=finger tip away from the top edge of the note in percentage 
//eee=percentage of key width over finger width
//fff=percentage of key height over finger height
//Example
//
//L1100055509007806112000535075080059130005250700750401400050507507504715000485085064071R2100060509007806122000535075080059230005250700750402400050507507504725000485085064071
//
//L1100055509007806112000535075080059130005250700750401400050507507504715000485085064071
//R2100060509007806122000535075080059230005250700750402400050507507504725000485085064071

//each finger attribute has 4+3+2+2+3+3=17 chars five fingers have 85 chars plus finger indicator of 1, total of 86
//the total chars of two hands are 86+86=172 char
end event

type st_13 from statictext within w_music_composer_fingering
integer x = 4997
integer y = 1484
integer width = 553
integer height = 56
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Source Fingering Library"
alignment alignment = center!
boolean focusrectangle = false
end type

type cb_10 from commandbutton within w_music_composer_fingering
integer x = 4027
integer y = 788
integer width = 370
integer height = 76
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Get W and H Pct"
end type

event clicked;// Get Width and Height Percentage of fingering to key width and key height

// get Name Entry ID

integer li_i, li_j, li_key_width, li_key_height, li_natural_note_count = 0, li_min_note, li_max_note, li_array_range
long ll_array_size, ll_x_array[], ll_y_array[], ll_w_array[], ll_h_array[], ll_pct, ll_empty_list[]
string ls_name_id[], ls_w_pct[], ls_h_pct[]

li_min_note = integer(sle_min_note.text)
li_max_note = integer(sle_max_note.text)

// 1. maker sure the spcified key range is valid
if not IsNaturalNote(li_min_note) then
	MessageBox("Error", "Min Note Is Not A Natural Note, Please Validate It!");
	return 1
end if
if not IsNaturalNote(li_max_note) then
	MessageBox("Error", "Max Note Is Not A Natural Note, Please Validate It!");
	return 1
end if
if li_min_note > li_max_note then
	MessageBox("Error", "Note Range Error, Please Validate It!");
	return 1
end if

// 2. calculate the number of natural keys
for li_i = li_min_note to li_max_note
	if IsNaturalNote(li_i) then
		li_natural_note_count ++
	end if
next
	
//MessageBox("li_natural_note_count", li_natural_note_count)


//li_key_height = UnitsToPixels((ii_p1_height_orig/2)*2/3, YUnitsToPixels!)

// 3. calculate key width and key height
li_key_height = UnitsToPixels(ii_p1_height_orig*2/3, YUnitsToPixels!)
li_key_width = UnitsToPixels(ii_p1_width_orig/li_natural_note_count, XUnitsToPixels!)

ls_name_id[1] = ddlb_lh_1.text
ls_name_id[2] = ddlb_lh_2.text
ls_name_id[3] = ddlb_lh_3.text
ls_name_id[4] = ddlb_lh_4.text
ls_name_id[5] = ddlb_lh_5.text
ls_name_id[6] = ddlb_rh_1.text
ls_name_id[7] = ddlb_rh_2.text
ls_name_id[8] = ddlb_rh_3.text
ls_name_id[9] = ddlb_rh_4.text
ls_name_id[10] = ddlb_rh_5.text

// 4. using name specified in sle_lh_1 to sle_rh_5 as fingering name to retrieve fingering coordinates
for li_i = 1 to upperbound(ls_name_id)
	// get array size
//	ll_array_size = extGetCoordGraphCount("finger_graphic.lhi", "finger_graphic.lhm", ls_name_id[li_i])
	ll_array_size = extGetCoordGraphCount(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", ls_name_id[li_i])
	
	
	ll_x_array = ll_empty_list
	ll_y_array = ll_empty_list
	for li_j = 1 to ll_array_size
		ll_x_array[li_j] = 0
		ll_y_array[li_j] = 0
	next
	if ll_array_size > 0 then
		// given fingering name to retrieve array of the fingering coordinates
//		extGetCoordGraphFile("finger_graphic.lhi", "finger_graphic.lhm", ll_x_array, ll_y_array, ll_array_size, ls_name_id[li_i])
		extGetCoordGraphFile(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", ll_x_array, ll_y_array, ll_array_size, ls_name_id[li_i])
		li_array_range = GetArrayRange(ll_x_array)
		// key width is equal to key X array range
		ll_pct = li_array_range*100/li_key_width
		ls_w_pct[li_i] = string(ll_pct)
		li_array_range = GetArrayRange(ll_y_array)
		// key height is equal to key Y array rage
		ll_pct = li_array_range*100/li_key_height
		ls_h_pct[li_i] = string(ll_pct)
	else
		ls_w_pct[li_i] = "0"
		ls_h_pct[li_i] = "0"
		MessageBox("Error", ls_name_id[li_i] + " not found in the resource file!")
	end if
next

// copy key width and height ratios to sle_lh_1_w and sle_lh_1_h 
//if cbx_append_left_hand.checked then
//	choose case ii_cur_f
//		case 1

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		sle_lh_1_w.text = string(ls_w_pct[1])
		sle_lh_2_w.text = string(ls_w_pct[2])
		sle_lh_3_w.text = string(ls_w_pct[3])
		sle_lh_4_w.text = string(ls_w_pct[4])
		sle_lh_5_w.text = string(ls_w_pct[5])		
		sle_lh_1_h.text = string(ls_h_pct[1])
		sle_lh_2_h.text = string(ls_h_pct[2])
		sle_lh_3_h.text = string(ls_h_pct[3])
		sle_lh_4_h.text = string(ls_h_pct[4])
		sle_lh_5_h.text = string(ls_h_pct[5])
	end if
	if cbx_append_right_hand.checked then
		sle_rh_1_w.text = string(ls_w_pct[6])
		sle_rh_2_w.text = string(ls_w_pct[7])
		sle_rh_3_w.text = string(ls_w_pct[8])
		sle_rh_4_w.text = string(ls_w_pct[9])
		sle_rh_5_w.text = string(ls_w_pct[10])		
		sle_rh_1_h.text = string(ls_h_pct[6])
		sle_rh_2_h.text = string(ls_h_pct[7])
		sle_rh_3_h.text = string(ls_h_pct[8])
		sle_rh_4_h.text = string(ls_h_pct[9])
		sle_rh_5_h.text = string(ls_h_pct[10])
	end if
else // only individual note
	choose case ii_cur_f
		case 1
			sle_lh_1_w.text = string(ls_w_pct[ii_cur_f])
			sle_lh_1_h.text = string(ls_h_pct[ii_cur_f])
		case 2
			sle_lh_2_w.text = string(ls_w_pct[ii_cur_f])
			sle_lh_2_h.text = string(ls_h_pct[ii_cur_f])
		case 3
			sle_lh_3_w.text = string(ls_w_pct[ii_cur_f])
			sle_lh_3_h.text = string(ls_h_pct[ii_cur_f])
		case 4
			sle_lh_4_w.text = string(ls_w_pct[ii_cur_f])
			sle_lh_4_h.text = string(ls_h_pct[ii_cur_f])
		case 5
			sle_lh_5_w.text = string(ls_w_pct[ii_cur_f])
			sle_lh_5_h.text = string(ls_h_pct[ii_cur_f])
		case 6
			sle_rh_1_w.text = string(ls_w_pct[ii_cur_f])
			sle_rh_1_h.text = string(ls_h_pct[ii_cur_f])
		case 7
			sle_rh_2_w.text = string(ls_w_pct[ii_cur_f])
			sle_rh_2_h.text = string(ls_h_pct[ii_cur_f])
		case 8
			sle_rh_3_w.text = string(ls_w_pct[ii_cur_f])
			sle_rh_3_h.text = string(ls_h_pct[ii_cur_f])
		case 9
			sle_rh_4_w.text = string(ls_w_pct[ii_cur_f])
			sle_rh_4_h.text = string(ls_h_pct[ii_cur_f])
		case 10
			sle_rh_5_w.text = string(ls_w_pct[ii_cur_f])
			sle_rh_5_h.text = string(ls_h_pct[ii_cur_f])
	end choose	
end if


end event

type cb_9 from commandbutton within w_music_composer_fingering
integer x = 859
integer y = 788
integer width = 192
integer height = 72
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Validate"
end type

event clicked;integer li_min_note,li_max_note, ll_mod_remain

li_min_note = integer(sle_min_note.text)
li_max_note = integer(sle_max_note.text)

if li_min_note > li_max_note then
	MessageBox("Error", "Incorrect Note Range!")
	return 1
end if

if not IsNaturalNote(li_min_note) then 
	li_min_note = li_min_note - 1
	sle_min_note.text = string(li_min_note)
end if

if not IsNaturalNote(li_max_note) then 
	li_max_note = li_max_note + 1
	sle_max_note.text = string(li_max_note)
end if


//  *       *       *   *       *       *      *
//      1   2   3   4   5   6   7   8   9  10  11
// 12  13  14  15  16  17  18  19  20  21  22  23 
// 24  25  26  27  28  29  30  31  32  33  34  35
// 36  37  38  39  40  41  42  43  44  45  46  47
// 48  49  50  51  52  53  54  55  56  57  58  59
// 60  61  62  63  64  65  66  67  68  69  70  71
// 72  73  74  75  76  77  78  79  80  81  82  83
// 84  85  86  87  88  89  90  91  92  93  94  95
// 96  97  98  99 100 101 102 103 104 105 106 107 
//108 
//
//
//a natural key can be determined by mod 12 with remaining of 0 2 4 5 7 9 or 11
//and on contrery a non-natural key by mod 12 with remaining of 1 3 6 8 or 10

//piano beginning at 21 and end at 108 (totally there 88 keys)
end event

type pb_2 from picturebutton within w_music_composer_fingering
boolean visible = false
integer x = 2176
integer y = 780
integer width = 101
integer height = 88
integer taborder = 180
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
string picturename = "Custom033!"
alignment htextalign = left!
end type

event clicked;p_1.height = p_1.height - 10
end event

type pb_1 from picturebutton within w_music_composer_fingering
boolean visible = false
integer x = 2304
integer y = 776
integer width = 101
integer height = 88
integer taborder = 180
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "none"
boolean originalsize = true
string picturename = "Custom034!"
alignment htextalign = left!
end type

event clicked;p_1.height = p_1.height + 10
end event

type rb_14 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 812
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 10

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_13 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 744
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 9

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_12 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 672
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 8

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_11 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 600
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 7

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_10 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 524
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 6

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_9 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 432
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 5

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_8 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 360
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 4

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_rh_3 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 288
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 3

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_rh_2 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 216
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

event clicked;ii_cur_f = 2

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type rb_rh_1 from radiobutton within w_music_composer_fingering
integer x = 4416
integer y = 144
integer width = 87
integer height = 60
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
boolean checked = true
end type

event clicked;ii_cur_f = 1

if cb_draw.enabled then
	cb_draw.post event clicked()
end if
end event

type sle_lh_1_h from singlelineedit within w_music_composer_fingering
integer x = 5714
integer y = 112
integer width = 146
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_5_h from singlelineedit within w_music_composer_fingering
integer x = 5714
integer y = 412
integer width = 146
integer height = 76
integer taborder = 160
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_4_h from singlelineedit within w_music_composer_fingering
integer x = 5714
integer y = 340
integer width = 146
integer height = 76
integer taborder = 150
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_3_h from singlelineedit within w_music_composer_fingering
integer x = 5714
integer y = 268
integer width = 146
integer height = 76
integer taborder = 140
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_2_h from singlelineedit within w_music_composer_fingering
integer x = 5714
integer y = 196
integer width = 146
integer height = 76
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_2_h from singlelineedit within w_music_composer_fingering
integer x = 5710
integer y = 580
integer width = 146
integer height = 76
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_3_h from singlelineedit within w_music_composer_fingering
integer x = 5710
integer y = 652
integer width = 146
integer height = 76
integer taborder = 150
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_4_h from singlelineedit within w_music_composer_fingering
integer x = 5710
integer y = 724
integer width = 146
integer height = 76
integer taborder = 160
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_5_h from singlelineedit within w_music_composer_fingering
integer x = 5710
integer y = 796
integer width = 146
integer height = 76
integer taborder = 170
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_1_h from singlelineedit within w_music_composer_fingering
integer x = 5710
integer y = 508
integer width = 146
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_1_w from singlelineedit within w_music_composer_fingering
integer x = 5559
integer y = 508
integer width = 146
integer height = 76
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_5_w from singlelineedit within w_music_composer_fingering
integer x = 5559
integer y = 796
integer width = 146
integer height = 76
integer taborder = 160
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_4_w from singlelineedit within w_music_composer_fingering
integer x = 5559
integer y = 724
integer width = 146
integer height = 76
integer taborder = 150
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_3_w from singlelineedit within w_music_composer_fingering
integer x = 5559
integer y = 652
integer width = 146
integer height = 76
integer taborder = 140
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_2_w from singlelineedit within w_music_composer_fingering
integer x = 5559
integer y = 580
integer width = 146
integer height = 76
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_2_w from singlelineedit within w_music_composer_fingering
integer x = 5563
integer y = 196
integer width = 146
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_3_w from singlelineedit within w_music_composer_fingering
integer x = 5563
integer y = 268
integer width = 146
integer height = 76
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_4_w from singlelineedit within w_music_composer_fingering
integer x = 5563
integer y = 340
integer width = 146
integer height = 76
integer taborder = 140
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_5_w from singlelineedit within w_music_composer_fingering
integer x = 5563
integer y = 412
integer width = 146
integer height = 76
integer taborder = 150
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_1_w from singlelineedit within w_music_composer_fingering
integer x = 5563
integer y = 112
integer width = 146
integer height = 76
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "0"
borderstyle borderstyle = stylelowered!
end type

type st_12 from statictext within w_music_composer_fingering
integer y = 704
integer width = 265
integer height = 76
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Note Range"
alignment alignment = center!
boolean focusrectangle = false
end type

type sle_min_note from singlelineedit within w_music_composer_fingering
integer x = 320
integer y = 784
integer width = 114
integer height = 88
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "41"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_min_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_note_name_range_min.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_note_level_range_min.text = right(ls_note_name, 1)

string ls_header, ls_prefix, ls_lo_bound, ls_hi_bound

if dw_1.RowCount() < 2 then return

ls_header = dw_1.GetItemString(1, "entry")

if isnull(ls_header) then ls_header = ""


ls_header = dw_1.GetItemString(1, "entry")

if len(ls_header) < 48 then return
ls_prefix = left(ls_header, 42)
ls_lo_bound = string(li_note_seq, "000")
ls_hi_bound = mid(ls_header, 43, 3)
ls_header = ls_prefix + ls_lo_bound + ls_hi_bound
dw_1.SetItem(1, "entry", ls_header)



end event

type sle_max_note from singlelineedit within w_music_composer_fingering
integer x = 759
integer y = 784
integer width = 105
integer height = 88
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "84"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_max_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_note_name_range_max.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_note_level_range_max.text = right(ls_note_name, 1)

string ls_header, ls_prefix, ls_hi_bound

if dw_1.RowCount() < 2 then return

ls_header = dw_1.GetItemString(1, "entry")

if isnull(ls_header) then ls_header = ""


ls_header = dw_1.GetItemString(1, "entry")

if len(ls_header) < 48 then return
ls_prefix = left(ls_header, 45)
ls_hi_bound = string(li_note_seq, "000")
ls_header = ls_prefix + ls_hi_bound
dw_1.SetItem(1, "entry", ls_header)

end event

type sle_note_id from singlelineedit within w_music_composer_fingering
integer x = 1426
integer y = 784
integer width = 123
integer height = 76
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type cbx_collect_ind from checkbox within w_music_composer_fingering
integer x = 1051
integer y = 780
integer width = 375
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Collect Coord"
boolean checked = true
end type

event clicked;
if cbx_collect_ind.checked then
	extToGetFingerCoord(1)
else
	extToGetFingerCoord(0)
end if

//FUNCTION int extCurrentEntry(ref long lh_id[],ref long lh_note_x[],ref long lh_note_y[],long lh_size, ref long rh_id[],ref long rh_note_x[],ref long rh_note_y[],long rh_size)  Library "MusicLesson.dll" ALIAS FOR "_extCurrentEntry@32"
//FUNCTION int extToGetFingerCoord(long getFingerCoord) Library "MusicLesson.dll" ALIAS FOR "_extToGetFingerCoord@0"

end event

type cb_draw from commandbutton within w_music_composer_fingering
integer x = 4485
integer width = 206
integer height = 68
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
string text = "Draw"
end type

event clicked;string ls_shmem_buf, ls_right_dev_name, ls_prim_or_second = "01", ls_finger_prompt_ind = "01"
long ll_pb_win_handle, ll_kb_handle, ll_kb_dc
integer li_prompt_ind = 3
long li_high_note = 84
long li_low_note = 36
int li_i
long ll_lh_id[],ll_lh_note_id[],ll_lh_note_x[],ll_lh_note_y[],ll_lh_w_pct_y[],ll_lh_h_pct_y[],ll_lh_size
long ll_rh_id[],ll_rh_note_id[],ll_rh_note_x[],ll_rh_note_y[],ll_rh_w_pct_y[],ll_rh_h_pct_y[],ll_rh_size

if cbx_all_finger.checked then
	if cbx_append_left_hand.checked then
		ll_lh_id[1] = long(ddlb_lh_1.text)
		ll_lh_id[2] = long(ddlb_lh_2.text)
		ll_lh_id[3] = long(ddlb_lh_3.text)
		ll_lh_id[4] = long(ddlb_lh_4.text)
		ll_lh_id[5] = long(ddlb_lh_5.text)
		ll_lh_note_id[1] = long(sle_lh_1_note.text)
		ll_lh_note_id[2] = long(sle_lh_2_note.text)
		ll_lh_note_id[3] = long(sle_lh_3_note.text)
		ll_lh_note_id[4] = long(sle_lh_4_note.text)
		ll_lh_note_id[5] = long(sle_lh_5_note.text)
		ll_lh_note_x[1] = long(sle_lh_1_x.text)
		ll_lh_note_x[2] = long(sle_lh_2_x.text)
		ll_lh_note_x[3] = long(sle_lh_3_x.text)
		ll_lh_note_x[4] = long(sle_lh_4_x.text)
		ll_lh_note_x[5] = long(sle_lh_5_x.text)
		ll_lh_note_y[1] = long(sle_lh_1_y.text)
		ll_lh_note_y[2] = long(sle_lh_2_y.text)
		ll_lh_note_y[3] = long(sle_lh_3_y.text)
		ll_lh_note_y[4] = long(sle_lh_4_y.text)
		ll_lh_note_y[5] = long(sle_lh_5_y.text)
		ll_lh_w_pct_y[1] = long(sle_lh_1_w.text)
		ll_lh_w_pct_y[2] = long(sle_lh_2_w.text)
		ll_lh_w_pct_y[3] = long(sle_lh_3_w.text)
		ll_lh_w_pct_y[4] = long(sle_lh_4_w.text)
		ll_lh_w_pct_y[5] = long(sle_lh_5_w.text)
		ll_lh_h_pct_y[1] = long(sle_lh_1_h.text)
		ll_lh_h_pct_y[2] = long(sle_lh_2_h.text)
		ll_lh_h_pct_y[3] = long(sle_lh_3_h.text)
		ll_lh_h_pct_y[4] = long(sle_lh_4_h.text)
		ll_lh_h_pct_y[5] = long(sle_lh_5_h.text)
	end if
	if cbx_append_right_hand.checked then
		ll_rh_id[1] = long(ddlb_rh_1.text)
		ll_rh_id[2] = long(ddlb_rh_2.text)
		ll_rh_id[3] = long(ddlb_rh_3.text)
		ll_rh_id[4] = long(ddlb_rh_4.text)
		ll_rh_id[5] = long(ddlb_rh_5.text)
		ll_rh_note_id[1] = long(sle_rh_1_note.text)
		ll_rh_note_id[2] = long(sle_rh_2_note.text)
		ll_rh_note_id[3] = long(sle_rh_3_note.text)
		ll_rh_note_id[4] = long(sle_rh_4_note.text)
		ll_rh_note_id[5] = long(sle_rh_5_note.text)
		ll_rh_note_x[1] = long(sle_rh_1_x.text)
		ll_rh_note_x[2] = long(sle_rh_2_x.text)
		ll_rh_note_x[3] = long(sle_rh_3_x.text)
		ll_rh_note_x[4] = long(sle_rh_4_x.text)
		ll_rh_note_x[5] = long(sle_rh_5_x.text)
		ll_rh_note_y[1] = long(sle_rh_1_y.text)
		ll_rh_note_y[2] = long(sle_rh_2_y.text)
		ll_rh_note_y[3] = long(sle_rh_3_y.text)
		ll_rh_note_y[4] = long(sle_rh_4_y.text)
		ll_rh_note_y[5] = long(sle_rh_5_y.text)
		ll_rh_w_pct_y[1] = long(sle_rh_1_w.text)
		ll_rh_w_pct_y[2] = long(sle_rh_2_w.text)
		ll_rh_w_pct_y[3] = long(sle_rh_3_w.text)
		ll_rh_w_pct_y[4] = long(sle_rh_4_w.text)
		ll_rh_w_pct_y[5] = long(sle_rh_5_w.text)
		ll_rh_h_pct_y[1] = long(sle_rh_1_h.text)
		ll_rh_h_pct_y[2] = long(sle_rh_2_h.text)
		ll_rh_h_pct_y[3] = long(sle_rh_3_h.text)
		ll_rh_h_pct_y[4] = long(sle_rh_4_h.text)
		ll_rh_h_pct_y[5] = long(sle_rh_5_h.text)
	end if
else
	choose case ii_cur_f
		case 1
			ll_lh_id[1] = long(ddlb_lh_1.text)
			ll_lh_note_id[1] = long(sle_lh_1_note.text)
			ll_lh_note_x[1] = long(sle_lh_1_x.text)		
			ll_lh_note_y[1] = long(sle_lh_1_y.text)
			ll_lh_w_pct_y[1] = long(sle_lh_1_w.text)
			ll_lh_h_pct_y[1] = long(sle_lh_1_h.text)
		case 2
			ll_lh_id[1] = long(ddlb_lh_2.text)
			ll_lh_note_id[1] = long(sle_lh_2_note.text)
			ll_lh_note_x[1] = long(sle_lh_2_x.text)		
			ll_lh_note_y[1] = long(sle_lh_2_y.text)
			ll_lh_w_pct_y[1] = long(sle_lh_2_w.text)
			ll_lh_h_pct_y[1] = long(sle_lh_2_h.text)
		case 3
			ll_lh_id[1] = long(ddlb_lh_3.text)
			ll_lh_note_id[1] = long(sle_lh_3_note.text)
			ll_lh_note_x[1] = long(sle_lh_3_x.text)		
			ll_lh_note_y[1] = long(sle_lh_3_y.text)
			ll_lh_w_pct_y[1] = long(sle_lh_3_w.text)
			ll_lh_h_pct_y[1] = long(sle_lh_3_h.text)
		case 4
			ll_lh_id[1] = long(ddlb_lh_4.text)
			ll_lh_note_id[1] = long(sle_lh_4_note.text)
			ll_lh_note_x[1] = long(sle_lh_4_x.text)		
			ll_lh_note_y[1] = long(sle_lh_4_y.text)
			ll_rh_w_pct_y[1] = long(sle_lh_4_w.text)
			ll_lh_h_pct_y[1] = long(sle_lh_4_h.text)
		case 5
			ll_lh_id[1] = long(ddlb_lh_4.text)
			ll_lh_note_id[1] = long(sle_lh_5_note.text)
			ll_lh_note_x[1] = long(sle_lh_5_x.text)		
			ll_lh_note_y[1] = long(sle_lh_5_y.text)
			ll_lh_w_pct_y[1] = long(sle_lh_5_w.text)
			ll_lh_h_pct_y[1] = long(sle_lh_5_h.text)				
		case 6
			ll_rh_id[1] = long(ddlb_rh_1.text)
			ll_rh_note_id[1] = long(sle_rh_1_note.text)
			ll_rh_note_x[1] = long(sle_rh_1_x.text)		
			ll_rh_note_y[1] = long(sle_rh_1_y.text)
			ll_rh_w_pct_y[1] = long(sle_rh_1_w.text)
			ll_rh_h_pct_y[1] = long(sle_rh_1_h.text)
		case 7
			ll_rh_id[1] = long(ddlb_rh_2.text)
			ll_rh_note_id[1] = long(sle_rh_2_note.text)
			ll_rh_note_x[1] = long(sle_rh_2_x.text)		
			ll_rh_note_y[1] = long(sle_rh_2_y.text)
			ll_rh_w_pct_y[1] = long(sle_rh_2_w.text)
			ll_rh_h_pct_y[1] = long(sle_rh_2_h.text)
		case 8
			ll_rh_id[1] = long(ddlb_rh_3.text)
			ll_rh_note_id[1] = long(sle_rh_3_note.text)
			ll_rh_note_x[1] = long(sle_rh_3_x.text)		
			ll_rh_note_y[1] = long(sle_rh_3_y.text)
			ll_rh_w_pct_y[1] = long(sle_rh_3_w.text)
			ll_rh_h_pct_y[1] = long(sle_rh_3_h.text)
		case 9
			ll_rh_id[1] = long(ddlb_rh_4.text)
			ll_rh_note_id[1] = long(sle_rh_4_note.text)
			ll_rh_note_x[1] = long(sle_rh_4_x.text)		
			ll_rh_note_y[1] = long(sle_rh_4_y.text)
			ll_rh_w_pct_y[1] = long(sle_rh_4_w.text)
			ll_rh_h_pct_y[1] = long(sle_rh_4_h.text)
		case 10
			ll_rh_id[1] = long(ddlb_rh_5.text)
			ll_rh_note_id[1] = long(sle_rh_5_note.text)
			ll_rh_note_x[1] = long(sle_rh_5_x.text)		
			ll_rh_note_y[1] = long(sle_rh_5_y.text)
			ll_rh_w_pct_y[1] = long(sle_rh_5_w.text)
			ll_rh_h_pct_y[1] = long(sle_rh_5_h.text)				
		
	end choose
end if
//MessageBox("upperbound(ll_rh_id)", upperbound(ll_rh_id))
//for li_i = 1 to 5
//	MessageBox("ll_rh_id" + string(li_i), ll_rh_id[li_i])
//	MessageBox("ll_rh_note_id" + string(li_i), ll_rh_note_id[li_i])
//	MessageBox("ll_rh_note_x" + string(li_i), ll_rh_note_x[li_i])
//	MessageBox("ll_rh_note_y" + string(li_i), ll_rh_note_y[li_i])
//	MessageBox("ll_rh_w_pct_y" + string(li_i), ll_rh_w_pct_y[li_i])
//	MessageBox("ll_rh_h_pct_y" + string(li_i), ll_rh_h_pct_y[li_i])
//	
//next
extCurrentEntry(ll_lh_id,ll_lh_note_id,ll_lh_note_x,ll_lh_note_y,ll_lh_w_pct_y,ll_lh_h_pct_y,upperbound(ll_lh_id),ll_rh_id,ll_rh_note_id,ll_rh_note_x,ll_rh_note_y,ll_rh_w_pct_y,ll_rh_h_pct_y,upperbound(ll_rh_id))

extPostThreadMessage(il_thread_id, 1099, 0, 0)	// send message to the music player to draw fingering graph
//extPostThreadMessage(il_thread_id, 1025, 0, 0)	// send message to the music player to draw fingering graph


end event

type st_11 from statictext within w_music_composer_fingering
integer x = 5083
integer y = 68
integer width = 777
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Note   X pct   Y pct    W pct  H pct"
boolean focusrectangle = false
end type

type sle_y_pct from singlelineedit within w_music_composer_fingering
integer x = 1673
integer y = 784
integer width = 119
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type sle_x_pct from singlelineedit within w_music_composer_fingering
integer x = 1545
integer y = 784
integer width = 133
integer height = 76
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type sle_rh_2_note from singlelineedit within w_music_composer_fingering
integer x = 5079
integer y = 580
integer width = 146
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "62"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_rh_2_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_rh_note_name_2.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_rh_note_level_2.text = right(ls_note_name, 1)
end event

type sle_rh_3_note from singlelineedit within w_music_composer_fingering
integer x = 5079
integer y = 652
integer width = 146
integer height = 76
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "64"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_rh_3_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_rh_note_name_3.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_rh_note_level_3.text = right(ls_note_name, 1)
end event

type sle_rh_4_note from singlelineedit within w_music_composer_fingering
integer x = 5079
integer y = 724
integer width = 146
integer height = 76
integer taborder = 140
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "65"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_rh_4_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_rh_note_name_4.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_rh_note_level_4.text = right(ls_note_name, 1)
end event

type sle_rh_5_note from singlelineedit within w_music_composer_fingering
integer x = 5079
integer y = 796
integer width = 146
integer height = 76
integer taborder = 150
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "67"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_rh_5_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_rh_note_name_5.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_rh_note_level_5.text = right(ls_note_name, 1)
end event

type sle_rh_1_note from singlelineedit within w_music_composer_fingering
integer x = 5079
integer y = 508
integer width = 146
integer height = 76
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "60"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_rh_1_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_rh_note_name_1.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_rh_note_level_1.text = right(ls_note_name, 1)
end event

type sle_lh_1_note from singlelineedit within w_music_composer_fingering
integer x = 5088
integer y = 112
integer width = 146
integer height = 76
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "55"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_lh_1_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_lh_note_name_1.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_lh_note_level_1.text = right(ls_note_name, 1)


end event

type sle_lh_5_note from singlelineedit within w_music_composer_fingering
integer x = 5088
integer y = 412
integer width = 146
integer height = 76
integer taborder = 140
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "48"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_lh_5_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_lh_note_name_5.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_lh_note_level_5.text = right(ls_note_name, 1)
end event

type sle_lh_4_note from singlelineedit within w_music_composer_fingering
integer x = 5083
integer y = 340
integer width = 146
integer height = 76
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_lh_4_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_lh_note_name_4.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_lh_note_level_4.text = right(ls_note_name, 1)
end event

type sle_lh_3_note from singlelineedit within w_music_composer_fingering
integer x = 5083
integer y = 268
integer width = 146
integer height = 76
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "52"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_lh_3_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_lh_note_name_3.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_lh_note_level_3.text = right(ls_note_name, 1)
end event

type sle_lh_2_note from singlelineedit within w_music_composer_fingering
integer x = 5083
integer y = 196
integer width = 146
integer height = 76
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "53"
borderstyle borderstyle = stylelowered!
end type

event modified;string ls_note_name
integer li_note_seq

li_note_seq = integer(sle_lh_2_note.text)

ls_note_name = wf_seq_to_note(li_note_seq)

ddlb_lh_note_name_2.text = left(ls_note_name, len(ls_note_name) - 1)
ddlb_lh_note_level_2.text = right(ls_note_name, 1)
end event

type sle_lh_1_x from singlelineedit within w_music_composer_fingering
integer x = 5234
integer y = 112
integer width = 146
integer height = 76
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_5_x from singlelineedit within w_music_composer_fingering
integer x = 5234
integer y = 412
integer width = 146
integer height = 76
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_4_x from singlelineedit within w_music_composer_fingering
integer x = 5234
integer y = 340
integer width = 146
integer height = 76
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_3_x from singlelineedit within w_music_composer_fingering
integer x = 5234
integer y = 268
integer width = 146
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_2_x from singlelineedit within w_music_composer_fingering
integer x = 5234
integer y = 196
integer width = 146
integer height = 76
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_2_x from singlelineedit within w_music_composer_fingering
integer x = 5230
integer y = 580
integer width = 146
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_3_x from singlelineedit within w_music_composer_fingering
integer x = 5230
integer y = 652
integer width = 146
integer height = 76
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_4_x from singlelineedit within w_music_composer_fingering
integer x = 5230
integer y = 724
integer width = 146
integer height = 76
integer taborder = 140
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_5_x from singlelineedit within w_music_composer_fingering
integer x = 5230
integer y = 796
integer width = 146
integer height = 76
integer taborder = 150
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_1_x from singlelineedit within w_music_composer_fingering
integer x = 5230
integer y = 508
integer width = 146
integer height = 76
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "50"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_1_y from singlelineedit within w_music_composer_fingering
integer x = 5390
integer y = 508
integer width = 146
integer height = 76
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "90"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_5_y from singlelineedit within w_music_composer_fingering
integer x = 5390
integer y = 796
integer width = 146
integer height = 76
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "85"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_4_y from singlelineedit within w_music_composer_fingering
integer x = 5390
integer y = 724
integer width = 146
integer height = 76
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "75"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_3_y from singlelineedit within w_music_composer_fingering
integer x = 5390
integer y = 652
integer width = 146
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "70"
borderstyle borderstyle = stylelowered!
end type

type sle_rh_2_y from singlelineedit within w_music_composer_fingering
integer x = 5390
integer y = 580
integer width = 146
integer height = 76
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "75"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_2_y from singlelineedit within w_music_composer_fingering
integer x = 5394
integer y = 196
integer width = 146
integer height = 76
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "75"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_3_y from singlelineedit within w_music_composer_fingering
integer x = 5394
integer y = 268
integer width = 146
integer height = 76
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "70"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_4_y from singlelineedit within w_music_composer_fingering
integer x = 5394
integer y = 340
integer width = 146
integer height = 76
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "75"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_5_y from singlelineedit within w_music_composer_fingering
integer x = 5394
integer y = 412
integer width = 146
integer height = 76
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "85"
borderstyle borderstyle = stylelowered!
end type

type sle_lh_1_y from singlelineedit within w_music_composer_fingering
integer x = 5394
integer y = 112
integer width = 146
integer height = 76
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
string text = "90"
borderstyle borderstyle = stylelowered!
end type

type cb_stop_keyboard from commandbutton within w_music_composer_fingering
integer x = 5371
integer width = 352
integer height = 68
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean enabled = false
string text = "Stop Keyboard"
end type

event clicked;enabled = false
cb_start_keyboard.enabled = true
cb_play_note.enabled = true
cb_draw.enabled = false
extPostThreadMessage(il_thread_id,18,0,0)
il_thread_id = 0
extClearCurGraph()
extClearGraphLib() 
end event

type cb_start_keyboard from commandbutton within w_music_composer_fingering
integer x = 4699
integer width = 389
integer height = 68
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Start Keyboard"
end type

event clicked;string ls_shmem_buf, ls_right_dev_name, ls_prim_or_second = "01", ls_finger_prompt_ind = "01"
long ll_pb_win_handle, ll_kb_handle, ll_kb_dc, ll_i, ll_kb_width, ll_divider, ll_remainder, ll_unit_pixel
long li_high_note = 72
long li_low_note = 36
long li_natural_note_count = 0
int li_i, li_j
long ll_x_array[], ll_y_array[], ll_array_size
string ls_name_id[] = {"1100","1200","1300","1400","1500","2100","2200","2300","2400","2500"}

cb_mk_entry.event clicked()
cb_get_list.event clicked()

ls_name_id[1] = ddlb_lh_1.text
ls_name_id[2] = ddlb_lh_2.text
ls_name_id[3] = ddlb_lh_3.text
ls_name_id[4] = ddlb_lh_4.text
ls_name_id[5] = ddlb_lh_5.text
ls_name_id[6] = ddlb_rh_1.text
ls_name_id[7] = ddlb_rh_2.text
ls_name_id[8] = ddlb_rh_3.text
ls_name_id[9] = ddlb_rh_4.text
ls_name_id[10] = ddlb_rh_5.text


li_low_note =  long(sle_min_note.text)
li_high_note =  long(sle_max_note.text)

enabled = false
cb_stop_keyboard.enabled = true

extClearGraphLib()
//extClearCurGraph()
//extResizeGraphLib(10)
//for li_i = 1 to upperbound(ls_name_id)

integer li_num

//li_num = FileOpen("t1.txt",  LineMode!, Write!, LockWrite!, Replace!)
for li_i = 1 to upperbound(is_id)
//	ll_array_size = extGetCoordGraphCount("finger_graphic.lhi", "finger_graphic.lhm", is_id[li_i])
	ll_array_size = extGetCoordGraphCount(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", is_id[li_i])
//	FileWrite(li_num, "Finger " +  is_id[li_i])
	for li_j = 1 to ll_array_size
		ll_x_array[li_j] = 0
		ll_y_array[li_j] = 0
	next
	//MessageBox("ll_array_size", ll_array_size)
	if ll_array_size > 0 then
//		extGetCoordGraphFile("finger_graphic.lhi", "finger_graphic.lhm", ll_x_array, ll_y_array, ll_array_size, is_id[li_i])
		extGetCoordGraphFile(sle_dest_lib.text + ".lhi", sle_dest_lib.text + ".lhm", ll_x_array, ll_y_array, ll_array_size, is_id[li_i])
	else
		MessageBox("Error", is_id[li_i] + " not found in the resource file!")
		return
	end if
	extLoadGraphData(ll_x_array, ll_y_array, ll_array_size, long(is_id[li_i]))
//	for li_j = 1 to ll_array_size
//		FileWrite(li_num, string(ll_x_array[li_j]) + " " + string(ll_y_array[li_j]))
//	next
	
next
//FileClose(li_num)


ll_pb_win_handle = handle(parent)
ls_right_dev_name = "Digital Audio (S/PDIF) (High De"

long ll_lo_note
long ll_hi_note
long ll_prompt_ind
long ll_finger_prompt_ind, ll_prim_or_second
string ls_dev_name2
ll_prim_or_second = 1
ll_lo_note = long(sle_min_note.text)
ll_hi_note = long(sle_max_note.text)
if cbx_key_only.checked then
	ll_prompt_ind = 2
else
	ll_prompt_ind = 3
end if
ll_finger_prompt_ind = long(ls_finger_prompt_ind)
ls_dev_name2 =  "dummy"
//extSetKeyboardParms(ll_pb_win_handle,long(sle_min_note.text),long(sle_max_note.text),1,li_prompt_ind,long(ls_finger_prompt_ind),ls_right_dev_name,"dummy") 

extToggleMIDI(0)
//extToggleMIDI(1)

// reajust keyboard width so that it is divisible by 2*number of natural notes
for li_i = li_low_note to li_high_note
	if IsNaturalNote(li_i) then
		li_natural_note_count ++
	end if
next
ll_divider = 2*li_natural_note_count
SectionCount = ll_divider
ll_kb_width = UnitsToPixels(p_1.width, XUnitsToPixels!)
ll_unit_pixel = ll_kb_width/ll_divider
ll_remainder = ll_kb_width - (ll_unit_pixel*ll_divider)
if ll_remainder < ll_unit_pixel/2 then // shrink down
	ll_kb_width = ll_kb_width - ll_remainder
else												// expand up
	ll_unit_pixel = ll_unit_pixel + 1
	ll_kb_width = ll_unit_pixel*ll_divider
end if
p_1.width = PixelsToUnits(ll_kb_width, XPixelsToUnits!)

extSetKeyboardParms(ll_pb_win_handle,ll_lo_note,ll_hi_note,ll_prim_or_second,ll_prompt_ind,ll_finger_prompt_ind,ls_right_dev_name,ls_dev_name2) 

p_1.height = ii_p1_height_orig
ll_kb_handle = handle(p_1)
ll_kb_dc = GetDC(ll_kb_handle)

is_startupfile = ".\iLearning Helper.ini"
extStartPianoThread2(ll_pb_win_handle,ll_kb_handle,ll_kb_dc,is_startupfile,il_thread_id)

enabled = false
cb_stop_keyboard.enabled = true

//is_note_list = is_empty_list
//wf_make_string_list( mle_note_coord.text, is_note_list)
//ii_current_i = 2

cb_draw.enabled = true


//p_1 event paint *****************************************************************************************************************************
//
//extPostThreadMessage(il_thread_id,15,0,0)
//
//
//
//p_1 event lbuttondown *****************************************************************************************************************************
//
//
//long li_x, li_y
//long msg_lbutton_down = 1060
//
//li_x = UnitsToPixels(xpos, XUnitsToPixels!)
//li_y = UnitsToPixels(ypos, YUnitsToPixels!)
////MessageBox("cliked", xpos);
//extPostThreadMessage(il_thread_id,msg_lbutton_down,li_x,li_y)
//
//
//
//p_1 event lbuttonup *****************************************************************************************************************************
//
//
//long li_x, li_y
//long msg_lbutton_up = 1061
//
//li_x = UnitsToPixels(xpos, XUnitsToPixels!)
//li_y = UnitsToPixels(ypos, YUnitsToPixels!)
////MessageBox("cliked", xpos);
//extPostThreadMessage(il_thread_id,msg_lbutton_up,0,0)
//
//
//event close *****************************************************************************************************************************
//
//extPostThreadMessage(il_thread_id,18,0,0)
//
//
//
//event ue_get_player_handle (message=1024) *****************************************************************************************************************************
//
//
//long ll_pb_win_handle
//string ls_shmem_buf
//string ls_device1 = "SoundMAX Digital Audio"
//string ls_device2 = "SSS USB Headphone Set"
//
////MessageBox("1024", ib_sound_seperation)
////return
//
//ll_pb_win_handle = handle(this)
//ls_shmem_buf = string(ll_pb_win_handle, "00000000") + string(ii_prompt_ind, "00") + string(ii_low_note, "000")  + string(ii_high_note,"000")
//ls_shmem_buf = ls_shmem_buf + "02"  + is_finger_prompt + is_left_dev_name// + space(82 - len(ls_device2))
//extSetMusicNoteToSharedMemory(ls_shmem_buf) // set variable in share memory for MusicLesson.exe to pick up
//cb_start.enabled = true
//cb_start.post event clicked()
//post wf_set_bar(1, ii_begin_note)
//post wf_set_bar(2, ii_end_note)
//
//
//
//event ue_key_played (message=1025) *****************************************************************************************************************************
//
//
//// the keyboard control send this message (1025), when key is detected as played
//
//string ls_note_to_keyboard, ls_local_filename, ls_text, ls_shmem_buf
//double ldb_note_duration
//long ll_note_duration = 0
//long ll_i, ll_pb_win_handle
//integer li_check_repeat
//
//if ib_playing_demo then return 0
//if ib_busy_token then return 0
//
//li_check_repeat = wf_check_repeat(ii_current_note)
//if li_check_repeat = 0 then
//	ii_current_note++
//else
//	ii_current_note = li_check_repeat
//end if
//
////for ll_i = 1 to 10
////	Yield()
////	Sleep(0.01)
////next
////timer(1, this)
////MessageBox("ue_key_played", "1")
////	sle_2.text = string(ii_current_note) + " " + string(ii_end_note)
//
//if ii_current_note <= ii_end_note then
//	if pos(lower(is_cur_picture_list[ii_current_note]),".jpg") > 0 or &
//		pos(lower(is_cur_picture_list[ii_current_note]),".bmp") > 0 or &
//		pos(lower(is_cur_picture_list[ii_current_note]),".gif") > 0 or &
//		pos(lower(is_cur_picture_list[ii_current_note]),".png") > 0 or &
//		pos(lower(is_cur_picture_list[ii_current_note]),".tif") > 0 then
//		ls_local_filename = gn_appman.is_sys_temp + "\music_sheet" + string(ii_current_note, "000") + right(is_cur_picture_list[ii_current_note], 4)
//		f_GetCacheResourceFile(is_cur_picture_list[ii_current_note], ls_local_filename)
//		uo_1.p_1.PictureName = ls_local_filename
//		Sleep(1)
//		post wf_reset_pic_coord()
////		uo_1.p_1.y = 1
//	end if
//	yield()
//	if idb_right_note_duration[1] > 0.0 then
//		ll_note_duration = idb_right_note_duration[1]*1000
//	end if
//	if idb_left_note_duration[1] > 0.0 then
//		ll_note_duration = idb_left_note_duration[1]*1000
//	end if
////	BringWindowToTop(il_player_handle)
//	extSetMusicNoteToSharedMemory(is_empty_note)
//	Send(il_player_handle, 1025, 0, 0)
//
//	if ii_prompt_ind <> 0 and  mod(ii_prompt_ind, 2) <> 2 then // not 0 and not 2
//		wf_rec_move(is_cur_text_list[ii_current_note])
//	end if
//	ls_note_to_keyboard = mid(is_cur_text_list[ii_current_note], 17, len(is_cur_text_list[ii_current_note]) - 16)
////	sle_2.text = ls_note_to_keyboard
//	extSetMusicNoteToSharedMemory(ls_note_to_keyboard)
////	send(il_player_handle, 1025, 0, 0)
//	extPostThreadMessage(il_thread_id,1025, 0, 0)
//else
////	MessageBox("ii_prompt_ind", ii_prompt_ind)
//	Sleep(2)
////	extSetMusicNoteToSharedMemory(is_empty_note)
////	Send(il_player_handle, 1025, 0, 0)
//	ii_current_note = ii_begin_note
//	ls_note_to_keyboard = right(is_cur_text_list[ii_current_note], len(is_cur_text_list[ii_current_note]) - 16)
//	extSetMusicNoteToSharedMemory(ls_note_to_keyboard)
////	Send(il_player_handle, 1025, 0, 0)
////	Send(il_player_handle, 1027, ii_prompt_ind, 0)
//	extPostThreadMessage(il_thread_id,1025, 0, 0)
//	extPostThreadMessage(il_thread_id,1027, ii_prompt_ind, 0)
//	cb_start.enabled = true
//	cb_start.visible = true
//	cb_close.visible = true
//	if mod(ii_prompt_ind, 4) = 0 and ii_prompt_ind > 0 then
//		sleep(1)
//		cb_play_demo.post event clicked()
//	else
//		ii_current_note = ii_begin_note
////		Send(handle(uo_1),277,6,0) // 6=TOP, 2=UP 3 DOWN
//		ls_text = trim(is_cur_text_list[ii_current_note])
//		if ii_prompt_ind > 1 then
//			wf_rec_move(ls_text)	
//		end if
//		if ii_begin_note = 2 then
//			cb_3.event clicked()
//		end if
//		ll_pb_win_handle = handle(this)
//		//ii_prompt_ind = 0
//		//ib_sound_seperation = true
//		ls_shmem_buf = string(ll_pb_win_handle, "00000000") + string(ii_prompt_ind, "00") + string(ii_low_note, "000")  + string(ii_high_note,"000")
//		ls_shmem_buf = ls_shmem_buf + "01"  + is_finger_prompt + is_right_dev_name// + space(82 - len(ls_device1))		
//		extSetMusicNoteToSharedMemory(ls_shmem_buf) // set variable in share memory for MusicLesson.exe to pick up
//		extPostThreadMessage(il_thread_id,1032, 0, 0)
////		SetDlgSignal()
//	end if
//end if
//return 1
//
//
//event open *****************************************************************************************************************************
//
//
//il_kb_handle = handle(p_keyboard1)
//il_kb_dc = GetDC(il_kb_handle)
//
//
////uo_1.x = 40
////uo_1.width = width - 120
////if is_finger_prompt = "01" then
////	p_keyboard1.height = p_keyboard1.height + p_keyboard1.height/2	
////end if
////uo_1.height = (height - p_keyboard1.height) - 300
////p_keyboard1.x = uo_1.x
////p_keyboard1.width = uo_1.width
////p_keyboard1.y = uo_1.y + uo_1.height + 20
//
//post wf_reset_pos()
//
//
//wf_reset_pos() *****************************************************************************************************************************
//
//
//long ll_pb_win_handle
//string ls_shmem_buf, msg
//string ls_title = "Piano"
//string ls_dll_name, ls_dll_func_name
//ls_dll_name = "MusicLesson.dll"
//ll_pb_win_handle = handle(this)
//ulong lul_startPlayer, llextStartPianoThread
//
//try
//ii_prompt_ind = dw_prompt.GetItemNumber(1, "prompt_ind")
//dw_prompt.Modify("prompt_ind.dddw.Lines=13")
////MessageBox("wf_reset_post",ii_prompt_ind)
//if not ib_data_process then // First time call to process left-right note
//	ib_data_process = true	
//
//	if pos(is_text_list[1], "F") > 0 then // finger prompt
//		is_finger_prompt = "01"
//		cbx_finger_hint.visible = true
//	else
//		is_finger_prompt = "00"
//		cbx_finger_hint.visible = false
//	end if	
//	wf_get_rh_lh_note_list()
////MessageBox("wf_reset_post","4")
//	if ib_both_exists then
//		if ii_prompt_ind < 0 or ii_prompt_ind > 12 then
//			ii_prompt_ind = 11
//		end if
//	elseif ib_right_exists then
//		if ii_prompt_ind < 0 or ii_prompt_ind > 5 then
//			ii_prompt_ind = 4
//		end if
//	else // Left Hand
//		if ii_prompt_ind <> 0 and (ii_prompt_ind < 5 or ii_prompt_ind > 8) then
//			ii_prompt_ind = 7
//		end if
//	end if 
//	
//	sle_2.text = sle_2.text + " ii_prompt_ind:" + string(ii_prompt_ind)
//	
//	if dw_prompt.RowCount() < 1 then dw_prompt.InsertRow(0)
//	
//	dw_prompt.SetItem(1, "prompt_ind", ii_prompt_ind)
//end if
//
//if not ib_reset_pos then
//	ib_reset_pos = true
//	uo_1.x = 40
//	uo_1.width = width - 120
//	if is_finger_prompt = "01" then
//		p_keyboard1.height = p_keyboard1.height + p_keyboard1.height/2	
//	end if
//	uo_1.height = (height - p_keyboard1.height) - 300
//	p_keyboard1.x = uo_1.x
//	p_keyboard1.width = uo_1.width
//	p_keyboard1.y = uo_1.y + uo_1.height + 20
//end if
//wf_set_current_data_array()
//wf_get_high_low_notes()	
//ii_begin_note = 2
//ii_end_note = upperbound(is_cur_text_list)	
//ls_shmem_buf = string(ll_pb_win_handle, "00000000") + string(ii_prompt_ind, "00") + string(ii_low_note, "000")  + string(ii_high_note,"000")
//ls_shmem_buf = ls_shmem_buf + "01"  + is_finger_prompt + is_right_dev_name// + space(82 - len(ls_device1))
//extSetMusicNoteToSharedMemory(ls_shmem_buf) // set variable in share memory for MusicLesson.exe to pick up
////MessageBox("is_right_dev_name", is_right_dev_name)
//il_kb_handle = handle(p_keyboard1)
//il_kb_dc = GetDC(il_kb_handle)
//extStartPianoThread2(ll_pb_win_handle,il_kb_handle,il_kb_dc,is_startupfile,il_thread_id)
////Sleep(4)
//if is_finger_prompt = "01" then
//	timer(1, this)
//else
//	timer(0, this)
//end if
//visible = true
////MessageBox("Multi-Threading Test", ls_shmem_buf)
//ii_p_1_y_orig = uo_1.p_1.y
//cb_start.visible = true
//ib_playing_token = true
//
//CATCH(RuntimeError re1)
//	msg = "Class=" + re1.Class + " Line=" + string(re1.Line) + " Number=" + string(re1.Number) + " RoutineName=" + re1.RoutineName + " Text=" + re1.Text
//	MessageBox("msg", msg)
//END TRY
//
//
//cb_start.event clicked() *****************************************************************************************************************************
//
//
//integer li_i
//
//string ls_note_to_keyboard, ls_text, ls_local_filename
//uo_1.p_1.visible = true
//uo_1.p_1.BringToTop = true
//
////MessageBox(string(upperbound(is_cur_text_list)), ii_begin_note)
//
//ii_current_note = ii_begin_note // first note
//ls_text = trim(is_cur_text_list[ii_current_note])
//for li_i =  1 to upperbound(istr_cur_repeat)
//	istr_cur_repeat[li_i].played = false
//next
//
//
//for ii_current_note = ii_begin_note to upperbound(is_cur_picture_list) 
//	// paint music sheet
//	if pos(lower(is_cur_picture_list[ii_current_note]),".jpg") > 0 or &
//		pos(lower(is_cur_picture_list[ii_current_note]),".bmp") > 0 or &
//		pos(lower(is_cur_picture_list[ii_current_note]),".gif") > 0 or &
//		pos(lower(is_cur_picture_list[ii_current_note]),".png") > 0 or &
//		pos(lower(is_cur_picture_list[ii_current_note]),".tif") > 0 then
//		ls_local_filename = gn_appman.is_sys_temp + "\music_sheet" + string(ii_current_note, "000") + right(is_cur_picture_list[ii_current_note], 4)
//		f_GetCacheResourceFile(is_cur_picture_list[ii_current_note], ls_local_filename)
//		uo_1.p_1.PictureName = ls_local_filename
//		wf_reset_pic_coord()
//		exit
//	end if
//next
//
//ii_current_note = ii_begin_note // first note
//ls_text = trim(is_cur_text_list[ii_current_note])
//
//if ii_prompt_ind <> 0 and mod(ii_prompt_ind, 4) <> 2 then // not 0 and 2
//	// move hint highlight
//	wf_rec_move(ls_text)
//	uo_1.st_11.visible = true
//	uo_1.st_2.visible = true
//	uo_1.st_3.visible = true
//	uo_1.st_4.visible = true
//else
//	uo_1.st_11.visible = false
//	uo_1.st_2.visible = false
//	uo_1.st_3.visible = false
//	uo_1.st_4.visible = false	
//end if
//
////MessageBox("ii_prompt_ind", ii_prompt_ind)
////Send(il_player_handle, 1027, ii_prompt_ind, 0) //reset prompt
//
//ls_note_to_keyboard = mid(ls_text, 17, len(ls_text) - 16)
////if mod(len(ls_note_to_keyboard)/8, 2) = 1 then ls_note_to_keyboard = ls_note_to_keyboard + "00000000"
////MessageBox("ls_note_to_keyboard", ls_note_to_keyboard)
//extSetMusicNoteToSharedMemory(ls_note_to_keyboard) //set key-note information to sharememory
//Sleep(1)
//
////MessageBox(ls_note_to_keyboard, ii_prompt_ind)
//if ii_prompt_ind > 0 then
//	extPostThreadMessage(il_player_handle, 1025, 0, 0)	// send message to the music player to inform Next Note to play data in sharemory
//end if






end event

type cb_8 from commandbutton within w_music_composer_fingering
integer x = 5
integer y = 480
integer width = 183
integer height = 72
integer taborder = 70
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Extract"
end type

event clicked;integer li_i, li_r_count, li_l_count, li_j, li_note, li_pos, li_entry_note_divider = 8, li_note_len = 2, li_coord_len = 16
string ls_tmp, ls_entry_list[], ls_note_list[], ls_coord_list[], ls_empty_note = "00000000"
string ls_entry, ls_note, ls_coord, ls_f_attributes, ls_l_note,ls_r_note, ls_seq, ls_sub_note, ls_note_value, ls_note_entry

If len(mle_note.text) > 3 or len(mle_note_coord.text) > 3 or len(mle_finger_attributes.text) > 3 then 
	If MessageBox("Warning", "Extracted Data Will Overwrite Existing Data", Question!, YesNo!) = 2 then return
end if

ls_tmp = mle_entry.text
if len(ls_tmp) > 0 then
	wf_make_string_list(ls_tmp, ls_entry_list)
	if upperbound(ls_entry_list) = 0 then
		MessageBox("Error", "Empty Note List, Cannot Extract!")
		return
	end if
end if	

if cbx_new_format.checked then 
	li_entry_note_divider = 9
	li_coord_len = 18
	li_note_len = 3
	ls_empty_note = "000000000"
end if

if upperbound(ls_entry_list) > 0 then
	ls_coord = ls_entry_list[1]
	ls_note_entry = ls_entry_list[1] + "~r~n"
//	ls_note_entry = "H~r~n"
	if cbx_new_format.checked then 
//		ls_f_attributes = "H~r~n"
		ls_f_attributes = ls_entry_list[1] + "~r~n"
	end if
end if
for li_i = 2 to upperbound(ls_entry_list)
	li_pos = pos(ls_entry_list[li_i], "FE")
	if cbx_new_format.checked then 
		if li_pos > 0 then
			ls_f_attributes = ls_f_attributes + left(ls_entry_list[li_i], li_pos + 1)
			ls_entry_list[li_i] = right(ls_entry_list[li_i], len(ls_entry_list[li_i]) - (li_pos + 1))
		end if	
		ls_f_attributes = ls_f_attributes +  + "~r~n"
	end if
	ls_coord = ls_coord + "~r~n" + left(ls_entry_list[li_i], li_coord_len)
	ls_note = mid(ls_entry_list[li_i], li_coord_len + 1, len(ls_entry_list[li_i]) - li_coord_len)
	for li_j = 1 to len(ls_note)/li_entry_note_divider
		ls_sub_note = mid(ls_note, (li_j - 1)*li_entry_note_divider + 1, li_entry_note_divider)
		if mod(li_j, 2) = 1 then // right note
			if ls_sub_note <> ls_empty_note then // real right note
				ls_seq = mid(ls_sub_note, 5, li_note_len)
				ls_note_value = wf_seq_to_note(integer(ls_seq))
				if ls_note_value = "" or ls_note_value = "00" then
					ls_note_entry = ls_note_entry + "R" + left(ls_sub_note, 4)
				else
					ls_note_entry = ls_note_entry + "R" + left(ls_sub_note, 4) + right(ls_sub_note, 2) + ls_note_value
				end if
			end if
		else		// left
			if ls_sub_note <> ls_empty_note then // real right note
				ls_seq = mid(ls_sub_note, 5, li_note_len)
				ls_note_value = wf_seq_to_note(integer(ls_seq))
				if ls_note_value = "" or ls_note_value = "00" then
					ls_note_entry = ls_note_entry + "L" + left(ls_sub_note, 4)
				else
					ls_note_entry = ls_note_entry + "L" + left(ls_sub_note, 4) + right(ls_sub_note, 2) + ls_note_value
				end if
			end if			
		end if		
	next
	ls_note_entry = ls_note_entry + "~r~n"
next

mle_note_coord.text = ls_coord
mle_note.text = ls_note_entry
mle_finger_attributes.text = ls_f_attributes


//integer li_i, li_r_count, li_l_count, li_j, li_note, li_pos, li_entry_note_divider = 8, li_note_len = 2
//string ls_tmp, ls_entry_list[], ls_note_list[], ls_coord_list[], ls_empty_note = "00000000"
//string ls_entry, ls_note, ls_coord, ls_f_attributes, ls_l_note,ls_r_note, ls_seq, ls_sub_note, ls_note_value, ls_note_entry
//string ls_x1,ls_y1,ls_x2,ls_y2, ls_coord_tmp
//
//If len(mle_note.text) > 3 or len(mle_note_coord.text) > 3 or len(mle_finger_attributes.text) > 3 then 
//	If MessageBox("Warning", "Extracted Data Will Overwrite Existing Data", Question!, YesNo!) = 2 then return
//end if
//
//ls_tmp = mle_entry.text
//if len(ls_tmp) > 0 then
//	wf_make_string_list(ls_tmp, ls_entry_list)
//	if upperbound(ls_entry_list) = 0 then
//		MessageBox("Error", "Empty Note List, Cannot Extract!")
//		return
//	end if
//end if	
//
//if cbx_new_format.checked then 
//	li_entry_note_divider = 9
//	li_note_len = 3
//	ls_empty_note = "000000000"
//end if
//
//if upperbound(ls_entry_list) > 0 then
//	ls_coord = ls_entry_list[1]
//	ls_note_entry = "H~r~n"
//	if cbx_new_format.checked then 
//		ls_f_attributes = "H~r~n"
//	end if
//end if
//for li_i = 2 to upperbound(ls_entry_list)
//	li_pos = pos(ls_entry_list[li_i], "FE")
//	if cbx_new_format.checked then 
//		if li_pos > 0 then
//			ls_f_attributes = ls_f_attributes + left(ls_entry_list[li_i], li_pos + 1)
//			ls_entry_list[li_i] = right(ls_entry_list[li_i], len(ls_entry_list[li_i]) - (li_pos + 1))
//		end if	
//		ls_f_attributes = ls_f_attributes +  + "~r~n"
//	end if
//	ls_coord_tmp = left(ls_entry_list[li_i], 16)
//	ls_x1 = left(ls_coord_tmp, 4)
//	ls_y1 = mid(ls_coord_tmp, 5, 4)
//	ls_x2 = mid(ls_coord_tmp, 9, 4)
//	ls_y2 = mid(ls_coord_tmp, 13, 4)
//	ls_coord_tmp = ls_x1 + "0" + ls_y1 + ls_x2 + "0" + ls_y2
//	ls_coord = ls_coord + "~r~n" + ls_coord_tmp
////	ls_coord = ls_coord + "~r~n" + left(ls_entry_list[li_i], 16)	
//	ls_note = mid(ls_entry_list[li_i], 17, len(ls_entry_list[li_i]) - 16)
//	for li_j = 1 to len(ls_note)/li_entry_note_divider
//		ls_sub_note = mid(ls_note, (li_j - 1)*li_entry_note_divider + 1, li_entry_note_divider)
//		if mod(li_j, 2) = 1 then // right note
//			if ls_sub_note <> ls_empty_note then // real right note
//				ls_seq = mid(ls_sub_note, 5, li_note_len)
//				ls_note_value = wf_seq_to_note(integer(ls_seq))
//				ls_note_entry = ls_note_entry + "R" + left(ls_sub_note, 4) + right(ls_sub_note, 2) + ls_note_value
//			end if
//		else		// left
//			if ls_sub_note <> ls_empty_note then // real right note
//				ls_seq = mid(ls_sub_note, 5, li_note_len)
//				ls_note_value = wf_seq_to_note(integer(ls_seq))
//				ls_note_entry = ls_note_entry + "L" + left(ls_sub_note, 4) + right(ls_sub_note, 2) + ls_note_value
//			end if			
//		end if		
//	next
//	ls_note_entry = ls_note_entry + "~r~n"
//next
//
//mle_note_coord.text = ls_coord
//mle_note.text = ls_note_entry
//mle_finger_attributes.text = ls_f_attributes
end event

type cb_5 from commandbutton within w_music_composer_fingering
integer x = 613
integer y = 4
integer width = 78
integer height = 80
integer taborder = 70
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = ".."
end type

event clicked;integer li_i, li_j, li_seq, li_begin, li_pos, li_len, li_value
string ls_tmp, ls_line, ls_Docname, ls_named, ls_path, ls_cur_dir, ls_bmp = "tttmmmppp.bmp"
long graphW, graphH

//ls_Docname = "c:\tmp\123"
is_graph_path = sle_file_name.text
ls_cur_dir = GetCurrentDirectory()
li_j = 0
for li_i = 1 to len(is_graph_path)
	if mid(is_graph_path, len(is_graph_path) + 1 - li_i, 1) = "\" then exit
	li_j++
next

if li_j < len(is_graph_path) then
	ls_path = left(is_graph_path, len(is_graph_path) - li_j)
else
	ls_path = ".\"
end if
ChangeDirectory(ls_path)
//li_value = GetFileOpenName("Select Image File", ls_Docname, ls_named, "JPG", "JPeg File (*.JPG),*.JPG," + " GIF Files (*.GIF),*.GIF," + " BMP Files (*.BMP),*.BMP," + " PNG Files (*.PNG),*.PNG")
li_value = GetFileOpenName("Select Image File", ls_Docname, ls_named, "PNG", "PNG File (*.PNG),*.PNG,"  + " PNG Files (*.PNG),*.PNG,"  + " JPeg Files (*.JPG),*.JPG," + " GIF Files (*.GIF),*.GIF," + " BMP Files (*.BMP),*.BMP") 

ChangeDirectory(ls_cur_dir)
if li_value = 1 then
	is_graph_path = ls_Docname
	sle_file_name.text = is_graph_path
	wf_display_music_sheet()
//	if pos(lower(ls_named), ".png") > 0 then // convert to BMP
//		ConvertGraphFile(sle_file_name.text, ls_bmp)
////		MessageBox(ls_named, ls_tmp)
//		uo_1.uo_1.p_1.PictureName = ls_bmp
//	else
//		uo_1.uo_1.p_1.PictureName = sle_file_name.text		
//	end if
//	//sle_file_name.text = "C:\Han\SOFTWARE DEVELOPMENT\Music\score_bitmap\oh_usanna.bmp"
//	//MessageBox("sle_file_name.text", sle_file_name.text)
//	GetGraphDim(sle_file_name.text, graphW, graphH)
//	graphW = PixelsToUnits(graphW, XPixelsToUnits!)
//	graphH = PixelsToUnits(graphH, YPixelsToUnits!)
////	uo_1.uo_1.p_1.PictureName = sle_file_name.text
//	uo_1.UnitsPerLine = graphH/100
//	uo_1.uo_1.x = 0
//	uo_1.uo_1.y = 0
//	uo_1.uo_1.p_1.x = 0
//	uo_1.uo_1.p_1.y = 0
//	uo_1.LinesPerPage = 10
//	uo_1.uo_1.width = graphW
//	uo_1.uo_1.height = graphH
//	uo_1.uo_1.p_1.width = graphW
//	uo_1.uo_1.p_1.height = graphH
end if

end event

type sle_file_name from singlelineedit within w_music_composer_fingering
integer y = 4
integer width = 613
integer height = 88
integer taborder = 20
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type cb_new_format from commandbutton within w_music_composer_fingering
integer x = 187
integer y = 480
integer width = 311
integer height = 72
integer taborder = 60
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Make Entries"
end type

event clicked;integer li_i, li_j,li_seq, li_begin, li_pos, li_len, li_left_note_list[], li_right_note_list[], li_empty_list[]
integer li_left_count, li_right_count, li_max_count
string ls_tmp, ls_line, ls_note_list[], ls_coord_list[],ls_f_attr_list[], ls_left_note_list[], ls_right_note_list[], ls_empty_list[]
string ls_entry
ls_tmp = mle_note.text
if len(ls_tmp) > 0 then
	wf_make_string_list(ls_tmp, ls_note_list)
end if	
ls_tmp = mle_note_coord.text
if len(ls_tmp) > 0 then
	wf_make_string_list(ls_tmp, ls_coord_list)
end if
ls_tmp = mle_finger_attributes.text
if len(ls_tmp) > 0 then
	wf_make_string_list(ls_tmp, ls_f_attr_list)
end if
string msg
//msg = "upperbound(ls_note_list):" + string(upperbound(ls_note_list)) + " upperbound(ls_coord_list):" + string(upperbound(ls_coord_list)) + " upperbound(ls_f_attr_list):" + string(upperbound(ls_f_attr_list))
//MessageBox("msg", msg)

if upperbound(ls_note_list) <> upperbound(ls_coord_list) then
	MessageBox("Error", "Un-equal list count")
	msg = "upperbound(ls_note_list):" + string(upperbound(ls_note_list)) + " upperbound(ls_coord_list):" + string(upperbound(ls_coord_list)) 
	MessageBox("msg", msg)
	return
else
	if upperbound(ls_note_list) <> upperbound(ls_f_attr_list) then
		MessageBox("Error", "Un-equal list count")
		msg = "upperbound(ls_note_list):" + string(upperbound(ls_note_list)) + " upperbound(ls_coord_list):" + string(upperbound(ls_coord_list)) + " upperbound(ls_f_attr_list):" + string(upperbound(ls_f_attr_list))
		MessageBox("msg", msg)
		return
	end if
end if

mle_entry.text = ""

for li_i = 1 to upperbound(ls_note_list)
	if li_i = 1 then
		ls_entry = ls_coord_list[li_i]
		mle_entry.text = mle_entry.text + ls_entry + "~r~n"
		continue
	end if
	if cbx_new_format.checked then 
		ls_entry = ls_f_attr_list[li_i] + ls_coord_list[li_i]
	else
		ls_entry  = ls_coord_list[li_i]
	end if
	li_left_note_list = li_empty_list
	li_right_note_list = li_empty_list
	ls_left_note_list = ls_empty_list
	ls_right_note_list = ls_empty_list
//	MessageBox(ls_note_list[li_i], li_i)
	wf_get_note_list("R", ls_note_list[li_i], li_right_note_list, ls_right_note_list)
	wf_get_note_list("L", ls_note_list[li_i], li_left_note_list, ls_left_note_list)
//	for li_j = 1 to upperbound(li_left_note_list)
//		MessageBox(ls_left_note_list[li_j], li_left_note_list[li_j])
//	next
	li_right_count = upperbound(li_right_note_list)
	if li_right_count > upperbound(ls_right_note_list) then li_right_count = upperbound(ls_right_note_list)
	li_left_count = upperbound(li_left_note_list)
	if li_left_count > upperbound(ls_left_note_list) then li_left_count = upperbound(ls_left_note_list)
//	MessageBox("ls_left_note_list count: " + string(upperbound(ls_left_note_list)), "li_left_note_list count: " + string(upperbound(li_left_note_list)))
//	for li_j = 1 to li_right_count
//		MessageBox(string(li_j) + " right note char: " + ls_right_note_list[li_j], "right note num: " + string(li_right_note_list[li_j]))
//	next
	
	if li_right_count > li_left_count then
		li_max_count = li_right_count
	else
		li_max_count = li_left_count
	end if
//	MessageBox("li_left_count count: " + string(li_left_count), "li_right_count count: " + string(li_right_count))
	for li_j = 1 to li_max_count
		if li_j <= li_right_count then
			if cbx_new_format.checked then
				ls_entry = ls_entry + left(ls_right_note_list[li_j], 4) + string(li_right_note_list[li_j], "000") + right(ls_right_note_list[li_j], 2)
			else
				ls_entry = ls_entry + left(ls_right_note_list[li_j], 4) + string(li_right_note_list[li_j], "00") + right(ls_right_note_list[li_j], 2)
			end if
		else
			if cbx_new_format.checked then
				ls_entry = ls_entry + "000000000"
			else
				ls_entry = ls_entry + "00000000"
			end if
		end if			
		if li_j <= li_left_count then
			ls_entry = ls_entry + left(ls_left_note_list[li_j], 4) + string(li_left_note_list[li_j], "000") + right(ls_left_note_list[li_j], 2) 
		elseif li_j < li_max_count then
			if cbx_new_format.checked then
				ls_entry = ls_entry + "000000000"
			else
				ls_entry = ls_entry + "00000000"
			end if
		end if			
	next
	mle_entry.text = mle_entry.text + ls_entry + "~r~n"
//	ls_note = wf_seq_to_note(li_seq_list[li_i])
next



end event

type cb_3 from commandbutton within w_music_composer_fingering
boolean visible = false
integer y = 324
integer width = 293
integer height = 88
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Add Header"
end type

event clicked;mle_note.text = "H~r~n"
mle_note_coord.text = string(p_1.width, "0000") +string(p_1.height, "0000") 

end event

type rb_3 from radiobutton within w_music_composer_fingering
boolean visible = false
integer x = 658
integer y = 152
integer width = 379
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Row Lower"
end type

type st_6 from statictext within w_music_composer_fingering
boolean visible = false
integer y = 348
integer width = 302
integer height = 68
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Row Lower"
alignment alignment = right!
boolean focusrectangle = false
end type

type st_5 from statictext within w_music_composer_fingering
boolean visible = false
integer y = 240
integer width = 302
integer height = 72
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Row Upper"
alignment alignment = right!
boolean focusrectangle = false
end type

type sle_2 from singlelineedit within w_music_composer_fingering
boolean visible = false
integer x = 311
integer y = 328
integer width = 343
integer height = 92
integer taborder = 10
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type rb_5 from radiobutton within w_music_composer_fingering
boolean visible = false
integer x = 658
integer y = 296
integer width = 366
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Note"
end type

type rb_4 from radiobutton within w_music_composer_fingering
boolean visible = false
integer x = 658
integer y = 224
integer width = 361
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Note120"
end type

type rb_2 from radiobutton within w_music_composer_fingering
boolean visible = false
integer x = 658
integer y = 80
integer width = 370
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Row Upper"
boolean checked = true
end type

type st_4 from statictext within w_music_composer_fingering
boolean visible = false
integer x = 590
integer y = 140
integer width = 14
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 255
long bordercolor = 255
boolean focusrectangle = false
end type

type st_3 from statictext within w_music_composer_fingering
boolean visible = false
integer x = 617
integer y = 140
integer width = 14
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 255
long bordercolor = 255
boolean focusrectangle = false
end type

type st_2 from statictext within w_music_composer_fingering
boolean visible = false
integer x = 562
integer y = 140
integer width = 14
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 255
long bordercolor = 255
boolean focusrectangle = false
end type

type cb_2 from commandbutton within w_music_composer_fingering
integer x = 302
integer y = 556
integer width = 311
integer height = 72
integer taborder = 40
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Reset Note"
end type

event clicked;dwobject dwo

if cbx_dw_visible.checked then
	ii_current_row = 2
	dw_1.ScrollToRow(ii_current_row)
	dw_1.SelectRow(0, false)
	dw_1.SelectRow(ii_current_row, true)		
	dw_1.event doubleclicked(0,0,ii_current_row,dwo)
else
	is_note_list = is_empty_list
	if len(mle_note_coord.text) < 16 then
		MessageBox("Error", "No Coordinate Data")
		return 0
	end if
	wf_make_string_list( mle_note_coord.text, is_note_list)
	
	if len(mle_note_coord.text) > 20 then
		wf_make_string_list( mle_finger_attributes.text, is_fingering_list)
	end if
	
	//st_1.BringToTop = true
	//st_2.BringToTop = true
	//st_3.BringToTop = true
	//st_4.BringToTop = true
	//
	//st_1.Visible = true
	//st_2.Visible = true
	//st_3.Visible = true
	//st_4.Visible = true
	
	ii_current_i = 2
	wf_rec_move(is_note_list[ii_current_i])
	if not cb_start_keyboard.enabled then // the button has been clicked, so the keyboard player is ready
		if upperbound(is_fingering_list) > 1 then
			wf_fingering_test(is_fingering_list[ii_current_i], "")
		end if
	end if
end if
end event

type cb_1 from commandbutton within w_music_composer_fingering
integer y = 552
integer width = 293
integer height = 72
integer taborder = 30
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Next Note"
end type

event clicked;dwobject dwo
if cbx_dw_visible.checked then	
	if ii_current_row < dw_1.RowCount() then
		ii_current_row++
//		sle_4.text = string(ii_current_row)
		dw_1.ScrollToRow(ii_current_row)
		dw_1.SelectRow(0, false)
		dw_1.SelectRow(ii_current_row, true)		
		dw_1.event doubleclicked(0,0,ii_current_row,dwo)
	end if
else
	ii_current_i++
	if ii_current_i <= upperbound(is_note_list) then
		wf_rec_move(is_note_list[ii_current_i])
	end if
	if not cb_start_keyboard.enabled then // the button has been clicked, so the keyboard player is ready
		if ii_current_i <= upperbound(is_fingering_list) then
			wf_fingering_test(is_fingering_list[ii_current_i], "")
	//		wf_fingering_test()
		end if
	end if
end if

end event

type sle_1 from singlelineedit within w_music_composer_fingering
boolean visible = false
integer x = 311
integer y = 232
integer width = 343
integer height = 92
integer taborder = 10
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type st_1 from statictext within w_music_composer_fingering
boolean visible = false
integer x = 640
integer y = 140
integer width = 14
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 255
long bordercolor = 255
boolean focusrectangle = false
end type

type p_1 from picture within w_music_composer_fingering
event paint pbm_paint
event ue_lbuttondown pbm_lbuttondown
event ue_lbuttonup pbm_lbuttonup
integer x = 18
integer y = 2112
integer width = 5824
integer height = 796
boolean focusrectangle = false
end type

event paint;extPostThreadMessage(il_thread_id,15,0,0)

return
//long li_x, li_y
//
//ulong ul_win_handle, ul_device, ul_color
//
//integer li_num, li_image_width, li_image_height, li_i,li_j, li_pos
//string ls_buf, ls_sub
//
//ul_win_handle = handle(p_1)
//
//ul_device = GetDC(ul_win_handle)
//
//li_num = FileOpen("c:\\graph_coord1.txt")
//
//Do While FileRead(li_num, ls_buf) > 5
//	li_pos = pos(ls_buf, " ")
//	ls_sub = left(ls_buf, li_pos)
//	if len(ls_sub) > 0 then
//		li_x = long(ls_sub)
//		ls_sub = right(ls_buf, len(ls_buf) - li_pos)
//		if len(ls_sub) > 0 then
//			li_y = long(ls_sub)
//			SetPixel(ul_device, li_y, li_x, 255)
//		end if
//	end if
//Loop
//FileClose(li_num)
//
//return 1

end event

event ue_lbuttondown;long li_x, li_y
long msg_lbutton_down = 1060

li_x = UnitsToPixels(xpos, XUnitsToPixels!)
li_y = UnitsToPixels(ypos, YUnitsToPixels!)


extPostThreadMessage(il_thread_id,msg_lbutton_down,li_x,li_y)

end event

event ue_lbuttonup;long li_x, li_y
long msg_lbutton_up = 1061

li_x = UnitsToPixels(xpos, XUnitsToPixels!)
li_y = UnitsToPixels(ypos, YUnitsToPixels!)
//MessageBox("cliked", xpos);
//extPostThreadMessage(il_thread_id,msg_lbutton_up,0,0)

end event

type gb_1 from groupbox within w_music_composer_fingering
boolean visible = false
integer x = 649
integer y = 48
integer width = 366
integer height = 340
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

type gb_2 from groupbox within w_music_composer_fingering
integer x = 4402
integer y = 108
integer width = 96
integer height = 780
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
end type

type mle_finger_attributes from multilineedit within w_music_composer_fingering
integer x = 2240
integer y = 60
integer width = 1056
integer height = 712
integer taborder = 40
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type mle_note from multilineedit within w_music_composer_fingering
integer x = 1403
integer y = 60
integer width = 837
integer height = 712
integer taborder = 20
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type mle_note_coord from multilineedit within w_music_composer_fingering
integer x = 686
integer y = 60
integer width = 722
integer height = 712
integer taborder = 40
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type mle_entry from multilineedit within w_music_composer_fingering
integer x = 3287
integer y = 60
integer width = 1001
integer height = 712
integer taborder = 30
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type dw_1 from datawindow within w_music_composer_fingering
integer x = 690
integer y = 68
integer width = 3602
integer height = 716
integer taborder = 50
boolean bringtotop = true
string title = "none"
string dataobject = "d_finger_attr_buf"
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

event doubleclicked;long ll_seq_row, ll_seq, li_i, ll_width, ll_height
string ls_coord, ls_finger_attr, ls_entry
string ls_file_name, ls_token, ls_res_file_name = ""
if row < 2 or row > rowcount() then return 0

if GetItemNumber(1, "seq") < 10 then
	MessageBox("Warning", "Please Genereate the sequence!")
	return
end if

ll_seq = GetItemNumber(row, "seq")
ll_seq_row = ll_seq/10
ls_coord = GetItemString(row, "coord")
ls_finger_attr = GetItemString(row, "finger")
//sle_4.text = string(ll_seq_row)

if trim(ls_coord) <> "" then 
	wf_rec_move(ls_coord)
end if
if GetItemNumber(1, "seq") < 10 then
	MessageBox("Warning", "Please Genereate the sequence!")
	return
end if
if cbx_view_image.checked then // retrieve image
	for li_i = 1 to len(sle_dw_path.text)
		ls_token = mid(sle_dw_path.text, len(sle_dw_path.text) + 1 - li_i, 1)
		if ls_token = "\" then exit
		ls_res_file_name = ls_token + ls_res_file_name 
	next
	ls_res_file_name = left(ls_res_file_name, len(ls_res_file_name) - 4) + "_fingering_image"
	is_image_prefix = ls_res_file_name
	if not cbx_append_right_hand.checked then
		ls_res_file_name = ls_res_file_name + "_left"
	elseif not cbx_append_left_hand.checked then
		ls_res_file_name = ls_res_file_name + "_right"
	end if
	if (not FileExists(ls_res_file_name + ".lhi")) or (not FileExists(ls_res_file_name + ".lhm")) then
		MessageBox("Error", "Create None Active Animation First!")
		return 0
	end if
		
	//cbx_mix_image	
	ll_seq = dw_1.GetItemNumber(row,"SEQ")
	if cbx_mix_image.checked then
		if mod(ll_seq, 10) = 0 then // the active fingering entry, show two images and the second image is displayed through timer
			ls_file_name = string(ll_seq, "000000") + ".png"
			f_set_picture_with_lhm(ls_res_file_name, ls_file_name, p_1, ll_width, ll_height)
			il_animate_id = 1000000 + ll_seq
			ib_animate_fingering = true
			timer(1, parent)
		end if
		return	
	end if
	if cbx_activate_animation.checked then // ONLY display the second image of the animated images
		if mod(ll_seq, 10) = 0 then // the active fingering entry
			ls_file_name = string(1000000 + ll_seq) + ".png"
			f_set_picture_with_lhm(ls_res_file_name, ls_file_name, p_1, ll_width, ll_height)
			return
		else
			return
		end if
	else
		ls_file_name = string(ll_seq, "000000") + ".png"
		f_set_picture_with_lhm(ls_res_file_name, ls_file_name, p_1, ll_width, ll_height)
	end if
else // draw fingering
	if cbx_1.checked then // a full DataWindow
		if mod(ll_seq, 10) = 0 then // a valid note
			if cbx_activate_animation.checked then	// treat as trans
				extTransFinger(TRANSITTION_MODE)
			else 
				extTransFinger(NONE_TRANSITTION_MODE) // not a transitional fingering
			end if
			if upperbound(is_bh_text_list) >= ll_seq_row then // use text_list generated by get_note_list()
				if cbx_append_left_hand.checked and cbx_append_right_hand.checked then
					ls_entry = is_bh_text_list[ll_seq_row]
				elseif cbx_append_left_hand.checked and upperbound(ii_bh_to_lh) >= ll_seq_row  then
					// ls_entry = is_lh_text_list[ll_seq_row] // because LH may be collapsed to remove empty entry
//					MessageBox("upperbound(ii_bh_to_lh)", upperbound(ii_bh_to_lh))
//					MessageBox("ii_bh_to_lh[2]", ii_bh_to_lh[ll_seq_row])
					
					ls_entry = is_lh_text_list[ii_bh_to_lh[ll_seq_row]]
				elseif upperbound(ii_bh_to_rh) >= ll_seq_row then
					// ls_entry = is_rh_text_list[ll_seq_row]	// because RH may be collapsed to remove empty entry
					ls_entry = is_rh_text_list[ii_bh_to_rh[ll_seq_row]]	
				else	// not showing fingering
					ls_entry = is_bh_text_list[ll_seq_row]
				end if			
			else
				ls_entry = GetItemString(row, "entry")
			end if	
		else		// transitional note
			extTransFinger(TRANSITTION_MODE) // a transitional fingering
			if ll_seq_row + 1 <= upperbound(is_bh_text_list) then
				if cbx_append_left_hand.checked and cbx_append_right_hand.checked then
					ls_entry = is_bh_text_list[ll_seq_row + 1]
				elseif cbx_append_left_hand.checked and upperbound(is_lh_text_list) >= ll_seq_row + 1 then
					ls_entry = is_lh_text_list[ll_seq_row]
				elseif upperbound(is_rh_text_list) >= ll_seq_row + 1 then
					ls_entry = is_rh_text_list[ll_seq_row + 1]	
				end if			
			else
				ls_entry = GetItemString(row, "entry")			
			end if
		end if
	else		// Sequential DataWindow
		extTransFinger(NONE_TRANSITTION_MODE) // not a transitional fingering
		if upperbound(is_bh_text_list) >= row then // use text_list generated by get_note_list()
		
			if cbx_append_left_hand.checked and cbx_append_right_hand.checked then
				ls_entry = is_bh_text_list[row]
			elseif cbx_append_left_hand.checked and upperbound(is_lh_text_list) >= row  then
				//ls_entry = is_lh_text_list[row]
				ls_entry = is_lh_text_list[ii_bh_to_lh[ll_seq_row]]
			elseif upperbound(ii_bh_to_rh) >= row then
				//ls_entry = is_rh_text_list[row]	
				ls_entry = is_rh_text_list[ii_bh_to_rh[ll_seq_row]]
			end if
		else
			ls_entry = GetItemString(row, "entry")
		end if
	end if
	
	if IsNull(ls_coord) then ls_coord = ""
	if IsNull(ls_finger_attr) then ls_finger_attr = ""
	
//	if trim(ls_coord) <> "" then 
//		wf_rec_move(ls_coord)
//	end if
	if not cb_start_keyboard.enabled then // the button has been clicked, so the keyboard player is ready
		if trim(ls_finger_attr) <> "" then 
			wf_fingering_test(ls_finger_attr, ls_entry)
		end if
	end if
end if
end event

event clicked;string ls_note, ls_coord, ls_finger_attr, ls_entry
this.SelectRow(0, false)
this.SelectRow(row, true)
ii_current_row = row

if xpos > 0 then
	ls_coord = GetItemString(row, "coord")
	if trim(ls_coord) <> "" then 
		wf_rec_move(ls_coord)
	end if
	
	if dwo.name = "b_1" then
		if row < 1 or row > rowcount() then return 0	
		ls_note = GetItemString(row, "note")
		ls_coord = GetItemString(row, "coord")
		ls_finger_attr = GetItemString(row, "finger")
		ls_entry = GetItemString(row, "entry")
		if IsNull(ls_note) then ls_note = "" 
		if IsNull(ls_coord) then ls_coord = "" 
		if IsNull(ls_finger_attr) then ls_finger_attr = ""
		if ls_coord = ""  then
			MessageBox("Error","Coord Is Invalid, Can't Make the entry")
		end if
		if ls_note = ""  then
			MessageBox("Error","Note Is Invalid, Can't Make the entry")
		end if
		if ls_finger_attr = ""  then
			MessageBox("Error","Finger Attr Is Invalid, Can't Make the entry")
		end if
		if ls_coord = "" or ls_note = "" or ls_finger_attr = ""  then
			ls_entry = ""
		else
			ls_entry = wf_make_entry(ls_note, ls_coord, ls_finger_attr)
		end if
		if trim(ls_entry) = "" then
			MessageBox("Error", "Invalid Entry Generated")
		else
			setItem(row, "entry", ls_entry)
		end if	
	end if
end if
end event

event buttonclicked;//string ls_note, ls_coord, ls_finger_attr, ls_entry
//MessageBox("debug", "buttonclicked 1")
//if row < 1 or row > rowcount() then return 0
//MessageBox("debug", "buttonclicked 2")
//
//ls_note = GetItemString(row, "note")
//ls_coord = GetItemString(row, "coord")
//ls_finger_attr = GetItemString(row, "finger")
//ls_entry = GetItemString(row, "entry")
//if IsNull(ls_note) then ls_note = "" 
//if IsNull(ls_coord) then ls_coord = "" 
//if IsNull(ls_finger_attr) then ls_finger_attr = ""
//if ls_coord = ""  then
//	MessageBox("Error","Coord Is Invalid, Can't Make the entry")
//end if
//if ls_note = ""  then
//	MessageBox("Error","Note Is Invalid, Can't Make the entry")
//end if
//if ls_finger_attr = ""  then
//	MessageBox("Error","Finger Attr Is Invalid, Can't Make the entry")
//end if
//
//ls_entry = wf_make_entry(ls_note, ls_coord, ls_finger_attr)
//if trim(ls_entry) = "" then
//	MessageBox("Error", "Invalid Entry Generated")
//else
//	setItem(row, "entry", ls_entry)
//end if
end event

event itemchanged;//ids_1.Reset()
//dw_1.RowsCopy(1, dw_1.RowCount(), Primary!, ids_1, 1, Primary!)
//
end event

